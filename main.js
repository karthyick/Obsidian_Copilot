/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var Ut=Object.defineProperty;var Ku=Object.getOwnPropertyDescriptor;var Ju=Object.getOwnPropertyNames;var Yu=Object.prototype.hasOwnProperty;var Xu=(r,e,t)=>e in r?Ut(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var et=(r,e)=>()=>(r&&(e=r(r=0)),e);var To=(r,e)=>{for(var t in e)Ut(r,t,{get:e[t],enumerable:!0})},Qu=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of Ju(e))!Yu.call(r,s)&&s!==t&&Ut(r,s,{get:()=>e[s],enumerable:!(n=Ku(e,s))||n.enumerable});return r};var Zu=r=>Qu(Ut({},"__esModule",{value:!0}),r);var m=(r,e,t)=>(Xu(r,typeof e!="symbol"?e+"":e,t),t);var U,Qn=et(()=>{U=r=>new TextEncoder().encode(r)});var fe,Jo=et(()=>{Qn();fe=r=>typeof r=="string"?U(r):ArrayBuffer.isView(r)?new Uint8Array(r.buffer,r.byteOffset,r.byteLength/Uint8Array.BYTES_PER_ELEMENT):new Uint8Array(r)});var H,Yo=et(()=>{H=r=>{if(typeof r=="string")return r;if(typeof r!="object"||typeof r.byteOffset!="number"||typeof r.byteLength!="number")throw new Error("@smithy/util-utf8: toUtf8 encoder function only accepts string | Uint8Array.");return new TextDecoder("utf-8").decode(r)}});var z=et(()=>{Qn();Jo();Yo()});var ms,vi=et(()=>{z();ms=class{constructor({marshaller:e,serializer:t,deserializer:n,serdeContext:s,defaultContentType:o}){m(this,"marshaller");m(this,"serializer");m(this,"deserializer");m(this,"serdeContext");m(this,"defaultContentType");this.marshaller=e,this.serializer=t,this.deserializer=n,this.serdeContext=s,this.defaultContentType=o}async serializeEventStream({eventStream:e,requestSchema:t,initialRequest:n}){let s=this.marshaller,o=t.getEventStreamMember(),i=t.getMemberSchema(o),a=this.serializer,c=this.defaultContentType,l=Symbol("initialRequestMarker"),d={async*[Symbol.asyncIterator](){if(n){let u={":event-type":{type:"string",value:"initial-request"},":message-type":{type:"string",value:"event"},":content-type":{type:"string",value:c}};a.write(t,n);let f=a.flush();yield{[l]:!0,headers:u,body:f}}for await(let u of e)yield u}};return s.serialize(d,u=>{var w;if(u[l])return{headers:u.headers,body:u.body};let f=(w=Object.keys(u).find(E=>E!=="__type"))!=null?w:"",{additionalHeaders:h,body:g,eventType:y,explicitPayloadContentType:x}=this.writeEventBody(f,i,u);return{headers:{":event-type":{type:"string",value:y},":message-type":{type:"string",value:"event"},":content-type":{type:"string",value:x!=null?x:c},...h},body:g}})}async deserializeEventStream({response:e,responseSchema:t,initialResponseContainer:n}){var f;let s=this.marshaller,o=t.getEventStreamMember(),a=t.getMemberSchema(o).getMemberSchemas(),c=Symbol("initialResponseMarker"),l=s.deserialize(e.body,async h=>{var x,S,w,E;let g=(x=Object.keys(h).find(b=>b!=="__type"))!=null?x:"",y=h[g].body;if(g==="initial-response"){let b=await this.deserializer.read(t,y);return delete b[o],{[c]:!0,...b}}else if(g in a){let b=a[g];if(b.isStructSchema()){let v={},M=!1;for(let[B,W]of b.structIterator()){let{eventHeader:Be,eventPayload:Ao}=W.getMergedTraits();if(M=M||!!(Be||Ao),Ao)W.isBlobSchema()?v[B]=y:W.isStringSchema()?v[B]=((w=(S=this.serdeContext)==null?void 0:S.utf8Encoder)!=null?w:H)(y):W.isStructSchema()&&(v[B]=await this.deserializer.read(W,y));else if(Be){let Oe=(E=h[g].headers[B])==null?void 0:E.value;Oe!=null&&(W.isNumericSchema()?Oe&&typeof Oe=="object"&&"bytes"in Oe?v[B]=BigInt(Oe.toString()):v[B]=Number(Oe):v[B]=Oe)}}if(M)return{[g]:v}}return{[g]:await this.deserializer.read(b,y)}}else return{$unknown:h}}),d=l[Symbol.asyncIterator](),u=await d.next();if(u.done)return l;if((f=u.value)!=null&&f[c]){if(!t)throw new Error("@smithy::core/protocols - initial-response event encountered in event stream but no response schema given.");for(let[h,g]of Object.entries(u.value))n[h]=g}return{async*[Symbol.asyncIterator](){var h;for((h=u==null?void 0:u.value)!=null&&h[c]||(yield u.value);;){let{done:g,value:y}=await d.next();if(g)break;yield y}}}}writeEventBody(e,t,n){var f,h;let s=this.serializer,o=e,i=null,a,c=t.getSchema()[4].includes(e),l={};if(c){let g=t.getMemberSchema(e);if(g.isStructSchema()){for(let[y,x]of g.structIterator()){let{eventHeader:S,eventPayload:w}=x.getMergedTraits();if(w)i=y;else if(S){let E=n[e][y],b="binary";x.isNumericSchema()?(-2)**31<=E&&E<=2**31-1?b="integer":b="long":x.isTimestampSchema()?b="timestamp":x.isStringSchema()?b="string":x.isBooleanSchema()&&(b="boolean"),E!=null&&(l[y]={type:b,value:E},delete n[e][y])}}if(i!==null){let y=g.getMemberSchema(i);y.isBlobSchema()?a="application/octet-stream":y.isStringSchema()&&(a="text/plain"),s.write(y,n[e][i])}else s.write(g,n[e])}else throw new Error("@smithy/core/event-streams - non-struct member not supported in event stream union.")}else{let[g,y]=n[e];o=g,s.write(15,y)}let d=s.flush();return{body:typeof d=="string"?((h=(f=this.serdeContext)==null?void 0:f.utf8Decoder)!=null?h:U)(d):d,eventType:o,explicitPayloadContentType:a,additionalHeaders:l}}}});var Ci={};To(Ci,{EventStreamSerde:()=>ms});var Ai=et(()=>{vi()});var ub={};To(ub,{default:()=>Kn});module.exports=Zu(ub);var Jn=require("obsidian");var Ro={provider:"bedrock",awsAccessKeyId:"",awsSecretAccessKey:"",awsSessionToken:"",awsRegion:"us-east-1",bedrockModelId:"anthropic.claude-sonnet-4-20250514-v1:0",geminiApiKey:"",geminiModelId:"gemini-1.5-pro",groqApiKey:"",groqModelId:"llama-3.3-70b-versatile",maxTokens:4096,temperature:.7,systemPrompt:"",autoIncludeContext:!0,streamResponses:!0},_o={"anthropic.claude-sonnet-4-20250514-v1:0":"Claude Sonnet 4 (Latest)","anthropic.claude-3-5-sonnet-20241022-v2:0":"Claude 3.5 Sonnet v2","anthropic.claude-3-5-sonnet-20240620-v1:0":"Claude 3.5 Sonnet","anthropic.claude-3-5-haiku-20241022-v1:0":"Claude 3.5 Haiku","anthropic.claude-3-opus-20240229-v1:0":"Claude 3 Opus","anthropic.claude-3-sonnet-20240229-v1:0":"Claude 3 Sonnet","anthropic.claude-3-haiku-20240307-v1:0":"Claude 3 Haiku"},Io={"gemini-1.5-pro":"Gemini 1.5 Pro","gemini-1.5-flash":"Gemini 1.5 Flash","gemini-1.5-flash-8b":"Gemini 1.5 Flash 8B","gemini-2.0-flash-exp":"Gemini 2.0 Flash (Experimental)"},ko={"llama-3.3-70b-versatile":"Llama 3.3 70B Versatile","llama-3.1-70b-versatile":"Llama 3.1 70B Versatile","llama-3.1-8b-instant":"Llama 3.1 8B Instant","llama3-groq-70b-8192-tool-use-preview":"Llama 3 Groq 70B Tool Use","mixtral-8x7b-32768":"Mixtral 8x7B","gemma2-9b-it":"Gemma 2 9B"},Mo={"us-east-1":"US East (N. Virginia)","us-west-2":"US West (Oregon)","eu-west-1":"Europe (Ireland)","eu-central-1":"Europe (Frankfurt)","ap-southeast-1":"Asia Pacific (Singapore)","ap-northeast-1":"Asia Pacific (Tokyo)","ap-south-1":"Asia Pacific (Mumbai)"},be={bedrock:"AWS Bedrock (Claude)",gemini:"Google Gemini",groq:"Groq"},Ne="ai-assistant-view";var A=require("obsidian");var Gt=class extends A.PluginSettingTab{constructor(e,t){super(e,t),this.plugin=t}display(){let{containerEl:e}=this;e.empty(),e.createEl("h1",{text:"AI Assistant Settings"}),this.renderProviderSection(e),this.renderBedrockSettings(e),this.renderGeminiSettings(e),this.renderGroqSettings(e),this.renderCommonSettings(e),this.renderSystemPromptSection(e),this.renderInfoSection(e)}renderProviderSection(e){e.createEl("h2",{text:"AI Provider"}),new A.Setting(e).setName("Active Provider").setDesc("Select which AI provider to use").addDropdown(s=>{for(let[o,i]of Object.entries(be))s.addOption(o,i);s.setValue(this.plugin.settings.provider),s.onChange(async o=>{this.plugin.settings.provider=o,await this.plugin.saveSettings(),this.plugin.reinitializeLLMService(),this.display()})});let t=e.createDiv({cls:"ai-assistant-provider-status"}),n=["bedrock","gemini","groq"];for(let s of n){let o=this.plugin.settings.provider===s,i=this.isProviderConfigured(s),a=t.createSpan({cls:`ai-assistant-status-badge ${o?"active":""} ${i?"configured":"not-configured"}`});a.createSpan({text:be[s]}),a.createSpan({text:i?" \u2713":" \u25CB",cls:"status-icon"})}}isProviderConfigured(e){switch(e){case"bedrock":return!!(this.plugin.settings.awsAccessKeyId&&this.plugin.settings.awsSecretAccessKey);case"gemini":return!!this.plugin.settings.geminiApiKey;case"groq":return!!this.plugin.settings.groqApiKey;default:return!1}}renderBedrockSettings(e){let t=this.plugin.settings.provider==="bedrock",n=e.createDiv({cls:`ai-assistant-provider-section ${t?"active":"inactive"}`});n.createEl("h2",{text:"AWS Bedrock (Claude)"}),t||n.createEl("p",{text:"Switch to AWS Bedrock provider to use these settings.",cls:"setting-item-description"}),new A.Setting(n).setName("AWS Access Key ID").setDesc("Your AWS access key ID").addText(s=>s.setPlaceholder("AKIAIOSFODNN7EXAMPLE").setValue(this.plugin.settings.awsAccessKeyId).onChange(async o=>{this.plugin.settings.awsAccessKeyId=o,await this.plugin.saveSettings()})),new A.Setting(n).setName("AWS Secret Access Key").setDesc("Your AWS secret access key").addText(s=>(s.setPlaceholder("wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY").setValue(this.plugin.settings.awsSecretAccessKey).onChange(async o=>{this.plugin.settings.awsSecretAccessKey=o,await this.plugin.saveSettings()}),s.inputEl.type="password",s)),new A.Setting(n).setName("AWS Session Token (Optional)").setDesc("Session token for temporary credentials").addText(s=>(s.setPlaceholder("Optional session token").setValue(this.plugin.settings.awsSessionToken).onChange(async o=>{this.plugin.settings.awsSessionToken=o,await this.plugin.saveSettings()}),s.inputEl.type="password",s)),new A.Setting(n).setName("AWS Region").setDesc("AWS region where Bedrock is enabled").addDropdown(s=>{for(let[o,i]of Object.entries(Mo))s.addOption(o,i);s.setValue(this.plugin.settings.awsRegion),s.onChange(async o=>{this.plugin.settings.awsRegion=o,await this.plugin.saveSettings(),this.plugin.reinitializeLLMService()})}),new A.Setting(n).setName("Model").setDesc("Select the Claude model to use").addDropdown(s=>{for(let[o,i]of Object.entries(_o))s.addOption(o,i);s.setValue(this.plugin.settings.bedrockModelId),s.onChange(async o=>{this.plugin.settings.bedrockModelId=o,await this.plugin.saveSettings()})}),new A.Setting(n).setName("Test Connection").setDesc("Verify your AWS credentials and model access").addButton(s=>s.setButtonText("Test Connection").setCta().onClick(async()=>{await this.testProviderConnection("bedrock",s)}))}renderGeminiSettings(e){let t=this.plugin.settings.provider==="gemini",n=e.createDiv({cls:`ai-assistant-provider-section ${t?"active":"inactive"}`});n.createEl("h2",{text:"Google Gemini"}),t||n.createEl("p",{text:"Switch to Google Gemini provider to use these settings.",cls:"setting-item-description"}),new A.Setting(n).setName("Gemini API Key").setDesc("Your Google AI Studio API key").addText(i=>(i.setPlaceholder("Enter your Gemini API key").setValue(this.plugin.settings.geminiApiKey).onChange(async a=>{this.plugin.settings.geminiApiKey=a,await this.plugin.saveSettings()}),i.inputEl.type="password",i)),new A.Setting(n).setName("Model").setDesc("Select the Gemini model to use").addDropdown(i=>{for(let[a,c]of Object.entries(Io))i.addOption(a,c);i.setValue(this.plugin.settings.geminiModelId),i.onChange(async a=>{this.plugin.settings.geminiModelId=a,await this.plugin.saveSettings()})}),new A.Setting(n).setName("Test Connection").setDesc("Verify your Gemini API key").addButton(i=>i.setButtonText("Test Connection").setCta().onClick(async()=>{await this.testProviderConnection("gemini",i)})),n.createDiv({cls:"ai-assistant-link"}).createEl("a",{text:"Get a Gemini API key from Google AI Studio",href:"https://aistudio.google.com/app/apikey"}).setAttr("target","_blank")}renderGroqSettings(e){let t=this.plugin.settings.provider==="groq",n=e.createDiv({cls:`ai-assistant-provider-section ${t?"active":"inactive"}`});n.createEl("h2",{text:"Groq"}),t||n.createEl("p",{text:"Switch to Groq provider to use these settings.",cls:"setting-item-description"}),new A.Setting(n).setName("Groq API Key").setDesc("Your Groq API key").addText(i=>(i.setPlaceholder("Enter your Groq API key").setValue(this.plugin.settings.groqApiKey).onChange(async a=>{this.plugin.settings.groqApiKey=a,await this.plugin.saveSettings()}),i.inputEl.type="password",i)),new A.Setting(n).setName("Model").setDesc("Select the Groq model to use").addDropdown(i=>{for(let[a,c]of Object.entries(ko))i.addOption(a,c);i.setValue(this.plugin.settings.groqModelId),i.onChange(async a=>{this.plugin.settings.groqModelId=a,await this.plugin.saveSettings()})}),new A.Setting(n).setName("Test Connection").setDesc("Verify your Groq API key").addButton(i=>i.setButtonText("Test Connection").setCta().onClick(async()=>{await this.testProviderConnection("groq",i)})),n.createDiv({cls:"ai-assistant-link"}).createEl("a",{text:"Get a Groq API key from GroqCloud",href:"https://console.groq.com/keys"}).setAttr("target","_blank")}async testProviderConnection(e,t){t.setDisabled(!0),t.setButtonText("Testing...");try{let n=await this.plugin.testProviderConnection(e);n.success?new A.Notice(`\u2713 ${be[e]} connection successful!`):new A.Notice(`\u2717 ${be[e]} failed: ${n.message}`)}catch(n){new A.Notice(`\u2717 Error: ${n instanceof Error?n.message:"Unknown error"}`)}finally{t.setDisabled(!1),t.setButtonText("Test Connection")}}renderCommonSettings(e){e.createEl("h2",{text:"Generation Settings"}),new A.Setting(e).setName("Max Tokens").setDesc("Maximum number of tokens in the response (256-4096)").addSlider(t=>t.setLimits(256,4096,256).setValue(this.plugin.settings.maxTokens).setDynamicTooltip().onChange(async n=>{this.plugin.settings.maxTokens=n,await this.plugin.saveSettings()})),new A.Setting(e).setName("Temperature").setDesc("Response creativity (0 = focused, 1 = creative)").addSlider(t=>t.setLimits(0,1,.1).setValue(this.plugin.settings.temperature).setDynamicTooltip().onChange(async n=>{this.plugin.settings.temperature=n,await this.plugin.saveSettings()})),e.createEl("h2",{text:"Behavior"}),new A.Setting(e).setName("Auto-include Note Context").setDesc("Automatically include the active note content in AI requests").addToggle(t=>t.setValue(this.plugin.settings.autoIncludeContext).onChange(async n=>{this.plugin.settings.autoIncludeContext=n,await this.plugin.saveSettings()})),new A.Setting(e).setName("Stream Responses").setDesc("Show AI responses in real-time as they are generated").addToggle(t=>t.setValue(this.plugin.settings.streamResponses).onChange(async n=>{this.plugin.settings.streamResponses=n,await this.plugin.saveSettings()}))}renderSystemPromptSection(e){e.createEl("h2",{text:"System Prompt"}),e.createEl("p",{text:"Customize the AI's behavior and capabilities. Leave empty to use the default prompt.",cls:"setting-item-description"}),new A.Setting(e).setName("Custom System Prompt").setDesc("Override the default system prompt (optional)").addTextArea(t=>(t.setPlaceholder("Leave empty for default prompt...").setValue(this.plugin.settings.systemPrompt).onChange(async n=>{this.plugin.settings.systemPrompt=n,await this.plugin.saveSettings()}),t.inputEl.rows=10,t.inputEl.cols=50,t.inputEl.style.width="100%",t.inputEl.style.minHeight="200px",t)),new A.Setting(e).setName("Reset System Prompt").setDesc("Reset to the default system prompt").addButton(t=>t.setButtonText("Reset to Default").setWarning().onClick(async()=>{this.plugin.settings.systemPrompt="",await this.plugin.saveSettings(),this.display(),new A.Notice("System prompt reset to default")}))}renderInfoSection(e){e.createEl("h2",{text:"Information"});let t=e.createDiv({cls:"ai-assistant-info"});t.createEl("p",{text:"This plugin supports multiple AI providers. Configure at least one provider to start using the AI Assistant."});let n=t.createEl("ul");n.createEl("li",{text:"AWS Bedrock: Requires AWS account with Bedrock access and Claude models enabled"}),n.createEl("li",{text:"Google Gemini: Requires Google AI Studio API key (free tier available)"}),n.createEl("li",{text:"Groq: Requires Groq API key (free tier available with rate limits)"})}};function Yn(r){let e=[];switch(r.provider){case"bedrock":r.awsAccessKeyId||e.push("AWS Access Key ID is required"),r.awsSecretAccessKey||e.push("AWS Secret Access Key is required"),r.awsRegion||e.push("AWS Region is required"),r.bedrockModelId||e.push("Bedrock Model is required");break;case"gemini":r.geminiApiKey||e.push("Gemini API Key is required"),r.geminiModelId||e.push("Gemini Model is required");break;case"groq":r.groqApiKey||e.push("Groq API Key is required"),r.groqModelId||e.push("Groq Model is required");break}return{valid:e.length===0,errors:e}}function Po(r){let e=r.signer,t=r.signer,n=Object.assign(r,{eventSigner:e,messageSigner:t}),s=n.eventStreamPayloadHandlerProvider(n);return Object.assign(n,{eventStreamPayloadHandler:s})}var Do=r=>({setHttpHandler(e){r.httpHandler=e},httpHandler(){return r.httpHandler},updateHttpClientConfig(e,t){var n;(n=r.httpHandler)==null||n.updateHttpClientConfig(e,t)},httpHandlerConfigs(){return r.httpHandler.httpHandlerConfigs()}}),Bo=r=>({httpHandler:r.httpHandler()});var tt;(function(r){r.HTTP="http",r.HTTPS="https"})(tt||(tt={}));var rt;(function(r){r.MD5="md5",r.CRC32="crc32",r.CRC32C="crc32c",r.SHA1="sha1",r.SHA256="sha256"})(rt||(rt={}));var wt="__smithy_context";var R=class r{constructor(e){m(this,"method");m(this,"protocol");m(this,"hostname");m(this,"port");m(this,"path");m(this,"query");m(this,"headers");m(this,"username");m(this,"password");m(this,"fragment");m(this,"body");this.method=e.method||"GET",this.hostname=e.hostname||"localhost",this.port=e.port,this.query=e.query||{},this.headers=e.headers||{},this.body=e.body,this.protocol=e.protocol?e.protocol.slice(-1)!==":"?`${e.protocol}:`:e.protocol:"https:",this.path=e.path?e.path.charAt(0)!=="/"?`/${e.path}`:e.path:"/",this.username=e.username,this.password=e.password,this.fragment=e.fragment}static clone(e){let t=new r({...e,headers:{...e.headers}});return t.query&&(t.query=ed(t.query)),t}static isInstance(e){if(!e)return!1;let t=e;return"method"in t&&"protocol"in t&&"hostname"in t&&"path"in t&&typeof t.query=="object"&&typeof t.headers=="object"}clone(){return r.clone(this)}};function ed(r){return Object.keys(r).reduce((e,t)=>{let n=r[t];return{...e,[t]:Array.isArray(n)?[...n]:n}},{})}var $=class{constructor(e){m(this,"statusCode");m(this,"reason");m(this,"headers");m(this,"body");this.statusCode=e.statusCode,this.reason=e.reason,this.headers=e.headers||{},this.body=e.body}static isInstance(e){if(!e)return!1;let t=e;return typeof t.statusCode=="number"&&typeof t.headers=="object"}};var td=r=>e=>async t=>{if(!R.isInstance(t.request))return e(t);let{request:n}=t,{handlerProtocol:s=""}=r.requestHandler.metadata||{};if(s.indexOf("h2")>=0&&!n.headers[":authority"])delete n.headers.host,n.headers[":authority"]=n.hostname+(n.port?":"+n.port:"");else if(!n.headers.host){let o=n.hostname;n.port!=null&&(o+=`:${n.port}`),n.headers.host=o}return e(t)},rd={name:"hostHeaderMiddleware",step:"build",priority:"low",tags:["HOST"],override:!0},Oo=r=>({applyToStack:e=>{e.add(td(r),rd)}});var nd=()=>(r,e)=>async t=>{var n,s;try{let o=await r(t),{clientName:i,commandName:a,logger:c,dynamoDbDocumentClientOptions:l={}}=e,{overrideInputFilterSensitiveLog:d,overrideOutputFilterSensitiveLog:u}=l,f=d!=null?d:e.inputFilterSensitiveLog,h=u!=null?u:e.outputFilterSensitiveLog,{$metadata:g,...y}=o.output;return(n=c==null?void 0:c.info)==null||n.call(c,{clientName:i,commandName:a,input:f(t.input),output:h(y),metadata:g}),o}catch(o){let{clientName:i,commandName:a,logger:c,dynamoDbDocumentClientOptions:l={}}=e,{overrideInputFilterSensitiveLog:d}=l,u=d!=null?d:e.inputFilterSensitiveLog;throw(s=c==null?void 0:c.error)==null||s.call(c,{clientName:i,commandName:a,input:u(t.input),error:o,metadata:o.$metadata}),o}},sd={name:"loggerMiddleware",tags:["LOGGER"],step:"initialize",override:!0},No=r=>({applyToStack:e=>{e.add(nd(),sd)}});var Lo={step:"build",tags:["RECURSION_DETECTION"],name:"recursionDetectionMiddleware",override:!0,priority:"low"};var $o=()=>r=>async e=>r(e);var Uo=r=>({applyToStack:e=>{e.add($o(),Lo)}});var J=r=>r[wt]||(r[wt]={});var K=r=>{if(typeof r=="function")return r;let e=Promise.resolve(r);return()=>e};var Go=(r,e)=>{if(!e||e.length===0)return r;let t=[];for(let n of e)for(let s of r)s.schemeId.split("#")[1]===n&&t.push(s);for(let n of r)t.find(({schemeId:s})=>s===n.schemeId)||t.push(n);return t};function od(r){let e=new Map;for(let t of r)e.set(t.schemeId,t);return e}var Fo=(r,e)=>(t,n)=>async s=>{var u;let o=r.httpAuthSchemeProvider(await e.httpAuthSchemeParametersProvider(r,n,s.input)),i=r.authSchemePreference?await r.authSchemePreference():[],a=Go(o,i),c=od(r.httpAuthSchemes),l=J(n),d=[];for(let f of a){let h=c.get(f.schemeId);if(!h){d.push(`HttpAuthScheme \`${f.schemeId}\` was not enabled for this service.`);continue}let g=h.identityProvider(await e.identityProviderConfigProvider(r));if(!g){d.push(`HttpAuthScheme \`${f.schemeId}\` did not have an IdentityProvider configured.`);continue}let{identityProperties:y={},signingProperties:x={}}=((u=f.propertiesExtractor)==null?void 0:u.call(f,r,n))||{};f.identityProperties=Object.assign(f.identityProperties||{},y),f.signingProperties=Object.assign(f.signingProperties||{},x),l.selectedHttpAuthScheme={httpAuthOption:f,identity:await g(f.identityProperties),signer:h.signer};break}if(!l.selectedHttpAuthScheme)throw new Error(d.join(`
`));return t(s)};var id={step:"serialize",tags:["HTTP_AUTH_SCHEME"],name:"httpAuthSchemeMiddleware",override:!0,relation:"before",toMiddleware:"endpointV2Middleware"},Ho=(r,{httpAuthSchemeParametersProvider:e,identityProviderConfigProvider:t})=>({applyToStack:n=>{n.addRelativeTo(Fo(r,{httpAuthSchemeParametersProvider:e,identityProviderConfigProvider:t}),id)}});var zo={name:"serializerMiddleware",step:"serialize",tags:["SERIALIZER"],override:!0};var ad=r=>e=>{throw e},cd=(r,e)=>{},qo=r=>(e,t)=>async n=>{if(!R.isInstance(n.request))return e(n);let o=J(t).selectedHttpAuthScheme;if(!o)throw new Error("No HttpAuthScheme was selected: unable to sign request");let{httpAuthOption:{signingProperties:i={}},identity:a,signer:c}=o,l=await e({...n,request:await c.sign(n.request,a,i)}).catch((c.errorHandler||ad)(i));return(c.successHandler||cd)(l.response,i),l};var ld={step:"finalizeRequest",tags:["HTTP_SIGNING"],name:"httpSigningMiddleware",aliases:["apiKeyMiddleware","tokenMiddleware","awsAuthMiddleware"],override:!0,relation:"after",toMiddleware:"retryMiddleware"},jo=r=>({applyToStack:e=>{e.addRelativeTo(qo(r),ld)}});var Le=r=>{if(typeof r=="function")return r;let e=Promise.resolve(r);return()=>e};var Vo="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Xn=Object.entries(Vo).reduce((r,[e,t])=>(r[t]=Number(e),r),{}),Wo=Vo.split(""),Ee=6,$e=8,Ko=63;var re=r=>{let e=r.length/4*3;r.slice(-2)==="=="?e-=2:r.slice(-1)==="="&&e--;let t=new ArrayBuffer(e),n=new DataView(t);for(let s=0;s<r.length;s+=4){let o=0,i=0;for(let l=s,d=s+3;l<=d;l++)if(r[l]!=="="){if(!(r[l]in Xn))throw new TypeError(`Invalid character ${r[l]} in base64 string.`);o|=Xn[r[l]]<<(d-l)*Ee,i+=Ee}else o>>=Ee;let a=s/4*3;o>>=i%$e;let c=Math.floor(i/$e);for(let l=0;l<c;l++){let d=(c-l-1)*$e;n.setUint8(a+l,(o&255<<d)>>d)}}return new Uint8Array(t)};z();function Y(r){let e;typeof r=="string"?e=U(r):e=r;let t=typeof e=="object"&&typeof e.length=="number",n=typeof e=="object"&&typeof e.byteOffset=="number"&&typeof e.byteLength=="number";if(!t&&!n)throw new Error("@smithy/util-base64: toBase64 encoder function only accepts string | Uint8Array.");let s="";for(let o=0;o<e.length;o+=3){let i=0,a=0;for(let l=o,d=Math.min(o+3,e.length);l<d;l++)i|=e[l]<<(d-l-1)*$e,a+=$e;let c=Math.ceil(a/Ee);i<<=c*Ee-a;for(let l=1;l<=c;l++){let d=(c-l)*Ee;s+=Wo[(i&Ko<<d)>>d]}s+="==".slice(0,4-c)}return s}z();var nt=class r extends Uint8Array{static fromString(e,t="utf-8"){if(typeof e=="string")return t==="base64"?r.mutate(re(e)):r.mutate(U(e));throw new Error(`Unsupported conversion from ${typeof e} to Uint8ArrayBlobAdapter.`)}static mutate(e){return Object.setPrototypeOf(e,r.prototype),e}transformToString(e="utf-8"){return e==="base64"?Y(this):H(this)}};var Zn=r=>{var e;return typeof ReadableStream=="function"&&(((e=r==null?void 0:r.constructor)==null?void 0:e.name)===ReadableStream.name||r instanceof ReadableStream)};var ie=r=>encodeURIComponent(r).replace(/[!'()*]/g,ud),ud=r=>`%${r.charCodeAt(0).toString(16).toUpperCase()}`;function Ft(r){let e=[];for(let t of Object.keys(r).sort()){let n=r[t];if(t=ie(t),Array.isArray(n))for(let s=0,o=n.length;s<o;s++)e.push(`${t}=${ie(n[s])}`);else{let s=t;(n||typeof n=="string")&&(s+=`=${ie(n)}`),e.push(s)}}return e.join("&")}function es(r,e){return new Request(r,e)}function Xo(r=0){return new Promise((e,t)=>{r&&setTimeout(()=>{let n=new Error(`Request did not complete within ${r} ms`);n.name="TimeoutError",t(n)},r)})}var ts={supported:void 0},Ue=class r{constructor(e){m(this,"config");m(this,"configProvider");typeof e=="function"?this.configProvider=e().then(t=>t||{}):(this.config=e!=null?e:{},this.configProvider=Promise.resolve(this.config)),ts.supported===void 0&&(ts.supported=typeof Request!="undefined"&&"keepalive"in es("https://[::1]"))}static create(e){return typeof(e==null?void 0:e.handle)=="function"?e:new r(e)}destroy(){}async handle(e,{abortSignal:t,requestTimeout:n}={}){var w,E,b;this.config||(this.config=await this.configProvider);let s=n!=null?n:this.config.requestTimeout,o=this.config.keepAlive===!0,i=this.config.credentials;if(t!=null&&t.aborted){let v=new Error("Request aborted");return v.name="AbortError",Promise.reject(v)}let a=e.path,c=Ft(e.query||{});c&&(a+=`?${c}`),e.fragment&&(a+=`#${e.fragment}`);let l="";if(e.username!=null||e.password!=null){let v=(w=e.username)!=null?w:"",M=(E=e.password)!=null?E:"";l=`${v}:${M}@`}let{port:d,method:u}=e,f=`${e.protocol}//${l}${e.hostname}${d?`:${d}`:""}${a}`,h=u==="GET"||u==="HEAD"?void 0:e.body,g={body:h,headers:new Headers(e.headers),method:u,credentials:i};(b=this.config)!=null&&b.cache&&(g.cache=this.config.cache),h&&(g.duplex="half"),typeof AbortController!="undefined"&&(g.signal=t),ts.supported&&(g.keepalive=o),typeof this.config.requestInit=="function"&&Object.assign(g,this.config.requestInit(e));let y=()=>{},x=es(f,g),S=[fetch(x).then(v=>{let M=v.headers,B={};for(let Be of M.entries())B[Be[0]]=Be[1];return v.body!=null?{response:new $({headers:B,reason:v.statusText,statusCode:v.status,body:v.body})}:v.blob().then(Be=>({response:new $({headers:B,reason:v.statusText,statusCode:v.status,body:Be})}))}),Xo(s)];return t&&S.push(new Promise((v,M)=>{let B=()=>{let W=new Error("Request aborted");W.name="AbortError",M(W)};if(typeof t.addEventListener=="function"){let W=t;W.addEventListener("abort",B,{once:!0}),y=()=>W.removeEventListener("abort",B)}else t.onabort=B})),Promise.race(S).finally(y)}updateHttpClientConfig(e,t){this.config=void 0,this.configProvider=this.configProvider.then(n=>(n[e]=t,n))}httpHandlerConfigs(){var e;return(e=this.config)!=null?e:{}}};var Ht=async r=>{var e;return typeof Blob=="function"&&r instanceof Blob||((e=r.constructor)==null?void 0:e.name)==="Blob"?Blob.prototype.arrayBuffer!==void 0?new Uint8Array(await r.arrayBuffer()):dd(r):pd(r)};async function dd(r){let e=await md(r),t=re(e);return new Uint8Array(t)}async function pd(r){let e=[],t=r.getReader(),n=!1,s=0;for(;!n;){let{done:a,value:c}=await t.read();c&&(e.push(c),s+=c.length),n=a}let o=new Uint8Array(s),i=0;for(let a of e)o.set(a,i),i+=a.length;return o}function md(r){return new Promise((e,t)=>{let n=new FileReader;n.onloadend=()=>{var a;if(n.readyState!==2)return t(new Error("Reader aborted too early"));let s=(a=n.result)!=null?a:"",o=s.indexOf(","),i=o>-1?o+1:s.length;e(s.substring(i))},n.onabort=()=>t(new Error("Read aborted")),n.onerror=()=>t(n.error),n.readAsDataURL(r)})}var Qo={},rs={};for(let r=0;r<256;r++){let e=r.toString(16).toLowerCase();e.length===1&&(e=`0${e}`),Qo[r]=e,rs[e]=r}function st(r){if(r.length%2!==0)throw new Error("Hex encoded strings must have an even number length");let e=new Uint8Array(r.length/2);for(let t=0;t<r.length;t+=2){let n=r.slice(t,t+2).toLowerCase();if(n in rs)e[t/2]=rs[n];else throw new Error(`Cannot decode unrecognized sequence ${n} as hexadecimal`)}return e}function I(r){let e="";for(let t=0;t<r.byteLength;t++)e+=Qo[r[t]];return e}z();var Zo="The stream has already been transformed.",ti=r=>{var s,o;if(!ei(r)&&!Zn(r)){let i=((o=(s=r==null?void 0:r.__proto__)==null?void 0:s.constructor)==null?void 0:o.name)||r;throw new Error(`Unexpected stream implementation, expect Blob or ReadableStream, got ${i}`)}let e=!1,t=async()=>{if(e)throw new Error(Zo);return e=!0,await Ht(r)},n=i=>{if(typeof i.stream!="function")throw new Error(`Cannot transform payload Blob to web stream. Please make sure the Blob.stream() is polyfilled.
If you are using React Native, this API is not yet supported, see: https://react-native.canny.io/feature-requests/p/fetch-streaming-body`);return i.stream()};return Object.assign(r,{transformToByteArray:t,transformToString:async i=>{let a=await t();if(i==="base64")return Y(a);if(i==="hex")return I(a);if(i===void 0||i==="utf8"||i==="utf-8")return H(a);if(typeof TextDecoder=="function")return new TextDecoder(i).decode(a);throw new Error("TextDecoder is not available, please make sure polyfill is provided.")},transformToWebStream:()=>{if(e)throw new Error(Zo);if(e=!0,ei(r))return n(r);if(Zn(r))return r;throw new Error(`Cannot transform payload to web stream, got ${r}`)}})},ei=r=>typeof Blob=="function"&&r instanceof Blob;var ve=async(r=new Uint8Array,e)=>{if(r instanceof Uint8Array)return nt.mutate(r);if(!r)return nt.mutate(new Uint8Array);let t=e.streamCollector(r);return nt.mutate(await t)};function ns(r){return encodeURIComponent(r).replace(/[!'()*]/g,function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()})}var zt=r=>typeof r=="function"?r():r;var qt=(r,e,t,n,s)=>({name:e,namespace:r,traits:t,input:n,output:s});var ri=r=>(e,t)=>async n=>{var u,f,h,g;let{response:s}=await e(n),{operationSchema:o}=J(t),[,i,a,c,l,d]=o!=null?o:[];try{let y=await r.protocol.deserializeResponse(qt(i,a,c,l,d),{...r,...t},s);return{response:s,output:y}}catch(y){if(Object.defineProperty(y,"$response",{value:s,enumerable:!1,writable:!1,configurable:!1}),!("$metadata"in y)){let x="Deserialization error: to see the raw response, inspect the hidden field {error}.$response on this object.";try{y.message+=`
  `+x}catch(S){!t.logger||((f=(u=t.logger)==null?void 0:u.constructor)==null?void 0:f.name)==="NoOpLogger"?console.warn(x):(g=(h=t.logger)==null?void 0:h.warn)==null||g.call(h,x)}typeof y.$responseBodyText!="undefined"&&y.$response&&(y.$response.body=y.$responseBodyText);try{if($.isInstance(s)){let{headers:S={}}=s,w=Object.entries(S);y.$metadata={httpStatusCode:s.statusCode,requestId:ss(/^x-[\w-]+-request-?id$/,w),extendedRequestId:ss(/^x-[\w-]+-id-2$/,w),cfId:ss(/^x-[\w-]+-cf-id$/,w)}}}catch(S){}}throw y}},ss=(r,e)=>(e.find(([t])=>t.match(r))||[void 0,void 0])[1];var ni=r=>(e,t)=>async n=>{var f;let{operationSchema:s}=J(t),[,o,i,a,c,l]=s!=null?s:[],d=(f=t.endpointV2)!=null&&f.url&&r.urlParser?async()=>r.urlParser(t.endpointV2.url):r.endpoint,u=await r.protocol.serializeRequest(qt(o,i,a,c,l),n.input,{...r,...t,endpoint:d});return e({...n,request:u})};var fd={name:"deserializerMiddleware",step:"deserialize",tags:["DESERIALIZER"],override:!0},hd={name:"serializerMiddleware",step:"serialize",tags:["SERIALIZER"],override:!0};function si(r){return{applyToStack:e=>{e.add(ni(r),hd),e.add(ri(r),fd),r.protocol.setSerdeContext(r)}}}function he(r){if(typeof r=="object")return r;r=r|0;let e={},t=0;for(let n of["httpLabel","idempotent","idempotencyToken","sensitive","httpPayload","httpResponseCode","httpQueryParams"])(r>>t++&1)===1&&(e[n]=1);return e}var Ce=class Ce{constructor(e,t){m(this,"ref");m(this,"memberName");m(this,"symbol",Ce.symbol);m(this,"name");m(this,"schema");m(this,"_isMemberSchema");m(this,"traits");m(this,"memberTraits");m(this,"normalizedTraits");var i;this.ref=e,this.memberName=t;let n=[],s=e,o=e;for(this._isMemberSchema=!1;os(s);)n.push(s[1]),s=s[0],o=zt(s),this._isMemberSchema=!0;if(n.length>0){this.memberTraits={};for(let a=n.length-1;a>=0;--a){let c=n[a];Object.assign(this.memberTraits,he(c))}}else this.memberTraits=0;if(o instanceof Ce){let a=this.memberTraits;Object.assign(this,o),this.memberTraits=Object.assign({},a,o.getMemberTraits(),this.getMemberTraits()),this.normalizedTraits=void 0,this.memberName=t!=null?t:o.memberName;return}if(this.schema=zt(o),gd(this.schema)?(this.name=`${this.schema[1]}#${this.schema[2]}`,this.traits=this.schema[3]):(this.name=(i=this.memberName)!=null?i:String(o),this.traits=0),this._isMemberSchema&&!t)throw new Error(`@smithy/core/schema - NormalizedSchema member init ${this.getName(!0)} missing member name.`)}static[Symbol.hasInstance](e){let t=this.prototype.isPrototypeOf(e);return!t&&typeof e=="object"&&e!==null?e.symbol===this.symbol:t}static of(e){let t=zt(e);if(t instanceof Ce)return t;if(os(t)){let[n,s]=t;if(n instanceof Ce)return Object.assign(n.getMergedTraits(),he(s)),n;throw new Error(`@smithy/core/schema - may not init unwrapped member schema=${JSON.stringify(e,null,2)}.`)}return new Ce(t)}getSchema(){let e=this.schema;return e[0]===0?e[4]:e}getName(e=!1){let{name:t}=this;return!e&&t&&t.includes("#")?t.split("#")[1]:t||void 0}getMemberName(){return this.memberName}isMemberSchema(){return this._isMemberSchema}isListSchema(){let e=this.getSchema();return typeof e=="number"?e>=64&&e<128:e[0]===1}isMapSchema(){let e=this.getSchema();return typeof e=="number"?e>=128&&e<=255:e[0]===2}isStructSchema(){let e=this.getSchema();return e[0]===3||e[0]===-3}isBlobSchema(){let e=this.getSchema();return e===21||e===42}isTimestampSchema(){let e=this.getSchema();return typeof e=="number"&&e>=4&&e<=7}isUnitSchema(){return this.getSchema()==="unit"}isDocumentSchema(){return this.getSchema()===15}isStringSchema(){return this.getSchema()===0}isBooleanSchema(){return this.getSchema()===2}isNumericSchema(){return this.getSchema()===1}isBigIntegerSchema(){return this.getSchema()===17}isBigDecimalSchema(){return this.getSchema()===19}isStreaming(){let{streaming:e}=this.getMergedTraits();return!!e||this.getSchema()===42}isIdempotencyToken(){let e=o=>(o&4)===4||!!(o!=null&&o.idempotencyToken),{normalizedTraits:t,traits:n,memberTraits:s}=this;return e(t)||e(n)||e(s)}getMergedTraits(){var e;return(e=this.normalizedTraits)!=null?e:this.normalizedTraits={...this.getOwnTraits(),...this.getMemberTraits()}}getMemberTraits(){return he(this.memberTraits)}getOwnTraits(){return he(this.traits)}getKeySchema(){var o;let[e,t]=[this.isDocumentSchema(),this.isMapSchema()];if(!e&&!t)throw new Error(`@smithy/core/schema - cannot get key for non-map: ${this.getName(!0)}`);let n=this.getSchema(),s=e?15:(o=n[4])!=null?o:0;return bt([s,0],"key")}getValueSchema(){let e=this.getSchema(),[t,n,s]=[this.isDocumentSchema(),this.isMapSchema(),this.isListSchema()],o=typeof e=="number"?63&e:e&&typeof e=="object"&&(n||s)?e[3+e[0]]:t?15:void 0;if(o!=null)return bt([o,0],n?"value":"member");throw new Error(`@smithy/core/schema - ${this.getName(!0)} has no value member.`)}getMemberSchema(e){let t=this.getSchema();if(this.isStructSchema()&&t[4].includes(e)){let n=t[4].indexOf(e),s=t[5][n];return bt(os(s)?s:[s,0],e)}if(this.isDocumentSchema())return bt([15,0],e);throw new Error(`@smithy/core/schema - ${this.getName(!0)} has no no member=${e}.`)}getMemberSchemas(){let e={};try{for(let[t,n]of this.structIterator())e[t]=n}catch(t){}return e}getEventStreamMember(){if(this.isStructSchema()){for(let[e,t]of this.structIterator())if(t.isStreaming()&&t.isStructSchema())return e}return""}*structIterator(){if(this.isUnitSchema())return;if(!this.isStructSchema())throw new Error("@smithy/core/schema - cannot iterate non-struct schema.");let e=this.getSchema();for(let t=0;t<e[4].length;++t)yield[e[4][t],bt([e[5][t],0],e[4][t])]}};m(Ce,"symbol",Symbol.for("@smithy/nor"));var C=Ce;function bt(r,e){if(r instanceof C)return Object.assign(r,{memberName:e,_isMemberSchema:!0});let t=C;return new t(r,e)}var os=r=>Array.isArray(r)&&r.length===2,gd=r=>Array.isArray(r)&&r.length>=5;var ae=class ae{constructor(e,t=new Map,n=new Map){m(this,"namespace");m(this,"schemas");m(this,"exceptions");this.namespace=e,this.schemas=t,this.exceptions=n}static for(e){return ae.registries.has(e)||ae.registries.set(e,new ae(e)),ae.registries.get(e)}register(e,t){let n=this.normalizeShapeId(e);ae.for(n.split("#")[0]).schemas.set(n,t)}getSchema(e){let t=this.normalizeShapeId(e);if(!this.schemas.has(t))throw new Error(`@smithy/core/schema - schema not found for ${t}`);return this.schemas.get(t)}registerError(e,t){let n=e,s=ae.for(n[1]);s.schemas.set(n[1]+"#"+n[2],n),s.exceptions.set(n,t)}getErrorCtor(e){let t=e;return ae.for(t[1]).exceptions.get(t)}getBaseException(){for(let e of this.exceptions.keys())if(Array.isArray(e)){let[,t,n]=e,s=t+"#"+n;if(s.startsWith("smithy.ts.sdk.synthetic.")&&s.endsWith("ServiceException"))return e}}find(e){return[...this.schemas.values()].find(e)}clear(){this.schemas.clear(),this.exceptions.clear()}normalizeShapeId(e){return e.includes("#")?e:this.namespace+"#"+e}};m(ae,"registries",new Map);var k=ae;var is=r=>{if(r!=null){if(typeof r=="string"){let e=parseFloat(r);if(!Number.isNaN(e))return String(e)!==String(r)&&Ed.warn(bd(`Expected number but observed string: ${r}`)),e}if(typeof r=="number")return r;throw new TypeError(`Expected number, got ${typeof r}: ${r}`)}},yd=Math.ceil(34028234663852886e22),oi=r=>{let e=is(r);if(e!==void 0&&!Number.isNaN(e)&&e!==1/0&&e!==-1/0&&Math.abs(e)>yd)throw new TypeError(`Expected 32-bit float, got ${r}`);return e},xd=r=>{if(r!=null){if(Number.isInteger(r)&&!Number.isNaN(r))return r;throw new TypeError(`Expected integer, got ${typeof r}: ${r}`)}};var ii=r=>ci(r,16),ai=r=>ci(r,8),ci=(r,e)=>{let t=xd(r);if(t!==void 0&&Sd(t,e)!==t)throw new TypeError(`Expected ${e}-bit integer, got ${r}`);return t},Sd=(r,e)=>{switch(e){case 32:return Int32Array.of(r)[0];case 16:return Int16Array.of(r)[0];case 8:return Int8Array.of(r)[0]}};var li=r=>is(typeof r=="string"?jt(r):r);var ui=r=>oi(typeof r=="string"?jt(r):r),wd=/(-?(?:0|[1-9]\d*)(?:\.\d+)?(?:[eE][+-]?\d+)?)|(-?Infinity)|(NaN)/g,jt=r=>{let e=r.match(wd);if(e===null||e[0].length!==r.length)throw new TypeError("Expected real number, got implicit NaN");return parseFloat(r)};var Et=r=>ii(typeof r=="string"?jt(r):r),di=r=>ai(typeof r=="string"?jt(r):r),bd=r=>String(new TypeError(r).stack||r).split(`
`).slice(0,5).filter(e=>!e.includes("stackTraceWarning")).join(`
`),Ed={warn:console.warn};var vd=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],cs=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function Wt(r){let e=r.getUTCFullYear(),t=r.getUTCMonth(),n=r.getUTCDay(),s=r.getUTCDate(),o=r.getUTCHours(),i=r.getUTCMinutes(),a=r.getUTCSeconds(),c=s<10?`0${s}`:`${s}`,l=o<10?`0${o}`:`${o}`,d=i<10?`0${i}`:`${i}`,u=a<10?`0${a}`:`${a}`;return`${vd[n]}, ${c} ${cs[t]} ${e} ${l}:${d}:${u} GMT`}var lv=new RegExp(/^(\d{4})-(\d{2})-(\d{2})[tT](\d{2}):(\d{2}):(\d{2})(?:\.(\d+))?[zZ]$/);var Cd=new RegExp(/^(\d{4})-(\d{2})-(\d{2})[tT](\d{2}):(\d{2}):(\d{2})(?:\.(\d+))?(([-+]\d{2}\:\d{2})|[zZ])$/),pi=r=>{if(r==null)return;if(typeof r!="string")throw new TypeError("RFC-3339 date-times must be expressed as strings");let e=Cd.exec(r);if(!e)throw new TypeError("Invalid RFC-3339 date-time value");let[t,n,s,o,i,a,c,l,d]=e,u=Et(vt(n)),f=Ae(s,"month",1,12),h=Ae(o,"day",1,31),g=Vt(u,f,h,{hours:i,minutes:a,seconds:c,fractionalMilliseconds:l});return d.toUpperCase()!="Z"&&g.setTime(g.getTime()-Od(d)),g},Ad=new RegExp(/^(?:Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d{2}) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d{1,2}):(\d{2}):(\d{2})(?:\.(\d+))? GMT$/),Td=new RegExp(/^(?:Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday), (\d{2})-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d{2}) (\d{1,2}):(\d{2}):(\d{2})(?:\.(\d+))? GMT$/),Rd=new RegExp(/^(?:Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( [1-9]|\d{2}) (\d{1,2}):(\d{2}):(\d{2})(?:\.(\d+))? (\d{4})$/),mi=r=>{if(r==null)return;if(typeof r!="string")throw new TypeError("RFC-7231 date-times must be expressed as strings");let e=Ad.exec(r);if(e){let[t,n,s,o,i,a,c,l]=e;return Vt(Et(vt(o)),as(s),Ae(n,"day",1,31),{hours:i,minutes:a,seconds:c,fractionalMilliseconds:l})}if(e=Td.exec(r),e){let[t,n,s,o,i,a,c,l]=e;return kd(Vt(_d(o),as(s),Ae(n,"day",1,31),{hours:i,minutes:a,seconds:c,fractionalMilliseconds:l}))}if(e=Rd.exec(r),e){let[t,n,s,o,i,a,c,l]=e;return Vt(Et(vt(l)),as(n),Ae(s.trimLeft(),"day",1,31),{hours:o,minutes:i,seconds:a,fractionalMilliseconds:c})}throw new TypeError("Invalid RFC-7231 date-time value")},fi=r=>{if(r==null)return;let e;if(typeof r=="number")e=r;else if(typeof r=="string")e=li(r);else if(typeof r=="object"&&r.tag===1)e=r.value;else throw new TypeError("Epoch timestamps must be expressed as floating point numbers or their string representation");if(Number.isNaN(e)||e===1/0||e===-1/0)throw new TypeError("Epoch timestamps must be valid, non-Infinite, non-NaN numerics");return new Date(Math.round(e*1e3))},Vt=(r,e,t,n)=>{let s=e-1;return Pd(r,s,t),new Date(Date.UTC(r,s,t,Ae(n.hours,"hour",0,23),Ae(n.minutes,"minute",0,59),Ae(n.seconds,"seconds",0,60),Bd(n.fractionalMilliseconds)))},_d=r=>{let e=new Date().getUTCFullYear(),t=Math.floor(e/100)*100+Et(vt(r));return t<e?t+100:t},Id=50*365*24*60*60*1e3,kd=r=>r.getTime()-new Date().getTime()>Id?new Date(Date.UTC(r.getUTCFullYear()-100,r.getUTCMonth(),r.getUTCDate(),r.getUTCHours(),r.getUTCMinutes(),r.getUTCSeconds(),r.getUTCMilliseconds())):r,as=r=>{let e=cs.indexOf(r);if(e<0)throw new TypeError(`Invalid month: ${r}`);return e+1},Md=[31,28,31,30,31,30,31,31,30,31,30,31],Pd=(r,e,t)=>{let n=Md[e];if(e===1&&Dd(r)&&(n=29),t>n)throw new TypeError(`Invalid day for ${cs[e]} in ${r}: ${t}`)},Dd=r=>r%4===0&&(r%100!==0||r%400===0),Ae=(r,e,t,n)=>{let s=di(vt(r));if(s<t||s>n)throw new TypeError(`${e} must be between ${t} and ${n}, inclusive`);return s},Bd=r=>r==null?0:ui("0."+r)*1e3,Od=r=>{let e=r[0],t=1;if(e=="+")t=1;else if(e=="-")t=-1;else throw new TypeError(`Offset direction, ${e}, must be "+" or "-"`);let n=Number(r.substring(1,3)),s=Number(r.substring(4,6));return t*(n*60+s)*60*1e3},vt=r=>{let e=0;for(;e<r.length-1&&r.charAt(e)==="0";)e++;return e===0?r:r.slice(e)};var ls=typeof crypto!="undefined"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);var N=Array.from({length:256},(r,e)=>e.toString(16).padStart(2,"0")),Ge=()=>{if(ls)return ls();let r=new Uint8Array(16);return crypto.getRandomValues(r),r[6]=r[6]&15|64,r[8]=r[8]&63|128,N[r[0]]+N[r[1]]+N[r[2]]+N[r[3]]+"-"+N[r[4]]+N[r[5]]+"-"+N[r[6]]+N[r[7]]+"-"+N[r[8]]+N[r[9]]+"-"+N[r[10]]+N[r[11]]+N[r[12]]+N[r[13]]+N[r[14]]+N[r[15]]};var q=function(e){return Object.assign(new String(e),{deserializeJSON(){return JSON.parse(String(e))},toString(){return String(e)},toJSON(){return String(e)}})};q.from=r=>r&&typeof r=="object"&&(r instanceof q||"deserializeJSON"in r)?r:typeof r=="string"||Object.getPrototypeOf(r)===String.prototype?q(String(r)):q(JSON.stringify(r));q.fromObject=q.from;function hi(r){return(r.includes(",")||r.includes('"'))&&(r=`"${r.replace(/"/g,'\\"')}"`),r}var us="(?:Mon|Tue|Wed|Thu|Fri|Sat|Sun)(?:[ne|u?r]?s?day)?",ds="(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)",ps="(\\d?\\d):(\\d{2}):(\\d{2})(?:\\.(\\d+))?",gi="(\\d?\\d)",yi="(\\d{4})",Nd=new RegExp(/^(\d{4})-(\d\d)-(\d\d)[tT](\d\d):(\d\d):(\d\d)(\.(\d+))?(([-+]\d\d:\d\d)|[zZ])$/),Ld=new RegExp(`^${us}, ${gi} ${ds} ${yi} ${ps} GMT$`),$d=new RegExp(`^${us}, ${gi}-${ds}-(\\d\\d) ${ps} GMT$`),Ud=new RegExp(`^${us} ${ds} ( [1-9]|\\d\\d) ${ps} ${yi}$`),Gd=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],xi=r=>{if(r==null)return;let e=NaN;if(typeof r=="number")e=r;else if(typeof r=="string"){if(!/^-?\d*\.?\d+$/.test(r))throw new TypeError("parseEpochTimestamp - numeric string invalid.");e=Number.parseFloat(r)}else typeof r=="object"&&r.tag===1&&(e=r.value);if(isNaN(e)||Math.abs(e)===1/0)throw new TypeError("Epoch timestamps must be valid finite numbers.");return new Date(Math.round(e*1e3))},Si=r=>{if(r==null)return;if(typeof r!="string")throw new TypeError("RFC3339 timestamps must be strings");let e=Nd.exec(r);if(!e)throw new TypeError(`Invalid RFC3339 timestamp format ${r}`);let[,t,n,s,o,i,a,,c,l]=e;ge(n,1,12),ge(s,1,31),ge(o,0,23),ge(i,0,59),ge(a,0,60);let d=new Date(Date.UTC(Number(t),Number(n)-1,Number(s),Number(o),Number(i),Number(a),Number(c)?Math.round(parseFloat(`0.${c}`)*1e3):0));if(d.setUTCFullYear(Number(t)),l.toUpperCase()!="Z"){let[,u,f,h]=/([+-])(\d\d):(\d\d)/.exec(l)||[void 0,"+",0,0],g=u==="-"?1:-1;d.setTime(d.getTime()+g*(Number(f)*60*60*1e3+Number(h)*60*1e3))}return d},wi=r=>{if(r==null)return;if(typeof r!="string")throw new TypeError("RFC7231 timestamps must be strings.");let e,t,n,s,o,i,a,c;if((c=Ld.exec(r))?[,e,t,n,s,o,i,a]=c:(c=$d.exec(r))?([,e,t,n,s,o,i,a]=c,n=(Number(n)+1900).toString()):(c=Ud.exec(r))&&([,t,e,s,o,i,a,n]=c),n&&i){let l=Date.UTC(Number(n),Gd.indexOf(t),Number(e),Number(s),Number(o),Number(i),a?Math.round(parseFloat(`0.${a}`)*1e3):0);ge(e,1,31),ge(s,0,23),ge(o,0,59),ge(i,0,60);let d=new Date(l);return d.setUTCFullYear(Number(n)),d}throw new TypeError(`Invalid RFC7231 date-time value ${r}.`)};function ge(r,e,t){let n=Number(r);if(n<e||n>t)throw new Error(`Value ${n} out of range [${e}, ${t}]`)}function bi(r,e,t){if(t<=0||!Number.isInteger(t))throw new Error("Invalid number of delimiters ("+t+") for splitEvery.");let n=r.split(e);if(t===1)return n;let s=[],o="";for(let i=0;i<n.length;i++)o===""?o=n[i]:o+=e+n[i],(i+1)%t===0&&(s.push(o),o="");return o!==""&&s.push(o),s}var Kt=r=>{let e=r.length,t=[],n=!1,s,o=0;for(let i=0;i<e;++i){let a=r[i];switch(a){case'"':s!=="\\"&&(n=!n);break;case",":n||(t.push(r.slice(o,i)),o=i+1);break;default:}s=a}return t.push(r.slice(o)),t.map(i=>{i=i.trim();let a=i.length;return a<2?i:(i[0]==='"'&&i[a-1]==='"'&&(i=i.slice(1,a-1)),i.replace(/\\"/g,'"'))})};var Ei=/^-?\d*(\.\d+)?$/,L=class r{constructor(e,t){m(this,"string");m(this,"type");if(this.string=e,this.type=t,!Ei.test(e))throw new Error('@smithy/core/serde - NumericValue must only contain [0-9], at most one decimal point ".", and an optional negation prefix "-".')}toString(){return this.string}static[Symbol.hasInstance](e){if(!e||typeof e!="object")return!1;let t=e;return r.prototype.isPrototypeOf(e)||t.type==="bigDecimal"&&Ei.test(t.string)}};var ce=class{constructor(){m(this,"serdeContext")}setSerdeContext(e){this.serdeContext=e}};var Jt=class extends ce{constructor(t){super();m(this,"options");this.options=t}getRequestType(){return R}getResponseType(){return $}setSerdeContext(t){this.serdeContext=t,this.serializer.setSerdeContext(t),this.deserializer.setSerdeContext(t),this.getPayloadCodec()&&this.getPayloadCodec().setSerdeContext(t)}updateServiceEndpoint(t,n){if("url"in n){t.protocol=n.url.protocol,t.hostname=n.url.hostname,t.port=n.url.port?Number(n.url.port):void 0,t.path=n.url.pathname,t.fragment=n.url.hash||void 0,t.username=n.url.username||void 0,t.password=n.url.password||void 0,t.query||(t.query={});for(let[s,o]of n.url.searchParams.entries())t.query[s]=o;return t}else return t.protocol=n.protocol,t.hostname=n.hostname,t.port=n.port?Number(n.port):void 0,t.path=n.path,t.query={...n.query},t}setHostPrefix(t,n,s){var a,c;let o=C.of(n.input),i=he((a=n.traits)!=null?a:{});if(i.endpoint){let l=(c=i.endpoint)==null?void 0:c[0];if(typeof l=="string"){let d=[...o.structIterator()].filter(([,u])=>u.getMergedTraits().hostLabel);for(let[u]of d){let f=s[u];if(typeof f!="string")throw new Error(`@smithy/core/schema - ${u} in input must be a string as hostLabel.`);l=l.replace(`{${u}}`,f)}t.hostname=l+t.hostname}}}deserializeMetadata(t){var n,s;return{httpStatusCode:t.statusCode,requestId:(s=(n=t.headers["x-amzn-requestid"])!=null?n:t.headers["x-amzn-request-id"])!=null?s:t.headers["x-amz-request-id"],extendedRequestId:t.headers["x-amz-id-2"],cfId:t.headers["x-amz-cf-id"]}}async serializeEventStream({eventStream:t,requestSchema:n,initialRequest:s}){return(await this.loadEventStreamCapability()).serializeEventStream({eventStream:t,requestSchema:n,initialRequest:s})}async deserializeEventStream({response:t,responseSchema:n,initialResponseContainer:s}){return(await this.loadEventStreamCapability()).deserializeEventStream({response:t,responseSchema:n,initialResponseContainer:s})}async loadEventStreamCapability(){let{EventStreamSerde:t}=await Promise.resolve().then(()=>(Ai(),Ci));return new t({marshaller:this.getEventStreamMarshaller(),serializer:this.serializer,deserializer:this.deserializer,serdeContext:this.serdeContext,defaultContentType:this.getDefaultContentType()})}getDefaultContentType(){throw new Error(`@smithy/core/protocols - ${this.constructor.name} getDefaultContentType() implementation missing.`)}async deserializeHttpMessage(t,n,s,o,i){return[]}getEventStreamMarshaller(){let t=this.serdeContext;if(!t.eventStreamMarshaller)throw new Error("@smithy/core - HttpProtocol: eventStreamMarshaller missing in serdeContext.");return t.eventStreamMarshaller}};var Yt=class extends Jt{async serializeRequest(e,t,n){var g;let s={...t!=null?t:{}},o=this.serializer,i={},a={},c=await n.endpoint(),l=C.of(e==null?void 0:e.input),d=l.getSchema(),u=!1,f,h=new R({protocol:"",hostname:"",port:void 0,path:"",fragment:void 0,query:i,headers:a,body:void 0});if(c){this.updateServiceEndpoint(h,c),this.setHostPrefix(h,e,s);let y=he(e.traits);if(y.http){h.method=y.http[0];let[x,S]=y.http[1].split("?");h.path=="/"?h.path=x:h.path+=x;let w=new URLSearchParams(S!=null?S:"");Object.assign(i,Object.fromEntries(w))}}for(let[y,x]of l.structIterator()){let S=(g=x.getMergedTraits())!=null?g:{},w=s[y];if(!(w==null&&!x.isIdempotencyToken()))if(S.httpPayload)x.isStreaming()?x.isStructSchema()?s[y]&&(f=await this.serializeEventStream({eventStream:s[y],requestSchema:l})):f=w:(o.write(x,w),f=o.flush()),delete s[y];else if(S.httpLabel){o.write(x,w);let E=o.flush();h.path.includes(`{${y}+}`)?h.path=h.path.replace(`{${y}+}`,E.split("/").map(ns).join("/")):h.path.includes(`{${y}}`)&&(h.path=h.path.replace(`{${y}}`,ns(E))),delete s[y]}else if(S.httpHeader)o.write(x,w),a[S.httpHeader.toLowerCase()]=String(o.flush()),delete s[y];else if(typeof S.httpPrefixHeaders=="string"){for(let[E,b]of Object.entries(w)){let v=S.httpPrefixHeaders+E;o.write([x.getValueSchema(),{httpHeader:v}],b),a[v.toLowerCase()]=o.flush()}delete s[y]}else S.httpQuery||S.httpQueryParams?(this.serializeQuery(x,w,i),delete s[y]):u=!0}return u&&s&&(o.write(d,s),f=o.flush()),h.headers=a,h.query=i,h.body=f,h}serializeQuery(e,t,n){let s=this.serializer,o=e.getMergedTraits();if(o.httpQueryParams){for(let[i,a]of Object.entries(t))if(!(i in n)){let c=e.getValueSchema();Object.assign(c.getMergedTraits(),{...o,httpQuery:i,httpQueryParams:void 0}),this.serializeQuery(c,a,n)}return}if(e.isListSchema()){let i=!!e.getMergedTraits().sparse,a=[];for(let c of t){s.write([e.getValueSchema(),o],c);let l=s.flush();(i||l!==void 0)&&a.push(l)}n[o.httpQuery]=a}else s.write([e,o],t),n[o.httpQuery]=s.flush()}async deserializeResponse(e,t,n){let s=this.deserializer,o=C.of(e.output),i={};if(n.statusCode>=300){let c=await ve(n.body,t);throw c.byteLength>0&&Object.assign(i,await s.read(15,c)),await this.handleError(e,t,n,i,this.deserializeMetadata(n)),new Error("@smithy/core/protocols - HTTP Protocol error handler failed to throw.")}for(let c in n.headers){let l=n.headers[c];delete n.headers[c],n.headers[c.toLowerCase()]=l}let a=await this.deserializeHttpMessage(o,t,n,i);if(a.length){let c=await ve(n.body,t);if(c.byteLength>0){let l=await s.read(o,c);for(let d of a)i[d]=l[d]}}else a.discardResponseBody&&await ve(n.body,t);return i.$metadata=this.deserializeMetadata(n),i}async deserializeHttpMessage(e,t,n,s,o){let i;s instanceof Set?i=o:i=s;let a=!0,c=this.deserializer,l=C.of(e),d=[];for(let[u,f]of l.structIterator()){let h=f.getMemberTraits();if(h.httpPayload){if(a=!1,f.isStreaming())f.isStructSchema()?i[u]=await this.deserializeEventStream({response:n,responseSchema:l}):i[u]=ti(n.body);else if(n.body){let y=await ve(n.body,t);y.byteLength>0&&(i[u]=await c.read(f,y))}}else if(h.httpHeader){let g=String(h.httpHeader).toLowerCase(),y=n.headers[g];if(y!=null)if(f.isListSchema()){let x=f.getValueSchema();x.getMergedTraits().httpHeader=g;let S;x.isTimestampSchema()&&x.getSchema()===4?S=bi(y,",",2):S=Kt(y);let w=[];for(let E of S)w.push(await c.read(x,E.trim()));i[u]=w}else i[u]=await c.read(f,y)}else if(h.httpPrefixHeaders!==void 0){i[u]={};for(let[g,y]of Object.entries(n.headers))if(g.startsWith(h.httpPrefixHeaders)){let x=f.getValueSchema();x.getMergedTraits().httpHeader=g,i[u][g.slice(h.httpPrefixHeaders.length)]=await c.read(x,y)}}else h.httpResponseCode?i[u]=n.statusCode:d.push(u)}return d.discardResponseBody=a,d}};z();function Te(r,e){if(e.timestampFormat.useTrait&&r.isTimestampSchema()&&(r.getSchema()===5||r.getSchema()===6||r.getSchema()===7))return r.getSchema();let{httpLabel:t,httpPrefixHeaders:n,httpHeader:s,httpQuery:o}=r.getMergedTraits(),i=e.httpBindings?typeof n=="string"||s?6:o||t?5:void 0:void 0;return i!=null?i:e.timestampFormat.default}var Xt=class extends ce{constructor(t){super();m(this,"settings");this.settings=t}read(t,n){var o,i;let s=C.of(t);if(s.isListSchema())return Kt(n).map(a=>this.read(s.getValueSchema(),a));if(s.isBlobSchema())return((i=(o=this.serdeContext)==null?void 0:o.base64Decoder)!=null?i:re)(n);if(s.isTimestampSchema())switch(Te(s,this.settings)){case 5:return Si(n);case 6:return wi(n);case 7:return xi(n);default:return console.warn("Missing timestamp format, parsing value with Date constructor:",n),new Date(n)}if(s.isStringSchema()){let a=s.getMergedTraits().mediaType,c=n;if(a)return s.getMergedTraits().httpHeader&&(c=this.base64ToUtf8(c)),(a==="application/json"||a.endsWith("+json"))&&(c=q.from(c)),c}return s.isNumericSchema()?Number(n):s.isBigIntegerSchema()?BigInt(n):s.isBigDecimalSchema()?new L(n,"bigDecimal"):s.isBooleanSchema()?String(n).toLowerCase()==="true":n}base64ToUtf8(t){var n,s,o,i;return((s=(n=this.serdeContext)==null?void 0:n.utf8Encoder)!=null?s:H)(((i=(o=this.serdeContext)==null?void 0:o.base64Decoder)!=null?i:re)(t))}};z();var Qt=class extends ce{constructor(t,n){super();m(this,"codecDeserializer");m(this,"stringDeserializer");this.codecDeserializer=t,this.stringDeserializer=new Xt(n)}setSerdeContext(t){this.stringDeserializer.setSerdeContext(t),this.codecDeserializer.setSerdeContext(t),this.serdeContext=t}read(t,n){var a,c,l,d;let s=C.of(t),o=s.getMergedTraits(),i=(c=(a=this.serdeContext)==null?void 0:a.utf8Encoder)!=null?c:H;if(o.httpHeader||o.httpResponseCode)return this.stringDeserializer.read(s,i(n));if(o.httpPayload){if(s.isBlobSchema()){let u=(d=(l=this.serdeContext)==null?void 0:l.utf8Decoder)!=null?d:U;return typeof n=="string"?u(n):n}else if(s.isStringSchema())return"byteLength"in n?i(n):n}return this.codecDeserializer.read(s,n)}};var Zt=class extends ce{constructor(t){super();m(this,"settings");m(this,"stringBuffer","");this.settings=t}write(t,n){var o,i,a,c;let s=C.of(t);switch(typeof n){case"object":if(n===null){this.stringBuffer="null";return}if(s.isTimestampSchema()){if(!(n instanceof Date))throw new Error(`@smithy/core/protocols - received non-Date value ${n} when schema expected Date in ${s.getName(!0)}`);switch(Te(s,this.settings)){case 5:this.stringBuffer=n.toISOString().replace(".000Z","Z");break;case 6:this.stringBuffer=Wt(n);break;case 7:this.stringBuffer=String(n.getTime()/1e3);break;default:console.warn("Missing timestamp format, using epoch seconds",n),this.stringBuffer=String(n.getTime()/1e3)}return}if(s.isBlobSchema()&&"byteLength"in n){this.stringBuffer=((i=(o=this.serdeContext)==null?void 0:o.base64Encoder)!=null?i:Y)(n);return}if(s.isListSchema()&&Array.isArray(n)){let u="";for(let f of n){this.write([s.getValueSchema(),s.getMergedTraits()],f);let h=this.flush(),g=s.getValueSchema().isTimestampSchema()?h:hi(h);u!==""&&(u+=", "),u+=g}this.stringBuffer=u;return}this.stringBuffer=JSON.stringify(n,null,2);break;case"string":let l=s.getMergedTraits().mediaType,d=n;if(l&&((l==="application/json"||l.endsWith("+json"))&&(d=q.from(d)),s.getMergedTraits().httpHeader)){this.stringBuffer=((c=(a=this.serdeContext)==null?void 0:a.base64Encoder)!=null?c:Y)(d.toString());return}this.stringBuffer=n;break;default:s.isIdempotencyToken()?this.stringBuffer=Ge():this.stringBuffer=String(n)}}flush(){let t=this.stringBuffer;return this.stringBuffer="",t}};var er=class{constructor(e,t,n=new Zt(t)){m(this,"codecSerializer");m(this,"stringSerializer");m(this,"buffer");this.codecSerializer=e,this.stringSerializer=n}setSerdeContext(e){this.codecSerializer.setSerdeContext(e),this.stringSerializer.setSerdeContext(e)}write(e,t){let n=C.of(e),s=n.getMergedTraits();if(s.httpHeader||s.httpLabel||s.httpQuery){this.stringSerializer.write(n,t),this.buffer=this.stringSerializer.flush();return}return this.codecSerializer.write(n,t)}flush(){if(this.buffer!==void 0){let e=this.buffer;return this.buffer=void 0,e}return this.codecSerializer.flush()}};function Ti(r,e,t){r.__smithy_context?r.__smithy_context.features||(r.__smithy_context.features={}):r.__smithy_context={features:{}},r.__smithy_context.features[e]=t}var tr=class{constructor(e){m(this,"authSchemes",new Map);for(let[t,n]of Object.entries(e))n!==void 0&&this.authSchemes.set(t,n)}getIdentityProvider(e){return this.authSchemes.get(e)}};var rr=class{async sign(e,t,n){let s=R.clone(e);if(!t.token)throw new Error("request could not be signed with `token` since the `token` is not defined");return s.headers.Authorization=`Bearer ${t.token}`,s}};var Fd=r=>function(t){return Ct(t)&&t.expiration.getTime()-Date.now()<r};var nr=Fd(3e5),Ct=r=>r.expiration!==void 0,sr=(r,e,t)=>{if(r===void 0)return;let n=typeof r!="function"?async()=>Promise.resolve(r):r,s,o,i,a=!1,c=async l=>{o||(o=n(l));try{s=await o,i=!0,a=!1}finally{o=void 0}return s};return e===void 0?async l=>((!i||l!=null&&l.forceRefresh)&&(s=await c(l)),s):async l=>((!i||l!=null&&l.forceRefresh)&&(s=await c(l)),a?s:t(s)?(e(s)&&await c(l),s):(a=!0,s))};var Hd=void 0;function zd(r){return r===void 0?!0:typeof r=="string"&&r.length<=50}function Ri(r){var n;let e=Le((n=r.userAgentAppId)!=null?n:Hd),{customUserAgent:t}=r;return Object.assign(r,{customUserAgent:typeof t=="string"?[[t]]:t,userAgentAppId:async()=>{var o,i;let s=await e();if(!zd(s)){let a=((i=(o=r.logger)==null?void 0:o.constructor)==null?void 0:i.name)==="NoOpLogger"||!r.logger?console:r.logger;typeof s!="string"?a==null||a.warn("userAgentAppId must be a string or undefined."):s.length>50&&(a==null||a.warn("The provided userAgentAppId exceeds the maximum length of 50 characters."))}return s}})}var or=class{constructor({size:e,params:t}){m(this,"capacity");m(this,"data",new Map);m(this,"parameters",[]);this.capacity=e!=null?e:50,t&&(this.parameters=t)}get(e,t){let n=this.hash(e);if(n===!1)return t();if(!this.data.has(n)){if(this.data.size>this.capacity+10){let s=this.data.keys(),o=0;for(;;){let{value:i,done:a}=s.next();if(this.data.delete(i),a||++o>10)break}}this.data.set(n,t())}return this.data.get(n)}size(){return this.data.size}hash(e){var s;let t="",{parameters:n}=this;if(n.length===0)return!1;for(let o of n){let i=String((s=e[o])!=null?s:"");if(i.includes("|;"))return!1;t+=i+"|;"}return t}};var qd=new RegExp("^(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}$"),At=r=>qd.test(r)||r.startsWith("[")&&r.endsWith("]");var jd=new RegExp("^(?!.*-$)(?!-)[a-zA-Z0-9-]{1,63}$"),Fe=(r,e=!1)=>{if(!e)return jd.test(r);let t=r.split(".");for(let n of t)if(!Fe(n))return!1;return!0};var He={};var ye="endpoints";function X(r){return typeof r!="object"||r==null?r:"ref"in r?`$${X(r.ref)}`:"fn"in r?`${r.fn}(${(r.argv||[]).map(X).join(", ")})`:JSON.stringify(r,null,2)}var _=class extends Error{constructor(e){super(e),this.name="EndpointError"}};var _i=(r,e)=>r===e;var Ii=r=>{let e=r.split("."),t=[];for(let n of e){let s=n.indexOf("[");if(s!==-1){if(n.indexOf("]")!==n.length-1)throw new _(`Path: '${r}' does not end with ']'`);let o=n.slice(s+1,-1);if(Number.isNaN(parseInt(o)))throw new _(`Invalid array index: '${o}' in path: '${r}'`);s!==0&&t.push(n.slice(0,s)),t.push(o)}else t.push(n)}return t};var ir=(r,e)=>Ii(e).reduce((t,n)=>{if(typeof t!="object")throw new _(`Index '${n}' in '${e}' not found in '${JSON.stringify(r)}'`);return Array.isArray(t)?t[parseInt(n)]:t[n]},r);var ki=r=>r!=null;var Mi=r=>!r;var fs={[tt.HTTP]:80,[tt.HTTPS]:443},Pi=r=>{let e=(()=>{try{if(r instanceof URL)return r;if(typeof r=="object"&&"hostname"in r){let{hostname:f,port:h,protocol:g="",path:y="",query:x={}}=r,S=new URL(`${g}//${f}${h?`:${h}`:""}${y}`);return S.search=Object.entries(x).map(([w,E])=>`${w}=${E}`).join("&"),S}return new URL(r)}catch(f){return null}})();if(!e)return console.error(`Unable to parse ${JSON.stringify(r)} as a whatwg URL.`),null;let t=e.href,{host:n,hostname:s,pathname:o,protocol:i,search:a}=e;if(a)return null;let c=i.slice(0,-1);if(!Object.values(tt).includes(c))return null;let l=At(s),d=t.includes(`${n}:${fs[c]}`)||typeof r=="string"&&r.includes(`${n}:${fs[c]}`),u=`${n}${d?`:${fs[c]}`:""}`;return{scheme:c,authority:u,path:o,normalizedPath:o.endsWith("/")?o:`${o}/`,isIp:l}};var Di=(r,e)=>r===e;var Bi=(r,e,t,n)=>e>=t||r.length<t?null:n?r.substring(r.length-t,r.length-e):r.substring(e,t);var Oi=r=>encodeURIComponent(r).replace(/[!*'()]/g,e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`);var Ni={booleanEquals:_i,getAttr:ir,isSet:ki,isValidHostLabel:Fe,not:Mi,parseURL:Pi,stringEquals:Di,substring:Bi,uriEncode:Oi};var ar=(r,e)=>{let t=[],n={...e.endpointParams,...e.referenceRecord},s=0;for(;s<r.length;){let o=r.indexOf("{",s);if(o===-1){t.push(r.slice(s));break}t.push(r.slice(s,o));let i=r.indexOf("}",o);if(i===-1){t.push(r.slice(o));break}r[o+1]==="{"&&r[i+1]==="}"&&(t.push(r.slice(o+1,i)),s=i+2);let a=r.substring(o+1,i);if(a.includes("#")){let[c,l]=a.split("#");t.push(ir(n[c],l))}else t.push(n[a]);s=i+1}return t.join("")};var Li=({ref:r},e)=>({...e.endpointParams,...e.referenceRecord})[r];var ze=(r,e,t)=>{if(typeof r=="string")return ar(r,t);if(r.fn)return $i.callFunction(r,t);if(r.ref)return Li(r,t);throw new _(`'${e}': ${String(r)} is not a string, function or reference.`)},cr=({fn:r,argv:e},t)=>{let n=e.map(o=>["boolean","number"].includes(typeof o)?o:$i.evaluateExpression(o,"arg",t)),s=r.split(".");return s[0]in He&&s[1]!=null?He[s[0]][s[1]](...n):Ni[r](...n)},$i={evaluateExpression:ze,callFunction:cr};var Ui=({assign:r,...e},t)=>{var s,o;if(r&&r in t.referenceRecord)throw new _(`'${r}' is already defined in Reference Record.`);let n=cr(e,t);return(o=(s=t.logger)==null?void 0:s.debug)==null||o.call(s,`${ye} evaluateCondition: ${X(e)} = ${X(n)}`),{result:n===""?!0:!!n,...r!=null&&{toAssign:{name:r,value:n}}}};var ot=(r=[],e)=>{var n,s;let t={};for(let o of r){let{result:i,toAssign:a}=Ui(o,{...e,referenceRecord:{...e.referenceRecord,...t}});if(!i)return{result:i};a&&(t[a.name]=a.value,(s=(n=e.logger)==null?void 0:n.debug)==null||s.call(n,`${ye} assign: ${a.name} := ${X(a.value)}`))}return{result:!0,referenceRecord:t}};var Gi=(r,e)=>Object.entries(r).reduce((t,[n,s])=>({...t,[n]:s.map(o=>{let i=ze(o,"Header value entry",e);if(typeof i!="string")throw new _(`Header '${n}' value '${i}' is not a string`);return i})}),{});var hs=(r,e)=>Object.entries(r).reduce((t,[n,s])=>({...t,[n]:Hi.getEndpointProperty(s,e)}),{}),Fi=(r,e)=>{if(Array.isArray(r))return r.map(t=>Fi(t,e));switch(typeof r){case"string":return ar(r,e);case"object":if(r===null)throw new _(`Unexpected endpoint property: ${r}`);return Hi.getEndpointProperties(r,e);case"boolean":return r;default:throw new _(`Unexpected endpoint property type: ${typeof r}`)}},Hi={getEndpointProperty:Fi,getEndpointProperties:hs};var zi=(r,e)=>{let t=ze(r,"Endpoint URL",e);if(typeof t=="string")try{return new URL(t)}catch(n){throw console.error(`Failed to construct URL with ${t}`,n),n}throw new _(`Endpoint URL must be a string, got ${typeof t}`)};var qi=(r,e)=>{var d,u;let{conditions:t,endpoint:n}=r,{result:s,referenceRecord:o}=ot(t,e);if(!s)return;let i={...e,referenceRecord:{...e.referenceRecord,...o}},{url:a,properties:c,headers:l}=n;return(u=(d=e.logger)==null?void 0:d.debug)==null||u.call(d,`${ye} Resolving endpoint from template: ${X(n)}`),{...l!=null&&{headers:Gi(l,i)},...c!=null&&{properties:hs(c,i)},url:zi(a,i)}};var ji=(r,e)=>{let{conditions:t,error:n}=r,{result:s,referenceRecord:o}=ot(t,e);if(s)throw new _(ze(n,"Error",{...e,referenceRecord:{...e.referenceRecord,...o}}))};var gs=(r,e)=>{for(let t of r)if(t.type==="endpoint"){let n=qi(t,e);if(n)return n}else if(t.type==="error")ji(t,e);else if(t.type==="tree"){let n=Vi.evaluateTreeRule(t,e);if(n)return n}else throw new _(`Unknown endpoint rule: ${t}`);throw new _("Rules evaluation failed")},Vd=(r,e)=>{let{conditions:t,rules:n}=r,{result:s,referenceRecord:o}=ot(t,e);if(s)return Vi.evaluateRules(n,{...e,referenceRecord:{...e.referenceRecord,...o}})},Vi={evaluateRules:gs,evaluateTreeRule:Vd};var Wi=(r,e)=>{var l,d,u,f,h;let{endpointParams:t,logger:n}=e,{parameters:s,rules:o}=r;(d=(l=e.logger)==null?void 0:l.debug)==null||d.call(l,`${ye} Initial EndpointParams: ${X(t)}`);let i=Object.entries(s).filter(([,g])=>g.default!=null).map(([g,y])=>[g,y.default]);if(i.length>0)for(let[g,y]of i)t[g]=(u=t[g])!=null?u:y;let a=Object.entries(s).filter(([,g])=>g.required).map(([g])=>g);for(let g of a)if(t[g]==null)throw new _(`Missing required parameter: '${g}'`);let c=gs(o,{endpointParams:t,logger:n,referenceRecord:{}});return(h=(f=e.logger)==null?void 0:f.debug)==null||h.call(f,`${ye} Resolved endpoint: ${X(c)}`),c};var ys=(r,e=!1)=>{if(e){for(let t of r.split("."))if(!ys(t))return!1;return!0}return!(!Fe(r)||r.length<3||r.length>63||r!==r.toLowerCase()||At(r))};var Ki=":",Wd="/",Ji=r=>{let e=r.split(Ki);if(e.length<6)return null;let[t,n,s,o,i,...a]=e;if(t!=="arn"||n===""||s===""||a.join(Ki)==="")return null;let c=a.map(l=>l.split(Wd)).flat();return{partition:n,service:s,region:o,accountId:i,resourceId:c}};var Yi={partitions:[{id:"aws",outputs:{dnsSuffix:"amazonaws.com",dualStackDnsSuffix:"api.aws",implicitGlobalRegion:"us-east-1",name:"aws",supportsDualStack:!0,supportsFIPS:!0},regionRegex:"^(us|eu|ap|sa|ca|me|af|il|mx)\\-\\w+\\-\\d+$",regions:{"af-south-1":{description:"Africa (Cape Town)"},"ap-east-1":{description:"Asia Pacific (Hong Kong)"},"ap-east-2":{description:"Asia Pacific (Taipei)"},"ap-northeast-1":{description:"Asia Pacific (Tokyo)"},"ap-northeast-2":{description:"Asia Pacific (Seoul)"},"ap-northeast-3":{description:"Asia Pacific (Osaka)"},"ap-south-1":{description:"Asia Pacific (Mumbai)"},"ap-south-2":{description:"Asia Pacific (Hyderabad)"},"ap-southeast-1":{description:"Asia Pacific (Singapore)"},"ap-southeast-2":{description:"Asia Pacific (Sydney)"},"ap-southeast-3":{description:"Asia Pacific (Jakarta)"},"ap-southeast-4":{description:"Asia Pacific (Melbourne)"},"ap-southeast-5":{description:"Asia Pacific (Malaysia)"},"ap-southeast-6":{description:"Asia Pacific (New Zealand)"},"ap-southeast-7":{description:"Asia Pacific (Thailand)"},"aws-global":{description:"aws global region"},"ca-central-1":{description:"Canada (Central)"},"ca-west-1":{description:"Canada West (Calgary)"},"eu-central-1":{description:"Europe (Frankfurt)"},"eu-central-2":{description:"Europe (Zurich)"},"eu-north-1":{description:"Europe (Stockholm)"},"eu-south-1":{description:"Europe (Milan)"},"eu-south-2":{description:"Europe (Spain)"},"eu-west-1":{description:"Europe (Ireland)"},"eu-west-2":{description:"Europe (London)"},"eu-west-3":{description:"Europe (Paris)"},"il-central-1":{description:"Israel (Tel Aviv)"},"me-central-1":{description:"Middle East (UAE)"},"me-south-1":{description:"Middle East (Bahrain)"},"mx-central-1":{description:"Mexico (Central)"},"sa-east-1":{description:"South America (Sao Paulo)"},"us-east-1":{description:"US East (N. Virginia)"},"us-east-2":{description:"US East (Ohio)"},"us-west-1":{description:"US West (N. California)"},"us-west-2":{description:"US West (Oregon)"}}},{id:"aws-cn",outputs:{dnsSuffix:"amazonaws.com.cn",dualStackDnsSuffix:"api.amazonwebservices.com.cn",implicitGlobalRegion:"cn-northwest-1",name:"aws-cn",supportsDualStack:!0,supportsFIPS:!0},regionRegex:"^cn\\-\\w+\\-\\d+$",regions:{"aws-cn-global":{description:"aws-cn global region"},"cn-north-1":{description:"China (Beijing)"},"cn-northwest-1":{description:"China (Ningxia)"}}},{id:"aws-eusc",outputs:{dnsSuffix:"amazonaws.eu",dualStackDnsSuffix:"api.amazonwebservices.eu",implicitGlobalRegion:"eusc-de-east-1",name:"aws-eusc",supportsDualStack:!0,supportsFIPS:!0},regionRegex:"^eusc\\-(de)\\-\\w+\\-\\d+$",regions:{"eusc-de-east-1":{description:"EU (Germany)"}}},{id:"aws-iso",outputs:{dnsSuffix:"c2s.ic.gov",dualStackDnsSuffix:"api.aws.ic.gov",implicitGlobalRegion:"us-iso-east-1",name:"aws-iso",supportsDualStack:!0,supportsFIPS:!0},regionRegex:"^us\\-iso\\-\\w+\\-\\d+$",regions:{"aws-iso-global":{description:"aws-iso global region"},"us-iso-east-1":{description:"US ISO East"},"us-iso-west-1":{description:"US ISO WEST"}}},{id:"aws-iso-b",outputs:{dnsSuffix:"sc2s.sgov.gov",dualStackDnsSuffix:"api.aws.scloud",implicitGlobalRegion:"us-isob-east-1",name:"aws-iso-b",supportsDualStack:!0,supportsFIPS:!0},regionRegex:"^us\\-isob\\-\\w+\\-\\d+$",regions:{"aws-iso-b-global":{description:"aws-iso-b global region"},"us-isob-east-1":{description:"US ISOB East (Ohio)"},"us-isob-west-1":{description:"US ISOB West"}}},{id:"aws-iso-e",outputs:{dnsSuffix:"cloud.adc-e.uk",dualStackDnsSuffix:"api.cloud-aws.adc-e.uk",implicitGlobalRegion:"eu-isoe-west-1",name:"aws-iso-e",supportsDualStack:!0,supportsFIPS:!0},regionRegex:"^eu\\-isoe\\-\\w+\\-\\d+$",regions:{"aws-iso-e-global":{description:"aws-iso-e global region"},"eu-isoe-west-1":{description:"EU ISOE West"}}},{id:"aws-iso-f",outputs:{dnsSuffix:"csp.hci.ic.gov",dualStackDnsSuffix:"api.aws.hci.ic.gov",implicitGlobalRegion:"us-isof-south-1",name:"aws-iso-f",supportsDualStack:!0,supportsFIPS:!0},regionRegex:"^us\\-isof\\-\\w+\\-\\d+$",regions:{"aws-iso-f-global":{description:"aws-iso-f global region"},"us-isof-east-1":{description:"US ISOF EAST"},"us-isof-south-1":{description:"US ISOF SOUTH"}}},{id:"aws-us-gov",outputs:{dnsSuffix:"amazonaws.com",dualStackDnsSuffix:"api.aws",implicitGlobalRegion:"us-gov-west-1",name:"aws-us-gov",supportsDualStack:!0,supportsFIPS:!0},regionRegex:"^us\\-gov\\-\\w+\\-\\d+$",regions:{"aws-us-gov-global":{description:"aws-us-gov global region"},"us-gov-east-1":{description:"AWS GovCloud (US-East)"},"us-gov-west-1":{description:"AWS GovCloud (US-West)"}}}],version:"1.1"};var Jd=Yi,Yd="",Xi=r=>{let{partitions:e}=Jd;for(let n of e){let{regions:s,outputs:o}=n;for(let[i,a]of Object.entries(s))if(i===r)return{...o,...a}}for(let n of e){let{regionRegex:s,outputs:o}=n;if(new RegExp(s).test(r))return{...o}}let t=e.find(n=>n.id==="aws");if(!t)throw new Error("Provided region was not found in the partition array or regex, and default partition with id 'aws' doesn't exist.");return{...t.outputs}};var Qi=()=>Yd;var xs={isVirtualHostableS3Bucket:ys,parseArn:Ji,partition:Xi};He.aws=xs;function Zi(r){let e={};if(r=r.replace(/^\?/,""),r)for(let t of r.split("&")){let[n,s=null]=t.split("=");n=decodeURIComponent(n),s&&(s=decodeURIComponent(s)),n in e?Array.isArray(e[n])?e[n].push(s):e[n]=[e[n],s]:e[n]=s}return e}var it=r=>{if(typeof r=="string")return it(new URL(r));let{hostname:e,pathname:t,port:n,protocol:s,search:o}=r,i;return o&&(i=Zi(o)),{hostname:e,port:n?parseInt(n):void 0,protocol:s,path:t,query:i}};function ea(r,e,t){return r.$source||(r.$source={}),r.$source[e]=t,r}function ne(r,e,t){r.__aws_sdk_context?r.__aws_sdk_context.features||(r.__aws_sdk_context.features={}):r.__aws_sdk_context={features:{}},r.__aws_sdk_context.features[e]=t}var Ss=r=>{var e,t,n;return $.isInstance(r)?(n=(e=r.headers)==null?void 0:e.date)!=null?n:(t=r.headers)==null?void 0:t.Date:void 0};var lr=r=>new Date(Date.now()+r);var ta=(r,e)=>Math.abs(lr(e).getTime()-r)>=3e5;var ws=(r,e)=>{let t=Date.parse(r);return ta(t,e)?t-Date.now():e};var Tt=(r,e)=>{if(!e)throw new Error(`Property \`${r}\` is not resolved for AWS SDK SigV4Auth`);return e},ra=async r=>{var l,d,u;let e=Tt("context",r.context),t=Tt("config",r.config),n=(u=(d=(l=e.endpointV2)==null?void 0:l.properties)==null?void 0:d.authSchemes)==null?void 0:u[0],o=await Tt("signer",t.signer)(n),i=r==null?void 0:r.signingRegion,a=r==null?void 0:r.signingRegionSet,c=r==null?void 0:r.signingName;return{config:t,signer:o,signingRegion:i,signingRegionSet:a,signingName:c}},Rt=class{async sign(e,t,n){var u,f,h,g;if(!R.isInstance(e))throw new Error("The request is not an instance of `HttpRequest` and cannot be signed");let s=await ra(n),{config:o,signer:i}=s,{signingRegion:a,signingName:c}=s,l=n.context;if((f=(u=l==null?void 0:l.authSchemes)==null?void 0:u.length)!=null&&f){let[y,x]=l.authSchemes;(y==null?void 0:y.name)==="sigv4a"&&(x==null?void 0:x.name)==="sigv4"&&(a=(h=x==null?void 0:x.signingRegion)!=null?h:a,c=(g=x==null?void 0:x.signingName)!=null?g:c)}return await i.sign(e,{signingDate:lr(o.systemClockOffset),signingRegion:a,signingService:c})}errorHandler(e){return t=>{var s;let n=(s=t.ServerTime)!=null?s:Ss(t.$response);if(n){let o=Tt("config",e.config),i=o.systemClockOffset;o.systemClockOffset=ws(n,o.systemClockOffset),o.systemClockOffset!==i&&t.$metadata&&(t.$metadata.clockSkewCorrected=!0)}throw t}}successHandler(e,t){let n=Ss(e);if(n){let s=Tt("config",t.config);s.systemClockOffset=ws(n,s.systemClockOffset)}}};var na=(r,e,t)=>{let n,s,o,i=!1,a=async()=>{s||(s=r());try{n=await s,o=!0,i=!1}finally{s=void 0}return n};return e===void 0?async c=>((!o||c!=null&&c.forceRefresh)&&(n=await a()),n):async c=>((!o||c!=null&&c.forceRefresh)&&(n=await a()),i?n:t&&!t(n)?(i=!0,n):(e(n)&&await a(),n))};z();var sa="X-Amz-Algorithm",oa="X-Amz-Credential",bs="X-Amz-Date",ia="X-Amz-SignedHeaders",aa="X-Amz-Expires",Es="X-Amz-Signature",vs="X-Amz-Security-Token";var Cs="authorization",As=bs.toLowerCase(),Xd="date",ca=[Cs,As,Xd],la=Es.toLowerCase(),_t="x-amz-content-sha256",ua=vs.toLowerCase();var da={authorization:!0,"cache-control":!0,connection:!0,expect:!0,from:!0,"keep-alive":!0,"max-forwards":!0,pragma:!0,referer:!0,te:!0,trailer:!0,"transfer-encoding":!0,upgrade:!0,"user-agent":!0,"x-amzn-trace-id":!0},pa=/^proxy-/,ma=/^sec-/;var ur="AWS4-HMAC-SHA256";var fa="AWS4-HMAC-SHA256-PAYLOAD",ha="UNSIGNED-PAYLOAD",ga=50,Ts="aws4_request",ya=60*60*24*7;z();var dr={},Rs=[],pr=(r,e,t)=>`${r}/${e}/${t}/${Ts}`,Sa=async(r,e,t,n,s)=>{let o=await xa(r,e.secretAccessKey,e.accessKeyId),i=`${t}:${n}:${s}:${I(o)}:${e.sessionToken}`;if(i in dr)return dr[i];for(Rs.push(i);Rs.length>ga;)delete dr[Rs.shift()];let a=`AWS4${e.secretAccessKey}`;for(let c of[t,n,s,Ts])a=await xa(r,a,c);return dr[i]=a};var xa=(r,e,t)=>{let n=new r(e);return n.update(fe(t)),n.digest()};var _s=({headers:r},e,t)=>{let n={};for(let s of Object.keys(r).sort()){if(r[s]==null)continue;let o=s.toLowerCase();(o in da||e!=null&&e.has(o)||pa.test(o)||ma.test(o))&&(!t||t&&!t.has(o))||(n[o]=r[s].trim().replace(/\s+/g," "))}return n};var wa=r=>typeof ArrayBuffer=="function"&&r instanceof ArrayBuffer||Object.prototype.toString.call(r)==="[object ArrayBuffer]";z();var mr=async({headers:r,body:e},t)=>{for(let n of Object.keys(r))if(n.toLowerCase()===_t)return r[n];if(e==null)return"e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855";if(typeof e=="string"||ArrayBuffer.isView(e)||wa(e)){let n=new t;return n.update(fe(e)),I(await n.digest())}return ha};z();var fr=class{format(e){let t=[];for(let o of Object.keys(e)){let i=U(o);t.push(Uint8Array.from([i.byteLength]),i,this.formatHeaderValue(e[o]))}let n=new Uint8Array(t.reduce((o,i)=>o+i.byteLength,0)),s=0;for(let o of t)n.set(o,s),s+=o.byteLength;return n}formatHeaderValue(e){switch(e.type){case"boolean":return Uint8Array.from([e.value?0:1]);case"byte":return Uint8Array.from([2,e.value]);case"short":let t=new DataView(new ArrayBuffer(3));return t.setUint8(0,3),t.setInt16(1,e.value,!1),new Uint8Array(t.buffer);case"integer":let n=new DataView(new ArrayBuffer(5));return n.setUint8(0,4),n.setInt32(1,e.value,!1),new Uint8Array(n.buffer);case"long":let s=new Uint8Array(9);return s[0]=5,s.set(e.value.bytes,1),s;case"binary":let o=new DataView(new ArrayBuffer(3+e.value.byteLength));o.setUint8(0,6),o.setUint16(1,e.value.byteLength,!1);let i=new Uint8Array(o.buffer);return i.set(e.value,3),i;case"string":let a=U(e.value),c=new DataView(new ArrayBuffer(3+a.byteLength));c.setUint8(0,7),c.setUint16(1,a.byteLength,!1);let l=new Uint8Array(c.buffer);return l.set(a,3),l;case"timestamp":let d=new Uint8Array(9);return d[0]=8,d.set(Is.fromNumber(e.value.valueOf()).bytes,1),d;case"uuid":if(!Qd.test(e.value))throw new Error(`Invalid UUID received: ${e.value}`);let u=new Uint8Array(17);return u[0]=9,u.set(st(e.value.replace(/\-/g,"")),1),u}}},ba;(function(r){r[r.boolTrue=0]="boolTrue",r[r.boolFalse=1]="boolFalse",r[r.byte=2]="byte",r[r.short=3]="short",r[r.integer=4]="integer",r[r.long=5]="long",r[r.byteArray=6]="byteArray",r[r.string=7]="string",r[r.timestamp=8]="timestamp",r[r.uuid=9]="uuid"})(ba||(ba={}));var Qd=/^[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}$/,Is=class r{constructor(e){m(this,"bytes");if(this.bytes=e,e.byteLength!==8)throw new Error("Int64 buffers must be exactly 8 bytes")}static fromNumber(e){if(e>9223372036854776e3||e<-9223372036854776e3)throw new Error(`${e} is too large (or, if negative, too small) to represent as an Int64`);let t=new Uint8Array(8);for(let n=7,s=Math.abs(Math.round(e));n>-1&&s>0;n--,s/=256)t[n]=s;return e<0&&Ea(t),new r(t)}valueOf(){let e=this.bytes.slice(0),t=e[0]&128;return t&&Ea(e),parseInt(I(e),16)*(t?-1:1)}toString(){return String(this.valueOf())}};function Ea(r){for(let e=0;e<8;e++)r[e]^=255;for(let e=7;e>-1&&(r[e]++,r[e]===0);e--);}var va=(r,e)=>{r=r.toLowerCase();for(let t of Object.keys(e))if(r===t.toLowerCase())return!0;return!1};var Ca=(r,e={})=>{var s,o;let{headers:t,query:n={}}=R.clone(r);for(let i of Object.keys(t)){let a=i.toLowerCase();(a.slice(0,6)==="x-amz-"&&!((s=e.unhoistableHeaders)!=null&&s.has(a))||(o=e.hoistableHeaders)!=null&&o.has(a))&&(n[i]=t[i],delete t[i])}return{...r,headers:t,query:n}};var ks=r=>{r=R.clone(r);for(let e of Object.keys(r.headers))ca.indexOf(e.toLowerCase())>-1&&delete r.headers[e];return r};z();var Aa=({query:r={}})=>{let e=[],t={};for(let n of Object.keys(r)){if(n.toLowerCase()===la)continue;let s=ie(n);e.push(s);let o=r[n];typeof o=="string"?t[s]=`${s}=${ie(o)}`:Array.isArray(o)&&(t[s]=o.slice(0).reduce((i,a)=>i.concat([`${s}=${ie(a)}`]),[]).sort().join("&"))}return e.sort().map(n=>t[n]).filter(n=>n).join("&")};var Ta=r=>Zd(r).toISOString().replace(/\.\d{3}Z$/,"Z"),Zd=r=>typeof r=="number"?new Date(r*1e3):typeof r=="string"?Number(r)?new Date(Number(r)*1e3):new Date(r):r;var hr=class{constructor({applyChecksum:e,credentials:t,region:n,service:s,sha256:o,uriEscapePath:i=!0}){m(this,"service");m(this,"regionProvider");m(this,"credentialProvider");m(this,"sha256");m(this,"uriEscapePath");m(this,"applyChecksum");this.service=s,this.sha256=o,this.uriEscapePath=i,this.applyChecksum=typeof e=="boolean"?e:!0,this.regionProvider=K(n),this.credentialProvider=K(t)}createCanonicalRequest(e,t,n){let s=Object.keys(t).sort();return`${e.method}
${this.getCanonicalPath(e)}
${Aa(e)}
${s.map(o=>`${o}:${t[o]}`).join(`
`)}

${s.join(";")}
${n}`}async createStringToSign(e,t,n,s){let o=new this.sha256;o.update(fe(n));let i=await o.digest();return`${s}
${e}
${t}
${I(i)}`}getCanonicalPath({path:e}){if(this.uriEscapePath){let t=[];for(let o of e.split("/"))(o==null?void 0:o.length)!==0&&o!=="."&&(o===".."?t.pop():t.push(o));let n=`${e!=null&&e.startsWith("/")?"/":""}${t.join("/")}${t.length>0&&(e!=null&&e.endsWith("/"))?"/":""}`;return ie(n).replace(/%2F/g,"/")}return e}validateResolvedCredentials(e){if(typeof e!="object"||typeof e.accessKeyId!="string"||typeof e.secretAccessKey!="string")throw new Error("Resolved credential object is not valid")}formatDate(e){let t=Ta(e).replace(/[\-:]/g,"");return{longDate:t,shortDate:t.slice(0,8)}}getCanonicalHeaderList(e){return Object.keys(e).sort().join(";")}};var It=class extends hr{constructor({applyChecksum:t,credentials:n,region:s,service:o,sha256:i,uriEscapePath:a=!0}){super({applyChecksum:t,credentials:n,region:s,service:o,sha256:i,uriEscapePath:a});m(this,"headerFormatter",new fr)}async presign(t,n={}){let{signingDate:s=new Date,expiresIn:o=3600,unsignableHeaders:i,unhoistableHeaders:a,signableHeaders:c,hoistableHeaders:l,signingRegion:d,signingService:u}=n,f=await this.credentialProvider();this.validateResolvedCredentials(f);let h=d!=null?d:await this.regionProvider(),{longDate:g,shortDate:y}=this.formatDate(s);if(o>ya)return Promise.reject("Signature version 4 presigned URLs must have an expiration date less than one week in the future");let x=pr(y,h,u!=null?u:this.service),S=Ca(ks(t),{unhoistableHeaders:a,hoistableHeaders:l});f.sessionToken&&(S.query[vs]=f.sessionToken),S.query[sa]=ur,S.query[oa]=`${f.accessKeyId}/${x}`,S.query[bs]=g,S.query[aa]=o.toString(10);let w=_s(S,i,c);return S.query[ia]=this.getCanonicalHeaderList(w),S.query[Es]=await this.getSignature(g,x,this.getSigningKey(f,h,y,u),this.createCanonicalRequest(S,w,await mr(t,this.sha256))),S}async sign(t,n){return typeof t=="string"?this.signString(t,n):t.headers&&t.payload?this.signEvent(t,n):t.message?this.signMessage(t,n):this.signRequest(t,n)}async signEvent({headers:t,payload:n},{signingDate:s=new Date,priorSignature:o,signingRegion:i,signingService:a}){let c=i!=null?i:await this.regionProvider(),{shortDate:l,longDate:d}=this.formatDate(s),u=pr(l,c,a!=null?a:this.service),f=await mr({headers:{},body:n},this.sha256),h=new this.sha256;h.update(t);let g=I(await h.digest()),y=[fa,d,u,o,g,f].join(`
`);return this.signString(y,{signingDate:s,signingRegion:c,signingService:a})}async signMessage(t,{signingDate:n=new Date,signingRegion:s,signingService:o}){return this.signEvent({headers:this.headerFormatter.format(t.message.headers),payload:t.message.body},{signingDate:n,signingRegion:s,signingService:o,priorSignature:t.priorSignature}).then(a=>({message:t.message,signature:a}))}async signString(t,{signingDate:n=new Date,signingRegion:s,signingService:o}={}){let i=await this.credentialProvider();this.validateResolvedCredentials(i);let a=s!=null?s:await this.regionProvider(),{shortDate:c}=this.formatDate(n),l=new this.sha256(await this.getSigningKey(i,a,c,o));return l.update(fe(t)),I(await l.digest())}async signRequest(t,{signingDate:n=new Date,signableHeaders:s,unsignableHeaders:o,signingRegion:i,signingService:a}={}){let c=await this.credentialProvider();this.validateResolvedCredentials(c);let l=i!=null?i:await this.regionProvider(),d=ks(t),{longDate:u,shortDate:f}=this.formatDate(n),h=pr(f,l,a!=null?a:this.service);d.headers[As]=u,c.sessionToken&&(d.headers[ua]=c.sessionToken);let g=await mr(d,this.sha256);!va(_t,d.headers)&&this.applyChecksum&&(d.headers[_t]=g);let y=_s(d,o,s),x=await this.getSignature(u,h,this.getSigningKey(c,l,f,a),this.createCanonicalRequest(d,y,g));return d.headers[Cs]=`${ur} Credential=${c.accessKeyId}/${h}, SignedHeaders=${this.getCanonicalHeaderList(y)}, Signature=${x}`,d}async getSignature(t,n,s,o){let i=await this.createStringToSign(t,n,o,ur),a=new this.sha256(await s);return a.update(fe(i)),I(await a.digest())}getSigningKey(t,n,s,o){return Sa(this.sha256,t,s,n,o||this.service)}};var Ra=r=>{let e=r.credentials,t=!!r.credentials,n;Object.defineProperty(r,"credentials",{set(l){l&&l!==e&&l!==n&&(t=!0),e=l;let d=ep(r,{credentials:e,credentialDefaultProvider:r.credentialDefaultProvider}),u=tp(r,d);t&&!u.attributed?(n=async f=>u(f).then(h=>ea(h,"CREDENTIALS_CODE","e")),n.memoized=u.memoized,n.configBound=u.configBound,n.attributed=!0):n=u},get(){return n},enumerable:!0,configurable:!0}),r.credentials=e;let{signingEscapePath:s=!0,systemClockOffset:o=r.systemClockOffset||0,sha256:i}=r,a;return r.signer?a=Le(r.signer):r.regionInfoProvider?a=()=>Le(r.region)().then(async l=>[await r.regionInfoProvider(l,{useFipsEndpoint:await r.useFipsEndpoint(),useDualstackEndpoint:await r.useDualstackEndpoint()})||{},l]).then(([l,d])=>{let{signingRegion:u,signingService:f}=l;r.signingRegion=r.signingRegion||u||d,r.signingName=r.signingName||f||r.serviceId;let h={...r,credentials:r.credentials,region:r.signingRegion,service:r.signingName,sha256:i,uriEscapePath:s},g=r.signerConstructor||It;return new g(h)}):a=async l=>{l=Object.assign({},{name:"sigv4",signingName:r.signingName||r.defaultSigningName,signingRegion:await Le(r.region)(),properties:{}},l);let d=l.signingRegion,u=l.signingName;r.signingRegion=r.signingRegion||d,r.signingName=r.signingName||u||r.serviceId;let f={...r,credentials:r.credentials,region:r.signingRegion,service:r.signingName,sha256:i,uriEscapePath:s},h=r.signerConstructor||It;return new h(f)},Object.assign(r,{systemClockOffset:o,signingEscapePath:s,signer:a})};function ep(r,{credentials:e,credentialDefaultProvider:t}){let n;return e?e!=null&&e.memoized?n=e:n=sr(e,nr,Ct):t?n=Le(t(Object.assign({},r,{parentClientConfig:r}))):n=async()=>{throw new Error("@aws-sdk/core::resolveAwsSdkSigV4Config - `credentials` not provided and no credentialDefaultProvider was configured.")},n.memoized=!0,n}function tp(r,e){if(e.configBound)return e;let t=async n=>e({...n,callerClientConfig:r});return t.memoized=e.memoized,t.configBound=!0,t}var _a=typeof TextEncoder=="function"?new TextEncoder:null,Ia=r=>{if(typeof r=="string"){if(_a)return _a.encode(r).byteLength;let e=r.length;for(let t=e-1;t>=0;t--){let n=r.charCodeAt(t);n>127&&n<=2047?e++:n>2047&&n<=65535&&(e+=2),n>=56320&&n<=57343&&t--}return e}else{if(typeof r.byteLength=="number")return r.byteLength;if(typeof r.size=="number")return r.size}throw new Error(`Body Length computation failed for ${r}`)};var qe=(r,e)=>{let t=[];if(r&&t.push(r),e)for(let n of e)t.push(n);return t},Re=(r,e)=>`${r||"anonymous"}${e&&e.length>0?` (a.k.a. ${e.join(",")})`:""}`,at=()=>{let r=[],e=[],t=!1,n=new Set,s=u=>u.sort((f,h)=>ka[h.step]-ka[f.step]||Ma[h.priority||"normal"]-Ma[f.priority||"normal"]),o=u=>{let f=!1,h=g=>{let y=qe(g.name,g.aliases);if(y.includes(u)){f=!0;for(let x of y)n.delete(x);return!1}return!0};return r=r.filter(h),e=e.filter(h),f},i=u=>{let f=!1,h=g=>{if(g.middleware===u){f=!0;for(let y of qe(g.name,g.aliases))n.delete(y);return!1}return!0};return r=r.filter(h),e=e.filter(h),f},a=u=>{var f;return r.forEach(h=>{u.add(h.middleware,{...h})}),e.forEach(h=>{u.addRelativeTo(h.middleware,{...h})}),(f=u.identifyOnResolve)==null||f.call(u,d.identifyOnResolve()),u},c=u=>{let f=[];return u.before.forEach(h=>{h.before.length===0&&h.after.length===0?f.push(h):f.push(...c(h))}),f.push(u),u.after.reverse().forEach(h=>{h.before.length===0&&h.after.length===0?f.push(h):f.push(...c(h))}),f},l=(u=!1)=>{let f=[],h=[],g={};return r.forEach(x=>{let S={...x,before:[],after:[]};for(let w of qe(S.name,S.aliases))g[w]=S;f.push(S)}),e.forEach(x=>{let S={...x,before:[],after:[]};for(let w of qe(S.name,S.aliases))g[w]=S;h.push(S)}),h.forEach(x=>{if(x.toMiddleware){let S=g[x.toMiddleware];if(S===void 0){if(u)return;throw new Error(`${x.toMiddleware} is not found when adding ${Re(x.name,x.aliases)} middleware ${x.relation} ${x.toMiddleware}`)}x.relation==="after"&&S.after.push(x),x.relation==="before"&&S.before.push(x)}}),s(f).map(c).reduce((x,S)=>(x.push(...S),x),[])},d={add:(u,f={})=>{let{name:h,override:g,aliases:y}=f,x={step:"initialize",priority:"normal",middleware:u,...f},S=qe(h,y);if(S.length>0){if(S.some(w=>n.has(w))){if(!g)throw new Error(`Duplicate middleware name '${Re(h,y)}'`);for(let w of S){let E=r.findIndex(v=>{var M;return v.name===w||((M=v.aliases)==null?void 0:M.some(B=>B===w))});if(E===-1)continue;let b=r[E];if(b.step!==x.step||x.priority!==b.priority)throw new Error(`"${Re(b.name,b.aliases)}" middleware with ${b.priority} priority in ${b.step} step cannot be overridden by "${Re(h,y)}" middleware with ${x.priority} priority in ${x.step} step.`);r.splice(E,1)}}for(let w of S)n.add(w)}r.push(x)},addRelativeTo:(u,f)=>{let{name:h,override:g,aliases:y}=f,x={middleware:u,...f},S=qe(h,y);if(S.length>0){if(S.some(w=>n.has(w))){if(!g)throw new Error(`Duplicate middleware name '${Re(h,y)}'`);for(let w of S){let E=e.findIndex(v=>{var M;return v.name===w||((M=v.aliases)==null?void 0:M.some(B=>B===w))});if(E===-1)continue;let b=e[E];if(b.toMiddleware!==x.toMiddleware||b.relation!==x.relation)throw new Error(`"${Re(b.name,b.aliases)}" middleware ${b.relation} "${b.toMiddleware}" middleware cannot be overridden by "${Re(h,y)}" middleware ${x.relation} "${x.toMiddleware}" middleware.`);e.splice(E,1)}}for(let w of S)n.add(w)}e.push(x)},clone:()=>a(at()),use:u=>{u.applyToStack(d)},remove:u=>typeof u=="string"?o(u):i(u),removeByTag:u=>{let f=!1,h=g=>{let{tags:y,name:x,aliases:S}=g;if(y&&y.includes(u)){let w=qe(x,S);for(let E of w)n.delete(E);return f=!0,!1}return!0};return r=r.filter(h),e=e.filter(h),f},concat:u=>{var h,g;let f=a(at());return f.use(u),f.identifyOnResolve(t||f.identifyOnResolve()||((g=(h=u.identifyOnResolve)==null?void 0:h.call(u))!=null?g:!1)),f},applyToStack:a,identify:()=>l(!0).map(u=>{var h;let f=(h=u.step)!=null?h:u.relation+" "+u.toMiddleware;return Re(u.name,u.aliases)+" - "+f}),identifyOnResolve(u){return typeof u=="boolean"&&(t=u),t},resolve:(u,f)=>{for(let h of l().map(g=>g.middleware).reverse())u=h(u,f);return t&&console.log(d.identify()),u}};return d},ka={initialize:5,serialize:4,build:3,finalizeRequest:2,deserialize:1},Ma={high:3,normal:2,low:1};var gr=class{constructor(e){m(this,"config");m(this,"middlewareStack",at());m(this,"initConfig");m(this,"handlers");this.config=e}send(e,t,n){let s=typeof t!="function"?t:void 0,o=typeof t=="function"?t:n,i=s===void 0&&this.config.cacheMiddleware===!0,a;if(i){this.handlers||(this.handlers=new WeakMap);let c=this.handlers;c.has(e.constructor)?a=c.get(e.constructor):(a=e.resolveMiddleware(this.middlewareStack,this.config,s),c.set(e.constructor,a))}else delete this.handlers,a=e.resolveMiddleware(this.middlewareStack,this.config,s);if(o)a(e).then(c=>o(null,c.output),c=>o(c)).catch(()=>{});else return a(e).then(c=>c.output)}destroy(){var e,t,n;(n=(t=(e=this.config)==null?void 0:e.requestHandler)==null?void 0:t.destroy)==null||n.call(t),delete this.handlers}};var Ms="***SensitiveInformation***";function yr(r,e){if(e==null)return e;let t=C.of(r);if(t.getMergedTraits().sensitive)return Ms;if(t.isListSchema()){if(!!t.getValueSchema().getMergedTraits().sensitive)return Ms}else if(t.isMapSchema()){if(!!t.getKeySchema().getMergedTraits().sensitive||!!t.getValueSchema().getMergedTraits().sensitive)return Ms}else if(t.isStructSchema()&&typeof e=="object"){let n=e,s={};for(let[o,i]of t.structIterator())n[o]!=null&&(s[o]=yr(i,n[o]));return s}return e}var je=class{constructor(){m(this,"middlewareStack",at());m(this,"schema")}static classBuilder(){return new Ps}resolveMiddlewareWithContext(e,t,n,{middlewareFn:s,clientName:o,commandName:i,inputFilterSensitiveLog:a,outputFilterSensitiveLog:c,smithyContext:l,additionalContext:d,CommandCtor:u}){for(let x of s.bind(this)(u,e,t,n))this.middlewareStack.use(x);let f=e.concat(this.middlewareStack),{logger:h}=t,g={logger:h,clientName:o,commandName:i,inputFilterSensitiveLog:a,outputFilterSensitiveLog:c,[wt]:{commandInstance:this,...l},...d},{requestHandler:y}=t;return f.resolve(x=>y.handle(x.request,n||{}),g)}},Ps=class{constructor(){m(this,"_init",()=>{});m(this,"_ep",{});m(this,"_middlewareFn",()=>[]);m(this,"_commandName","");m(this,"_clientName","");m(this,"_additionalContext",{});m(this,"_smithyContext",{});m(this,"_inputFilterSensitiveLog");m(this,"_outputFilterSensitiveLog");m(this,"_serializer",null);m(this,"_deserializer",null);m(this,"_operationSchema")}init(e){this._init=e}ep(e){return this._ep=e,this}m(e){return this._middlewareFn=e,this}s(e,t,n={}){return this._smithyContext={service:e,operation:t,...n},this}c(e={}){return this._additionalContext=e,this}n(e,t){return this._clientName=e,this._commandName=t,this}f(e=n=>n,t=n=>n){return this._inputFilterSensitiveLog=e,this._outputFilterSensitiveLog=t,this}ser(e){return this._serializer=e,this}de(e){return this._deserializer=e,this}sc(e){return this._operationSchema=e,this._smithyContext.operationSchema=e,this}build(){let e=this,t;return t=class extends je{constructor(...[s]){super();m(this,"input");m(this,"serialize",e._serializer);m(this,"deserialize",e._deserializer);this.input=s!=null?s:{},e._init(this),this.schema=e._operationSchema}static getEndpointParameterInstructions(){return e._ep}resolveMiddleware(s,o,i){var d,u,f,h;let a=e._operationSchema,c=(d=a==null?void 0:a[4])!=null?d:a==null?void 0:a.input,l=(u=a==null?void 0:a[5])!=null?u:a==null?void 0:a.output;return this.resolveMiddlewareWithContext(s,o,i,{CommandCtor:t,middlewareFn:e._middlewareFn,clientName:e._clientName,commandName:e._commandName,inputFilterSensitiveLog:(f=e._inputFilterSensitiveLog)!=null?f:a?yr.bind(null,c):g=>g,outputFilterSensitiveLog:(h=e._outputFilterSensitiveLog)!=null?h:a?yr.bind(null,l):g=>g,smithyContext:e._smithyContext,additionalContext:e._additionalContext})}}}};var xr=class r extends Error{constructor(t){super(t.message);m(this,"$fault");m(this,"$response");m(this,"$retryable");m(this,"$metadata");Object.setPrototypeOf(this,Object.getPrototypeOf(this).constructor.prototype),this.name=t.name,this.$fault=t.$fault,this.$metadata=t.$metadata}static isInstance(t){if(!t)return!1;let n=t;return r.prototype.isPrototypeOf(n)||!!n.$fault&&!!n.$metadata&&(n.$fault==="client"||n.$fault==="server")}static[Symbol.hasInstance](t){if(!t)return!1;let n=t;return this===r?r.isInstance(t):r.isInstance(t)?n.name&&this.name?this.prototype.isPrototypeOf(t)||n.name===this.name:this.prototype.isPrototypeOf(t):!1}},Ds=(r,e={})=>{Object.entries(e).filter(([,n])=>n!==void 0).forEach(([n,s])=>{(r[n]==null||r[n]==="")&&(r[n]=s)});let t=r.message||r.Message||"UnknownError";return r.message=t,delete r.Message,r};var Pa=r=>{switch(r){case"standard":return{retryMode:"standard",connectionTimeout:3100};case"in-region":return{retryMode:"standard",connectionTimeout:1100};case"cross-region":return{retryMode:"standard",connectionTimeout:3100};case"mobile":return{retryMode:"standard",connectionTimeout:3e4};default:return{}}};var Da=r=>{let e=[];for(let t in rt){let n=rt[t];r[n]!==void 0&&e.push({algorithmId:()=>n,checksumConstructor:()=>r[n]})}return{addChecksumAlgorithm(t){e.push(t)},checksumAlgorithms(){return e}}},Ba=r=>{let e={};return r.checksumAlgorithms().forEach(t=>{e[t.algorithmId()]=t.checksumConstructor()}),e};var Oa=r=>({setRetryStrategy(e){r.retryStrategy=e},retryStrategy(){return r.retryStrategy}}),Na=r=>{let e={};return e.retryStrategy=r.retryStrategy(),e};var La=r=>Object.assign(Da(r),Oa(r));var $a=r=>Object.assign(Ba(r),Na(r));var ct=class{trace(){}debug(){}info(){}warn(){}error(){}};var Sr=class{constructor(e=!1){m(this,"queryCompat");this.queryCompat=e}resolveRestContentType(e,t){let n=t.getMemberSchemas(),s=Object.values(n).find(o=>!!o.getMergedTraits().httpPayload);if(s){let o=s.getMergedTraits().mediaType;return o||(s.isStringSchema()?"text/plain":s.isBlobSchema()?"application/octet-stream":e)}else if(!t.isUnitSchema()&&Object.values(n).find(i=>{let{httpQuery:a,httpQueryParams:c,httpHeader:l,httpLabel:d,httpPrefixHeaders:u}=i.getMergedTraits();return!a&&!c&&!l&&!d&&u===void 0}))return e}async getErrorSchemaOrThrowBaseException(e,t,n,s,o,i){var u,f,h,g;let a=t,c=e;e.includes("#")&&([a,c]=e.split("#"));let l={$metadata:o,$fault:n.statusCode<500?"client":"server"},d=k.for(a);try{return{errorSchema:(u=i==null?void 0:i(d,c))!=null?u:d.getSchema(e),errorMetadata:l}}catch(y){s.message=(h=(f=s.message)!=null?f:s.Message)!=null?h:"UnknownError";let x=k.for("smithy.ts.sdk.synthetic."+a),S=x.getBaseException();if(S){let w=(g=x.getErrorCtor(S))!=null?g:Error;throw this.decorateServiceException(Object.assign(new w({name:c}),l),s)}throw this.decorateServiceException(Object.assign(new Error(c),l),s)}}decorateServiceException(e,t={}){var n,s,o;if(this.queryCompat){let i=(n=e.Message)!=null?n:t.Message,a=Ds(e,t);i&&(a.message=i),a.Error={...a.Error,Type:a.Error.Type,Code:a.Error.Code,Message:(o=(s=a.Error.message)!=null?s:a.Error.Message)!=null?o:i};let c=a.$metadata.requestId;return c&&(a.RequestId=c),a}return Ds(e,t)}setQueryCompatError(e,t){var s;let n=(s=t.headers)==null?void 0:s["x-amzn-query-error"];if(e!==void 0&&n!=null){let[o,i]=n.split(";"),a=Object.entries(e),c={Code:o,Type:i};Object.assign(e,c);for(let[l,d]of a)c[l==="message"?"Message":l]=d;delete c.__type,e.Error=c}}queryCompatOutput(e,t){e.Error&&(t.Error=e.Error),e.Type&&(t.Type=e.Type),e.Code&&(t.Code=e.Code)}findQueryCompatibleError(e,t){try{return e.getSchema(t)}catch(n){return e.find(s=>{var o;return((o=C.of(s).getMergedTraits().awsQueryError)==null?void 0:o[0])===t})}}};var _e=class{constructor(){m(this,"serdeContext")}setSerdeContext(e){this.serdeContext=e}};function*Ua(r,e){if(r.isUnitSchema())return;let t=r.getSchema();for(let n=0;n<t[4].length;++n){let s=t[4][n],o=t[5][n],i=new C([o,0],s);!(s in e)&&!i.isIdempotencyToken()||(yield[s,i])}}function*Ga(r,e,t){var o;if(r.isUnitSchema())return;let n=r.getSchema(),s=Object.keys(e).filter(i=>i!=="__type").length;for(let i=0;i<n[4].length&&s!==0;++i){let a=n[4][i],c=n[5][i],l=new C([c,0],a),d=a;t&&(d=(o=l.getMergedTraits()[t])!=null?o:a),d in e&&(yield[a,l],s-=1)}}function Fa(r,e,t){if(t!=null&&t.source){let n=t.source;if(typeof e=="number"&&(e>Number.MAX_SAFE_INTEGER||e<Number.MIN_SAFE_INTEGER||n!==String(e)))return n.includes(".")?new L(n,"bigDecimal"):BigInt(n)}return e}z();var Ha=(r,e)=>ve(r,e).then(t=>{var n;return((n=e==null?void 0:e.utf8Encoder)!=null?n:H)(t)});var za=(r,e)=>Ha(r,e).then(t=>{if(t.length)try{return JSON.parse(t)}catch(n){throw(n==null?void 0:n.name)==="SyntaxError"&&Object.defineProperty(n,"$responseBodyText",{value:t}),n}return{}});var qa=(r,e)=>{let t=(o,i)=>Object.keys(o).find(a=>a.toLowerCase()===i.toLowerCase()),n=o=>{let i=o;return typeof i=="number"&&(i=i.toString()),i.indexOf(",")>=0&&(i=i.split(",")[0]),i.indexOf(":")>=0&&(i=i.split(":")[0]),i.indexOf("#")>=0&&(i=i.split("#")[1]),i},s=t(r.headers,"x-amzn-errortype");if(s!==void 0)return n(r.headers[s]);if(e&&typeof e=="object"){let o=t(e,"code");if(o&&e[o]!==void 0)return n(e[o]);if(e.__type!==void 0)return n(e.__type)}};var wr=class extends _e{constructor(t){super();m(this,"settings");this.settings=t}async read(t,n){return this._read(t,typeof n=="string"?JSON.parse(n,Fa):await za(n,this.serdeContext))}readObject(t,n){return this._read(t,n)}_read(t,n){var a;let s=n!==null&&typeof n=="object",o=C.of(t);if(s){if(o.isStructSchema()){let c={};for(let[l,d]of Ga(o,n,this.settings.jsonName?"jsonName":!1)){let u=this.settings.jsonName&&(a=d.getMergedTraits().jsonName)!=null?a:l,f=this._read(d,n[u]);f!=null&&(c[l]=f)}return c}if(Array.isArray(n)&&o.isListSchema()){let c=o.getValueSchema(),l=[],d=!!o.getMergedTraits().sparse;for(let u of n)(d||u!=null)&&l.push(this._read(c,u));return l}if(o.isMapSchema()){let c=o.getValueSchema(),l={},d=!!o.getMergedTraits().sparse;for(let[u,f]of Object.entries(n))(d||f!=null)&&(l[u]=this._read(c,f));return l}}if(o.isBlobSchema()&&typeof n=="string")return re(n);let i=o.getMergedTraits().mediaType;if(o.isStringSchema()&&typeof n=="string"&&i)return i==="application/json"||i.endsWith("+json")?q.from(n):n;if(o.isTimestampSchema()&&n!=null)switch(Te(o,this.settings)){case 5:return pi(n);case 6:return mi(n);case 7:return fi(n);default:return console.warn("Missing timestamp format, parsing value with Date constructor:",n),new Date(n)}if(o.isBigIntegerSchema()&&(typeof n=="number"||typeof n=="string"))return BigInt(n);if(o.isBigDecimalSchema()&&n!=null){if(n instanceof L)return n;let c=n;return c.type==="bigDecimal"&&"string"in c?new L(c.string,c.type):new L(String(n),"bigDecimal")}if(o.isNumericSchema()&&typeof n=="string"){switch(n){case"Infinity":return 1/0;case"-Infinity":return-1/0;case"NaN":return NaN}return n}if(o.isDocumentSchema())if(s){let c=Array.isArray(n)?[]:{};for(let[l,d]of Object.entries(n))d instanceof L?c[l]=d:c[l]=this._read(o,d);return c}else return structuredClone(n);return n}};var ja="\u039D",br=class{constructor(){m(this,"values",new Map);m(this,"counter",0);m(this,"stage",0)}createReplacer(){if(this.stage===1)throw new Error("@aws-sdk/core/protocols - JsonReplacer already created.");if(this.stage===2)throw new Error("@aws-sdk/core/protocols - JsonReplacer exhausted.");return this.stage=1,(e,t)=>{if(t instanceof L){let n=`${ja+"nv"+this.counter++}_`+t.string;return this.values.set(`"${n}"`,t.string),n}if(typeof t=="bigint"){let n=t.toString(),s=`${ja+"b"+this.counter++}_`+n;return this.values.set(`"${s}"`,n),s}return t}}replaceInJson(e){if(this.stage===0)throw new Error("@aws-sdk/core/protocols - JsonReplacer not created yet.");if(this.stage===2)throw new Error("@aws-sdk/core/protocols - JsonReplacer exhausted.");if(this.stage=2,this.counter===0)return e;for(let[t,n]of this.values)e=e.replace(t,n);return e}};var Er=class extends _e{constructor(t){super();m(this,"settings");m(this,"buffer");m(this,"useReplacer",!1);m(this,"rootSchema");this.settings=t}write(t,n){this.rootSchema=C.of(t),this.buffer=this._write(this.rootSchema,n)}writeDiscriminatedDocument(t,n){this.write(t,n),typeof this.buffer=="object"&&(this.buffer.__type=C.of(t).getName(!0))}flush(){let{rootSchema:t,useReplacer:n}=this;if(this.rootSchema=void 0,this.useReplacer=!1,t!=null&&t.isStructSchema()||t!=null&&t.isDocumentSchema()){if(!n)return JSON.stringify(this.buffer);let s=new br;return s.replaceInJson(JSON.stringify(this.buffer,s.createReplacer(),0))}return this.buffer}_write(t,n,s){var a,c,l,d;let o=n!==null&&typeof n=="object",i=C.of(t);if(o){if(i.isStructSchema()){let u={};for(let[f,h]of Ua(i,n)){let g=this._write(h,n[f],i);if(g!==void 0){let y=h.getMergedTraits().jsonName,x=this.settings.jsonName&&y!=null?y:f;u[x]=g}}return u}if(Array.isArray(n)&&i.isListSchema()){let u=i.getValueSchema(),f=[],h=!!i.getMergedTraits().sparse;for(let g of n)(h||g!=null)&&f.push(this._write(u,g));return f}if(i.isMapSchema()){let u=i.getValueSchema(),f={},h=!!i.getMergedTraits().sparse;for(let[g,y]of Object.entries(n))(h||y!=null)&&(f[g]=this._write(u,y));return f}if(n instanceof Uint8Array&&(i.isBlobSchema()||i.isDocumentSchema()))return i===this.rootSchema?n:((c=(a=this.serdeContext)==null?void 0:a.base64Encoder)!=null?c:Y)(n);if(n instanceof Date&&(i.isTimestampSchema()||i.isDocumentSchema()))switch(Te(i,this.settings)){case 5:return n.toISOString().replace(".000Z","Z");case 6:return Wt(n);case 7:return n.getTime()/1e3;default:return console.warn("Missing timestamp format, using epoch seconds",n),n.getTime()/1e3}n instanceof L&&(this.useReplacer=!0)}if(!(n===null&&(s!=null&&s.isStructSchema()))){if(i.isStringSchema()){if(typeof n=="undefined"&&i.isIdempotencyToken())return Ge();let u=i.getMergedTraits().mediaType;return n!=null&&u&&(u==="application/json"||u.endsWith("+json"))?q.from(n):n}if(typeof n=="number"&&i.isNumericSchema())return Math.abs(n)===1/0||isNaN(n)?String(n):n;if(typeof n=="string"&&i.isBlobSchema())return i===this.rootSchema?n:((d=(l=this.serdeContext)==null?void 0:l.base64Encoder)!=null?d:Y)(n);if(typeof n=="bigint"&&(this.useReplacer=!0),i.isDocumentSchema())if(o){let u=Array.isArray(n)?[]:{};for(let[f,h]of Object.entries(n))h instanceof L?(this.useReplacer=!0,u[f]=h):u[f]=this._write(i,h);return u}else return structuredClone(n);return n}}};var vr=class extends _e{constructor(t){super();m(this,"settings");this.settings=t}createSerializer(){let t=new Er(this.settings);return t.setSerdeContext(this.serdeContext),t}createDeserializer(){let t=new wr(this.settings);return t.setSerdeContext(this.serdeContext),t}};var Cr=class extends Yt{constructor({defaultNamespace:t}){super({defaultNamespace:t});m(this,"serializer");m(this,"deserializer");m(this,"codec");m(this,"mixin",new Sr);let n={timestampFormat:{useTrait:!0,default:7},httpBindings:!0,jsonName:!0};this.codec=new vr(n),this.serializer=new er(this.codec.createSerializer(),n),this.deserializer=new Qt(this.codec.createDeserializer(),n)}getShapeId(){return"aws.protocols#restJson1"}getPayloadCodec(){return this.codec}setSerdeContext(t){this.codec.setSerdeContext(t),super.setSerdeContext(t)}async serializeRequest(t,n,s){let o=await super.serializeRequest(t,n,s),i=C.of(t.input);if(!o.headers["content-type"]){let a=this.mixin.resolveRestContentType(this.getDefaultContentType(),i);a&&(o.headers["content-type"]=a)}return o.body==null&&o.headers["content-type"]===this.getDefaultContentType()&&(o.body="{}"),o}async deserializeResponse(t,n,s){let o=await super.deserializeResponse(t,n,s),i=C.of(t.output);for(let[a,c]of i.structIterator())c.getMemberTraits().httpPayload&&!(a in o)&&(o[a]=null);return o}async handleError(t,n,s,o,i){var y,x,S,w,E;let a=(y=qa(s,o))!=null?y:"Unknown",{errorSchema:c,errorMetadata:l}=await this.mixin.getErrorSchemaOrThrowBaseException(a,this.options.defaultNamespace,s,o,i),d=C.of(c),u=(S=(x=o.message)!=null?x:o.Message)!=null?S:"Unknown",f=(w=k.for(c[1]).getErrorCtor(c))!=null?w:Error,h=new f(u);await this.deserializeHttpMessage(c,n,s,o);let g={};for(let[b,v]of d.structIterator()){let M=(E=v.getMergedTraits().jsonName)!=null?E:b;g[b]=this.codec.createDeserializer().readObject(v,o[M])}throw this.mixin.decorateServiceException(Object.assign(h,l,{$fault:d.getMergedTraits().error,message:u},g),o)}getDefaultContentType(){return"application/json"}};var rp=/\d{12}\.ddb/;async function Va(r,e,t){var o,i,a,c,l,d,u,f;let n=t.request;if(((o=n==null?void 0:n.headers)==null?void 0:o["smithy-protocol"])==="rpc-v2-cbor"&&ne(r,"PROTOCOL_RPC_V2_CBOR","M"),typeof e.retryStrategy=="function"){let h=await e.retryStrategy();typeof h.acquireInitialRetryToken=="function"?(a=(i=h.constructor)==null?void 0:i.name)!=null&&a.includes("Adaptive")?ne(r,"RETRY_MODE_ADAPTIVE","F"):ne(r,"RETRY_MODE_STANDARD","E"):ne(r,"RETRY_MODE_LEGACY","D")}if(typeof e.accountIdEndpointMode=="function"){let h=r.endpointV2;switch(String((c=h==null?void 0:h.url)==null?void 0:c.hostname).match(rp)&&ne(r,"ACCOUNT_ID_ENDPOINT","O"),await((l=e.accountIdEndpointMode)==null?void 0:l.call(e))){case"disabled":ne(r,"ACCOUNT_ID_MODE_DISABLED","Q");break;case"preferred":ne(r,"ACCOUNT_ID_MODE_PREFERRED","P");break;case"required":ne(r,"ACCOUNT_ID_MODE_REQUIRED","R");break}}let s=(u=(d=r.__smithy_context)==null?void 0:d.selectedHttpAuthScheme)==null?void 0:u.identity;if(s!=null&&s.$source){let h=s;h.accountId&&ne(r,"RESOLVED_ACCOUNT_ID","T");for(let[g,y]of Object.entries((f=h.$source)!=null?f:{}))ne(r,g,y)}}var Bs="user-agent",Ar="x-amz-user-agent",Os=" ",Tr="/",Wa=/[^!$%&'*+\-.^_`|~\w]/g,Ka=/[^!$%&'*+\-.^_`|~\w#]/g,Ns="-";function Ja(r){let e="";for(let t in r){let n=r[t];if(e.length+n.length+1<=1024){e.length?e+=","+n:e+=n;continue}break}return e}var np=r=>(e,t)=>async n=>{var g,y,x,S;let{request:s}=n;if(!R.isInstance(s))return e(n);let{headers:o}=s,i=((g=t==null?void 0:t.userAgent)==null?void 0:g.map(Rr))||[],a=(await r.defaultUserAgentProvider()).map(Rr);await Va(t,r,n);let c=t;a.push(`m/${Ja(Object.assign({},(y=t.__smithy_context)==null?void 0:y.features,(x=c.__aws_sdk_context)==null?void 0:x.features))}`);let l=((S=r==null?void 0:r.customUserAgent)==null?void 0:S.map(Rr))||[],d=await r.userAgentAppId();d&&a.push(Rr(["app",`${d}`]));let u=Qi(),f=(u?[u]:[]).concat([...a,...i,...l]).join(Os),h=[...a.filter(w=>w.startsWith("aws-sdk-")),...l].join(Os);return r.runtime!=="browser"?(h&&(o[Ar]=o[Ar]?`${o[Bs]} ${h}`:h),o[Bs]=f):o[Ar]=f,e({...n,request:s})},Rr=r=>{var i;let e=r[0].split(Tr).map(a=>a.replace(Wa,Ns)).join(Tr),t=(i=r[1])==null?void 0:i.replace(Ka,Ns),n=e.indexOf(Tr),s=e.substring(0,n),o=e.substring(n+1);return s==="api"&&(o=o.toLowerCase()),[s,o,t].filter(a=>a&&a.length>0).reduce((a,c,l)=>{switch(l){case 0:return c;case 1:return`${a}/${c}`;default:return`${a}#${c}`}},"")},sp={name:"getUserAgentMiddleware",step:"build",priority:"low",tags:["SET_USER_AGENT","USER_AGENT"],override:!0},Ya=r=>({applyToStack:e=>{e.add(np(r),sp)}});function _r(r,e,t,n){function s(o){return o instanceof t?o:new t(function(i){i(o)})}return new(t||(t=Promise))(function(o,i){function a(d){try{l(n.next(d))}catch(u){i(u)}}function c(d){try{l(n.throw(d))}catch(u){i(u)}}function l(d){d.done?o(d.value):s(d.value).then(a,c)}l((n=n.apply(r,e||[])).next())})}function Ir(r,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,s,o,i=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return i.next=a(0),i.throw=a(1),i.return=a(2),typeof Symbol=="function"&&(i[Symbol.iterator]=function(){return this}),i;function a(l){return function(d){return c([l,d])}}function c(l){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(t=0)),t;)try{if(n=1,s&&(o=l[0]&2?s.return:l[0]?s.throw||((o=s.return)&&o.call(s),0):s.next)&&!(o=o.call(s,l[1])).done)return o;switch(s=0,o&&(l=[l[0]&2,o.value]),l[0]){case 0:case 1:o=l;break;case 4:return t.label++,{value:l[1],done:!1};case 5:t.label++,s=l[1],l=[0];continue;case 7:l=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(l[0]===6||l[0]===2)){t=0;continue}if(l[0]===3&&(!o||l[1]>o[0]&&l[1]<o[3])){t.label=l[1];break}if(l[0]===6&&t.label<o[1]){t.label=o[1],o=l;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(l);break}o[2]&&t.ops.pop(),t.trys.pop();continue}l=e.call(r,t)}catch(d){l=[6,d],s=0}finally{n=o=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function Xa(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var Ls=r=>new TextEncoder().encode(r);var op=typeof Buffer!="undefined"&&Buffer.from?function(r){return Buffer.from(r,"utf8")}:Ls;function se(r){return r instanceof Uint8Array?r:typeof r=="string"?op(r):ArrayBuffer.isView(r)?new Uint8Array(r.buffer,r.byteOffset,r.byteLength/Uint8Array.BYTES_PER_ELEMENT):new Uint8Array(r)}function Ie(r){return typeof r=="string"?r.length===0:r.byteLength===0}function $s(r){return new Uint8Array([(r&4278190080)>>24,(r&16711680)>>16,(r&65280)>>8,r&255])}function Us(r){if(!Uint32Array.from){for(var e=new Uint32Array(r.length),t=0;t<r.length;)e[t]=r[t],t+=1;return e}return Uint32Array.from(r)}var ip=function(){function r(){this.crc32=new Ve}return r.prototype.update=function(e){Ie(e)||this.crc32.update(se(e))},r.prototype.digest=function(){return _r(this,void 0,void 0,function(){return Ir(this,function(e){return[2,$s(this.crc32.digest())]})})},r.prototype.reset=function(){this.crc32=new Ve},r}();var Ve=function(){function r(){this.checksum=4294967295}return r.prototype.update=function(e){var t,n;try{for(var s=Xa(e),o=s.next();!o.done;o=s.next()){var i=o.value;this.checksum=this.checksum>>>8^cp[(this.checksum^i)&255]}}catch(a){t={error:a}}finally{try{o&&!o.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}return this},r.prototype.digest=function(){return(this.checksum^4294967295)>>>0},r}();var ap=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],cp=Us(ap);var lt=class r{constructor(e){m(this,"bytes");if(this.bytes=e,e.byteLength!==8)throw new Error("Int64 buffers must be exactly 8 bytes")}static fromNumber(e){if(e>9223372036854776e3||e<-9223372036854776e3)throw new Error(`${e} is too large (or, if negative, too small) to represent as an Int64`);let t=new Uint8Array(8);for(let n=7,s=Math.abs(Math.round(e));n>-1&&s>0;n--,s/=256)t[n]=s;return e<0&&Qa(t),new r(t)}valueOf(){let e=this.bytes.slice(0),t=e[0]&128;return t&&Qa(e),parseInt(I(e),16)*(t?-1:1)}toString(){return String(this.valueOf())}};function Qa(r){for(let e=0;e<8;e++)r[e]^=255;for(let e=7;e>-1&&(r[e]++,r[e]===0);e--);}var kr=class{constructor(e,t){m(this,"toUtf8");m(this,"fromUtf8");this.toUtf8=e,this.fromUtf8=t}format(e){let t=[];for(let o of Object.keys(e)){let i=this.fromUtf8(o);t.push(Uint8Array.from([i.byteLength]),i,this.formatHeaderValue(e[o]))}let n=new Uint8Array(t.reduce((o,i)=>o+i.byteLength,0)),s=0;for(let o of t)n.set(o,s),s+=o.byteLength;return n}formatHeaderValue(e){switch(e.type){case"boolean":return Uint8Array.from([e.value?0:1]);case"byte":return Uint8Array.from([2,e.value]);case"short":let t=new DataView(new ArrayBuffer(3));return t.setUint8(0,3),t.setInt16(1,e.value,!1),new Uint8Array(t.buffer);case"integer":let n=new DataView(new ArrayBuffer(5));return n.setUint8(0,4),n.setInt32(1,e.value,!1),new Uint8Array(n.buffer);case"long":let s=new Uint8Array(9);return s[0]=5,s.set(e.value.bytes,1),s;case"binary":let o=new DataView(new ArrayBuffer(3+e.value.byteLength));o.setUint8(0,6),o.setUint16(1,e.value.byteLength,!1);let i=new Uint8Array(o.buffer);return i.set(e.value,3),i;case"string":let a=this.fromUtf8(e.value),c=new DataView(new ArrayBuffer(3+a.byteLength));c.setUint8(0,7),c.setUint16(1,a.byteLength,!1);let l=new Uint8Array(c.buffer);return l.set(a,3),l;case"timestamp":let d=new Uint8Array(9);return d[0]=8,d.set(lt.fromNumber(e.value.valueOf()).bytes,1),d;case"uuid":if(!yp.test(e.value))throw new Error(`Invalid UUID received: ${e.value}`);let u=new Uint8Array(17);return u[0]=9,u.set(st(e.value.replace(/\-/g,"")),1),u}}parse(e){let t={},n=0;for(;n<e.byteLength;){let s=e.getUint8(n++),o=this.toUtf8(new Uint8Array(e.buffer,e.byteOffset+n,s));switch(n+=s,e.getUint8(n++)){case 0:t[o]={type:ec,value:!0};break;case 1:t[o]={type:ec,value:!1};break;case 2:t[o]={type:lp,value:e.getInt8(n++)};break;case 3:t[o]={type:up,value:e.getInt16(n,!1)},n+=2;break;case 4:t[o]={type:dp,value:e.getInt32(n,!1)},n+=4;break;case 5:t[o]={type:pp,value:new lt(new Uint8Array(e.buffer,e.byteOffset+n,8))},n+=8;break;case 6:let i=e.getUint16(n,!1);n+=2,t[o]={type:mp,value:new Uint8Array(e.buffer,e.byteOffset+n,i)},n+=i;break;case 7:let a=e.getUint16(n,!1);n+=2,t[o]={type:fp,value:this.toUtf8(new Uint8Array(e.buffer,e.byteOffset+n,a))},n+=a;break;case 8:t[o]={type:hp,value:new Date(new lt(new Uint8Array(e.buffer,e.byteOffset+n,8)).valueOf())},n+=8;break;case 9:let c=new Uint8Array(e.buffer,e.byteOffset+n,16);n+=16,t[o]={type:gp,value:`${I(c.subarray(0,4))}-${I(c.subarray(4,6))}-${I(c.subarray(6,8))}-${I(c.subarray(8,10))}-${I(c.subarray(10))}`};break;default:throw new Error("Unrecognized header type tag")}}return t}},Za;(function(r){r[r.boolTrue=0]="boolTrue",r[r.boolFalse=1]="boolFalse",r[r.byte=2]="byte",r[r.short=3]="short",r[r.integer=4]="integer",r[r.long=5]="long",r[r.byteArray=6]="byteArray",r[r.string=7]="string",r[r.timestamp=8]="timestamp",r[r.uuid=9]="uuid"})(Za||(Za={}));var ec="boolean",lp="byte",up="short",dp="integer",pp="long",mp="binary",fp="string",hp="timestamp",gp="uuid",yp=/^[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}$/;var tc=4,ke=tc*2,We=4,xp=ke+We*2;function rc({byteLength:r,byteOffset:e,buffer:t}){if(r<xp)throw new Error("Provided message too short to accommodate event stream message overhead");let n=new DataView(t,e,r),s=n.getUint32(0,!1);if(r!==s)throw new Error("Reported message length does not match received message length");let o=n.getUint32(tc,!1),i=n.getUint32(ke,!1),a=n.getUint32(r-We,!1),c=new Ve().update(new Uint8Array(t,e,ke));if(i!==c.digest())throw new Error(`The prelude checksum specified in the message (${i}) does not match the calculated CRC32 checksum (${c.digest()})`);if(c.update(new Uint8Array(t,e+ke,r-(ke+We))),a!==c.digest())throw new Error(`The message checksum (${c.digest()}) did not match the expected value of ${a}`);return{headers:new DataView(t,e+ke+We,o),body:new Uint8Array(t,e+ke+We+o,s-o-(ke+We+We))}}var ut=class{constructor(e,t){m(this,"headerMarshaller");m(this,"messageBuffer");m(this,"isEndOfStream");this.headerMarshaller=new kr(e,t),this.messageBuffer=[],this.isEndOfStream=!1}feed(e){this.messageBuffer.push(this.decode(e))}endOfStream(){this.isEndOfStream=!0}getMessage(){let e=this.messageBuffer.pop(),t=this.isEndOfStream;return{getMessage(){return e},isEndOfStream(){return t}}}getAvailableMessages(){let e=this.messageBuffer;this.messageBuffer=[];let t=this.isEndOfStream;return{getMessages(){return e},isEndOfStream(){return t}}}encode({headers:e,body:t}){let n=this.headerMarshaller.format(e),s=n.byteLength+t.byteLength+16,o=new Uint8Array(s),i=new DataView(o.buffer,o.byteOffset,o.byteLength),a=new Ve;return i.setUint32(0,s,!1),i.setUint32(4,n.byteLength,!1),i.setUint32(8,a.update(o.subarray(0,8)).digest(),!1),o.set(n,12),o.set(t,n.byteLength+12),i.setUint32(s-4,a.update(o.subarray(8,s-4)).digest(),!1),o}decode(e){let{headers:t,body:n}=rc(e);return{headers:this.headerMarshaller.parse(t),body:n}}formatHeaders(e){return this.headerMarshaller.format(e)}};var Mr=class{constructor(e){m(this,"options");this.options=e}[Symbol.asyncIterator](){return this.asyncIterator()}async*asyncIterator(){for await(let e of this.options.inputStream)yield this.options.decoder.decode(e)}};var Pr=class{constructor(e){m(this,"options");this.options=e}[Symbol.asyncIterator](){return this.asyncIterator()}async*asyncIterator(){for await(let e of this.options.messageStream)yield this.options.encoder.encode(e);this.options.includeEndFrame&&(yield new Uint8Array(0))}};var Dr=class{constructor(e){m(this,"options");this.options=e}[Symbol.asyncIterator](){return this.asyncIterator()}async*asyncIterator(){for await(let e of this.options.messageStream){let t=await this.options.deserializer(e);t!==void 0&&(yield t)}}};var Br=class{constructor(e){m(this,"options");this.options=e}[Symbol.asyncIterator](){return this.asyncIterator()}async*asyncIterator(){for await(let e of this.options.inputStream)yield this.options.serializer(e)}};var nc=(r,e,t,n)=>{let s=r,o={start(){},async transform(i,a){try{let c=new Date(Date.now()+await n()),l={":date":{type:"timestamp",value:c}},d=await e.sign({message:{body:i,headers:l},priorSignature:s},{signingDate:c});s=d.signature;let u=t.encode({headers:{...l,":chunk-signature":{type:"binary",value:st(d.signature)}},body:i});a.enqueue(u)}catch(c){a.error(c)}}};return new TransformStream({...o})};var Or=class{constructor(e){m(this,"messageSigner");m(this,"eventStreamCodec");m(this,"systemClockOffsetProvider");this.messageSigner=e.messageSigner,this.eventStreamCodec=new ut(e.utf8Encoder,e.utf8Decoder),this.systemClockOffsetProvider=async()=>{var t;return(t=e.systemClockOffset)!=null?t:0}}async handle(e,t,n={}){let s=t.request,{body:o,headers:i,query:a}=s;if(!(o instanceof ReadableStream))throw new Error("Eventstream payload must be a ReadableStream.");let c=new TransformStream;s.body=c.readable;let l;try{l=await e(t)}catch(g){throw s.body.cancel(),g}let u=((i.authorization||"").match(/Signature=([\w]+)$/)||[])[1]||a&&a["X-Amz-Signature"]||"",f=nc(u,await this.messageSigner(),this.eventStreamCodec,this.systemClockOffsetProvider);return o.pipeThrough(f).pipeThrough(c),l}};var sc=r=>new Or(r);var Nr=r=>r.protocol==="ws:"||r.protocol==="wss:";var Lr=class{constructor(e){m(this,"signer");this.signer=e.signer}presign(e,t={}){return this.signer.presign(e,t)}async sign(e,t){return R.isInstance(e)&&Nr(e)?{...await this.signer.presign({...e,body:""},{...t,expiresIn:60,unsignableHeaders:new Set(Object.keys(e.headers).filter(s=>s!=="host"))}),body:e.body}:this.signer.sign(e,t)}};var oc=r=>{let{signer:e}=r;return Object.assign(r,{signer:async t=>{let n=await e(t);if(Sp(n))return new Lr({signer:n});throw new Error("Expected WebsocketSignatureV4 signer, please check the client constructor.")}})},Sp=r=>!!r;function ic(r){var l,d;let{port:e,query:t}=r,{protocol:n,path:s,hostname:o}=r;n&&n.slice(-1)!==":"&&(n+=":"),e&&(o+=`:${e}`),s&&s.charAt(0)!=="/"&&(s=`/${s}`);let i=t?Ft(t):"";i&&i[0]!=="?"&&(i=`?${i}`);let a="";if(r.username!=null||r.password!=null){let u=(l=r.username)!=null?l:"",f=(d=r.password)!=null?d:"";a=`${u}:${f}@`}let c="";return r.fragment&&(c=`#${r.fragment}`),`${n}//${a}${o}${s}${i}${c}`}function ac(r){let e=0,t=0,n=null,s=null,o=a=>{if(typeof a!="number")throw new Error("Attempted to allocate an event message where size was not a number: "+a);e=a,t=4,n=new Uint8Array(a),new DataView(n.buffer).setUint32(0,a,!1)},i=async function*(){let a=r[Symbol.asyncIterator]();for(;;){let{value:c,done:l}=await a.next();if(l){if(e)if(e===t)yield n;else throw new Error("Truncated event message received.");else return;return}let d=c.length,u=0;for(;u<d;){if(!n){let h=d-u;s||(s=new Uint8Array(4));let g=Math.min(4-t,h);if(s.set(c.slice(u,u+g),t),t+=g,u+=g,t<4)break;o(new DataView(s.buffer).getUint32(0,!1)),s=null}let f=Math.min(e-t,d-u);n.set(c.slice(u,u+f),t),t+=f,u+=f,e&&e===t&&(yield n,n=null,e=0,t=0)}}};return{[Symbol.asyncIterator]:i}}function cc(r,e){return async function(t){let{value:n}=t.headers[":message-type"];if(n==="error"){let s=new Error(t.headers[":error-message"].value||"UnknownError");throw s.name=t.headers[":error-code"].value,s}else if(n==="exception"){let s=t.headers[":exception-type"].value,o={[s]:t},i=await r(o);if(i.$unknown){let a=new Error(e(t.body));throw a.name=s,a}throw i[s]}else if(n==="event"){let s={[t.headers[":event-type"].value]:t},o=await r(s);return o.$unknown?void 0:o}else throw Error(`Unrecognizable event type: ${t.headers[":event-type"].value}`)}}var $r=class{constructor({utf8Encoder:e,utf8Decoder:t}){m(this,"eventStreamCodec");m(this,"utfEncoder");this.eventStreamCodec=new ut(e,t),this.utfEncoder=e}deserialize(e,t){let n=ac(e);return new Dr({messageStream:new Mr({inputStream:n,decoder:this.eventStreamCodec}),deserializer:cc(t,this.utfEncoder)})}serialize(e,t){return new Pr({messageStream:new Br({inputStream:e,serializer:t}),encoder:this.eventStreamCodec,includeEndFrame:!0})}};var Ur=r=>({[Symbol.asyncIterator]:async function*(){let e=r.getReader();try{for(;;){let{done:t,value:n}=await e.read();if(t)return;yield n}}finally{e.releaseLock()}}}),Gr=r=>{let e=r[Symbol.asyncIterator]();return new ReadableStream({async pull(t){let{done:n,value:s}=await e.next();if(n)return t.close();t.enqueue(s)}})};var Fr=class{constructor({utf8Encoder:e,utf8Decoder:t}){m(this,"universalMarshaller");this.universalMarshaller=new $r({utf8Decoder:t,utf8Encoder:e})}deserialize(e,t){let n=wp(e)?Ur(e):e;return this.universalMarshaller.deserialize(n,t)}serialize(e,t){let n=this.universalMarshaller.serialize(e,t);return typeof ReadableStream=="function"?Gr(n):n}},wp=r=>typeof ReadableStream=="function"&&r instanceof ReadableStream;var lc=r=>new Fr(r);var bp=2e3,Hr=class r{constructor(e,t=new Ue){m(this,"metadata",{handlerProtocol:"websocket/h1.1"});m(this,"config");m(this,"configPromise");m(this,"httpHandler");m(this,"sockets",{});this.httpHandler=t,typeof e=="function"?(this.config={},this.configPromise=e().then(n=>this.config=n!=null?n:{})):(this.config=e!=null?e:{},this.configPromise=Promise.resolve(this.config))}static create(e,t=new Ue){return typeof(e==null?void 0:e.handle)=="function"?e:new r(e,t)}destroy(){for(let[e,t]of Object.entries(this.sockets)){for(let n of t)n.close(1e3,"Socket closed through destroy() call");delete this.sockets[e]}}async handle(e){if(!Nr(e))return this.httpHandler.handle(e);let t=ic(e),n=new WebSocket(t);this.sockets[t]||(this.sockets[t]=[]),this.sockets[t].push(n),n.binaryType="arraybuffer",this.config=await this.configPromise;let{connectionTimeout:s=bp}=this.config;await this.waitForReady(n,s);let{body:o}=e,i=Ep(o),a=this.connect(n,i),c=vp(a);return{response:new $({statusCode:200,body:c})}}updateHttpClientConfig(e,t){this.configPromise=this.configPromise.then(n=>(n[e]=t,n))}httpHandlerConfigs(){var e;return(e=this.config)!=null?e:{}}removeNotUsableSockets(e){var t;this.sockets[e]=((t=this.sockets[e])!=null?t:[]).filter(n=>![WebSocket.CLOSING,WebSocket.CLOSED].includes(n.readyState))}waitForReady(e,t){return new Promise((n,s)=>{let o=setTimeout(()=>{this.removeNotUsableSockets(e.url),s({$metadata:{httpStatusCode:500}})},t);e.onopen=()=>{clearTimeout(o),n()}})}connect(e,t){let n,s=!1,o=()=>{},i=()=>{};e.onmessage=l=>{i({done:!1,value:new Uint8Array(l.data)})},e.onerror=l=>{s=!0,e.close(),o(l)},e.onclose=()=>{this.removeNotUsableSockets(e.url),!s&&(n?o(n):i({done:!0,value:void 0}))};let a={[Symbol.asyncIterator]:()=>({next:()=>new Promise((l,d)=>{i=l,o=d})})};return(async()=>{try{for await(let l of t)e.send(l)}catch(l){n=l}finally{e.close(1e3)}})(),a}},Ep=r=>r[Symbol.asyncIterator]?r:Cp(r)?Ur(r):{[Symbol.asyncIterator]:async function*(){yield r}},vp=r=>typeof ReadableStream=="function"?Gr(r):r,Cp=r=>typeof ReadableStream=="function"&&r instanceof ReadableStream;var uc=!1;var dc=!1;var pc=new Set,mc=(r,e=Fe)=>{if(!pc.has(r)&&!e(r))if(r==="*")console.warn('@smithy/config-resolver WARN - Please use the caller region instead of "*". See "sigv4a" in https://github.com/aws/aws-sdk-js-v3/blob/main/supplemental-docs/CLIENTS.md.');else throw new Error(`Region not accepted: region="${r}" is not a valid hostname component.`);else pc.add(r)};var zr=r=>typeof r=="string"&&(r.startsWith("fips-")||r.endsWith("-fips"));var fc=r=>zr(r)?["fips-aws-global","aws-fips"].includes(r)?"us-east-1":r.replace(/fips-(dkr-|prod-)?|-fips/,""):r;var hc=r=>{let{region:e,useFipsEndpoint:t}=r;if(!e)throw new Error("Region is missing");return Object.assign(r,{region:async()=>{let n=typeof e=="function"?await e():e,s=fc(n);return mc(s),s},useFipsEndpoint:async()=>{let n=typeof e=="string"?e:await e();return zr(n)?!0:typeof t!="function"?Promise.resolve(!!t):t()}})};var gc=r=>Object.assign(r,{eventStreamMarshaller:r.eventStreamSerdeProvider(r)});var yc="content-length";function Ap(r){return e=>async t=>{let n=t.request;if(R.isInstance(n)){let{body:s,headers:o}=n;if(s&&Object.keys(o).map(i=>i.toLowerCase()).indexOf(yc)===-1)try{let i=r(s);n.headers={...n.headers,[yc]:String(i)}}catch(i){}}return e({...t,request:n})}}var Tp={step:"build",tags:["SET_CONTENT_LENGTH","CONTENT_LENGTH"],name:"contentLengthMiddleware",override:!0},xc=r=>({applyToStack:e=>{e.add(Ap(r.bodyLengthChecker),Tp)}});var Sc=async r=>{let e=(r==null?void 0:r.Bucket)||"";if(typeof r.Bucket=="string"&&(r.Bucket=e.replace(/#/g,encodeURIComponent("#")).replace(/\?/g,encodeURIComponent("?"))),Mp(e)){if(r.ForcePathStyle===!0)throw new Error("Path-style addressing cannot be used with ARN buckets")}else(!kp(e)||e.indexOf(".")!==-1&&!String(r.Endpoint).startsWith("http:")||e.toLowerCase()!==e||e.length<3)&&(r.ForcePathStyle=!0);return r.DisableMultiRegionAccessPoints&&(r.disableMultiRegionAccessPoints=!0,r.DisableMRAP=!0),r},Rp=/^[a-z0-9][a-z0-9\.\-]{1,61}[a-z0-9]$/,_p=/(\d+\.){3}\d+/,Ip=/\.\./;var kp=r=>Rp.test(r)&&!_p.test(r)&&!Ip.test(r),Mp=r=>{let[e,t,n,,,s]=r.split(":"),o=e==="arn"&&r.split(":").length>=6,i=!!(o&&t&&n&&s);if(o&&!i)throw new Error(`Invalid ARN: ${r} was an invalid ARN.`);return i};var wc=(r,e,t)=>{let n=async()=>{var o;let s=(o=t[r])!=null?o:t[e];return typeof s=="function"?s():s};return r==="credentialScope"||e==="CredentialScope"?async()=>{var i;let s=typeof t.credentials=="function"?await t.credentials():t.credentials;return(i=s==null?void 0:s.credentialScope)!=null?i:s==null?void 0:s.CredentialScope}:r==="accountId"||e==="AccountId"?async()=>{var i;let s=typeof t.credentials=="function"?await t.credentials():t.credentials;return(i=s==null?void 0:s.accountId)!=null?i:s==null?void 0:s.AccountId}:r==="endpoint"||e==="endpoint"?async()=>{if(t.isCustomEndpoint===!1)return;let s=await n();if(s&&typeof s=="object"){if("url"in s)return s.url.href;if("hostname"in s){let{protocol:o,hostname:i,port:a,path:c}=s;return`${o}//${i}${a?":"+a:""}${c}`}}return s}:n};var qr=async r=>{};var jr=r=>typeof r=="object"?"url"in r?it(r.url):r:it(r);var bc=async(r,e,t,n)=>{if(!t.isCustomEndpoint){let i;t.serviceConfiguredEndpoint?i=await t.serviceConfiguredEndpoint():i=await qr(t.serviceId),i&&(t.endpoint=()=>Promise.resolve(jr(i)),t.isCustomEndpoint=!0)}let s=await Pp(r,e,t);if(typeof t.endpointProvider!="function")throw new Error("config.endpointProvider is not set.");return t.endpointProvider(s,n)},Pp=async(r,e,t)=>{var o;let n={},s=((o=e==null?void 0:e.getEndpointParameterInstructions)==null?void 0:o.call(e))||{};for(let[i,a]of Object.entries(s))switch(a.type){case"staticContextParams":n[i]=a.value;break;case"contextParams":n[i]=r[a.name];break;case"clientContextParams":case"builtInParams":n[i]=await wc(a.name,i,t)();break;case"operationContextParams":n[i]=a.get(r);break;default:throw new Error("Unrecognized endpoint parameter instruction: "+JSON.stringify(a))}return Object.keys(s).length===0&&Object.assign(n,t),String(t.serviceId).toLowerCase()==="s3"&&await Sc(n),n};var Ec=({config:r,instructions:e})=>(t,n)=>async s=>{var a,c,l;r.isCustomEndpoint&&Ti(n,"ENDPOINT_OVERRIDE","N");let o=await bc(s.input,{getEndpointParameterInstructions(){return e}},{...r},n);n.endpointV2=o,n.authSchemes=(a=o.properties)==null?void 0:a.authSchemes;let i=(c=n.authSchemes)==null?void 0:c[0];if(i){n.signing_region=i.signingRegion,n.signing_service=i.signingName;let d=J(n),u=(l=d==null?void 0:d.selectedHttpAuthScheme)==null?void 0:l.httpAuthOption;u&&(u.signingProperties=Object.assign(u.signingProperties||{},{signing_region:i.signingRegion,signingRegion:i.signingRegion,signing_service:i.signingName,signingName:i.signingName,signingRegionSet:i.signingRegionSet},i.properties))}return t({...s})};var Dp={step:"serialize",tags:["ENDPOINT_PARAMETERS","ENDPOINT_V2","ENDPOINT"],name:"endpointV2Middleware",override:!0,relation:"before",toMiddleware:zo.name},Vr=(r,e)=>({applyToStack:t=>{t.addRelativeTo(Ec({config:r,instructions:e}),Dp)}});var vc=r=>{var l;let e=(l=r.tls)!=null?l:!0,{endpoint:t,useDualstackEndpoint:n,useFipsEndpoint:s}=r,o=t!=null?async()=>jr(await K(t)()):void 0,a=Object.assign(r,{endpoint:o,tls:e,isCustomEndpoint:!!t,useDualstackEndpoint:K(n!=null?n:!1),useFipsEndpoint:K(s!=null?s:!1)}),c;return a.serviceConfiguredEndpoint=async()=>(r.serviceId&&!c&&(c=qr(r.serviceId)),c),a};var xe;(function(r){r.STANDARD="standard",r.ADAPTIVE="adaptive"})(xe||(xe={}));var Ke=3,Gs=xe.STANDARD;var Cc=["BandwidthLimitExceeded","EC2ThrottledException","LimitExceededException","PriorRequestNotComplete","ProvisionedThroughputExceededException","RequestLimitExceeded","RequestThrottled","RequestThrottledException","SlowDown","ThrottledException","Throttling","ThrottlingException","TooManyRequestsException","TransactionInProgressException"],Ac=["TimeoutError","RequestTimeout","RequestTimeoutException"],Tc=[500,502,503,504],Rc=["ECONNRESET","ECONNREFUSED","EPIPE","ETIMEDOUT"],_c=["EHOSTUNREACH","ENETUNREACH","ENOTFOUND"];var Bp=r=>(r==null?void 0:r.$retryable)!==void 0;var Op=r=>{var e;return(e=r.$metadata)==null?void 0:e.clockSkewCorrected},Np=r=>{let e=new Set(["Failed to fetch","NetworkError when attempting to fetch resource","The Internet connection appears to be offline","Load failed","Network request failed"]);return r&&r instanceof TypeError?e.has(r.message):!1},Wr=r=>{var e,t;return((e=r.$metadata)==null?void 0:e.httpStatusCode)===429||Cc.includes(r.name)||((t=r.$retryable)==null?void 0:t.throttling)==!0},Kr=(r,e=0)=>{var t;return Bp(r)||Op(r)||Ac.includes(r.name)||Rc.includes((r==null?void 0:r.code)||"")||_c.includes((r==null?void 0:r.code)||"")||Tc.includes(((t=r.$metadata)==null?void 0:t.httpStatusCode)||0)||Np(r)||r.cause!==void 0&&e<=10&&Kr(r.cause,e+1)},Ic=r=>{var e;if(((e=r.$metadata)==null?void 0:e.httpStatusCode)!==void 0){let t=r.$metadata.httpStatusCode;return 500<=t&&t<=599&&!Kr(r)}return!1};var Yr=class Yr{constructor(e){m(this,"beta");m(this,"minCapacity");m(this,"minFillRate");m(this,"scaleConstant");m(this,"smooth");m(this,"currentCapacity",0);m(this,"enabled",!1);m(this,"lastMaxRate",0);m(this,"measuredTxRate",0);m(this,"requestCount",0);m(this,"fillRate");m(this,"lastThrottleTime");m(this,"lastTimestamp",0);m(this,"lastTxRateBucket");m(this,"maxCapacity");m(this,"timeWindow",0);var n,s,o,i,a;this.beta=(n=e==null?void 0:e.beta)!=null?n:.7,this.minCapacity=(s=e==null?void 0:e.minCapacity)!=null?s:1,this.minFillRate=(o=e==null?void 0:e.minFillRate)!=null?o:.5,this.scaleConstant=(i=e==null?void 0:e.scaleConstant)!=null?i:.4,this.smooth=(a=e==null?void 0:e.smooth)!=null?a:.8;let t=this.getCurrentTimeInSeconds();this.lastThrottleTime=t,this.lastTxRateBucket=Math.floor(this.getCurrentTimeInSeconds()),this.fillRate=this.minFillRate,this.maxCapacity=this.minCapacity}getCurrentTimeInSeconds(){return Date.now()/1e3}async getSendToken(){return this.acquireTokenBucket(1)}async acquireTokenBucket(e){if(this.enabled){if(this.refillTokenBucket(),e>this.currentCapacity){let t=(e-this.currentCapacity)/this.fillRate*1e3;await new Promise(n=>Yr.setTimeoutFn(n,t))}this.currentCapacity=this.currentCapacity-e}}refillTokenBucket(){let e=this.getCurrentTimeInSeconds();if(!this.lastTimestamp){this.lastTimestamp=e;return}let t=(e-this.lastTimestamp)*this.fillRate;this.currentCapacity=Math.min(this.maxCapacity,this.currentCapacity+t),this.lastTimestamp=e}updateClientSendingRate(e){let t;if(this.updateMeasuredRate(),Wr(e)){let s=this.enabled?Math.min(this.measuredTxRate,this.fillRate):this.measuredTxRate;this.lastMaxRate=s,this.calculateTimeWindow(),this.lastThrottleTime=this.getCurrentTimeInSeconds(),t=this.cubicThrottle(s),this.enableTokenBucket()}else this.calculateTimeWindow(),t=this.cubicSuccess(this.getCurrentTimeInSeconds());let n=Math.min(t,2*this.measuredTxRate);this.updateTokenBucketRate(n)}calculateTimeWindow(){this.timeWindow=this.getPrecise(Math.pow(this.lastMaxRate*(1-this.beta)/this.scaleConstant,1/3))}cubicThrottle(e){return this.getPrecise(e*this.beta)}cubicSuccess(e){return this.getPrecise(this.scaleConstant*Math.pow(e-this.lastThrottleTime-this.timeWindow,3)+this.lastMaxRate)}enableTokenBucket(){this.enabled=!0}updateTokenBucketRate(e){this.refillTokenBucket(),this.fillRate=Math.max(e,this.minFillRate),this.maxCapacity=Math.max(e,this.minCapacity),this.currentCapacity=Math.min(this.currentCapacity,this.maxCapacity)}updateMeasuredRate(){let e=this.getCurrentTimeInSeconds(),t=Math.floor(e*2)/2;if(this.requestCount++,t>this.lastTxRateBucket){let n=this.requestCount/(t-this.lastTxRateBucket);this.measuredTxRate=this.getPrecise(n*this.smooth+this.measuredTxRate*(1-this.smooth)),this.requestCount=0,this.lastTxRateBucket=t}}getPrecise(e){return parseFloat(e.toFixed(8))}};m(Yr,"setTimeoutFn",setTimeout);var Jr=Yr;var kc="amz-sdk-invocation-id",Mc="amz-sdk-request";var Dc=()=>{let r=100;return{computeNextBackoffDelay:n=>Math.floor(Math.min(2e4,Math.random()*2**n*r)),setDelayBase:n=>{r=n}}};var Fs=({retryDelay:r,retryCount:e,retryCost:t})=>({getRetryCount:()=>e,getRetryDelay:()=>Math.min(2e4,r),getRetryCost:()=>t});var dt=class{constructor(e){m(this,"maxAttempts");m(this,"mode",xe.STANDARD);m(this,"capacity",500);m(this,"retryBackoffStrategy",Dc());m(this,"maxAttemptsProvider");this.maxAttempts=e,this.maxAttemptsProvider=typeof e=="function"?e:async()=>e}async acquireInitialRetryToken(e){return Fs({retryDelay:100,retryCount:0})}async refreshRetryTokenForRetry(e,t){let n=await this.getMaxAttempts();if(this.shouldRetry(e,t,n)){let s=t.errorType;this.retryBackoffStrategy.setDelayBase(s==="THROTTLING"?500:100);let o=this.retryBackoffStrategy.computeNextBackoffDelay(e.getRetryCount()),i=t.retryAfterHint?Math.max(t.retryAfterHint.getTime()-Date.now()||0,o):o,a=this.getCapacityCost(s);return this.capacity-=a,Fs({retryDelay:i,retryCount:e.getRetryCount()+1,retryCost:a})}throw new Error("No retry token available")}recordSuccess(e){var t;this.capacity=Math.max(500,this.capacity+((t=e.getRetryCost())!=null?t:1))}getCapacity(){return this.capacity}async getMaxAttempts(){try{return await this.maxAttemptsProvider()}catch(e){return console.warn(`Max attempts provider could not resolve. Using default of ${Ke}`),Ke}}shouldRetry(e,t,n){return e.getRetryCount()+1<n&&this.capacity>=this.getCapacityCost(t.errorType)&&this.isRetryableError(t.errorType)}getCapacityCost(e){return e==="TRANSIENT"?10:5}isRetryableError(e){return e==="THROTTLING"||e==="TRANSIENT"}};var Xr=class{constructor(e,t){m(this,"maxAttemptsProvider");m(this,"rateLimiter");m(this,"standardRetryStrategy");m(this,"mode",xe.ADAPTIVE);this.maxAttemptsProvider=e;let{rateLimiter:n}=t!=null?t:{};this.rateLimiter=n!=null?n:new Jr,this.standardRetryStrategy=new dt(e)}async acquireInitialRetryToken(e){return await this.rateLimiter.getSendToken(),this.standardRetryStrategy.acquireInitialRetryToken(e)}async refreshRetryTokenForRetry(e,t){return this.rateLimiter.updateClientSendingRate(t),this.standardRetryStrategy.refreshRetryTokenForRetry(e,t)}recordSuccess(e){this.rateLimiter.updateClientSendingRate({}),this.standardRetryStrategy.recordSuccess(e)}};var Bc=r=>r instanceof Error?r:r instanceof Object?Object.assign(new Error,r):typeof r=="string"?new Error(r):new Error(`AWS SDK error wrapper for ${r}`);var Oc=r=>{let{retryStrategy:e,retryMode:t,maxAttempts:n}=r,s=K(n!=null?n:Ke);return Object.assign(r,{maxAttempts:s,retryStrategy:async()=>e||(await K(t)()===xe.ADAPTIVE?new Xr(s):new dt(s))})};var Nc=r=>(r==null?void 0:r.body)instanceof ReadableStream;var Up=r=>(e,t)=>async n=>{var i;let s=await r.retryStrategy(),o=await r.maxAttempts();if(Gp(s)){s=s;let a=await s.acquireInitialRetryToken(t.partition_id),c=new Error,l=0,d=0,{request:u}=n,f=R.isInstance(u);for(f&&(u.headers[kc]=Ge());;)try{f&&(u.headers[Mc]=`attempt=${l+1}; max=${o}`);let{response:h,output:g}=await e(n);return s.recordSuccess(a),g.$metadata.attempts=l+1,g.$metadata.totalRetryDelay=d,{response:h,output:g}}catch(h){let g=Fp(h);if(c=Bc(h),f&&Nc(u))throw(i=t.logger instanceof ct?console:t.logger)==null||i.warn("An error was encountered in a non-retryable streaming request."),c;try{a=await s.refreshRetryTokenForRetry(a,g)}catch(x){throw c.$metadata||(c.$metadata={}),c.$metadata.attempts=l+1,c.$metadata.totalRetryDelay=d,c}l=a.getRetryCount();let y=a.getRetryDelay();d+=y,await new Promise(x=>setTimeout(x,y))}}else return s=s,s!=null&&s.mode&&(t.userAgent=[...t.userAgent||[],["cfg/retry-mode",s.mode]]),s.retry(e,n)},Gp=r=>typeof r.acquireInitialRetryToken!="undefined"&&typeof r.refreshRetryTokenForRetry!="undefined"&&typeof r.recordSuccess!="undefined",Fp=r=>{let e={error:r,errorType:Hp(r)},t=qp(r.$response);return t&&(e.retryAfterHint=t),e},Hp=r=>Wr(r)?"THROTTLING":Kr(r)?"TRANSIENT":Ic(r)?"SERVER_ERROR":"CLIENT_ERROR",zp={name:"retryMiddleware",tags:["RETRY"],step:"finalizeRequest",priority:"high",override:!0},Lc=r=>({applyToStack:e=>{e.add(Up(r),zp)}}),qp=r=>{if(!$.isInstance(r))return;let e=Object.keys(r.headers).find(o=>o.toLowerCase()==="retry-after");if(!e)return;let t=r.headers[e],n=Number(t);return Number.isNaN(n)?new Date(t):new Date(n*1e3)};var $c=async(r,e,t)=>({operation:J(e).operation,region:await K(r.region)()||(()=>{throw new Error("expected `region` to be configured for `aws.auth#sigv4`")})()});function jp(r){return{schemeId:"aws.auth#sigv4",signingProperties:{name:"bedrock",region:r.region},propertiesExtractor:(e,t)=>({signingProperties:{config:e,context:t}})}}function Vp(r){return{schemeId:"smithy.api#httpBearerAuth",propertiesExtractor:({profile:e,filepath:t,configFilepath:n,ignoreCache:s},o)=>({identityProperties:{profile:e,filepath:t,configFilepath:n,ignoreCache:s}})}}var Uc=r=>{let e=[];switch(r.operation){default:e.push(jp(r)),e.push(Vp(r))}return e},Gc=r=>{var n;let e=sr(r.token,nr,Ct),t=Ra(r);return Object.assign(t,{authSchemePreference:K((n=r.authSchemePreference)!=null?n:[]),token:e})};var Fc=r=>{var e,t;return Object.assign(r,{useDualstackEndpoint:(e=r.useDualstackEndpoint)!=null?e:!1,useFipsEndpoint:(t=r.useFipsEndpoint)!=null?t:!1,defaultSigningName:"bedrock"})},Qr={UseFIPS:{type:"builtInParams",name:"useFipsEndpoint"},Endpoint:{type:"builtInParams",name:"endpoint"},Region:{type:"builtInParams",name:"region"},UseDualStack:{type:"builtInParams",name:"useDualstackEndpoint"}};var Hc={name:"@aws-sdk/client-bedrock-runtime",description:"AWS SDK for JavaScript Bedrock Runtime Client for Node.js, Browser and React Native",version:"3.947.0",scripts:{build:"concurrently 'yarn:build:cjs' 'yarn:build:es' 'yarn:build:types'","build:cjs":"node ../../scripts/compilation/inline client-bedrock-runtime","build:es":"tsc -p tsconfig.es.json","build:include:deps":"lerna run --scope $npm_package_name --include-dependencies build","build:types":"tsc -p tsconfig.types.json","build:types:downlevel":"downlevel-dts dist-types dist-types/ts3.4",clean:"rimraf ./dist-* && rimraf *.tsbuildinfo","extract:docs":"api-extractor run --local","generate:client":"node ../../scripts/generate-clients/single-service --solo bedrock-runtime","test:index":"tsc --noEmit ./test/index-types.ts && node ./test/index-objects.spec.mjs"},main:"./dist-cjs/index.js",types:"./dist-types/index.d.ts",module:"./dist-es/index.js",sideEffects:!1,dependencies:{"@aws-crypto/sha256-browser":"5.2.0","@aws-crypto/sha256-js":"5.2.0","@aws-sdk/core":"3.947.0","@aws-sdk/credential-provider-node":"3.947.0","@aws-sdk/eventstream-handler-node":"3.936.0","@aws-sdk/middleware-eventstream":"3.936.0","@aws-sdk/middleware-host-header":"3.936.0","@aws-sdk/middleware-logger":"3.936.0","@aws-sdk/middleware-recursion-detection":"3.936.0","@aws-sdk/middleware-user-agent":"3.947.0","@aws-sdk/middleware-websocket":"3.936.0","@aws-sdk/region-config-resolver":"3.936.0","@aws-sdk/token-providers":"3.947.0","@aws-sdk/types":"3.936.0","@aws-sdk/util-endpoints":"3.936.0","@aws-sdk/util-user-agent-browser":"3.936.0","@aws-sdk/util-user-agent-node":"3.947.0","@smithy/config-resolver":"^4.4.3","@smithy/core":"^3.18.7","@smithy/eventstream-serde-browser":"^4.2.5","@smithy/eventstream-serde-config-resolver":"^4.3.5","@smithy/eventstream-serde-node":"^4.2.5","@smithy/fetch-http-handler":"^5.3.6","@smithy/hash-node":"^4.2.5","@smithy/invalid-dependency":"^4.2.5","@smithy/middleware-content-length":"^4.2.5","@smithy/middleware-endpoint":"^4.3.14","@smithy/middleware-retry":"^4.4.14","@smithy/middleware-serde":"^4.2.6","@smithy/middleware-stack":"^4.2.5","@smithy/node-config-provider":"^4.3.5","@smithy/node-http-handler":"^4.4.5","@smithy/protocol-http":"^5.3.5","@smithy/smithy-client":"^4.9.10","@smithy/types":"^4.9.0","@smithy/url-parser":"^4.2.5","@smithy/util-base64":"^4.3.0","@smithy/util-body-length-browser":"^4.2.0","@smithy/util-body-length-node":"^4.2.1","@smithy/util-defaults-mode-browser":"^4.3.13","@smithy/util-defaults-mode-node":"^4.2.16","@smithy/util-endpoints":"^3.2.5","@smithy/util-middleware":"^4.2.5","@smithy/util-retry":"^4.2.5","@smithy/util-stream":"^4.5.6","@smithy/util-utf8":"^4.2.0",tslib:"^2.6.2"},devDependencies:{"@tsconfig/node18":"18.2.4","@types/node":"^18.19.69",concurrently:"7.0.0","downlevel-dts":"0.10.1",rimraf:"3.0.2",typescript:"~5.8.3"},engines:{node:">=18.0.0"},typesVersions:{"<4.0":{"dist-types/*":["dist-types/ts3.4/*"]}},files:["dist-*/**"],author:{name:"AWS SDK for JavaScript Team",url:"https://aws.amazon.com/javascript/"},license:"Apache-2.0",browser:{"./dist-es/runtimeConfig":"./dist-es/runtimeConfig.browser"},"react-native":{"./dist-es/runtimeConfig":"./dist-es/runtimeConfig.native"},homepage:"https://github.com/aws/aws-sdk-js-v3/tree/main/clients/client-bedrock-runtime",repository:{type:"git",url:"https://github.com/aws/aws-sdk-js-v3.git",directory:"clients/client-bedrock-runtime"}};var Hs={name:"SHA-256"},zs={name:"HMAC",hash:Hs},zc=new Uint8Array([227,176,196,66,152,252,28,20,154,251,244,200,153,111,185,36,39,174,65,228,100,155,147,76,164,149,153,27,120,82,184,85]);var Kp={};function pt(){return typeof window!="undefined"?window:typeof self!="undefined"?self:Kp}var qs=function(){function r(e){this.toHash=new Uint8Array(0),this.secret=e,this.reset()}return r.prototype.update=function(e){if(!Ie(e)){var t=se(e),n=new Uint8Array(this.toHash.byteLength+t.byteLength);n.set(this.toHash,0),n.set(t,this.toHash.byteLength),this.toHash=n}},r.prototype.digest=function(){var e=this;return this.key?this.key.then(function(t){return pt().crypto.subtle.sign(zs,t,e.toHash).then(function(n){return new Uint8Array(n)})}):Ie(this.toHash)?Promise.resolve(zc):Promise.resolve().then(function(){return pt().crypto.subtle.digest(Hs,e.toHash)}).then(function(t){return Promise.resolve(new Uint8Array(t))})},r.prototype.reset=function(){var e=this;this.toHash=new Uint8Array(0),this.secret&&this.secret!==void 0&&(this.key=new Promise(function(t,n){pt().crypto.subtle.importKey("raw",se(e.secret),zs,!1,["sign"]).then(t,n)}),this.key.catch(function(){}))},r}();var j=64,qc=32,jc=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Vc=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],Wc=Math.pow(2,53)-1;var kt=function(){function r(){this.state=Int32Array.from(Vc),this.temp=new Int32Array(64),this.buffer=new Uint8Array(64),this.bufferLength=0,this.bytesHashed=0,this.finished=!1}return r.prototype.update=function(e){if(this.finished)throw new Error("Attempted to update an already finished hash.");var t=0,n=e.byteLength;if(this.bytesHashed+=n,this.bytesHashed*8>Wc)throw new Error("Cannot hash more than 2^53 - 1 bits");for(;n>0;)this.buffer[this.bufferLength++]=e[t++],n--,this.bufferLength===j&&(this.hashBuffer(),this.bufferLength=0)},r.prototype.digest=function(){if(!this.finished){var e=this.bytesHashed*8,t=new DataView(this.buffer.buffer,this.buffer.byteOffset,this.buffer.byteLength),n=this.bufferLength;if(t.setUint8(this.bufferLength++,128),n%j>=j-8){for(var s=this.bufferLength;s<j;s++)t.setUint8(s,0);this.hashBuffer(),this.bufferLength=0}for(var s=this.bufferLength;s<j-8;s++)t.setUint8(s,0);t.setUint32(j-8,Math.floor(e/4294967296),!0),t.setUint32(j-4,e),this.hashBuffer(),this.finished=!0}for(var o=new Uint8Array(qc),s=0;s<8;s++)o[s*4]=this.state[s]>>>24&255,o[s*4+1]=this.state[s]>>>16&255,o[s*4+2]=this.state[s]>>>8&255,o[s*4+3]=this.state[s]>>>0&255;return o},r.prototype.hashBuffer=function(){for(var e=this,t=e.buffer,n=e.state,s=n[0],o=n[1],i=n[2],a=n[3],c=n[4],l=n[5],d=n[6],u=n[7],f=0;f<j;f++){if(f<16)this.temp[f]=(t[f*4]&255)<<24|(t[f*4+1]&255)<<16|(t[f*4+2]&255)<<8|t[f*4+3]&255;else{var h=this.temp[f-2],g=(h>>>17|h<<15)^(h>>>19|h<<13)^h>>>10;h=this.temp[f-15];var y=(h>>>7|h<<25)^(h>>>18|h<<14)^h>>>3;this.temp[f]=(g+this.temp[f-7]|0)+(y+this.temp[f-16]|0)}var x=(((c>>>6|c<<26)^(c>>>11|c<<21)^(c>>>25|c<<7))+(c&l^~c&d)|0)+(u+(jc[f]+this.temp[f]|0)|0)|0,S=((s>>>2|s<<30)^(s>>>13|s<<19)^(s>>>22|s<<10))+(s&o^s&i^o&i)|0;u=d,d=l,l=c,c=a+x|0,a=i,i=o,o=s,s=x+S|0}n[0]+=s,n[1]+=o,n[2]+=i,n[3]+=a,n[4]+=c,n[5]+=l,n[6]+=d,n[7]+=u},r}();var Kc=function(){function r(e){this.secret=e,this.hash=new kt,this.reset()}return r.prototype.update=function(e){if(!(Ie(e)||this.error))try{this.hash.update(se(e))}catch(t){this.error=t}},r.prototype.digestSync=function(){if(this.error)throw this.error;return this.outer?(this.outer.finished||this.outer.update(this.hash.digest()),this.outer.digest()):this.hash.digest()},r.prototype.digest=function(){return _r(this,void 0,void 0,function(){return Ir(this,function(e){return[2,this.digestSync()]})})},r.prototype.reset=function(){if(this.hash=new kt,this.secret){this.outer=new kt;var e=Jp(this.secret),t=new Uint8Array(j);t.set(e);for(var n=0;n<j;n++)e[n]^=54,t[n]^=92;this.hash.update(e),this.outer.update(t);for(var n=0;n<e.byteLength;n++)e[n]=0}},r}();function Jp(r){var e=se(r);if(e.byteLength>j){var t=new kt;t.update(e),e=t.digest()}var n=new Uint8Array(j);return n.set(e),n}var Yp=["decrypt","digest","encrypt","exportKey","generateKey","importKey","sign","verify"];function Jc(r){if(Xp(r)&&typeof r.crypto.subtle=="object"){var e=r.crypto.subtle;return Qp(e)}return!1}function Xp(r){if(typeof r=="object"&&typeof r.crypto=="object"){var e=r.crypto.getRandomValues;return typeof e=="function"}return!1}function Qp(r){return r&&Yp.every(function(e){return typeof r[e]=="function"})}var Yc=function(){function r(e){Jc(pt())?this.hash=new qs(e):this.hash=new Kc(e)}return r.prototype.update=function(e,t){this.hash.update(se(e))},r.prototype.digest=function(){return this.hash.digest()},r.prototype.reset=function(){this.hash.reset()},r}();var Qc=({serviceId:r,clientVersion:e})=>async t=>{var h,g,y,x,S,w,E,b,v,M;let n=typeof window!="undefined"?window.navigator:void 0,s=(h=n==null?void 0:n.userAgent)!=null?h:"",o=(x=(y=(g=n==null?void 0:n.userAgentData)==null?void 0:g.platform)!=null?y:Xc.os(s))!=null?x:"other",i=void 0,a=(w=(S=n==null?void 0:n.userAgentData)==null?void 0:S.brands)!=null?w:[],c=a[a.length-1],l=(b=(E=c==null?void 0:c.brand)!=null?E:Xc.browser(s))!=null?b:"unknown",d=(v=c==null?void 0:c.version)!=null?v:"unknown",u=[["aws-sdk-js",e],["ua","2.1"],[`os/${o}`,i],["lang/js"],["md/browser",`${l}_${d}`]];r&&u.push([`api/${r}`,e]);let f=await((M=t==null?void 0:t.userAgentAppId)==null?void 0:M.call(t));return f&&u.push([`app/${f}`]),u},Xc={os(r){if(/iPhone|iPad|iPod/.test(r))return"iOS";if(/Macintosh|Mac OS X/.test(r))return"macOS";if(/Windows NT/.test(r))return"Windows";if(/Android/.test(r))return"Android";if(/Linux/.test(r))return"Linux"},browser(r){if(/EdgiOS|EdgA|Edg\//.test(r))return"Microsoft Edge";if(/Firefox\//.test(r))return"Firefox";if(/Chrome\//.test(r))return"Chrome";if(/Safari\//.test(r))return"Safari"}};var Zc=r=>()=>Promise.reject(r);var el=["in-region","cross-region","mobile","standard","legacy"];var tl=({defaultsMode:r}={})=>na(async()=>{let e=typeof r=="function"?await r():r;switch(e==null?void 0:e.toLowerCase()){case"auto":return Promise.resolve(Zp()?"mobile":"standard");case"mobile":case"in-region":case"cross-region":case"standard":case"legacy":return Promise.resolve(e==null?void 0:e.toLocaleLowerCase());case void 0:return Promise.resolve("legacy");default:throw new Error(`Invalid parameter for "defaultsMode", expect ${el.join(", ")}, got ${e}`)}}),Zp=()=>{var e;let r=window==null?void 0:window.navigator;if(r!=null&&r.connection){let{effectiveType:t,rtt:n,downlink:s}=r==null?void 0:r.connection;if(typeof t=="string"&&t!=="4g"||Number(n)>100||Number(s)<10)return!0}return((e=r==null?void 0:r.userAgentData)==null?void 0:e.mobile)||typeof(r==null?void 0:r.maxTouchPoints)=="number"&&(r==null?void 0:r.maxTouchPoints)>1};z();var dl="required",ue="fn",de="argv",ft="ref";var rl="isSet",Pt="booleanEquals",mt="error",Mt="endpoint",G="tree",js="PartitionResult",nl={[dl]:!1,type:"string"},sl={[dl]:!0,default:!1,type:"boolean"},ol={[ft]:"Endpoint"},pl={[ue]:Pt,[de]:[{[ft]:"UseFIPS"},!0]},ml={[ue]:Pt,[de]:[{[ft]:"UseDualStack"},!0]},le={},il={[ue]:"getAttr",[de]:[{[ft]:js},"supportsFIPS"]},al={[ue]:Pt,[de]:[!0,{[ue]:"getAttr",[de]:[{[ft]:js},"supportsDualStack"]}]},cl=[pl],ll=[ml],ul=[{[ft]:"Region"}],em={version:"1.0",parameters:{Region:nl,UseDualStack:sl,UseFIPS:sl,Endpoint:nl},rules:[{conditions:[{[ue]:rl,[de]:[ol]}],rules:[{conditions:cl,error:"Invalid Configuration: FIPS and custom endpoint are not supported",type:mt},{rules:[{conditions:ll,error:"Invalid Configuration: Dualstack and custom endpoint are not supported",type:mt},{endpoint:{url:ol,properties:le,headers:le},type:Mt}],type:G}],type:G},{rules:[{conditions:[{[ue]:rl,[de]:ul}],rules:[{conditions:[{[ue]:"aws.partition",[de]:ul,assign:js}],rules:[{conditions:[pl,ml],rules:[{conditions:[{[ue]:Pt,[de]:[!0,il]},al],rules:[{rules:[{endpoint:{url:"https://bedrock-runtime-fips.{Region}.{PartitionResult#dualStackDnsSuffix}",properties:le,headers:le},type:Mt}],type:G}],type:G},{error:"FIPS and DualStack are enabled, but this partition does not support one or both",type:mt}],type:G},{conditions:cl,rules:[{conditions:[{[ue]:Pt,[de]:[il,!0]}],rules:[{rules:[{endpoint:{url:"https://bedrock-runtime-fips.{Region}.{PartitionResult#dnsSuffix}",properties:le,headers:le},type:Mt}],type:G}],type:G},{error:"FIPS is enabled but this partition does not support FIPS",type:mt}],type:G},{conditions:ll,rules:[{conditions:[al],rules:[{rules:[{endpoint:{url:"https://bedrock-runtime.{Region}.{PartitionResult#dualStackDnsSuffix}",properties:le,headers:le},type:Mt}],type:G}],type:G},{error:"DualStack is enabled but this partition does not support DualStack",type:mt}],type:G},{rules:[{endpoint:{url:"https://bedrock-runtime.{Region}.{PartitionResult#dnsSuffix}",properties:le,headers:le},type:Mt}],type:G}],type:G}],type:G},{error:"Invalid Configuration: Missing Region",type:mt}],type:G}]},fl=em;var tm=new or({size:50,params:["Endpoint","Region","UseDualStack","UseFIPS"]}),hl=(r,e={})=>tm.get(r,()=>Wi(fl,{endpointParams:r,logger:e.logger}));He.aws=xs;var gl=r=>{var e,t,n,s,o,i,a,c,l,d,u,f,h;return{apiVersion:"2023-09-30",base64Decoder:(e=r==null?void 0:r.base64Decoder)!=null?e:re,base64Encoder:(t=r==null?void 0:r.base64Encoder)!=null?t:Y,disableHostPrefix:(n=r==null?void 0:r.disableHostPrefix)!=null?n:!1,endpointProvider:(s=r==null?void 0:r.endpointProvider)!=null?s:hl,extensions:(o=r==null?void 0:r.extensions)!=null?o:[],httpAuthSchemeProvider:(i=r==null?void 0:r.httpAuthSchemeProvider)!=null?i:Uc,httpAuthSchemes:(a=r==null?void 0:r.httpAuthSchemes)!=null?a:[{schemeId:"aws.auth#sigv4",identityProvider:g=>g.getIdentityProvider("aws.auth#sigv4"),signer:new Rt},{schemeId:"smithy.api#httpBearerAuth",identityProvider:g=>g.getIdentityProvider("smithy.api#httpBearerAuth"),signer:new rr}],logger:(c=r==null?void 0:r.logger)!=null?c:new ct,protocol:(l=r==null?void 0:r.protocol)!=null?l:new Cr({defaultNamespace:"com.amazonaws.bedrockruntime"}),serviceId:(d=r==null?void 0:r.serviceId)!=null?d:"Bedrock Runtime",urlParser:(u=r==null?void 0:r.urlParser)!=null?u:it,utf8Decoder:(f=r==null?void 0:r.utf8Decoder)!=null?f:U,utf8Encoder:(h=r==null?void 0:r.utf8Encoder)!=null?h:H}};var yl=r=>{var s,o,i,a,c,l,d,u,f,h,g,y,x;let e=tl(r),t=()=>e().then(Pa),n=gl(r);return{...n,...r,runtime:"browser",defaultsMode:e,bodyLengthChecker:(s=r==null?void 0:r.bodyLengthChecker)!=null?s:Ia,credentialDefaultProvider:(o=r==null?void 0:r.credentialDefaultProvider)!=null?o:S=>()=>Promise.reject(new Error("Credential is missing")),defaultUserAgentProvider:(i=r==null?void 0:r.defaultUserAgentProvider)!=null?i:Qc({serviceId:n.serviceId,clientVersion:Hc.version}),eventStreamPayloadHandlerProvider:(a=r==null?void 0:r.eventStreamPayloadHandlerProvider)!=null?a:sc,eventStreamSerdeProvider:(c=r==null?void 0:r.eventStreamSerdeProvider)!=null?c:lc,maxAttempts:(l=r==null?void 0:r.maxAttempts)!=null?l:Ke,region:(d=r==null?void 0:r.region)!=null?d:Zc("Region is missing"),requestHandler:Hr.create((u=r==null?void 0:r.requestHandler)!=null?u:t,Ue.create(t)),retryMode:(f=r==null?void 0:r.retryMode)!=null?f:async()=>(await t()).retryMode||Gs,sha256:(h=r==null?void 0:r.sha256)!=null?h:Yc,streamCollector:(g=r==null?void 0:r.streamCollector)!=null?g:Ht,useDualstackEndpoint:(y=r==null?void 0:r.useDualstackEndpoint)!=null?y:()=>Promise.resolve(uc),useFipsEndpoint:(x=r==null?void 0:r.useFipsEndpoint)!=null?x:()=>Promise.resolve(dc)}};var xl=r=>({setRegion(e){r.region=e},region(){return r.region}}),Sl=r=>({region:r.region()});var wl=r=>{let e=r.httpAuthSchemes,t=r.httpAuthSchemeProvider,n=r.credentials,s=r.token;return{setHttpAuthScheme(o){let i=e.findIndex(a=>a.schemeId===o.schemeId);i===-1?e.push(o):e.splice(i,1,o)},httpAuthSchemes(){return e},setHttpAuthSchemeProvider(o){t=o},httpAuthSchemeProvider(){return t},setCredentials(o){n=o},credentials(){return n},setToken(o){s=o},token(){return s}}},bl=r=>({httpAuthSchemes:r.httpAuthSchemes(),httpAuthSchemeProvider:r.httpAuthSchemeProvider(),credentials:r.credentials(),token:r.token()});var El=(r,e)=>{let t=Object.assign(xl(r),La(r),Do(r),wl(r));return e.forEach(n=>n.configure(t)),Object.assign(r,Sl(t),$a(t),Bo(t),bl(t))};var Zr=class extends gr{constructor(...[t]){let n=yl(t||{});super(n);m(this,"config");this.initConfig=n;let s=Fc(n),o=Ri(s),i=Oc(o),a=hc(i),c=a,l=vc(c),d=gc(l),u=Gc(d),f=Po(u),h=oc(f),g=El(h,(t==null?void 0:t.extensions)||[]);this.config=g,this.middlewareStack.use(si(this.config)),this.middlewareStack.use(Ya(this.config)),this.middlewareStack.use(Lc(this.config)),this.middlewareStack.use(xc(this.config)),this.middlewareStack.use(Oo(this.config)),this.middlewareStack.use(No(this.config)),this.middlewareStack.use(Uo(this.config)),this.middlewareStack.use(Ho(this.config,{httpAuthSchemeParametersProvider:$c,identityProviderConfigProvider:async y=>new tr({"aws.auth#sigv4":y.credentials,"smithy.api#httpBearerAuth":y.token})})),this.middlewareStack.use(jo(this.config))}destroy(){super.destroy()}};var O=class r extends xr{constructor(e){super(e),Object.setPrototypeOf(this,r.prototype)}};var en=class r extends O{constructor(t){super({name:"AccessDeniedException",$fault:"client",...t});m(this,"name","AccessDeniedException");m(this,"$fault","client");Object.setPrototypeOf(this,r.prototype)}},tn=class r extends O{constructor(t){super({name:"InternalServerException",$fault:"server",...t});m(this,"name","InternalServerException");m(this,"$fault","server");Object.setPrototypeOf(this,r.prototype)}},rn=class r extends O{constructor(t){super({name:"ThrottlingException",$fault:"client",...t});m(this,"name","ThrottlingException");m(this,"$fault","client");Object.setPrototypeOf(this,r.prototype)}},nn=class r extends O{constructor(t){super({name:"ValidationException",$fault:"client",...t});m(this,"name","ValidationException");m(this,"$fault","client");Object.setPrototypeOf(this,r.prototype)}},sn=class r extends O{constructor(t){super({name:"ConflictException",$fault:"client",...t});m(this,"name","ConflictException");m(this,"$fault","client");Object.setPrototypeOf(this,r.prototype)}},on=class r extends O{constructor(t){super({name:"ResourceNotFoundException",$fault:"client",...t});m(this,"name","ResourceNotFoundException");m(this,"$fault","client");Object.setPrototypeOf(this,r.prototype)}},an=class r extends O{constructor(t){super({name:"ServiceQuotaExceededException",$fault:"client",...t});m(this,"name","ServiceQuotaExceededException");m(this,"$fault","client");Object.setPrototypeOf(this,r.prototype)}},cn=class r extends O{constructor(t){super({name:"ServiceUnavailableException",$fault:"server",...t});m(this,"name","ServiceUnavailableException");m(this,"$fault","server");Object.setPrototypeOf(this,r.prototype)}},ln=class r extends O{constructor(t){super({name:"ModelErrorException",$fault:"client",...t});m(this,"name","ModelErrorException");m(this,"$fault","client");m(this,"originalStatusCode");m(this,"resourceName");Object.setPrototypeOf(this,r.prototype),this.originalStatusCode=t.originalStatusCode,this.resourceName=t.resourceName}},un=class r extends O{constructor(t){super({name:"ModelNotReadyException",$fault:"client",...t});m(this,"name","ModelNotReadyException");m(this,"$fault","client");m(this,"$retryable",{});Object.setPrototypeOf(this,r.prototype)}},dn=class r extends O{constructor(t){super({name:"ModelTimeoutException",$fault:"client",...t});m(this,"name","ModelTimeoutException");m(this,"$fault","client");Object.setPrototypeOf(this,r.prototype)}},pn=class r extends O{constructor(t){super({name:"ModelStreamErrorException",$fault:"client",...t});m(this,"name","ModelStreamErrorException");m(this,"$fault","client");m(this,"originalStatusCode");m(this,"originalMessage");Object.setPrototypeOf(this,r.prototype),this.originalStatusCode=t.originalStatusCode,this.originalMessage=t.originalMessage}};var rm="Accept",nm="AudioBlock",sm="AccessDeniedException",om="ApplyGuardrail",im="AppliedGuardrailDetails",am="ApplyGuardrailRequest",cm="ApplyGuardrailResponse",lm="AsyncInvokeMessage",um="AsyncInvokeOutputDataConfig",dm="AsyncInvokeSummary",pm="AsyncInvokeS3OutputDataConfig",mm="AsyncInvokeSummaries",fm="AudioSource",hm="AnyToolChoice",gm="AutoToolChoice",ym="Body",xm="BidirectionalInputPayloadPart",Sm="BidirectionalOutputPayloadPart",wm="Citation",bm="ContentBlocks",Em="ContentBlockDelta",vm="ContentBlockDeltaEvent",Cm="ContentBlockStart",Am="ContentBlockStartEvent",Tm="ContentBlockStopEvent",Rm="ContentBlock",_m="CitationsConfig",Im="CitationsContentBlock",km="CitationsDelta",Mm="ConflictException",Pm="CitationGeneratedContent",Dm="CitationGeneratedContentList",Bm="CitationLocation",Om="ConverseMetrics",Nm="ConverseOutput",Lm="CachePointBlock",$m="ConverseRequest",Um="ConverseResponse",Gm="ConverseStream",Fm="CitationSourceContent",Hm="CitationSourceContentDelta",zm="CitationSourceContentList",qm="CitationSourceContentListDelta",jm="ConverseStreamMetrics",Vm="ConverseStreamMetadataEvent",Wm="ConverseStreamOutput",Km="ConverseStreamRequest",Jm="ConverseStreamResponse",Ym="ConverseStreamTrace",Xm="ConverseTrace",Qm="CountTokensInput",Zm="ConverseTokensRequest",ef="CountTokensRequest",tf="CountTokensResponse",Ws="Content-Type",rf="CountTokens",nf="Citations",sf="Converse",of="DocumentBlock",af="DocumentContentBlocks",cf="DocumentContentBlock",lf="DocumentCharLocation",uf="DocumentChunkLocation",df="DocumentPageLocation",pf="DocumentSource",mf="ErrorBlock",ff="GuardrailAssessment",hf="GetAsyncInvoke",gf="GetAsyncInvokeRequest",yf="GetAsyncInvokeResponse",xf="GuardrailAssessmentList",Sf="GuardrailAssessmentListMap",wf="GuardrailAssessmentMap",bf="GuardrailAutomatedReasoningDifferenceScenarioList",Ef="GuardrailAutomatedReasoningFinding",vf="GuardrailAutomatedReasoningFindingList",Cf="GuardrailAutomatedReasoningImpossibleFinding",Af="GuardrailAutomatedReasoningInvalidFinding",Tf="GuardrailAutomatedReasoningInputTextReference",Rf="GuardrailAutomatedReasoningInputTextReferenceList",_f="GuardrailAutomatedReasoningLogicWarning",If="GuardrailAutomatedReasoningNoTranslationsFinding",kf="GuardrailAutomatedReasoningPolicyAssessment",Mf="GuardrailAutomatedReasoningRule",Pf="GuardrailAutomatedReasoningRuleList",Df="GuardrailAutomatedReasoningScenario",Bf="GuardrailAutomatedReasoningSatisfiableFinding",Of="GuardrailAutomatedReasoningStatementList",Nf="GuardrailAutomatedReasoningStatementLogicContent",Lf="GuardrailAutomatedReasoningStatementNaturalLanguageContent",$f="GuardrailAutomatedReasoningStatement",Uf="GuardrailAutomatedReasoningTranslation",Gf="GuardrailAutomatedReasoningTranslationAmbiguousFinding",Ff="GuardrailAutomatedReasoningTooComplexFinding",Hf="GuardrailAutomatedReasoningTranslationList",zf="GuardrailAutomatedReasoningTranslationOption",qf="GuardrailAutomatedReasoningTranslationOptionList",jf="GuardrailAutomatedReasoningValidFinding",Vf="GuardrailConfiguration",Wf="GuardrailContentBlock",Kf="GuardrailContentBlockList",Jf="GuardrailConverseContentBlock",Yf="GuardrailContentFilter",Xf="GuardrailContentFilterList",Qf="GuardrailContextualGroundingFilter",Zf="GuardrailContextualGroundingFilters",eh="GuardrailContextualGroundingPolicyAssessment",th="GuardrailConverseImageBlock",rh="GuardrailConverseImageSource",nh="GuardrailContentPolicyAssessment",sh="GuardrailConverseTextBlock",oh="GuardrailCustomWord",ih="GuardrailCustomWordList",ah="GuardrailCoverage",ch="GuardrailImageBlock",lh="GuardrailImageCoverage",uh="GuardrailInvocationMetrics",dh="GuardrailImageSource",ph="GuardrailManagedWord",mh="GuardrailManagedWordList",fh="GuardrailOutputContent",hh="GuardrailOutputContentList",gh="GuardrailPiiEntityFilter",yh="GuardrailPiiEntityFilterList",xh="GuardrailRegexFilter",Sh="GuardrailRegexFilterList",wh="GuardrailStreamConfiguration",bh="GuardrailSensitiveInformationPolicyAssessment",Eh="GuardrailTopic",vh="GuardrailTraceAssessment",Ch="GuardrailTextBlock",Ah="GuardrailTextCharactersCoverage",Th="GuardrailTopicList",Rh="GuardrailTopicPolicyAssessment",_h="GuardrailUsage",Ih="GuardrailWordPolicyAssessment",kh="ImageBlock",Mh="ImageBlockDelta",Ph="ImageBlockStart",Dh="InferenceConfiguration",Bh="InvokeModel",Oh="InvokeModelRequest",Nh="InvokeModelResponse",Lh="InvokeModelTokensRequest",$h="InvokeModelWithBidirectionalStream",Uh="InvokeModelWithBidirectionalStreamInput",Gh="InvokeModelWithBidirectionalStreamOutput",Fh="InvokeModelWithBidirectionalStreamRequest",Hh="InvokeModelWithBidirectionalStreamResponse",zh="InvokeModelWithResponseStream",qh="InvokeModelWithResponseStreamRequest",jh="InvokeModelWithResponseStreamResponse",Vh="ImageSource",Wh="InternalServerException",Kh="ListAsyncInvokes",Jh="ListAsyncInvokesRequest",Yh="ListAsyncInvokesResponse",Xh="Message",Qh="ModelErrorException",Zh="ModelInputPayload",eg="ModelNotReadyException",tg="MessageStartEvent",rg="ModelStreamErrorException",ng="MessageStopEvent",sg="ModelTimeoutException",og="Messages",ig="PartBody",ag="PerformanceConfiguration",cg="PayloadPart",lg="PromptRouterTrace",ug="PromptVariableMap",dg="PromptVariableValues",pg="ReasoningContentBlock",mg="ReasoningContentBlockDelta",fg="RequestMetadata",hg="ResourceNotFoundException",gg="ResponseStream",yg="ReasoningTextBlock",xg="StartAsyncInvoke",Sg="StartAsyncInvokeRequest",wg="StartAsyncInvokeResponse",bg="SystemContentBlocks",Eg="SystemContentBlock",vg="S3Location",Cg="ServiceQuotaExceededException",Ag="SearchResultBlock",Tg="SearchResultContentBlock",Rg="SearchResultContentBlocks",_g="SearchResultLocation",Ig="ServiceTier",kg="SpecificToolChoice",Mg="SystemTool",Pg="ServiceUnavailableException",Dg="Tag",Bg="ToolConfiguration",Og="ToolChoice",Ng="ThrottlingException",Lg="ToolInputSchema",$g="TagList",Ug="ToolResultBlock",Gg="ToolResultBlocksDelta",Fg="ToolResultBlockDelta",Hg="ToolResultBlockStart",zg="ToolResultContentBlocks",qg="ToolResultContentBlock",jg="ToolSpecification",Vg="TokenUsage",Wg="ToolUseBlock",Kg="ToolUseBlockDelta",Jg="ToolUseBlockStart",Yg="Tools",Xg="Tool",Qg="VideoBlock",Zg="ValidationException",ey="VideoSource",ty="WebLocation",ry="X-Amzn-Bedrock-Accept",ny="X-Amzn-Bedrock-Content-Type",kl="X-Amzn-Bedrock-GuardrailIdentifier",Ml="X-Amzn-Bedrock-GuardrailVersion",fn="X-Amzn-Bedrock-PerformanceConfig-Latency",hn="X-Amzn-Bedrock-Service-Tier",Pl="X-Amzn-Bedrock-Trace",Me="action",sy="appliedGuardrailDetails",oy="asyncInvokeSummaries",Ks="additionalModelRequestFields",Dl="additionalModelResponseFieldPaths",Bl="additionalModelResponseFields",Ol="actionReason",iy="automatedReasoningPolicy",ay="automatedReasoningPolicyUnits",cy="automatedReasoningPolicies",Nl="accept",ly="any",uy="assessments",dy="audio",py="auto",Se="bytes",Ll="bucketOwner",Ye="body",pe="client",my="contentBlockDelta",Js="contentBlockIndex",fy="contentBlockStart",hy="contentBlockStop",gy="citationsContent",yy="claimsFalseScenario",xy="contextualGroundingPolicy",Sy="contextualGroundingPolicyUnits",wy="contentPolicy",by="contentPolicyImageUnits",Ey="contentPolicyUnits",Ys="cachePoint",$l="contradictingRules",vy="cacheReadInputTokens",Xs="clientRequestToken",gn="contentType",Ul="claimsTrueScenario",Cy="customWords",Ay="cacheWriteInputTokens",Qs="chunk",Zs="citations",Ty="citation",Gl="claims",ht="content",Ry="context",Fl="confidence",_y="converse",Iy="delta",ky="documentChar",My="documentChunk",eo="documentIndex",Py="documentPage",Dy="differenceScenarios",Xe="detected",By="description",Oy="domain",Hl="document",F="error",zl="endTime",Ny="enabled",yn="end",Qe="format",ql="failureMessage",Ly="filterStrength",$y="findings",jl="filters",Vl="guardrail",Uy="guardrailArn",Wl="guardrailCoverage",Kl="guardrailConfig",Jl="guardContent",Gy="guardrailId",Bt="guardrailIdentifier",Fy="guardrailOrigin",Hy="guardrailOwnership",zy="guardrailProcessingLatency",gt="guardrailVersion",Yl="guarded",me="http",Q="httpError",P="httpHeader",Je="httpQuery",to="input",xn="invocationArn",qy="inputAssessment",Xl="inferenceConfig",jy="invocationMetrics",Vy="invokedModelId",Wy="invokeModel",Ky="inputSchema",ro="internalServerException",Ql="inputTokens",Jy="identifier",Yy="images",yt="image",Xy="impossible",Qy="invalid",no="json",Zy="key",ex="kmsKeyId",Zl="location",eu="latencyMs",tu="lastModifiedTime",Sn="logicWarning",tx="latency",rx="logic",V="message",ru="modelArn",Ze="modelId",nx="modelInput",sx="modelOutput",vl="maxResults",ox="messageStart",so="modelStreamErrorException",ix="messageStop",ax="maxTokens",nu="modelTimeoutException",cx="managedWordLists",wn="match",oo="messages",su="metrics",lx="metadata",Pe="name",ux="naturalLanguage",Vs="nextToken",dx="noTranslations",px="outputs",mx="outputAssessments",io="outputDataConfig",fx="originalMessage",hx="outputScope",ou="originalStatusCode",gx="outputTokens",yx="options",xx="output",iu="premises",bn="performanceConfig",En="performanceConfigLatency",Sx="piiEntities",au="promptRouter",cu="promptVariables",wx="policyVersionArn",lu="qualifiers",bx="regex",uu="reasoningContent",du="redactedContent",pu="requestMetadata",Ex="resourceName",vx="reasoningText",Cx="regexes",mu="role",oe="source",Cl="sortBy",fu="sourceContent",Al="statusEquals",Ax="sensitiveInformationPolicy",Tx="sensitiveInformationPolicyFreeUnits",Rx="sensitiveInformationPolicyUnits",vn="s3Location",Tl="sortOrder",_x="s3OutputDataConfig",Ix="streamProcessingMode",hu="stopReason",kx="searchResultIndex",Mx="searchResultLocation",gu="searchResult",Px="supportingRules",Dx="stopSequences",yu="submitTime",Rl="submitTimeAfter",_l="submitTimeBefore",De="serviceTier",Bx="systemTool",Ox="s3Uri",ao="serviceUnavailableException",Nx="satisfiable",Lx="score",xu="server",Su="signature",wu="smithy.ts.sdk.synthetic.com.amazonaws.bedrockruntime",Cn="status",Ot="start",$x="statements",Ux="stream",An="streaming",co="system",Z="type",Gx="translationAmbiguous",lo="toolConfig",Fx="textCharacters",Hx="toolChoice",zx="tooComplex",uo="throttlingException",qx="topicPolicy",jx="topicPolicyUnits",Vx="topP",po="toolResult",Wx="toolSpec",Kx="totalTokens",mo="toolUse",Tn="toolUseId",Jx="tags",D="text",Yx="temperature",Xx="threshold",fo="title",bu="total",Qx="tools",Zx="tool",eS="topics",xt="trace",Rn="translation",tS="translations",_n="usage",rS="untranslatedClaims",nS="untranslatedPremises",sS="uri",oS="url",iS="value",ho="validationException",aS="valid",Eu="video",cS="web",lS="wordPolicy",uS="wordPolicyUnits",p="com.amazonaws.bedrockruntime",vu=[0,p,lm,8,0],In=[0,p,ym,8,21],dS=[0,p,Nf,8,0],Cu=[0,p,Lf,8,0],pS=[0,p,Zh,8,15],go=[0,p,ig,8,21],mS=[-3,p,sm,{[F]:pe,[Q]:403},[V],[0]];k.for(p).registerError(mS,en);var fS=[3,p,hm,0,[],[]],hS=[3,p,im,0,[Gy,gt,Uy,Fy,Hy],[0,0,0,64,0]],gS=[3,p,am,0,[Bt,gt,oe,ht,hx],[[0,1],[0,1],0,[()=>ww,0],0]],yS=[3,p,cm,0,[_n,Me,Ol,px,uy,Wl],[()=>ku,0,0,()=>Aw,[()=>$u,0],()=>_u]],xS=[3,p,pm,0,[Ox,ex,Ll],[0,0,0]],SS=[3,p,dm,0,[xn,ru,Xs,Cn,ql,yu,tu,zl,io],[0,0,0,0,[()=>vu,0],5,5,5,()=>Co]],wS=[3,p,nm,0,[Qe,oe,F],[0,[()=>Nw,0],[()=>xo,0]]],bS=[3,p,gm,0,[],[]],ES=[3,p,xm,8,[Se],[[()=>go,0]]],vS=[3,p,Sm,8,[Se],[[()=>go,0]]],yo=[3,p,Lm,0,[Z],[0]],CS=[3,p,wm,0,[fo,oe,fu,Zl],[0,0,()=>pw,()=>Fu]],Au=[3,p,_m,0,[Ny],[2]],AS=[3,p,Im,0,[ht,Zs],[()=>uw,()=>dw]],TS=[3,p,km,0,[fo,oe,fu,Zl],[0,0,()=>mw,()=>Fu]],RS=[3,p,Hm,0,[D],[0]],_S=[-3,p,Mm,{[F]:pe,[Q]:400},[V],[0]];k.for(p).registerError(_S,sn);var IS=[3,p,vm,0,[Iy,Js],[[()=>Gw,0],1]],kS=[3,p,Am,0,[Ot,Js],[()=>Fw,1]],MS=[3,p,Tm,0,[Js],[1]],PS=[3,p,Om,0,[eu],[1]],DS=[3,p,$m,0,[Ze,oo,co,Xl,lo,Kl,Ks,cu,Dl,pu,bn,De],[[0,1],[()=>Eo,0],[()=>vo,0],()=>Pu,()=>wo,()=>a0,15,[()=>Uu,0],64,[()=>Gu,0],()=>Dn,()=>On]],BS=[3,p,Um,0,[xx,hu,_n,su,Bl,xt,bn,De],[[()=>Hw,0],0,()=>Nu,()=>PS,15,[()=>FS,0],()=>Dn,()=>On]],OS=[3,p,Vm,0,[_n,su,xt,bn,De],[()=>Nu,()=>NS,[()=>US,0],()=>Dn,()=>On]],NS=[3,p,jm,0,[eu],[1]],LS=[3,p,Km,0,[Ze,oo,co,Xl,lo,Kl,Ks,cu,Dl,pu,bn,De],[[0,1],[()=>Eo,0],[()=>vo,0],()=>Pu,()=>wo,()=>v0,15,[()=>Uu,0],64,[()=>Gu,0],()=>Dn,()=>On]],$S=[3,p,Jm,0,[Ux],[[()=>zw,16]]],US=[3,p,Ym,0,[Vl,au],[[()=>Iu,0],()=>Bu]],GS=[3,p,Zm,0,[oo,co,lo,Ks],[[()=>Eo,0],[()=>vo,0],()=>wo,15]],FS=[3,p,Xm,0,[Vl,au],[[()=>Iu,0],()=>Bu]],HS=[3,p,ef,0,[Ze,to],[[0,1],[()=>qw,0]]],zS=[3,p,tf,0,[Ql],[1]],Tu=[3,p,of,0,[Qe,Pe,oe,Ry,Zs],[0,0,()=>Vw,0,()=>Au]],qS=[3,p,lf,0,[eo,Ot,yn],[1,1,1]],jS=[3,p,uf,0,[eo,Ot,yn],[1,1,1]],VS=[3,p,df,0,[eo,Ot,yn],[1,1,1]],xo=[3,p,mf,8,[V],[0]],WS=[3,p,gf,0,[xn],[[0,1]]],KS=[3,p,yf,0,[xn,ru,Xs,Cn,ql,yu,tu,zl,io],[0,0,0,0,[()=>vu,0],5,5,5,()=>Co]],Ru=[3,p,ff,0,[qx,wy,lS,Ax,xy,iy,jy,sy],[()=>R0,()=>l0,()=>_0,()=>E0,()=>d0,[()=>ZS,0],()=>y0,()=>hS]],JS=[3,p,Cf,0,[Rn,$l,Sn],[[()=>Nt,0],()=>bo,[()=>kn,0]]],YS=[3,p,Tf,0,[D],[[()=>Cu,0]]],XS=[3,p,Af,0,[Rn,$l,Sn],[[()=>Nt,0],()=>bo,[()=>kn,0]]],kn=[3,p,_f,0,[Z,iu,Gl],[0,[()=>Dt,0],[()=>Dt,0]]],QS=[3,p,If,0,[],[]],ZS=[3,p,kf,0,[$y],[[()=>yw,0]]],e0=[3,p,Mf,0,[Jy,wx],[0,0]],t0=[3,p,Bf,0,[Rn,Ul,yy,Sn],[[()=>Nt,0],[()=>mn,0],[()=>mn,0],[()=>kn,0]]],mn=[3,p,Df,0,[$x],[[()=>Dt,0]]],r0=[3,p,$f,0,[rx,ux],[[()=>dS,0],[()=>Cu,0]]],n0=[3,p,Ff,0,[],[]],Nt=[3,p,Uf,0,[iu,Gl,nS,rS,Fl],[[()=>Dt,0],[()=>Dt,0],[()=>Il,0],[()=>Il,0],1]],s0=[3,p,Gf,0,[yx,Dy],[[()=>Sw,0],[()=>gw,0]]],o0=[3,p,zf,0,[tS],[[()=>xw,0]]],i0=[3,p,jf,0,[Rn,Ul,Px,Sn],[[()=>Nt,0],[()=>mn,0],()=>bo,[()=>kn,0]]],a0=[3,p,Vf,0,[Bt,gt,xt],[0,0,0]],c0=[3,p,Yf,0,[Z,Fl,Ly,Me,Xe],[0,0,0,0,2]],l0=[3,p,nh,0,[jl],[()=>bw]],u0=[3,p,Qf,0,[Z,Xx,Lx,Me,Xe],[0,1,1,0,2]],d0=[3,p,eh,0,[jl],[()=>Ew]],p0=[3,p,th,8,[Qe,oe],[0,[()=>Jw,0]]],m0=[3,p,sh,0,[D,lu],[0,64]],_u=[3,p,ah,0,[Fx,Yy],[()=>A0,()=>g0]],f0=[3,p,oh,0,[wn,Me,Xe],[0,0,2]],h0=[3,p,ch,8,[Qe,oe],[0,[()=>Yw,0]]],g0=[3,p,lh,0,[Yl,bu],[1,1]],y0=[3,p,uh,0,[zy,_n,Wl],[1,()=>ku,()=>_u]],x0=[3,p,ph,0,[wn,Z,Me,Xe],[0,0,0,2]],S0=[3,p,fh,0,[D],[0]],w0=[3,p,gh,0,[wn,Z,Me,Xe],[0,0,0,2]],b0=[3,p,xh,0,[Pe,wn,bx,Me,Xe],[0,0,0,0,2]],E0=[3,p,bh,0,[Sx,Cx],[()=>Tw,()=>Rw]],v0=[3,p,wh,0,[Bt,gt,xt,Ix],[0,0,0,0]],C0=[3,p,Ch,0,[D,lu],[0,64]],A0=[3,p,Ah,0,[Yl,bu],[1,1]],T0=[3,p,Eh,0,[Pe,Z,Me,Xe],[0,0,0,2]],R0=[3,p,Rh,0,[eS],[()=>_w]],Iu=[3,p,vh,0,[sx,qy,mx,Ol],[64,[()=>Ow,0],[()=>Bw,0],0]],ku=[3,p,_h,0,[jx,Ey,uS,Rx,Tx,Sy,by,ay,cy],[1,1,1,1,1,1,1,1,1]],_0=[3,p,Ih,0,[Cy,cx],[()=>vw,()=>Cw]],Mu=[3,p,kh,0,[Qe,oe,F],[0,[()=>zu,0],[()=>xo,0]]],I0=[3,p,Mh,0,[oe,F],[[()=>zu,0],[()=>xo,0]]],k0=[3,p,Ph,0,[Qe],[0]],Pu=[3,p,Dh,0,[ax,Yx,Vx,Dx],[1,1,1,64]],Mn=[-3,p,Wh,{[F]:xu,[Q]:500},[V],[0]];k.for(p).registerError(Mn,tn);var M0=[3,p,Oh,0,[Ye,gn,Nl,Ze,xt,Bt,gt,En,De],[[()=>In,16],[0,{[P]:Ws}],[0,{[P]:rm}],[0,1],[0,{[P]:Pl}],[0,{[P]:kl}],[0,{[P]:Ml}],[0,{[P]:fn}],[0,{[P]:hn}]]],P0=[3,p,Nh,0,[Ye,gn,En,De],[[()=>In,16],[0,{[P]:Ws}],[0,{[P]:fn}],[0,{[P]:hn}]]],D0=[3,p,Lh,0,[Ye],[[()=>In,0]]],B0=[3,p,Fh,0,[Ze,Ye],[[0,1],[()=>Xw,16]]],O0=[3,p,Hh,0,[Ye],[[()=>Qw,16]]],N0=[3,p,qh,0,[Ye,gn,Nl,Ze,xt,Bt,gt,En,De],[[()=>In,16],[0,{[P]:Ws}],[0,{[P]:ry}],[0,1],[0,{[P]:Pl}],[0,{[P]:kl}],[0,{[P]:Ml}],[0,{[P]:fn}],[0,{[P]:hn}]]],L0=[3,p,jh,0,[Ye,gn,En,De],[[()=>rb,16],[0,{[P]:ny}],[0,{[P]:fn}],[0,{[P]:hn}]]],$0=[3,p,Jh,0,[Rl,_l,Al,vl,Vs,Cl,Tl],[[5,{[Je]:Rl}],[5,{[Je]:_l}],[0,{[Je]:Al}],[1,{[Je]:vl}],[0,{[Je]:Vs}],[0,{[Je]:Cl}],[0,{[Je]:Tl}]]],U0=[3,p,Yh,0,[Vs,oy],[0,[()=>lw,0]]],Du=[3,p,Xh,0,[mu,ht],[0,[()=>fw,0]]],G0=[3,p,tg,0,[mu],[0]],F0=[3,p,ng,0,[hu,Bl],[0,15]],H0=[-3,p,Qh,{[F]:pe,[Q]:424},[V,ou,Ex],[0,1,0]];k.for(p).registerError(H0,ln);var z0=[-3,p,eg,{[F]:pe,[Q]:429},[V],[0]];k.for(p).registerError(z0,un);var Pn=[-3,p,rg,{[F]:pe,[Q]:424},[V,ou,fx],[0,1,0]];k.for(p).registerError(Pn,pn);var So=[-3,p,sg,{[F]:pe,[Q]:408},[V],[0]];k.for(p).registerError(So,dn);var q0=[3,p,cg,8,[Se],[[()=>go,0]]],Dn=[3,p,ag,0,[tx],[0]],Bu=[3,p,lg,0,[Vy],[0]],j0=[3,p,yg,8,[D,Su],[0,0]],V0=[-3,p,hg,{[F]:pe,[Q]:404},[V],[0]];k.for(p).registerError(V0,on);var Bn=[3,p,vg,0,[sS,Ll],[0,0]],Ou=[3,p,Ag,0,[oe,fo,ht,Zs],[0,0,()=>Iw,()=>Au]],W0=[3,p,Tg,0,[D],[0]],K0=[3,p,_g,0,[kx,Ot,yn],[1,1,1]],J0=[-3,p,Cg,{[F]:pe,[Q]:400},[V],[0]];k.for(p).registerError(J0,an);var On=[3,p,Ig,0,[Z],[0]],Nn=[-3,p,Pg,{[F]:xu,[Q]:503},[V],[0]];k.for(p).registerError(Nn,cn);var Y0=[3,p,kg,0,[Pe],[0]],X0=[3,p,Sg,0,[Xs,Ze,nx,io,Jx],[[0,4],0,[()=>pS,0],()=>Co,()=>kw]],Q0=[3,p,wg,0,[xn],[0]],Z0=[3,p,Mg,0,[Pe],[0]],ew=[3,p,Dg,0,[Zy,iS],[0,0]],Ln=[-3,p,Ng,{[F]:pe,[Q]:429},[V],[0]];k.for(p).registerError(Ln,rn);var Nu=[3,p,Vg,0,[Ql,gx,Kx,vy,Ay],[1,1,1,1,1]],wo=[3,p,Bg,0,[Qx,Hx],[()=>Dw,()=>ob]],tw=[3,p,Ug,0,[Tn,ht,Cn,Z],[0,[()=>Pw,0],0,0]],rw=[3,p,Hg,0,[Tn,Z,Cn],[0,0,0]],nw=[3,p,jg,0,[Pe,By,Ky],[0,0,()=>ib]],sw=[3,p,Wg,0,[Tn,Pe,to,Z],[0,0,15,0]],ow=[3,p,Kg,0,[to],[0]],iw=[3,p,Jg,0,[Tn,Pe,Z],[0,0,0]],$n=[-3,p,Zg,{[F]:pe,[Q]:400},[V],[0]];k.for(p).registerError($n,nn);var Lu=[3,p,Qg,0,[Qe,oe],[0,()=>lb]],aw=[3,p,ty,0,[oS,Oy],[0,0]],cw=[-3,wu,"BedrockRuntimeServiceException",0,[],[]];k.for(wu).registerError(cw,O);var lw=[1,p,mm,0,[()=>SS,0]],uw=[1,p,Dm,0,()=>Lw],dw=[1,p,nf,0,()=>CS],pw=[1,p,zm,0,()=>$w],mw=[1,p,qm,0,()=>RS],fw=[1,p,bm,0,[()=>Uw,0]],hw=[1,p,af,0,()=>jw],$u=[1,p,xf,0,[()=>Ru,0]],gw=[1,p,bf,0,[()=>mn,0]],yw=[1,p,vf,0,[()=>Ww,0]],Il=[1,p,Rf,0,[()=>YS,0]],bo=[1,p,Pf,0,()=>e0],Dt=[1,p,Of,0,[()=>r0,0]],xw=[1,p,Hf,0,[()=>Nt,0]],Sw=[1,p,qf,0,[()=>o0,0]],ww=[1,p,Kf,0,[()=>Kw,0]],bw=[1,p,Xf,0,()=>c0];var Ew=[1,p,Zf,0,()=>u0];var vw=[1,p,ih,0,()=>f0],Cw=[1,p,mh,0,()=>x0];var Aw=[1,p,hh,0,()=>S0],Tw=[1,p,yh,0,()=>w0],Rw=[1,p,Sh,0,()=>b0],_w=[1,p,Th,0,()=>T0],Eo=[1,p,og,0,[()=>Du,0]];var Iw=[1,p,Rg,0,()=>W0],vo=[1,p,bg,0,[()=>nb,0]],kw=[1,p,$g,0,()=>ew],Mw=[1,p,Gg,0,()=>ab],Pw=[1,p,zg,0,[()=>cb,0]],Dw=[1,p,Yg,0,()=>sb],Bw=[2,p,Sf,0,[0,0],[()=>$u,0]],Ow=[2,p,wf,0,[0,0],[()=>Ru,0]],Uu=[2,p,ug,8,0,()=>Zw],Gu=[2,p,fg,8,0,0],Co=[3,p,um,0,[_x],[()=>xS]],Nw=[3,p,fm,8,[Se,vn],[21,()=>Bn]],Lw=[3,p,Pm,0,[D],[0]],Fu=[3,p,Bm,0,[cS,ky,Py,My,Mx],[()=>aw,()=>qS,()=>VS,()=>jS,()=>K0]],$w=[3,p,Fm,0,[D],[0]],Uw=[3,p,Rm,0,[D,yt,Hl,Eu,dy,mo,po,Jl,Ys,uu,gy,gu],[0,[()=>Mu,0],()=>Tu,()=>Lu,[()=>wS,0],()=>sw,[()=>tw,0],[()=>Hu,0],()=>yo,[()=>eb,0],()=>AS,()=>Ou]],Gw=[3,p,Em,0,[D,mo,po,uu,Ty,yt],[0,()=>ow,()=>Mw,[()=>tb,0],()=>TS,[()=>I0,0]]],Fw=[3,p,Cm,0,[mo,po,yt],[()=>iw,()=>rw,()=>k0]],Hw=[3,p,Nm,0,[V],[[()=>Du,0]]],zw=[3,p,Wm,{[An]:1},[ox,fy,my,hy,ix,lx,ro,so,ho,uo,ao],[()=>G0,()=>kS,[()=>IS,0],()=>MS,()=>F0,[()=>OS,0],[()=>Mn,0],[()=>Pn,0],[()=>$n,0],[()=>Ln,0],[()=>Nn,0]]],qw=[3,p,Qm,0,[Wy,_y],[[()=>D0,0],[()=>GS,0]]],jw=[3,p,cf,0,[D],[0]],Vw=[3,p,pf,0,[Se,vn,D,ht],[21,()=>Bn,0,()=>hw]],Ww=[3,p,Ef,0,[aS,Qy,Nx,Xy,Gx,zx,dx],[[()=>i0,0],[()=>XS,0],[()=>t0,0],[()=>JS,0],[()=>s0,0],()=>n0,()=>QS]],Kw=[3,p,Wf,0,[D,yt],[()=>C0,[()=>h0,0]]],Hu=[3,p,Jf,0,[D,yt],[()=>m0,[()=>p0,0]]],Jw=[3,p,rh,8,[Se],[21]],Yw=[3,p,dh,8,[Se],[21]],zu=[3,p,Vh,8,[Se,vn],[21,()=>Bn]],Xw=[3,p,Uh,{[An]:1},[Qs],[[()=>ES,0]]],Qw=[3,p,Gh,{[An]:1},[Qs,ro,so,ho,uo,nu,ao],[[()=>vS,0],[()=>Mn,0],[()=>Pn,0],[()=>$n,0],[()=>Ln,0],[()=>So,0],[()=>Nn,0]]],Zw=[3,p,dg,0,[D],[0]],eb=[3,p,pg,8,[vx,du],[[()=>j0,0],21]],tb=[3,p,mg,8,[D,du,Su],[0,21,0]],rb=[3,p,gg,{[An]:1},[Qs,ro,so,ho,uo,nu,ao],[[()=>q0,0],[()=>Mn,0],[()=>Pn,0],[()=>$n,0],[()=>Ln,0],[()=>So,0],[()=>Nn,0]]],nb=[3,p,Eg,0,[D,Jl,Ys],[0,[()=>Hu,0],()=>yo]],sb=[3,p,Xg,0,[Wx,Bx,Ys],[()=>nw,()=>Z0,()=>yo]],ob=[3,p,Og,0,[py,ly,Zx],[()=>bS,()=>fS,()=>Y0]],ib=[3,p,Lg,0,[no],[15]],ab=[3,p,Fg,0,[D,no],[0,15]],cb=[3,p,qg,0,[no,D,yt,Hl,Eu,gu],[15,0,[()=>Mu,0],()=>Tu,()=>Lu,()=>Ou]],lb=[3,p,ey,0,[Se,vn],[21,()=>Bn]],i1=[9,p,om,{[me]:["POST","/guardrail/{guardrailIdentifier}/version/{guardrailVersion}/apply",200]},()=>gS,()=>yS],a1=[9,p,sf,{[me]:["POST","/model/{modelId}/converse",200]},()=>DS,()=>BS],c1=[9,p,Gm,{[me]:["POST","/model/{modelId}/converse-stream",200]},()=>LS,()=>$S],l1=[9,p,rf,{[me]:["POST","/model/{modelId}/count-tokens",200]},()=>HS,()=>zS],u1=[9,p,hf,{[me]:["GET","/async-invoke/{invocationArn}",200]},()=>WS,()=>KS],qu=[9,p,Bh,{[me]:["POST","/model/{modelId}/invoke",200]},()=>M0,()=>P0],d1=[9,p,$h,{[me]:["POST","/model/{modelId}/invoke-with-bidirectional-stream",200]},()=>B0,()=>O0],ju=[9,p,zh,{[me]:["POST","/model/{modelId}/invoke-with-response-stream",200]},()=>N0,()=>L0],p1=[9,p,Kh,{[me]:["GET","/async-invoke",200]},()=>$0,()=>U0],m1=[9,p,xg,{[me]:["POST","/async-invoke",200]},()=>X0,()=>Q0];var Lt=class extends je.classBuilder().ep(Qr).m(function(e,t,n,s){return[Vr(n,e.getEndpointParameterInstructions())]}).s("AmazonBedrockFrontendService","InvokeModel",{}).n("BedrockRuntimeClient","InvokeModelCommand").sc(qu).build(){};var Un=class extends je.classBuilder().ep(Qr).m(function(e,t,n,s){return[Vr(n,e.getEndpointParameterInstructions())]}).s("AmazonBedrockFrontendService","InvokeModelWithResponseStream",{eventStream:{output:!0}}).n("BedrockRuntimeClient","InvokeModelWithResponseStreamCommand").sc(ju).build(){};var Gn=class{constructor(e){this.client=null;this.settings=e,this.initializeClient()}initializeClient(){if(!this.settings.awsAccessKeyId||!this.settings.awsSecretAccessKey){this.client=null;return}let e={accessKeyId:this.settings.awsAccessKeyId,secretAccessKey:this.settings.awsSecretAccessKey};this.settings.awsSessionToken&&(e.sessionToken=this.settings.awsSessionToken),this.client=new Zr({region:this.settings.awsRegion,credentials:e})}reinitialize(e){this.settings=e,this.initializeClient()}isInitialized(){return this.client!==null}async testConnection(){if(!this.client)return{success:!1,message:"Client not initialized. Please configure AWS credentials."};try{let e={anthropic_version:"bedrock-2023-05-31",max_tokens:10,temperature:0,system:"Reply with 'OK'",messages:[{role:"user",content:"Test"}]},t=new Lt({modelId:this.settings.bedrockModelId,contentType:"application/json",accept:"application/json",body:JSON.stringify(e)}),n=await this.client.send(t),s=JSON.parse(new TextDecoder().decode(n.body));return s.content&&s.content.length>0?{success:!0,message:"Connection successful"}:{success:!1,message:"Unexpected response format"}}catch(e){return{success:!1,message:this.parseError(e),error:e instanceof Error?e:new Error(String(e))}}}async sendMessage(e,t){if(!this.client)throw new Error("Bedrock client not initialized. Please configure AWS credentials.");let n=this.convertToBedrockFormat(e),s={anthropic_version:"bedrock-2023-05-31",max_tokens:this.settings.maxTokens,temperature:this.settings.temperature,system:t,messages:n},o=new Lt({modelId:this.settings.bedrockModelId,contentType:"application/json",accept:"application/json",body:JSON.stringify(s)});try{let i=await this.client.send(o),a=JSON.parse(new TextDecoder().decode(i.body));if(a.content&&a.content.length>0)return a.content.filter(c=>c.type==="text").map(c=>c.text).join("");throw new Error("Empty response from Bedrock")}catch(i){throw new Error(this.parseError(i))}}async*sendMessageStream(e,t){var i,a,c,l,d;if(!this.client)throw new Error("Bedrock client not initialized. Please configure AWS credentials.");let n=this.convertToBedrockFormat(e),s={anthropic_version:"bedrock-2023-05-31",max_tokens:this.settings.maxTokens,temperature:this.settings.temperature,system:t,messages:n},o=new Un({modelId:this.settings.bedrockModelId,contentType:"application/json",accept:"application/json",body:JSON.stringify(s)});try{let u=await this.client.send(o);if(!u.body)throw new Error("No response body received");for await(let f of u.body)if((i=f.chunk)!=null&&i.bytes){let h=JSON.parse(new TextDecoder().decode(f.chunk.bytes));if(h.type==="content_block_delta")((a=h.delta)==null?void 0:a.type)==="text_delta"&&((c=h.delta)!=null&&c.text)&&(yield h.delta.text);else if(h.type==="message_delta"){if((l=h.delta)!=null&&l.stop_reason)return}else if(h.type==="error")throw new Error(((d=h.error)==null?void 0:d.message)||"Stream error")}}catch(u){throw new Error(this.parseError(u))}}convertToBedrockFormat(e){let t=[];for(let n of e)n.role!=="system"&&t.push({role:n.role,content:n.content});return t}parseError(e){if(e instanceof Error){let t=e.name,n=e.message;switch(t){case"AccessDeniedException":return"Access denied. Check your AWS credentials and model access permissions.";case"ValidationException":return`Validation error: ${n}`;case"ThrottlingException":return"Request throttled. Please wait and try again.";case"ServiceQuotaExceededException":return"Service quota exceeded. Please check your Bedrock limits.";case"ModelNotReadyException":return"Model is not ready. Please wait and try again.";case"ModelTimeoutException":return"Model request timed out. Please try again.";case"ModelErrorException":return`Model error: ${n}`;case"ResourceNotFoundException":return"Model not found. Ensure the model is enabled in your AWS region.";case"UnauthorizedException":case"CredentialsProviderError":return"Authentication failed. Please check your AWS credentials.";case"NetworkingError":case"TimeoutError":return"Network error. Please check your internet connection.";default:return n||"An unknown error occurred"}}return String(e)}getModelId(){return this.settings.bedrockModelId}getRegion(){return this.settings.awsRegion}};var Vu=require("obsidian"),Fn=class{constructor(e){this.baseUrl="https://generativelanguage.googleapis.com/v1beta";this.settings=e}reinitialize(e){this.settings=e}isInitialized(){return!!this.settings.geminiApiKey}async testConnection(){if(!this.settings.geminiApiKey)return{success:!1,message:"Gemini API key is not configured"};try{return await this.sendMessage([{role:"user",content:"Reply with 'OK'"}],"Reply with 'OK'")?{success:!0,message:"Connection successful"}:{success:!1,message:"Unexpected response format"}}catch(e){return{success:!1,message:this.parseError(e),error:e instanceof Error?e:new Error(String(e))}}}async sendMessage(e,t){var i,a;if(!this.settings.geminiApiKey)throw new Error("Gemini API key is not configured");let s={contents:this.convertToGeminiFormat(e),generationConfig:{maxOutputTokens:this.settings.maxTokens,temperature:this.settings.temperature}};t&&(s.systemInstruction={parts:[{text:t}]});let o=`${this.baseUrl}/models/${this.settings.geminiModelId}:generateContent?key=${this.settings.geminiApiKey}`;try{let l=(await(0,Vu.requestUrl)({url:o,method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})).json;if(l.candidates&&l.candidates.length>0){let d=l.candidates[0];if(((a=(i=d.content)==null?void 0:i.parts)==null?void 0:a.length)>0)return d.content.parts.map(u=>u.text).join("")}throw new Error("Empty response from Gemini")}catch(c){throw new Error(this.parseError(c))}}async*sendMessageStream(e,t){var i,a,c,l,d;if(!this.settings.geminiApiKey)throw new Error("Gemini API key is not configured");let s={contents:this.convertToGeminiFormat(e),generationConfig:{maxOutputTokens:this.settings.maxTokens,temperature:this.settings.temperature}};t&&(s.systemInstruction={parts:[{text:t}]});let o=`${this.baseUrl}/models/${this.settings.geminiModelId}:streamGenerateContent?key=${this.settings.geminiApiKey}&alt=sse`;try{let u=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!u.ok){let y=await u.text();throw new Error(`Gemini API error: ${u.status} - ${y}`)}if(!u.body)throw new Error("No response body");let f=u.body.getReader(),h=new TextDecoder,g="";for(;;){let{done:y,value:x}=await f.read();if(y)break;g+=h.decode(x,{stream:!0});let S=g.split(`
`);g=S.pop()||"";for(let w of S)if(w.startsWith("data: ")){let E=w.slice(6).trim();if(E&&E!=="[DONE]")try{let b=JSON.parse(E);(d=(l=(c=(a=(i=b.candidates)==null?void 0:i[0])==null?void 0:a.content)==null?void 0:c.parts)==null?void 0:l[0])!=null&&d.text&&(yield b.candidates[0].content.parts[0].text)}catch(b){}}}}catch(u){throw new Error(this.parseError(u))}}convertToGeminiFormat(e){let t=[];for(let n of e)n.role!=="system"&&t.push({role:n.role==="assistant"?"model":"user",parts:[{text:n.content}]});return t}parseError(e){if(e instanceof Error){let t=e.message;return t.includes("401")||t.includes("403")?"Authentication failed. Please check your Gemini API key.":t.includes("429")?"Rate limit exceeded. Please wait and try again.":t.includes("404")?"Model not found. Please check the model ID.":t.includes("500")||t.includes("503")?"Gemini service error. Please try again later.":t}return String(e)}};var Wu=require("obsidian"),Hn=class{constructor(e){this.baseUrl="https://api.groq.com/openai/v1";this.settings=e}reinitialize(e){this.settings=e}isInitialized(){return!!this.settings.groqApiKey}async testConnection(){if(!this.settings.groqApiKey)return{success:!1,message:"Groq API key is not configured"};try{return await this.sendMessage([{role:"user",content:"Reply with 'OK'"}],"Reply with 'OK'")?{success:!0,message:"Connection successful"}:{success:!1,message:"Unexpected response format"}}catch(e){return{success:!1,message:this.parseError(e),error:e instanceof Error?e:new Error(String(e))}}}async sendMessage(e,t){if(!this.settings.groqApiKey)throw new Error("Groq API key is not configured");let n=this.convertToGroqFormat(e,t),s={model:this.settings.groqModelId,messages:n,max_tokens:this.settings.maxTokens,temperature:this.settings.temperature,stream:!1};try{let i=(await(0,Wu.requestUrl)({url:`${this.baseUrl}/chat/completions`,method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.settings.groqApiKey}`},body:JSON.stringify(s)})).json;if(i.choices&&i.choices.length>0)return i.choices[0].message.content;throw new Error("Empty response from Groq")}catch(o){throw new Error(this.parseError(o))}}async*sendMessageStream(e,t){var o,i,a;if(!this.settings.groqApiKey)throw new Error("Groq API key is not configured");let n=this.convertToGroqFormat(e,t),s={model:this.settings.groqModelId,messages:n,max_tokens:this.settings.maxTokens,temperature:this.settings.temperature,stream:!0};try{let c=await fetch(`${this.baseUrl}/chat/completions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.settings.groqApiKey}`},body:JSON.stringify(s)});if(!c.ok){let f=await c.text();throw new Error(`Groq API error: ${c.status} - ${f}`)}if(!c.body)throw new Error("No response body");let l=c.body.getReader(),d=new TextDecoder,u="";for(;;){let{done:f,value:h}=await l.read();if(f)break;u+=d.decode(h,{stream:!0});let g=u.split(`
`);u=g.pop()||"";for(let y of g)if(y.startsWith("data: ")){let x=y.slice(6).trim();if(x&&x!=="[DONE]")try{let S=JSON.parse(x);(a=(i=(o=S.choices)==null?void 0:o[0])==null?void 0:i.delta)!=null&&a.content&&(yield S.choices[0].delta.content)}catch(S){}}}}catch(c){throw new Error(this.parseError(c))}}convertToGroqFormat(e,t){let n=[];t&&n.push({role:"system",content:t});for(let s of e)s.role!=="system"&&n.push({role:s.role,content:s.content});return n}parseError(e){if(e instanceof Error){let t=e.message;return t.includes("401")?"Authentication failed. Please check your Groq API key.":t.includes("429")?"Rate limit exceeded. Please wait and try again.":t.includes("404")?"Model not found. Please check the model ID.":t.includes("400")?"Invalid request. Please check your message format.":t.includes("500")||t.includes("503")?"Groq service error. Please try again later.":t}return String(e)}};var zn=class{constructor(e){this.settings=e,this.bedrockService=new Gn(e),this.geminiService=new Fn(e),this.groqService=new Hn(e)}getActiveService(){switch(this.settings.provider){case"bedrock":return this.bedrockService;case"gemini":return this.geminiService;case"groq":return this.groqService;default:return this.bedrockService}}reinitialize(e){this.settings=e,this.bedrockService.reinitialize(e),this.geminiService.reinitialize(e),this.groqService.reinitialize(e)}isInitialized(){return this.getActiveService().isInitialized()}getCurrentProvider(){return this.settings.provider}getCurrentProviderName(){return be[this.settings.provider]}async testConnection(){let e=this.getActiveService();return e.isInitialized()?await e.testConnection():{success:!1,message:`${this.getCurrentProviderName()} is not configured. Please add your credentials.`}}async testProviderConnection(e){let t;switch(e){case"bedrock":t=this.bedrockService;break;case"gemini":t=this.geminiService;break;case"groq":t=this.groqService;break;default:return{success:!1,message:"Unknown provider"}}return t.isInitialized()?await t.testConnection():{success:!1,message:`${be[e]} is not configured. Please add your credentials.`}}async sendMessage(e,t){let n=this.getActiveService();if(!n.isInitialized())throw new Error(`${this.getCurrentProviderName()} is not configured. Please add your credentials in settings.`);return await n.sendMessage(e,t)}async*sendMessageStream(e,t){let n=this.getActiveService();if(!n.isInitialized())throw new Error(`${this.getCurrentProviderName()} is not configured. Please add your credentials in settings.`);yield*n.sendMessageStream(e,t)}getCurrentModelId(){switch(this.settings.provider){case"bedrock":return this.settings.bedrockModelId;case"gemini":return this.settings.geminiModelId;case"groq":return this.settings.groqModelId;default:return""}}getProvidersStatus(){return{bedrock:{configured:this.bedrockService.isInitialized(),active:this.settings.provider==="bedrock"},gemini:{configured:this.geminiService.isInitialized(),active:this.settings.provider==="gemini"},groq:{configured:this.groqService.isInitialized(),active:this.settings.provider==="groq"}}}};var $t=require("obsidian"),qn=class{constructor(e){this.app=e}getActiveNote(){var t;let e=this.app.workspace.getActiveViewOfType($t.MarkdownView);return(t=e==null?void 0:e.file)!=null?t:null}getActiveMarkdownView(){return this.app.workspace.getActiveViewOfType($t.MarkdownView)}getActiveEditor(){var t;let e=this.getActiveMarkdownView();return(t=e==null?void 0:e.editor)!=null?t:null}async getActiveNoteContent(){let e=this.getActiveNote();if(!e)return"";try{return await this.app.vault.read(e)}catch(t){return""}}getActiveNotePath(){var t;let e=this.getActiveNote();return(t=e==null?void 0:e.path)!=null?t:""}getActiveNoteBasename(){var t;let e=this.getActiveNote();return(t=e==null?void 0:e.basename)!=null?t:""}async getActiveNoteMetadata(){let e=await this.getActiveNoteContent();if(!e)return null;let t=e.match(/^---\n([\s\S]*?)\n---/);if(!t)return null;try{return(0,$t.parseYaml)(t[1])}catch(n){return null}}getSelection(){let e=this.getActiveEditor();return e?e.getSelection():""}getCursorPosition(){let e=this.getActiveEditor();if(!e)return null;let t=e.getCursor();return{line:t.line,ch:t.ch}}getSelectionRange(){let e=this.getActiveEditor();if(!e)return null;let t=e.getCursor("from"),n=e.getCursor("to");return t.line===n.line&&t.ch===n.ch?null:{from:{line:t.line,ch:t.ch},to:{line:n.line,ch:n.ch}}}getVisibleRange(){let e=this.getActiveEditor();if(!e)return null;let t=e.getCursor(),n=e.lineCount(),o=Math.floor(30/2),i=Math.max(0,t.line-o),a=Math.min(n-1,t.line+o);return{start:i,end:a}}async getNoteContext(){let e=this.getActiveNote();if(!e)return null;let t=await this.getActiveNoteContent(),n=await this.getActiveNoteMetadata(),s=this.getSelection(),o=this.getSelectionRange(),i=this.getCursorPosition();return{path:e.path,basename:e.basename,content:t,frontmatter:n,selection:s||null,selectionRange:o?{startLine:o.from.line,endLine:o.to.line,startCh:o.from.ch,endCh:o.to.ch}:null,cursorPosition:i}}insertAtCursor(e){let t=this.getActiveEditor();if(!t)return!1;let n=t.getCursor();return t.replaceRange(e,n),!0}replaceSelection(e){let t=this.getActiveEditor();return t?(t.replaceSelection(e),!0):!1}replaceRange(e,t,n,s,o){let i=this.getActiveEditor();return i?(i.replaceRange(e,{line:t,ch:n},{line:s,ch:o}),!0):!1}async appendToNote(e){let t=this.getActiveEditor();if(!t)return!1;let s=t.lineCount()-1,o=t.getLine(s).length,i=o>0?`

`:`
`;return t.replaceRange(i+e,{line:s,ch:o}),!0}async prependToNote(e){let t=this.getActiveEditor();if(!t)return!1;let s=t.getValue().match(/^---\n[\s\S]*?\n---\n?/),o=0;return s&&(o=s[0].split(`
`).length-1),t.replaceRange(e+`

`,{line:o,ch:0}),!0}async replaceEntireContent(e){let t=this.getActiveEditor();if(!t)return!1;let s=t.lineCount()-1,o=t.getLine(s).length;return t.replaceRange(e,{line:0,ch:0},{line:s,ch:o}),!0}insertHeading(e,t){let n="#".repeat(Math.min(Math.max(t,1),6));return this.insertAtCursor(`${n} ${e}

`)}insertCodeBlock(e,t=""){let n=`\`\`\`${t}
${e}
\`\`\`
`;return this.insertAtCursor(n)}insertMermaid(e){return this.insertCodeBlock(e,"mermaid")}async findAndReplace(e,t,n=!1){var a;let s=this.getActiveEditor();if(!s)return 0;let o=s.getValue(),i=0;if(n){let c=new RegExp(this.escapeRegex(e),"g"),l=o.match(c);if(i=(a=l==null?void 0:l.length)!=null?a:0,i>0){let d=o.replace(c,t);await this.replaceEntireContent(d)}}else{let c=o.indexOf(e);if(c!==-1){let l=o.substring(0,c)+t+o.substring(c+e.length);await this.replaceEntireContent(l),i=1}}return i}findHeadingLine(e){let t=this.getActiveEditor();if(!t)return-1;let s=t.getValue().split(`
`),o=e.replace(/^#+\s*/,"").trim().toLowerCase();for(let i=0;i<s.length;i++){let a=s[i];if(a.startsWith("#")&&a.replace(/^#+\s*/,"").trim().toLowerCase()===o)return i}return-1}findSectionEnd(e){let t=this.getActiveEditor();if(!t)return-1;let n=t.lineCount(),s=this.getHeadingLevel(t.getLine(e));for(let o=e+1;o<n;o++){let i=t.getLine(o);if(i.startsWith("#")&&this.getHeadingLevel(i)<=s)return o-1}return n-1}getHeadingLevel(e){let t=e.match(/^(#+)/);return t?t[1].length:0}async insertAfterHeading(e,t){let n=this.getActiveEditor();if(!n)return!1;let s=this.findHeadingLine(e);if(s===-1)return!1;let o=s+1;return n.replaceRange(`
`+t+`
`,{line:o,ch:0}),!0}async updateSection(e,t){let n=this.getActiveEditor();if(!n)return!1;let s=this.findHeadingLine(e);if(s===-1)return!1;let o=this.findSectionEnd(s),i=n.getLine(s);return this.replaceRange(i+`

`+t+`
`,s,0,o,n.getLine(o).length),!0}async appendToSection(e,t){let n=this.getActiveEditor();if(!n)return!1;let s=this.findHeadingLine(e);if(s===-1)return!1;let o=this.findSectionEnd(s),i=n.getLine(o).length;return n.replaceRange(`

`+t,{line:o,ch:i}),!0}escapeRegex(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}hasActiveNote(){return this.getActiveNote()!==null}hasSelection(){return this.getSelection().length>0}focusEditor(){let e=this.getActiveMarkdownView();e&&e.editor.focus()}scrollToLine(e){let t=this.getActiveEditor();t&&t.scrollIntoView({from:{line:e,ch:0},to:{line:e,ch:0}},!0)}setCursor(e,t){let n=this.getActiveEditor();n&&n.setCursor({line:e,ch:t})}setSelection(e,t,n,s){let o=this.getActiveEditor();o&&o.setSelection({line:e,ch:t},{line:n,ch:s})}};var ee=class ee{constructor(e){this.noteController=e}parseEditCommands(e){let t=[],n=new RegExp(`${ee.EDIT_START}\\s*([\\s\\S]*?)\\s*${ee.EDIT_END}`,"g"),s;for(;(s=n.exec(e))!==null;)try{let o=s[1].trim(),i=JSON.parse(o);this.isValidEditCommand(i)&&t.push(i)}catch(o){console.error("Failed to parse edit command:",o)}return t}isValidEditCommand(e){if(!e||typeof e!="object")return!1;let t=e;return!(!t.action||typeof t.action!="string"||!["replace_selection","insert_at_cursor","replace_range","find_replace","update_section","append","prepend","replace_all","insert_after_heading"].includes(t.action)||!t.params||typeof t.params!="object")}async executeCommand(e){let{action:t,params:n}=e;try{switch(t){case"replace_selection":return this.executeReplaceSelection(n);case"insert_at_cursor":return this.executeInsertAtCursor(n);case"replace_range":return this.executeReplaceRange(n);case"find_replace":return this.executeFindReplace(n);case"update_section":return this.executeUpdateSection(n);case"append":return this.executeAppend(n);case"prepend":return this.executePrepend(n);case"replace_all":return this.executeReplaceAll(n);case"insert_after_heading":return this.executeInsertAfterHeading(n);default:return{success:!1,message:`Unknown action: ${t}`}}}catch(s){return{success:!1,message:s instanceof Error?s.message:"Unknown error"}}}async executeCommands(e){let t=[];for(let n of e){let s=await this.executeCommand(n);if(t.push({command:n,success:s.success,message:s.message}),!s.success)break}return t}executeReplaceSelection(e){var s,o;let t=(o=(s=e.text)!=null?s:e.content)!=null?o:"";if(!this.noteController.hasSelection())return{success:!1,message:"No text selected to replace"};let n=this.noteController.replaceSelection(t);return{success:n,message:n?"Selection replaced":"Failed to replace selection"}}executeInsertAtCursor(e){var s,o;let t=(o=(s=e.text)!=null?s:e.content)!=null?o:"";if(!this.noteController.hasActiveNote())return{success:!1,message:"No active note"};let n=this.noteController.insertAtCursor(t);return{success:n,message:n?"Text inserted at cursor":"Failed to insert text"}}executeReplaceRange(e){var c,l,d,u;let t=(l=(c=e.text)!=null?c:e.content)!=null?l:"",n=e.startLine,s=e.endLine;if(n===void 0||s===void 0)return{success:!1,message:"Start and end lines are required for replace_range"};let o=this.noteController.getActiveEditor();if(!o)return{success:!1,message:"No active editor"};let i=(u=(d=o.getLine(s))==null?void 0:d.length)!=null?u:0,a=this.noteController.replaceRange(t,n,0,s,i);return{success:a,message:a?`Replaced lines ${n}-${s}`:"Failed to replace range"}}async executeFindReplace(e){var i,a;let t=e.find,n=(i=e.replace)!=null?i:"",s=(a=e.all)!=null?a:!1;if(!t)return{success:!1,message:"Find text is required for find_replace"};let o=await this.noteController.findAndReplace(t,n,s);return o===0?{success:!1,message:`Text "${t}" not found`}:{success:!0,message:`Replaced ${o} occurrence(s)`}}async executeUpdateSection(e){var o,i;let t=e.heading,n=(i=(o=e.content)!=null?o:e.text)!=null?i:"";if(!t)return{success:!1,message:"Heading is required for update_section"};let s=await this.noteController.updateSection(t,n);return{success:s,message:s?`Updated section "${t}"`:`Section "${t}" not found`}}async executeAppend(e){var s,o;let t=(o=(s=e.text)!=null?s:e.content)!=null?o:"",n=await this.noteController.appendToNote(t);return{success:n,message:n?"Content appended to note":"Failed to append content"}}async executePrepend(e){var s,o;let t=(o=(s=e.text)!=null?s:e.content)!=null?o:"",n=await this.noteController.prependToNote(t);return{success:n,message:n?"Content prepended to note":"Failed to prepend content"}}async executeReplaceAll(e){var s,o;let t=(o=(s=e.content)!=null?s:e.text)!=null?o:"",n=await this.noteController.replaceEntireContent(t);return{success:n,message:n?"Note content replaced":"Failed to replace content"}}async executeInsertAfterHeading(e){var o,i;let t=e.heading,n=(i=(o=e.text)!=null?o:e.content)!=null?i:"";if(!t)return{success:!1,message:"Heading is required for insert_after_heading"};let s=await this.noteController.insertAfterHeading(t,n);return{success:s,message:s?`Content inserted after "${t}"`:`Heading "${t}" not found`}}hasEditCommands(e){return e.includes(ee.EDIT_START)&&e.includes(ee.EDIT_END)}getDisplayText(e){let t=new RegExp(`${ee.EDIT_START}[\\s\\S]*?${ee.EDIT_END}`,"g");return e.replace(t,"").trim()}generatePreview(e){var s,o,i,a,c,l,d,u,f,h;let{action:t,params:n}=e;switch(t){case"replace_selection":return`Replace selection with: "${this.truncate((o=(s=n.text)!=null?s:n.content)!=null?o:"")}"`;case"insert_at_cursor":return`Insert at cursor: "${this.truncate((a=(i=n.text)!=null?i:n.content)!=null?a:"")}"`;case"replace_range":return`Replace lines ${n.startLine}-${n.endLine}`;case"find_replace":return`Replace "${n.find}" with "${n.replace}"${n.all?" (all occurrences)":""}`;case"update_section":return`Update section "${n.heading}"`;case"append":return`Append to note: "${this.truncate((l=(c=n.text)!=null?c:n.content)!=null?l:"")}"`;case"prepend":return`Prepend to note: "${this.truncate((u=(d=n.text)!=null?d:n.content)!=null?u:"")}"`;case"replace_all":return"Replace entire note content";case"insert_after_heading":return`Insert after "${n.heading}": "${this.truncate((h=(f=n.text)!=null?f:n.content)!=null?h:"")}"`;default:return`Unknown action: ${t}`}}truncate(e,t=50){return e.length<=t?e:e.substring(0,t)+"..."}static getMarkers(){return{start:ee.EDIT_START,end:ee.EDIT_END}}};ee.EDIT_START="<<<EDIT_START>>>",ee.EDIT_END="<<<EDIT_END>>>";var St=ee;var te=class te{constructor(e){this.noteController=e}buildSystemPrompt(e){return e&&e.trim()?e:this.getDefaultSystemPrompt()}getDefaultSystemPrompt(){let e=St.getMarkers();return`You are an AI assistant integrated into Obsidian, a markdown note-taking application.

## Your Capabilities:
1. READ the currently active note (provided in context)
2. EDIT the note using structured edit commands
3. GENERATE Mermaid diagrams
4. ANSWER questions about the note content
5. HELP with writing, formatting, and organizing

## Edit Command Protocol:
When the user asks you to modify, update, edit, change, add to, or rewrite any part of the note, you MUST use edit commands.

Format:
${e.start}
{"action": "action_name", "params": {...}}
${e.end}

Available actions:
- replace_selection: Replace currently selected text
  params: {"text": "new text"}

- insert_at_cursor: Insert at cursor position
  params: {"text": "text to insert"}

- find_replace: Find and replace text
  params: {"find": "text to find", "replace": "replacement", "all": true/false}

- update_section: Replace content under a heading
  params: {"heading": "Section Name", "content": "new section content"}

- append: Add to end of note
  params: {"text": "text to append"}

- prepend: Add to beginning of note (after frontmatter)
  params: {"text": "text to prepend"}

- replace_all: Replace entire note content
  params: {"content": "complete new note content"}

- insert_after_heading: Insert content after a specific heading
  params: {"heading": "Heading Name", "text": "content to insert"}

- replace_range: Replace specific lines
  params: {"text": "new text", "startLine": 0, "endLine": 5}

## Important Rules:
1. ALWAYS use edit commands for modifications - never just show the text without the command
2. For Mermaid diagrams, use \`\`\`mermaid code blocks
3. Preserve existing formatting unless asked to change it
4. Be concise in explanations, thorough in edits
5. If unsure what to edit, ask for clarification
6. When replacing or updating, include the COMPLETE new content
7. For find_replace, use exact text matches

## Response Format:
- Explain what you're doing briefly
- Include the edit command block if making changes
- The edit command will be parsed and executed by the plugin

## Examples:

User: "Add a conclusion to my note"
Response: I'll add a conclusion section to your note.

${e.start}
{"action": "append", "params": {"text": "## Conclusion\\n\\nIn summary, this note covers the key points discussed above."}}
${e.end}

User: "Fix the typo in the word 'recieve'"
Response: I'll fix that typo for you.

${e.start}
{"action": "find_replace", "params": {"find": "recieve", "replace": "receive", "all": true}}
${e.end}

User: "Make the selected text bold"
Response: I'll make the selected text bold.

${e.start}
{"action": "replace_selection", "params": {"text": "**your selected text**"}}
${e.end}`}async buildContextMessage(e,t){if(!t)return e;let n=await this.noteController.getNoteContext();if(!n)return e;let s=[];return s.push("=== CURRENT NOTE CONTEXT ==="),s.push(`Path: ${n.path}`),n.frontmatter&&(s.push(`
Frontmatter:`),s.push("```yaml"),s.push(JSON.stringify(n.frontmatter,null,2)),s.push("```")),s.push(`
Note Content:`),s.push("```markdown"),s.push(this.truncateContent(n.content)),s.push("```"),n.selection&&n.selectionRange&&(s.push(`
User Selection (Lines ${n.selectionRange.startLine+1}-${n.selectionRange.endLine+1}):`),s.push("```"),s.push(n.selection),s.push("```")),n.cursorPosition&&s.push(`
Cursor Position: Line ${n.cursorPosition.line+1}, Column ${n.cursorPosition.ch+1}`),s.push(`=== END CONTEXT ===
`),s.push("User Request:"),s.push(e),s.join(`
`)}truncateContent(e){if(e.length<=te.MAX_NOTE_CHARS)return e;let t=Math.floor(te.MAX_NOTE_CHARS/2),n=e.substring(0,t),s=e.substring(e.length-t);return`${n}

[...truncated ${e.length-te.MAX_NOTE_CHARS} characters...]

${s}`}convertToLLMMessages(e,t,n){let s=[];for(let o of e)s.push({role:o.role,content:o.content});return s}async buildMessages(e,t,n){let s=[];for(let i of e)s.push({role:i.role,content:i.content});let o=await this.buildContextMessage(t,n);return s.push({role:"user",content:o}),s}async getContextSummary(){let e=await this.noteController.getNoteContext();if(!e)return null;let t=[];if(t.push(`\u{1F4C4} ${e.basename}`),e.selection){let s=e.selectionRange?` (L${e.selectionRange.startLine+1}-${e.selectionRange.endLine+1})`:"";t.push(`\u{1F4DD} Selection${s}`)}let n=e.content.split(/\s+/).length;return t.push(`${n} words`),t.join(" \u2022 ")}async hasNoteContext(){return this.noteController.hasActiveNote()}estimateTokens(e){return Math.ceil(e.length/te.CHARS_PER_TOKEN)}getMaxMessageLength(){return te.MAX_NOTE_CHARS}};te.MAX_NOTE_TOKENS=8e3,te.CHARS_PER_TOKEN=4,te.MAX_NOTE_CHARS=te.MAX_NOTE_TOKENS*te.CHARS_PER_TOKEN;var jn=te;var T=require("obsidian");var we=class we{extractMermaidBlocks(e){let t=[],n=new RegExp(we.MERMAID_PATTERN.source,"g"),s;for(;(s=n.exec(e))!==null;)t.push({code:s[1].trim(),startIndex:s.index,endIndex:s.index+s[0].length});return t}hasMermaid(e){return we.MERMAID_PATTERN.test(e)}validateMermaid(e){let t=e.trim();if(!t)return{valid:!1,diagramType:null,error:"Empty Mermaid code"};let n=t.split(`
`)[0].trim().toLowerCase(),s=null;for(let u of we.DIAGRAM_TYPES)if(n.startsWith(u.toLowerCase())){s=u;break}if(!s)return{valid:!1,diagramType:null,error:`Unknown diagram type. First line: "${n}"`};let o=(t.match(/\[/g)||[]).length,i=(t.match(/\]/g)||[]).length,a=(t.match(/\(/g)||[]).length,c=(t.match(/\)/g)||[]).length,l=(t.match(/\{/g)||[]).length,d=(t.match(/\}/g)||[]).length;return o!==i?{valid:!1,diagramType:s,error:"Mismatched brackets []"}:a!==c?{valid:!1,diagramType:s,error:"Mismatched parentheses ()"}:l!==d?{valid:!1,diagramType:s,error:"Mismatched braces {}"}:{valid:!0,diagramType:s,error:null}}formatForInsertion(e){return`\`\`\`mermaid
${e.trim()}
\`\`\``}extractMermaidCode(e){return this.extractMermaidBlocks(e).map(n=>n.code)}getDiagramType(e){let t=e.trim().split(`
`)[0].trim().toLowerCase();for(let n of we.DIAGRAM_TYPES)if(t.startsWith(n.toLowerCase()))return n;return null}createFlowchartTemplate(e,t,n){let s=["flowchart TD"];for(let o of t)s.push(`    ${o.id}[${o.label}]`);for(let o of n){let i=o.label?`|${o.label}|`:"";s.push(`    ${o.from} -->${i} ${o.to}`)}return s.join(`
`)}createSequenceTemplate(e,t){let n=["sequenceDiagram"];for(let s of e)n.push(`    participant ${s}`);for(let s of t){let o=(s.type==="async","->>");n.push(`    ${s.from}${o}${s.to}: ${s.message}`)}return n.join(`
`)}createClassTemplate(e,t){let n=["classDiagram"];for(let o of e){if(n.push(`    class ${o.name} {`),o.attributes)for(let i of o.attributes)n.push(`        ${i}`);if(o.methods)for(let i of o.methods)n.push(`        ${i}()`);n.push("    }")}let s={inheritance:"<|--",composition:"*--",aggregation:"o--",association:"--"};for(let o of t){let i=s[o.type]||"--";n.push(`    ${o.from} ${i} ${o.to}`)}return n.join(`
`)}createPieTemplate(e,t){let n=[`pie title ${e}`];for(let s of t)n.push(`    "${s.label}" : ${s.value}`);return n.join(`
`)}createGanttTemplate(e,t){let n=["gantt",`    title ${e}`,"    dateFormat YYYY-MM-DD"];for(let s of t){n.push(`    section ${s.name}`);for(let o of s.tasks){let i=o.after?`, after ${o.after}`:"";n.push(`    ${o.name} :${i} ${o.duration}`)}}return n.join(`
`)}replaceMermaidWithPlaceholders(e){let t=this.extractMermaidBlocks(e),n=e,s=0;for(let o=0;o<t.length;o++){let i=t[o],a=`[MERMAID_DIAGRAM_${o}]`,c=i.endIndex-i.startIndex;n=n.substring(0,i.startIndex-s)+a+n.substring(i.endIndex-s),s+=c-a.length}return{text:n,blocks:t}}static getSupportedDiagramTypes(){return[...we.DIAGRAM_TYPES]}};we.MERMAID_PATTERN=/```mermaid\n([\s\S]*?)```/g,we.DIAGRAM_TYPES=["flowchart","graph","sequenceDiagram","classDiagram","stateDiagram","stateDiagram-v2","erDiagram","gantt","pie","journey","gitGraph","mindmap","timeline","quadrantChart","xychart-beta","block-beta","sankey-beta"];var Vn=we;var Wn=class extends T.ItemView{constructor(t,n){super(t);this.chatHistory=[];this.isLoading=!1;this.plugin=n,this.editProtocol=new St(this.plugin.noteController),this.mermaidHandler=new Vn}getViewType(){return Ne}getDisplayText(){return"AI Assistant"}getIcon(){return"bot"}async onOpen(){let t=this.containerEl.children[1];t.empty(),t.addClass("ai-assistant-container"),this.createHeader(t),this.messagesContainer=t.createDiv({cls:"ai-assistant-messages"}),this.createContextBar(t),this.createInputArea(t),this.addWelcomeMessage(),await this.updateContextInfo()}async onClose(){}createHeader(t){let n=t.createDiv({cls:"ai-assistant-header"});n.createDiv({cls:"ai-assistant-title"}).createSpan({text:"AI Assistant"});let o=n.createDiv({cls:"ai-assistant-header-actions"}),i=o.createEl("button",{cls:"ai-assistant-header-btn",attr:{"aria-label":"Settings"}});(0,T.setIcon)(i,"settings"),i.addEventListener("click",()=>{this.app.setting.open(),this.app.setting.openTabById(this.plugin.manifest.id)});let a=o.createEl("button",{cls:"ai-assistant-header-btn",attr:{"aria-label":"Clear chat"}});(0,T.setIcon)(a,"trash-2"),a.addEventListener("click",()=>this.clearChat())}createContextBar(t){let n=t.createDiv({cls:"ai-assistant-context-bar"});this.contextInfo=n.createDiv({cls:"ai-assistant-context-info"});let s=n.createEl("button",{cls:"ai-assistant-context-clear",attr:{"aria-label":"Clear context"}});(0,T.setIcon)(s,"x"),s.addEventListener("click",()=>{this.contextToggle.checked=!1,this.updateContextInfo()})}createInputArea(t){this.inputContainer=t.createDiv({cls:"ai-assistant-input-area"});let s=this.inputContainer.createDiv({cls:"ai-assistant-toggle-container"}).createEl("label",{cls:"ai-assistant-toggle-label"});this.contextToggle=s.createEl("input",{type:"checkbox",cls:"ai-assistant-toggle"}),this.contextToggle.checked=this.plugin.settings.autoIncludeContext,this.contextToggle.addEventListener("change",()=>this.updateContextInfo()),s.createSpan({text:"Include active note"});let o=this.inputContainer.createDiv({cls:"ai-assistant-input-row"});this.inputTextarea=o.createEl("textarea",{cls:"ai-assistant-input",attr:{placeholder:"Ask anything or request changes to your note...",rows:"1"}}),this.inputTextarea.addEventListener("input",()=>{this.inputTextarea.style.height="auto",this.inputTextarea.style.height=Math.min(this.inputTextarea.scrollHeight,150)+"px"}),this.inputTextarea.addEventListener("keydown",i=>{i.key==="Enter"&&(i.ctrlKey||i.metaKey)&&(i.preventDefault(),this.sendMessage())}),this.sendButton=o.createEl("button",{cls:"ai-assistant-send-btn",attr:{"aria-label":"Send message"}}),(0,T.setIcon)(this.sendButton,"send"),this.sendButton.addEventListener("click",()=>this.sendMessage())}addWelcomeMessage(){let t=this.messagesContainer.createDiv({cls:"ai-assistant-welcome"});t.createEl("h3",{text:"\u{1F44B} Welcome to AI Assistant"}),t.createEl("p",{text:"I can help you with your notes. Try asking me to:"});let n=t.createEl("ul"),s=["Summarize this note","Fix grammar and spelling","Add a conclusion section","Create a Mermaid diagram","Expand on a topic"];for(let o of s)n.createEl("li").createEl("a",{text:o,cls:"ai-assistant-suggestion"}).addEventListener("click",()=>{this.inputTextarea.value=o,this.inputTextarea.focus()})}async updateContextInfo(){if(!this.contextToggle.checked){this.contextInfo.setText("No context attached"),this.contextInfo.addClass("ai-assistant-context-none");return}let t=await this.plugin.contextBuilder.getContextSummary();t?(this.contextInfo.setText(t),this.contextInfo.removeClass("ai-assistant-context-none")):(this.contextInfo.setText("No active note"),this.contextInfo.addClass("ai-assistant-context-none"))}async sendMessage(t){let n=t!=null?t:this.inputTextarea.value.trim();if(!n||this.isLoading)return;t||(this.inputTextarea.value="",this.inputTextarea.style.height="auto");let s=this.messagesContainer.querySelector(".ai-assistant-welcome");s&&s.remove();let o=this.createChatMessage("user",n);this.chatHistory.push(o),this.renderMessage(o),this.setLoading(!0);let i=this.createChatMessage("assistant","");this.chatHistory.push(i);let a=this.renderMessage(i,!0),c=a.querySelector(".ai-assistant-message-content");try{let l=await this.plugin.contextBuilder.buildMessages(this.chatHistory.slice(0,-1),n,this.contextToggle.checked),d=this.plugin.contextBuilder.buildSystemPrompt(this.plugin.settings.systemPrompt),u="";if(this.plugin.settings.streamResponses){let f=this.plugin.llmService.sendMessageStream(l,d);for await(let h of f)u+=h,i.content=u,await this.updateMessageContent(c,u),this.scrollToBottom()}else u=await this.plugin.llmService.sendMessage(l,d),i.content=u,await this.updateMessageContent(c,u);i.editCommands=this.editProtocol.parseEditCommands(u),i.mermaidBlocks=this.mermaidHandler.extractMermaidCode(u),this.addMessageActions(a,i)}catch(l){let d=l instanceof Error?l.message:"An error occurred";i.content=`\u274C Error: ${d}`,c.setText(i.content),c.addClass("ai-assistant-error")}finally{this.setLoading(!1),this.scrollToBottom()}}createChatMessage(t,n){return{id:crypto.randomUUID(),role:t,content:n,timestamp:new Date}}renderMessage(t,n=!1){let s=this.messagesContainer.createDiv({cls:`ai-assistant-message ai-assistant-message-${t.role}`}),o=s.createDiv({cls:"ai-assistant-bubble"}),i=o.createDiv({cls:"ai-assistant-message-content"});return t.content?this.updateMessageContent(i,t.content):n&&i.createDiv({cls:"ai-assistant-typing"}),o.createDiv({cls:"ai-assistant-message-meta"}).createSpan({text:t.timestamp.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),this.scrollToBottom(),s}async updateMessageContent(t,n){t.empty();let s=this.editProtocol.getDisplayText(n);await T.MarkdownRenderer.render(this.app,s,t,"",this.plugin),t.querySelectorAll("pre").forEach(i=>{let a=i.createEl("button",{cls:"ai-assistant-copy-code",attr:{"aria-label":"Copy code"}});(0,T.setIcon)(a,"copy"),a.addEventListener("click",async()=>{var l,d;let c=(d=(l=i.querySelector("code"))==null?void 0:l.textContent)!=null?d:"";await navigator.clipboard.writeText(c),(0,T.setIcon)(a,"check"),setTimeout(()=>(0,T.setIcon)(a,"copy"),2e3)})})}addMessageActions(t,n){let s=t.querySelector(".ai-assistant-bubble");if(!s)return;let o=s.createDiv({cls:"ai-assistant-message-actions"}),i=o.createEl("button",{cls:"ai-assistant-action-btn",attr:{"aria-label":"Copy response"}});(0,T.setIcon)(i,"copy"),i.createSpan({text:"Copy"}),i.addEventListener("click",async()=>{let c=this.editProtocol.getDisplayText(n.content);await navigator.clipboard.writeText(c),new T.Notice("Copied to clipboard")});let a=o.createEl("button",{cls:"ai-assistant-action-btn",attr:{"aria-label":"Insert at cursor"}});if((0,T.setIcon)(a,"file-input"),a.createSpan({text:"Insert"}),a.addEventListener("click",()=>{let c=this.editProtocol.getDisplayText(n.content);this.plugin.noteController.insertAtCursor(c)?new T.Notice("Inserted at cursor"):new T.Notice("No active note")}),n.editCommands&&n.editCommands.length>0){let c=o.createEl("button",{cls:"ai-assistant-action-btn ai-assistant-action-apply",attr:{"aria-label":"Apply edit"}});n.applied?((0,T.setIcon)(c,"check-circle"),c.createSpan({text:"Applied"}),c.disabled=!0,c.addClass("ai-assistant-action-applied")):((0,T.setIcon)(c,"edit"),c.createSpan({text:"Apply Edit"}),c.addEventListener("click",async()=>{let l=await this.editProtocol.executeCommands(n.editCommands);if(l.every(u=>u.success)){n.applied=!0,(0,T.setIcon)(c,"check-circle");let u=c.querySelector("span");u&&u.setText("Applied"),c.disabled=!0,c.addClass("ai-assistant-action-applied"),new T.Notice("Edit applied successfully")}else{let u=l.find(f=>!f.success);new T.Notice(`Edit failed: ${u==null?void 0:u.message}`)}}))}if(n.mermaidBlocks&&n.mermaidBlocks.length>0){let c=o.createEl("button",{cls:"ai-assistant-action-btn",attr:{"aria-label":"Insert diagram"}});(0,T.setIcon)(c,"git-branch"),c.createSpan({text:"Insert Diagram"}),c.addEventListener("click",()=>{for(let l of n.mermaidBlocks)this.plugin.noteController.insertMermaid(l)?new T.Notice("Diagram inserted"):new T.Notice("No active note")})}}setLoading(t){this.isLoading=t,this.sendButton.disabled=t,this.inputTextarea.disabled=t,t?this.sendButton.addClass("ai-assistant-loading"):this.sendButton.removeClass("ai-assistant-loading")}scrollToBottom(){this.messagesContainer.scrollTop=this.messagesContainer.scrollHeight}clearChat(){this.chatHistory=[],this.messagesContainer.empty(),this.addWelcomeMessage(),new T.Notice("Chat cleared")}getChatHistory(){return[...this.chatHistory]}focusInput(){this.inputTextarea.focus()}async setInputAndSend(t,n=!1){this.inputTextarea.value=t,n?await this.sendMessage():this.inputTextarea.focus()}};var Kn=class extends Jn.Plugin{constructor(){super(...arguments);this.chatView=null}async onload(){console.log("Loading AI Assistant plugin"),await this.loadSettings(),this.noteController=new qn(this.app),this.llmService=new zn(this.settings),this.contextBuilder=new jn(this.noteController),this.registerView(Ne,t=>(this.chatView=new Wn(t,this),this.chatView)),this.addRibbonIcon("bot","AI Assistant",()=>{this.activateView()}),this.registerCommands(),this.addSettingTab(new Gt(this.app,this)),this.checkSettings()}async onunload(){console.log("Unloading AI Assistant plugin"),this.app.workspace.detachLeavesOfType(Ne)}registerCommands(){this.addCommand({id:"open-ai-chat",name:"Open AI Assistant",callback:()=>{this.activateView()}}),this.addCommand({id:"send-note-to-ai",name:"Send Note to AI",editorCallback:async()=>{await this.activateView(),await this.noteController.getActiveNoteContent()&&this.chatView&&await this.chatView.setInputAndSend("Please analyze and summarize this note.",!0)}}),this.addCommand({id:"ai-edit-selection",name:"AI Edit Selection",editorCallback:async()=>{let t=this.noteController.getSelection();if(!t){new Jn.Notice("Please select some text first");return}await this.activateView(),this.chatView&&await this.chatView.setInputAndSend(`Please improve or edit the following selected text:

"${t}"`,!1)}}),this.addCommand({id:"ai-generate-mermaid",name:"Generate Mermaid Diagram",editorCallback:async()=>{await this.activateView(),this.chatView&&await this.chatView.setInputAndSend("Based on the content of this note, create a Mermaid diagram that visualizes the key concepts or relationships.",!0)}}),this.addCommand({id:"ai-fix-grammar",name:"AI Fix Grammar",editorCallback:async()=>{await this.activateView(),this.chatView&&await this.chatView.setInputAndSend("Please fix any grammar and spelling errors in this note while preserving the original meaning and formatting.",!0)}}),this.addCommand({id:"ai-expand-content",name:"AI Expand Content",editorCallback:async()=>{let t=this.noteController.getSelection();await this.activateView(),this.chatView&&(t?await this.chatView.setInputAndSend(`Please expand on the following selected text, adding more detail and context:

"${t}"`,!0):await this.chatView.setInputAndSend("Please expand on the main topics in this note, adding more detail and context where appropriate.",!0))}}),this.addCommand({id:"ai-clear-chat",name:"Clear AI Chat",callback:()=>{this.chatView&&this.chatView.clearChat()}})}async activateView(){let{workspace:t}=this.app,n=null,s=t.getLeavesOfType(Ne);s.length>0?n=s[0]:(n=t.getRightLeaf(!1),n&&await n.setViewState({type:Ne,active:!0})),n&&(t.revealLeaf(n),this.chatView&&this.chatView.focusInput())}async loadSettings(){this.settings=Object.assign({},Ro,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}reinitializeLLMService(){this.llmService.reinitialize(this.settings)}async testConnection(){let t=Yn(this.settings);return t.valid?(this.reinitializeLLMService(),await this.llmService.testConnection()):{success:!1,message:t.errors.join(", ")}}async testProviderConnection(t){return this.reinitializeLLMService(),await this.llmService.testProviderConnection(t)}checkSettings(){Yn(this.settings).valid}getChatView(){return this.chatView}getCurrentProviderName(){return this.llmService.getCurrentProviderName()}};
