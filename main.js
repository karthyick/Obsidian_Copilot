/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var Gt=Object.defineProperty;var Kd=Object.getOwnPropertyDescriptor;var Xd=Object.getOwnPropertyNames;var Jd=Object.prototype.hasOwnProperty;var Qd=(r,e,t)=>e in r?Gt(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var tt=(r,e)=>()=>(r&&(e=r(r=0)),e);var ko=(r,e)=>{for(var t in e)Gt(r,t,{get:e[t],enumerable:!0})},Zd=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of Xd(e))!Jd.call(r,s)&&s!==t&&Gt(r,s,{get:()=>e[s],enumerable:!(n=Kd(e,s))||n.enumerable});return r};var eu=r=>Zd(Gt({},"__esModule",{value:!0}),r);var h=(r,e,t)=>(Qd(r,typeof e!="symbol"?e+"":e,t),t);var G,ts=tt(()=>{G=r=>new TextEncoder().encode(r)});var he,Xo=tt(()=>{ts();he=r=>typeof r=="string"?G(r):ArrayBuffer.isView(r)?new Uint8Array(r.buffer,r.byteOffset,r.byteLength/Uint8Array.BYTES_PER_ELEMENT):new Uint8Array(r)});var q,Jo=tt(()=>{q=r=>{if(typeof r=="string")return r;if(typeof r!="object"||typeof r.byteOffset!="number"||typeof r.byteLength!="number")throw new Error("@smithy/util-utf8: toUtf8 encoder function only accepts string | Uint8Array.");return new TextDecoder("utf-8").decode(r)}});var z=tt(()=>{ts();Xo();Jo()});var gs,Ai=tt(()=>{z();gs=class{constructor({marshaller:e,serializer:t,deserializer:n,serdeContext:s,defaultContentType:o}){h(this,"marshaller");h(this,"serializer");h(this,"deserializer");h(this,"serdeContext");h(this,"defaultContentType");this.marshaller=e,this.serializer=t,this.deserializer=n,this.serdeContext=s,this.defaultContentType=o}async serializeEventStream({eventStream:e,requestSchema:t,initialRequest:n}){let s=this.marshaller,o=t.getEventStreamMember(),i=t.getMemberSchema(o),a=this.serializer,c=this.defaultContentType,l=Symbol("initialRequestMarker"),u={async*[Symbol.asyncIterator](){if(n){let d={":event-type":{type:"string",value:"initial-request"},":message-type":{type:"string",value:"event"},":content-type":{type:"string",value:c}};a.write(t,n);let p=a.flush();yield{[l]:!0,headers:d,body:p}}for await(let d of e)yield d}};return s.serialize(u,d=>{var w;if(d[l])return{headers:d.headers,body:d.body};let p=(w=Object.keys(d).find(v=>v!=="__type"))!=null?w:"",{additionalHeaders:m,body:g,eventType:y,explicitPayloadContentType:S}=this.writeEventBody(p,i,d);return{headers:{":event-type":{type:"string",value:y},":message-type":{type:"string",value:"event"},":content-type":{type:"string",value:S!=null?S:c},...m},body:g}})}async deserializeEventStream({response:e,responseSchema:t,initialResponseContainer:n}){var p;let s=this.marshaller,o=t.getEventStreamMember(),a=t.getMemberSchema(o).getMemberSchemas(),c=Symbol("initialResponseMarker"),l=s.deserialize(e.body,async m=>{var S,x,w,v;let g=(S=Object.keys(m).find(E=>E!=="__type"))!=null?S:"",y=m[g].body;if(g==="initial-response"){let E=await this.deserializer.read(t,y);return delete E[o],{[c]:!0,...E}}else if(g in a){let E=a[g];if(E.isStructSchema()){let A={},M=!1;for(let[N,Y]of E.structIterator()){let{eventHeader:Ne,eventPayload:_o}=Y.getMergedTraits();if(M=M||!!(Ne||_o),_o)Y.isBlobSchema()?A[N]=y:Y.isStringSchema()?A[N]=((w=(x=this.serdeContext)==null?void 0:x.utf8Encoder)!=null?w:q)(y):Y.isStructSchema()&&(A[N]=await this.deserializer.read(Y,y));else if(Ne){let Be=(v=m[g].headers[N])==null?void 0:v.value;Be!=null&&(Y.isNumericSchema()?Be&&typeof Be=="object"&&"bytes"in Be?A[N]=BigInt(Be.toString()):A[N]=Number(Be):A[N]=Be)}}if(M)return{[g]:A}}return{[g]:await this.deserializer.read(E,y)}}else return{$unknown:m}}),u=l[Symbol.asyncIterator](),d=await u.next();if(d.done)return l;if((p=d.value)!=null&&p[c]){if(!t)throw new Error("@smithy::core/protocols - initial-response event encountered in event stream but no response schema given.");for(let[m,g]of Object.entries(d.value))n[m]=g}return{async*[Symbol.asyncIterator](){var m;for((m=d==null?void 0:d.value)!=null&&m[c]||(yield d.value);;){let{done:g,value:y}=await u.next();if(g)break;yield y}}}}writeEventBody(e,t,n){var p,m;let s=this.serializer,o=e,i=null,a,c=t.getSchema()[4].includes(e),l={};if(c){let g=t.getMemberSchema(e);if(g.isStructSchema()){for(let[y,S]of g.structIterator()){let{eventHeader:x,eventPayload:w}=S.getMergedTraits();if(w)i=y;else if(x){let v=n[e][y],E="binary";S.isNumericSchema()?(-2)**31<=v&&v<=2**31-1?E="integer":E="long":S.isTimestampSchema()?E="timestamp":S.isStringSchema()?E="string":S.isBooleanSchema()&&(E="boolean"),v!=null&&(l[y]={type:E,value:v},delete n[e][y])}}if(i!==null){let y=g.getMemberSchema(i);y.isBlobSchema()?a="application/octet-stream":y.isStringSchema()&&(a="text/plain"),s.write(y,n[e][i])}else s.write(g,n[e])}else throw new Error("@smithy/core/event-streams - non-struct member not supported in event stream union.")}else{let[g,y]=n[e];o=g,s.write(15,y)}let u=s.flush();return{body:typeof u=="string"?((m=(p=this.serdeContext)==null?void 0:p.utf8Decoder)!=null?m:G)(u):u,eventType:o,explicitPayloadContentType:a,additionalHeaders:l}}}});var Ci={};ko(Ci,{EventStreamSerde:()=>gs});var Ti=tt(()=>{Ai()});var u0={};ko(u0,{default:()=>Xn});module.exports=eu(u0);var Jn=require("obsidian");var Mo={provider:"bedrock",awsAccessKeyId:"",awsSecretAccessKey:"",awsSessionToken:"",awsRegion:"us-east-1",bedrockModelId:"anthropic.claude-sonnet-4-20250514-v1:0",geminiApiKey:"",geminiModelId:"gemini-2.0-flash",groqApiKey:"",groqModelId:"llama-3.3-70b-versatile",maxTokens:4096,temperature:.7,systemPrompt:"",autoIncludeContext:!0,streamResponses:!0},Ft={"anthropic.claude-sonnet-4-20250514-v1:0":"Claude Sonnet 4 (Latest)","anthropic.claude-3-5-sonnet-20241022-v2:0":"Claude 3.5 Sonnet v2","anthropic.claude-3-5-sonnet-20240620-v1:0":"Claude 3.5 Sonnet","anthropic.claude-3-5-haiku-20241022-v1:0":"Claude 3.5 Haiku","anthropic.claude-3-opus-20240229-v1:0":"Claude 3 Opus","anthropic.claude-3-sonnet-20240229-v1:0":"Claude 3 Sonnet","anthropic.claude-3-haiku-20240307-v1:0":"Claude 3 Haiku"};var Do={"us-east-1":"US East (N. Virginia)","us-west-2":"US West (Oregon)","eu-west-1":"Europe (Ireland)","eu-central-1":"Europe (Frankfurt)","ap-southeast-1":"Asia Pacific (Singapore)","ap-northeast-1":"Asia Pacific (Tokyo)","ap-south-1":"Asia Pacific (Mumbai)"},ie={bedrock:"AWS Bedrock (Claude)",gemini:"Google Gemini",groq:"Groq"},Oe="ai-assistant-view";var T=require("obsidian");var Qn=require("obsidian"),B=class{static async fetchGeminiModels(e){var t;if(!e)return[];try{let n=await(0,Qn.requestUrl)({url:`https://generativelanguage.googleapis.com/v1beta/models?key=${e}`,method:"GET"});if(n.status!==200)return console.error("Failed to fetch Gemini models:",n.status),[];let s=n.json,o=[];for(let i of s.models||[])if((i.supportedGenerationMethods||[]).includes("generateContent")){let c=((t=i.name)==null?void 0:t.replace("models/",""))||"";if(c.includes("embedding")||c.includes("aqa"))continue;o.push({id:c,name:i.displayName||c,description:i.description,inputTokenLimit:i.inputTokenLimit,outputTokenLimit:i.outputTokenLimit})}return o.sort((i,a)=>{var u,d;let c=((u=i.id.match(/gemini-(\d+)/))==null?void 0:u[1])||"0",l=((d=a.id.match(/gemini-(\d+)/))==null?void 0:d[1])||"0";return c!==l?parseInt(l)-parseInt(c):i.name.localeCompare(a.name)}),o}catch(n){return console.error("Error fetching Gemini models:",n),[]}}static async fetchGroqModels(e){if(!e)return[];try{let t=await(0,Qn.requestUrl)({url:"https://api.groq.com/openai/v1/models",method:"GET",headers:{Authorization:`Bearer ${e}`}});if(t.status!==200)return console.error("Failed to fetch Groq models:",t.status),[];let n=t.json,s=[];for(let o of n.data||[])o.id.includes("whisper")||s.push({id:o.id,name:this.formatGroqModelName(o.id),description:o.owned_by});return s.sort((o,i)=>o.name.localeCompare(i.name)),s}catch(t){return console.error("Error fetching Groq models:",t),[]}}static formatGroqModelName(e){return{"llama-3.3-70b-versatile":"Llama 3.3 70B Versatile","llama-3.3-70b-specdec":"Llama 3.3 70B SpecDec","llama-3.1-70b-versatile":"Llama 3.1 70B Versatile","llama-3.1-8b-instant":"Llama 3.1 8B Instant","llama-3.2-1b-preview":"Llama 3.2 1B Preview","llama-3.2-3b-preview":"Llama 3.2 3B Preview","llama-3.2-11b-vision-preview":"Llama 3.2 11B Vision Preview","llama-3.2-90b-vision-preview":"Llama 3.2 90B Vision Preview","llama3-70b-8192":"Llama 3 70B","llama3-8b-8192":"Llama 3 8B","llama3-groq-70b-8192-tool-use-preview":"Llama 3 Groq 70B Tool Use","llama3-groq-8b-8192-tool-use-preview":"Llama 3 Groq 8B Tool Use","mixtral-8x7b-32768":"Mixtral 8x7B","gemma-7b-it":"Gemma 7B","gemma2-9b-it":"Gemma 2 9B"}[e]||e}static getFallbackGeminiModels(){return[{id:"gemini-2.0-flash",name:"Gemini 2.0 Flash"},{id:"gemini-2.0-flash-lite",name:"Gemini 2.0 Flash Lite"},{id:"gemini-1.5-pro",name:"Gemini 1.5 Pro"},{id:"gemini-1.5-flash",name:"Gemini 1.5 Flash"},{id:"gemini-1.5-flash-8b",name:"Gemini 1.5 Flash 8B"}]}static getFallbackGroqModels(){return[{id:"llama-3.3-70b-versatile",name:"Llama 3.3 70B Versatile"},{id:"llama-3.1-70b-versatile",name:"Llama 3.1 70B Versatile"},{id:"llama-3.1-8b-instant",name:"Llama 3.1 8B Instant"},{id:"mixtral-8x7b-32768",name:"Mixtral 8x7B"},{id:"gemma2-9b-it",name:"Gemma 2 9B"}]}};var Ht=class extends T.PluginSettingTab{constructor(t,n){super(t,n);this.geminiModels=[];this.groqModels=[];this.geminiDropdown=null;this.groqDropdown=null;this.plugin=n}display(){let{containerEl:t}=this;t.empty(),t.createEl("h1",{text:"AI Assistant Settings"}),this.renderProviderSection(t),this.renderBedrockSettings(t),this.renderGeminiSettings(t),this.renderGroqSettings(t),this.renderCommonSettings(t),this.renderSystemPromptSection(t),this.renderInfoSection(t)}renderProviderSection(t){t.createEl("h2",{text:"AI Provider"}),new T.Setting(t).setName("Active Provider").setDesc("Select which AI provider to use").addDropdown(o=>{for(let[i,a]of Object.entries(ie))o.addOption(i,a);o.setValue(this.plugin.settings.provider),o.onChange(async i=>{this.plugin.settings.provider=i,await this.plugin.saveSettings(),this.plugin.reinitializeLLMService(),this.display()})});let n=t.createDiv({cls:"ai-assistant-provider-status"}),s=["bedrock","gemini","groq"];for(let o of s){let i=this.plugin.settings.provider===o,a=this.isProviderConfigured(o),c=n.createSpan({cls:`ai-assistant-status-badge ${i?"active":""} ${a?"configured":"not-configured"}`});c.createSpan({text:ie[o]}),c.createSpan({text:a?" \u2713":" \u25CB",cls:"status-icon"})}}isProviderConfigured(t){switch(t){case"bedrock":return!!(this.plugin.settings.awsAccessKeyId&&this.plugin.settings.awsSecretAccessKey);case"gemini":return!!this.plugin.settings.geminiApiKey;case"groq":return!!this.plugin.settings.groqApiKey;default:return!1}}renderBedrockSettings(t){let n=this.plugin.settings.provider==="bedrock",s=t.createDiv({cls:`ai-assistant-provider-section ${n?"active":"inactive"}`});s.createEl("h2",{text:"AWS Bedrock (Claude)"}),n||s.createEl("p",{text:"Switch to AWS Bedrock provider to use these settings.",cls:"setting-item-description"}),new T.Setting(s).setName("AWS Access Key ID").setDesc("Your AWS access key ID").addText(o=>o.setPlaceholder("Enter your access key ID").setValue(this.plugin.settings.awsAccessKeyId).onChange(async i=>{this.plugin.settings.awsAccessKeyId=i,await this.plugin.saveSettings()})),new T.Setting(s).setName("AWS Secret Access Key").setDesc("Your AWS secret access key").addText(o=>(o.setPlaceholder("Enter your secret access key").setValue(this.plugin.settings.awsSecretAccessKey).onChange(async i=>{this.plugin.settings.awsSecretAccessKey=i,await this.plugin.saveSettings()}),o.inputEl.type="password",o)),new T.Setting(s).setName("AWS Session Token (Optional)").setDesc("Session token for temporary credentials").addText(o=>(o.setPlaceholder("Enter session token (if using temporary credentials)").setValue(this.plugin.settings.awsSessionToken).onChange(async i=>{this.plugin.settings.awsSessionToken=i,await this.plugin.saveSettings()}),o.inputEl.type="password",o)),new T.Setting(s).setName("AWS Region").setDesc("AWS region where Bedrock is enabled").addDropdown(o=>{for(let[i,a]of Object.entries(Do))o.addOption(i,a);o.setValue(this.plugin.settings.awsRegion),o.onChange(async i=>{this.plugin.settings.awsRegion=i,await this.plugin.saveSettings(),this.plugin.reinitializeLLMService()})}),new T.Setting(s).setName("Model").setDesc("Select the Claude model to use").addDropdown(o=>{for(let[i,a]of Object.entries(Ft))o.addOption(i,a);o.setValue(this.plugin.settings.bedrockModelId),o.onChange(async i=>{this.plugin.settings.bedrockModelId=i,await this.plugin.saveSettings()})}),new T.Setting(s).setName("Test Connection").setDesc("Verify your AWS credentials and model access").addButton(o=>o.setButtonText("Test Connection").setCta().onClick(async()=>{await this.testProviderConnection("bedrock",o)}))}renderGeminiSettings(t){let n=this.plugin.settings.provider==="gemini",s=t.createDiv({cls:`ai-assistant-provider-section ${n?"active":"inactive"}`});s.createEl("h2",{text:"Google Gemini"}),n||s.createEl("p",{text:"Switch to Google Gemini provider to use these settings.",cls:"setting-item-description"}),new T.Setting(s).setName("Gemini API Key").setDesc("Your Google AI Studio API key").addText(c=>(c.setPlaceholder("Enter your Gemini API key").setValue(this.plugin.settings.geminiApiKey).onChange(async l=>{this.plugin.settings.geminiApiKey=l,await this.plugin.saveSettings(),this.refreshGeminiModels()}),c.inputEl.type="password",c));let o=new T.Setting(s).setName("Model").setDesc("Select the Gemini model to use (fetched from API)").addDropdown(c=>{this.geminiDropdown=c,this.populateGeminiDropdown(c),c.setValue(this.plugin.settings.geminiModelId),c.onChange(async l=>{this.plugin.settings.geminiModelId=l,await this.plugin.saveSettings()})}).addButton(c=>c.setIcon("refresh-cw").setTooltip("Refresh models from API").onClick(async()=>{c.setDisabled(!0),await this.refreshGeminiModels(),c.setDisabled(!1),new T.Notice("Gemini models refreshed")}));new T.Setting(s).setName("Test Connection").setDesc("Verify your Gemini API key").addButton(c=>c.setButtonText("Test Connection").setCta().onClick(async()=>{await this.testProviderConnection("gemini",c)})),s.createDiv({cls:"ai-assistant-link"}).createEl("a",{text:"Get a Gemini API key from Google AI Studio",href:"https://aistudio.google.com/app/apikey"}).setAttr("target","_blank"),this.plugin.settings.geminiApiKey&&this.geminiModels.length===0&&this.refreshGeminiModels()}async refreshGeminiModels(){if(!this.plugin.settings.geminiApiKey)this.geminiModels=B.getFallbackGeminiModels();else{let t=await B.fetchGeminiModels(this.plugin.settings.geminiApiKey);this.geminiModels=t.length>0?t:B.getFallbackGeminiModels()}if(this.geminiDropdown){let t=this.geminiDropdown.getValue();this.populateGeminiDropdown(this.geminiDropdown),this.geminiModels.find(s=>s.id===t)?this.geminiDropdown.setValue(t):this.geminiModels.length>0&&(this.geminiDropdown.setValue(this.geminiModels[0].id),this.plugin.settings.geminiModelId=this.geminiModels[0].id,await this.plugin.saveSettings())}}populateGeminiDropdown(t){t.selectEl.empty();let n=this.geminiModels.length>0?this.geminiModels:B.getFallbackGeminiModels();for(let s of n)t.addOption(s.id,s.name)}renderGroqSettings(t){let n=this.plugin.settings.provider==="groq",s=t.createDiv({cls:`ai-assistant-provider-section ${n?"active":"inactive"}`});s.createEl("h2",{text:"Groq"}),n||s.createEl("p",{text:"Switch to Groq provider to use these settings.",cls:"setting-item-description"}),new T.Setting(s).setName("Groq API Key").setDesc("Your Groq API key").addText(c=>(c.setPlaceholder("Enter your Groq API key").setValue(this.plugin.settings.groqApiKey).onChange(async l=>{this.plugin.settings.groqApiKey=l,await this.plugin.saveSettings(),this.refreshGroqModels()}),c.inputEl.type="password",c));let o=new T.Setting(s).setName("Model").setDesc("Select the Groq model to use (fetched from API)").addDropdown(c=>{this.groqDropdown=c,this.populateGroqDropdown(c),c.setValue(this.plugin.settings.groqModelId),c.onChange(async l=>{this.plugin.settings.groqModelId=l,await this.plugin.saveSettings()})}).addButton(c=>c.setIcon("refresh-cw").setTooltip("Refresh models from API").onClick(async()=>{c.setDisabled(!0),await this.refreshGroqModels(),c.setDisabled(!1),new T.Notice("Groq models refreshed")}));new T.Setting(s).setName("Test Connection").setDesc("Verify your Groq API key").addButton(c=>c.setButtonText("Test Connection").setCta().onClick(async()=>{await this.testProviderConnection("groq",c)})),s.createDiv({cls:"ai-assistant-link"}).createEl("a",{text:"Get a Groq API key from GroqCloud",href:"https://console.groq.com/keys"}).setAttr("target","_blank"),this.plugin.settings.groqApiKey&&this.groqModels.length===0&&this.refreshGroqModels()}async refreshGroqModels(){if(!this.plugin.settings.groqApiKey)this.groqModels=B.getFallbackGroqModels();else{let t=await B.fetchGroqModels(this.plugin.settings.groqApiKey);this.groqModels=t.length>0?t:B.getFallbackGroqModels()}if(this.groqDropdown){let t=this.groqDropdown.getValue();this.populateGroqDropdown(this.groqDropdown),this.groqModels.find(s=>s.id===t)?this.groqDropdown.setValue(t):this.groqModels.length>0&&(this.groqDropdown.setValue(this.groqModels[0].id),this.plugin.settings.groqModelId=this.groqModels[0].id,await this.plugin.saveSettings())}}populateGroqDropdown(t){t.selectEl.empty();let n=this.groqModels.length>0?this.groqModels:B.getFallbackGroqModels();for(let s of n)t.addOption(s.id,s.name)}async testProviderConnection(t,n){n.setDisabled(!0),n.setButtonText("Testing...");try{let s=await this.plugin.testProviderConnection(t);s.success?new T.Notice(`\u2713 ${ie[t]} connection successful!`):new T.Notice(`\u2717 ${ie[t]} failed: ${s.message}`)}catch(s){new T.Notice(`\u2717 Error: ${s instanceof Error?s.message:"Unknown error"}`)}finally{n.setDisabled(!1),n.setButtonText("Test Connection")}}renderCommonSettings(t){t.createEl("h2",{text:"Generation Settings"}),new T.Setting(t).setName("Max Tokens").setDesc("Maximum number of tokens in the response (256-4096)").addSlider(n=>n.setLimits(256,4096,256).setValue(this.plugin.settings.maxTokens).setDynamicTooltip().onChange(async s=>{this.plugin.settings.maxTokens=s,await this.plugin.saveSettings()})),new T.Setting(t).setName("Temperature").setDesc("Response creativity (0 = focused, 1 = creative)").addSlider(n=>n.setLimits(0,1,.1).setValue(this.plugin.settings.temperature).setDynamicTooltip().onChange(async s=>{this.plugin.settings.temperature=s,await this.plugin.saveSettings()})),t.createEl("h2",{text:"Behavior"}),new T.Setting(t).setName("Auto-include Note Context").setDesc("Automatically include the active note content in AI requests").addToggle(n=>n.setValue(this.plugin.settings.autoIncludeContext).onChange(async s=>{this.plugin.settings.autoIncludeContext=s,await this.plugin.saveSettings()})),new T.Setting(t).setName("Stream Responses").setDesc("Show AI responses in real-time as they are generated").addToggle(n=>n.setValue(this.plugin.settings.streamResponses).onChange(async s=>{this.plugin.settings.streamResponses=s,await this.plugin.saveSettings()}))}renderSystemPromptSection(t){t.createEl("h2",{text:"System Prompt"}),t.createEl("p",{text:"Customize the AI's behavior and capabilities. Leave empty to use the default prompt.",cls:"setting-item-description"}),new T.Setting(t).setName("Custom System Prompt").setDesc("Override the default system prompt (optional)").addTextArea(n=>(n.setPlaceholder("Leave empty for default prompt...").setValue(this.plugin.settings.systemPrompt).onChange(async s=>{this.plugin.settings.systemPrompt=s,await this.plugin.saveSettings()}),n.inputEl.rows=10,n.inputEl.cols=50,n.inputEl.style.width="100%",n.inputEl.style.minHeight="200px",n)),new T.Setting(t).setName("Reset System Prompt").setDesc("Reset to the default system prompt").addButton(n=>n.setButtonText("Reset to Default").setWarning().onClick(async()=>{this.plugin.settings.systemPrompt="",await this.plugin.saveSettings(),this.display(),new T.Notice("System prompt reset to default")}))}renderInfoSection(t){t.createEl("h2",{text:"Information"});let n=t.createDiv({cls:"ai-assistant-info"});n.createEl("p",{text:"This plugin supports multiple AI providers. Configure at least one provider to start using the AI Assistant."});let s=n.createEl("ul");s.createEl("li",{text:"AWS Bedrock: Requires AWS account with Bedrock access and Claude models enabled"}),s.createEl("li",{text:"Google Gemini: Requires Google AI Studio API key (free tier available)"}),s.createEl("li",{text:"Groq: Requires Groq API key (free tier available with rate limits)"})}};function Zn(r){let e=[];switch(r.provider){case"bedrock":r.awsAccessKeyId||e.push("AWS Access Key ID is required"),r.awsSecretAccessKey||e.push("AWS Secret Access Key is required"),r.awsRegion||e.push("AWS Region is required"),r.bedrockModelId||e.push("Bedrock Model is required");break;case"gemini":r.geminiApiKey||e.push("Gemini API Key is required"),r.geminiModelId||e.push("Gemini Model is required");break;case"groq":r.groqApiKey||e.push("Groq API Key is required"),r.groqModelId||e.push("Groq Model is required");break}return{valid:e.length===0,errors:e}}function Po(r){let e=r.signer,t=r.signer,n=Object.assign(r,{eventSigner:e,messageSigner:t}),s=n.eventStreamPayloadHandlerProvider(n);return Object.assign(n,{eventStreamPayloadHandler:s})}var No=r=>({setHttpHandler(e){r.httpHandler=e},httpHandler(){return r.httpHandler},updateHttpClientConfig(e,t){var n;(n=r.httpHandler)==null||n.updateHttpClientConfig(e,t)},httpHandlerConfigs(){return r.httpHandler.httpHandlerConfigs()}}),Bo=r=>({httpHandler:r.httpHandler()});var rt;(function(r){r.HTTP="http",r.HTTPS="https"})(rt||(rt={}));var nt;(function(r){r.MD5="md5",r.CRC32="crc32",r.CRC32C="crc32c",r.SHA1="sha1",r.SHA256="sha256"})(nt||(nt={}));var vt="__smithy_context";var R=class r{constructor(e){h(this,"method");h(this,"protocol");h(this,"hostname");h(this,"port");h(this,"path");h(this,"query");h(this,"headers");h(this,"username");h(this,"password");h(this,"fragment");h(this,"body");this.method=e.method||"GET",this.hostname=e.hostname||"localhost",this.port=e.port,this.query=e.query||{},this.headers=e.headers||{},this.body=e.body,this.protocol=e.protocol?e.protocol.slice(-1)!==":"?`${e.protocol}:`:e.protocol:"https:",this.path=e.path?e.path.charAt(0)!=="/"?`/${e.path}`:e.path:"/",this.username=e.username,this.password=e.password,this.fragment=e.fragment}static clone(e){let t=new r({...e,headers:{...e.headers}});return t.query&&(t.query=tu(t.query)),t}static isInstance(e){if(!e)return!1;let t=e;return"method"in t&&"protocol"in t&&"hostname"in t&&"path"in t&&typeof t.query=="object"&&typeof t.headers=="object"}clone(){return r.clone(this)}};function tu(r){return Object.keys(r).reduce((e,t)=>{let n=r[t];return{...e,[t]:Array.isArray(n)?[...n]:n}},{})}var $=class{constructor(e){h(this,"statusCode");h(this,"reason");h(this,"headers");h(this,"body");this.statusCode=e.statusCode,this.reason=e.reason,this.headers=e.headers||{},this.body=e.body}static isInstance(e){if(!e)return!1;let t=e;return typeof t.statusCode=="number"&&typeof t.headers=="object"}};var ru=r=>e=>async t=>{if(!R.isInstance(t.request))return e(t);let{request:n}=t,{handlerProtocol:s=""}=r.requestHandler.metadata||{};if(s.indexOf("h2")>=0&&!n.headers[":authority"])delete n.headers.host,n.headers[":authority"]=n.hostname+(n.port?":"+n.port:"");else if(!n.headers.host){let o=n.hostname;n.port!=null&&(o+=`:${n.port}`),n.headers.host=o}return e(t)},nu={name:"hostHeaderMiddleware",step:"build",priority:"low",tags:["HOST"],override:!0},Oo=r=>({applyToStack:e=>{e.add(ru(r),nu)}});var su=()=>(r,e)=>async t=>{var n,s;try{let o=await r(t),{clientName:i,commandName:a,logger:c,dynamoDbDocumentClientOptions:l={}}=e,{overrideInputFilterSensitiveLog:u,overrideOutputFilterSensitiveLog:d}=l,p=u!=null?u:e.inputFilterSensitiveLog,m=d!=null?d:e.outputFilterSensitiveLog,{$metadata:g,...y}=o.output;return(n=c==null?void 0:c.info)==null||n.call(c,{clientName:i,commandName:a,input:p(t.input),output:m(y),metadata:g}),o}catch(o){let{clientName:i,commandName:a,logger:c,dynamoDbDocumentClientOptions:l={}}=e,{overrideInputFilterSensitiveLog:u}=l,d=u!=null?u:e.inputFilterSensitiveLog;throw(s=c==null?void 0:c.error)==null||s.call(c,{clientName:i,commandName:a,input:d(t.input),error:o,metadata:o.$metadata}),o}},ou={name:"loggerMiddleware",tags:["LOGGER"],step:"initialize",override:!0},Lo=r=>({applyToStack:e=>{e.add(su(),ou)}});var Uo={step:"build",tags:["RECURSION_DETECTION"],name:"recursionDetectionMiddleware",override:!0,priority:"low"};var $o=()=>r=>async e=>r(e);var Go=r=>({applyToStack:e=>{e.add($o(),Uo)}});var X=r=>r[vt]||(r[vt]={});var K=r=>{if(typeof r=="function")return r;let e=Promise.resolve(r);return()=>e};var Fo=(r,e)=>{if(!e||e.length===0)return r;let t=[];for(let n of e)for(let s of r)s.schemeId.split("#")[1]===n&&t.push(s);for(let n of r)t.find(({schemeId:s})=>s===n.schemeId)||t.push(n);return t};function iu(r){let e=new Map;for(let t of r)e.set(t.schemeId,t);return e}var Ho=(r,e)=>(t,n)=>async s=>{var d;let o=r.httpAuthSchemeProvider(await e.httpAuthSchemeParametersProvider(r,n,s.input)),i=r.authSchemePreference?await r.authSchemePreference():[],a=Fo(o,i),c=iu(r.httpAuthSchemes),l=X(n),u=[];for(let p of a){let m=c.get(p.schemeId);if(!m){u.push(`HttpAuthScheme \`${p.schemeId}\` was not enabled for this service.`);continue}let g=m.identityProvider(await e.identityProviderConfigProvider(r));if(!g){u.push(`HttpAuthScheme \`${p.schemeId}\` did not have an IdentityProvider configured.`);continue}let{identityProperties:y={},signingProperties:S={}}=((d=p.propertiesExtractor)==null?void 0:d.call(p,r,n))||{};p.identityProperties=Object.assign(p.identityProperties||{},y),p.signingProperties=Object.assign(p.signingProperties||{},S),l.selectedHttpAuthScheme={httpAuthOption:p,identity:await g(p.identityProperties),signer:m.signer};break}if(!l.selectedHttpAuthScheme)throw new Error(u.join(`
`));return t(s)};var au={step:"serialize",tags:["HTTP_AUTH_SCHEME"],name:"httpAuthSchemeMiddleware",override:!0,relation:"before",toMiddleware:"endpointV2Middleware"},qo=(r,{httpAuthSchemeParametersProvider:e,identityProviderConfigProvider:t})=>({applyToStack:n=>{n.addRelativeTo(Ho(r,{httpAuthSchemeParametersProvider:e,identityProviderConfigProvider:t}),au)}});var zo={name:"serializerMiddleware",step:"serialize",tags:["SERIALIZER"],override:!0};var cu=r=>e=>{throw e},lu=(r,e)=>{},jo=r=>(e,t)=>async n=>{if(!R.isInstance(n.request))return e(n);let o=X(t).selectedHttpAuthScheme;if(!o)throw new Error("No HttpAuthScheme was selected: unable to sign request");let{httpAuthOption:{signingProperties:i={}},identity:a,signer:c}=o,l=await e({...n,request:await c.sign(n.request,a,i)}).catch((c.errorHandler||cu)(i));return(c.successHandler||lu)(l.response,i),l};var du={step:"finalizeRequest",tags:["HTTP_SIGNING"],name:"httpSigningMiddleware",aliases:["apiKeyMiddleware","tokenMiddleware","awsAuthMiddleware"],override:!0,relation:"after",toMiddleware:"retryMiddleware"},Vo=r=>({applyToStack:e=>{e.addRelativeTo(jo(r),du)}});var Le=r=>{if(typeof r=="function")return r;let e=Promise.resolve(r);return()=>e};var Wo="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",es=Object.entries(Wo).reduce((r,[e,t])=>(r[t]=Number(e),r),{}),Yo=Wo.split(""),ve=6,Ue=8,Ko=63;var re=r=>{let e=r.length/4*3;r.slice(-2)==="=="?e-=2:r.slice(-1)==="="&&e--;let t=new ArrayBuffer(e),n=new DataView(t);for(let s=0;s<r.length;s+=4){let o=0,i=0;for(let l=s,u=s+3;l<=u;l++)if(r[l]!=="="){if(!(r[l]in es))throw new TypeError(`Invalid character ${r[l]} in base64 string.`);o|=es[r[l]]<<(u-l)*ve,i+=ve}else o>>=ve;let a=s/4*3;o>>=i%Ue;let c=Math.floor(i/Ue);for(let l=0;l<c;l++){let u=(c-l-1)*Ue;n.setUint8(a+l,(o&255<<u)>>u)}}return new Uint8Array(t)};z();function J(r){let e;typeof r=="string"?e=G(r):e=r;let t=typeof e=="object"&&typeof e.length=="number",n=typeof e=="object"&&typeof e.byteOffset=="number"&&typeof e.byteLength=="number";if(!t&&!n)throw new Error("@smithy/util-base64: toBase64 encoder function only accepts string | Uint8Array.");let s="";for(let o=0;o<e.length;o+=3){let i=0,a=0;for(let l=o,u=Math.min(o+3,e.length);l<u;l++)i|=e[l]<<(u-l-1)*Ue,a+=Ue;let c=Math.ceil(a/ve);i<<=c*ve-a;for(let l=1;l<=c;l++){let u=(c-l)*ve;s+=Yo[(i&Ko<<u)>>u]}s+="==".slice(0,4-c)}return s}z();var st=class r extends Uint8Array{static fromString(e,t="utf-8"){if(typeof e=="string")return t==="base64"?r.mutate(re(e)):r.mutate(G(e));throw new Error(`Unsupported conversion from ${typeof e} to Uint8ArrayBlobAdapter.`)}static mutate(e){return Object.setPrototypeOf(e,r.prototype),e}transformToString(e="utf-8"){return e==="base64"?J(this):q(this)}};var rs=r=>{var e;return typeof ReadableStream=="function"&&(((e=r==null?void 0:r.constructor)==null?void 0:e.name)===ReadableStream.name||r instanceof ReadableStream)};var ae=r=>encodeURIComponent(r).replace(/[!'()*]/g,uu),uu=r=>`%${r.charCodeAt(0).toString(16).toUpperCase()}`;function qt(r){let e=[];for(let t of Object.keys(r).sort()){let n=r[t];if(t=ae(t),Array.isArray(n))for(let s=0,o=n.length;s<o;s++)e.push(`${t}=${ae(n[s])}`);else{let s=t;(n||typeof n=="string")&&(s+=`=${ae(n)}`),e.push(s)}}return e.join("&")}function ns(r,e){return new Request(r,e)}function Qo(r=0){return new Promise((e,t)=>{r&&setTimeout(()=>{let n=new Error(`Request did not complete within ${r} ms`);n.name="TimeoutError",t(n)},r)})}var ss={supported:void 0},$e=class r{constructor(e){h(this,"config");h(this,"configProvider");typeof e=="function"?this.configProvider=e().then(t=>t||{}):(this.config=e!=null?e:{},this.configProvider=Promise.resolve(this.config)),ss.supported===void 0&&(ss.supported=typeof Request!="undefined"&&"keepalive"in ns("https://[::1]"))}static create(e){return typeof(e==null?void 0:e.handle)=="function"?e:new r(e)}destroy(){}async handle(e,{abortSignal:t,requestTimeout:n}={}){var w,v,E;this.config||(this.config=await this.configProvider);let s=n!=null?n:this.config.requestTimeout,o=this.config.keepAlive===!0,i=this.config.credentials;if(t!=null&&t.aborted){let A=new Error("Request aborted");return A.name="AbortError",Promise.reject(A)}let a=e.path,c=qt(e.query||{});c&&(a+=`?${c}`),e.fragment&&(a+=`#${e.fragment}`);let l="";if(e.username!=null||e.password!=null){let A=(w=e.username)!=null?w:"",M=(v=e.password)!=null?v:"";l=`${A}:${M}@`}let{port:u,method:d}=e,p=`${e.protocol}//${l}${e.hostname}${u?`:${u}`:""}${a}`,m=d==="GET"||d==="HEAD"?void 0:e.body,g={body:m,headers:new Headers(e.headers),method:d,credentials:i};(E=this.config)!=null&&E.cache&&(g.cache=this.config.cache),m&&(g.duplex="half"),typeof AbortController!="undefined"&&(g.signal=t),ss.supported&&(g.keepalive=o),typeof this.config.requestInit=="function"&&Object.assign(g,this.config.requestInit(e));let y=()=>{},S=ns(p,g),x=[fetch(S).then(A=>{let M=A.headers,N={};for(let Ne of M.entries())N[Ne[0]]=Ne[1];return A.body!=null?{response:new $({headers:N,reason:A.statusText,statusCode:A.status,body:A.body})}:A.blob().then(Ne=>({response:new $({headers:N,reason:A.statusText,statusCode:A.status,body:Ne})}))}),Qo(s)];return t&&x.push(new Promise((A,M)=>{let N=()=>{let Y=new Error("Request aborted");Y.name="AbortError",M(Y)};if(typeof t.addEventListener=="function"){let Y=t;Y.addEventListener("abort",N,{once:!0}),y=()=>Y.removeEventListener("abort",N)}else t.onabort=N})),Promise.race(x).finally(y)}updateHttpClientConfig(e,t){this.config=void 0,this.configProvider=this.configProvider.then(n=>(n[e]=t,n))}httpHandlerConfigs(){var e;return(e=this.config)!=null?e:{}}};var zt=async r=>{var e;return typeof Blob=="function"&&r instanceof Blob||((e=r.constructor)==null?void 0:e.name)==="Blob"?Blob.prototype.arrayBuffer!==void 0?new Uint8Array(await r.arrayBuffer()):pu(r):mu(r)};async function pu(r){let e=await fu(r),t=re(e);return new Uint8Array(t)}async function mu(r){let e=[],t=r.getReader(),n=!1,s=0;for(;!n;){let{done:a,value:c}=await t.read();c&&(e.push(c),s+=c.length),n=a}let o=new Uint8Array(s),i=0;for(let a of e)o.set(a,i),i+=a.length;return o}function fu(r){return new Promise((e,t)=>{let n=new FileReader;n.onloadend=()=>{var a;if(n.readyState!==2)return t(new Error("Reader aborted too early"));let s=(a=n.result)!=null?a:"",o=s.indexOf(","),i=o>-1?o+1:s.length;e(s.substring(i))},n.onabort=()=>t(new Error("Read aborted")),n.onerror=()=>t(n.error),n.readAsDataURL(r)})}var Zo={},os={};for(let r=0;r<256;r++){let e=r.toString(16).toLowerCase();e.length===1&&(e=`0${e}`),Zo[r]=e,os[e]=r}function ot(r){if(r.length%2!==0)throw new Error("Hex encoded strings must have an even number length");let e=new Uint8Array(r.length/2);for(let t=0;t<r.length;t+=2){let n=r.slice(t,t+2).toLowerCase();if(n in os)e[t/2]=os[n];else throw new Error(`Cannot decode unrecognized sequence ${n} as hexadecimal`)}return e}function _(r){let e="";for(let t=0;t<r.byteLength;t++)e+=Zo[r[t]];return e}z();var ei="The stream has already been transformed.",ri=r=>{var s,o;if(!ti(r)&&!rs(r)){let i=((o=(s=r==null?void 0:r.__proto__)==null?void 0:s.constructor)==null?void 0:o.name)||r;throw new Error(`Unexpected stream implementation, expect Blob or ReadableStream, got ${i}`)}let e=!1,t=async()=>{if(e)throw new Error(ei);return e=!0,await zt(r)},n=i=>{if(typeof i.stream!="function")throw new Error(`Cannot transform payload Blob to web stream. Please make sure the Blob.stream() is polyfilled.
If you are using React Native, this API is not yet supported, see: https://react-native.canny.io/feature-requests/p/fetch-streaming-body`);return i.stream()};return Object.assign(r,{transformToByteArray:t,transformToString:async i=>{let a=await t();if(i==="base64")return J(a);if(i==="hex")return _(a);if(i===void 0||i==="utf8"||i==="utf-8")return q(a);if(typeof TextDecoder=="function")return new TextDecoder(i).decode(a);throw new Error("TextDecoder is not available, please make sure polyfill is provided.")},transformToWebStream:()=>{if(e)throw new Error(ei);if(e=!0,ti(r))return n(r);if(rs(r))return r;throw new Error(`Cannot transform payload to web stream, got ${r}`)}})},ti=r=>typeof Blob=="function"&&r instanceof Blob;var be=async(r=new Uint8Array,e)=>{if(r instanceof Uint8Array)return st.mutate(r);if(!r)return st.mutate(new Uint8Array);let t=e.streamCollector(r);return st.mutate(await t)};function is(r){return encodeURIComponent(r).replace(/[!'()*]/g,function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()})}var jt=r=>typeof r=="function"?r():r;var Vt=(r,e,t,n,s)=>({name:e,namespace:r,traits:t,input:n,output:s});var ni=r=>(e,t)=>async n=>{var d,p,m,g;let{response:s}=await e(n),{operationSchema:o}=X(t),[,i,a,c,l,u]=o!=null?o:[];try{let y=await r.protocol.deserializeResponse(Vt(i,a,c,l,u),{...r,...t},s);return{response:s,output:y}}catch(y){if(Object.defineProperty(y,"$response",{value:s,enumerable:!1,writable:!1,configurable:!1}),!("$metadata"in y)){let S="Deserialization error: to see the raw response, inspect the hidden field {error}.$response on this object.";try{y.message+=`
  `+S}catch(x){!t.logger||((p=(d=t.logger)==null?void 0:d.constructor)==null?void 0:p.name)==="NoOpLogger"?console.warn(S):(g=(m=t.logger)==null?void 0:m.warn)==null||g.call(m,S)}typeof y.$responseBodyText!="undefined"&&y.$response&&(y.$response.body=y.$responseBodyText);try{if($.isInstance(s)){let{headers:x={}}=s,w=Object.entries(x);y.$metadata={httpStatusCode:s.statusCode,requestId:as(/^x-[\w-]+-request-?id$/,w),extendedRequestId:as(/^x-[\w-]+-id-2$/,w),cfId:as(/^x-[\w-]+-cf-id$/,w)}}}catch(x){}}throw y}},as=(r,e)=>(e.find(([t])=>t.match(r))||[void 0,void 0])[1];var si=r=>(e,t)=>async n=>{var p;let{operationSchema:s}=X(t),[,o,i,a,c,l]=s!=null?s:[],u=(p=t.endpointV2)!=null&&p.url&&r.urlParser?async()=>r.urlParser(t.endpointV2.url):r.endpoint,d=await r.protocol.serializeRequest(Vt(o,i,a,c,l),n.input,{...r,...t,endpoint:u});return e({...n,request:d})};var hu={name:"deserializerMiddleware",step:"deserialize",tags:["DESERIALIZER"],override:!0},gu={name:"serializerMiddleware",step:"serialize",tags:["SERIALIZER"],override:!0};function oi(r){return{applyToStack:e=>{e.add(si(r),gu),e.add(ni(r),hu),r.protocol.setSerdeContext(r)}}}function ge(r){if(typeof r=="object")return r;r=r|0;let e={},t=0;for(let n of["httpLabel","idempotent","idempotencyToken","sensitive","httpPayload","httpResponseCode","httpQueryParams"])(r>>t++&1)===1&&(e[n]=1);return e}var Ae=class Ae{constructor(e,t){h(this,"ref");h(this,"memberName");h(this,"symbol",Ae.symbol);h(this,"name");h(this,"schema");h(this,"_isMemberSchema");h(this,"traits");h(this,"memberTraits");h(this,"normalizedTraits");var i;this.ref=e,this.memberName=t;let n=[],s=e,o=e;for(this._isMemberSchema=!1;cs(s);)n.push(s[1]),s=s[0],o=jt(s),this._isMemberSchema=!0;if(n.length>0){this.memberTraits={};for(let a=n.length-1;a>=0;--a){let c=n[a];Object.assign(this.memberTraits,ge(c))}}else this.memberTraits=0;if(o instanceof Ae){let a=this.memberTraits;Object.assign(this,o),this.memberTraits=Object.assign({},a,o.getMemberTraits(),this.getMemberTraits()),this.normalizedTraits=void 0,this.memberName=t!=null?t:o.memberName;return}if(this.schema=jt(o),yu(this.schema)?(this.name=`${this.schema[1]}#${this.schema[2]}`,this.traits=this.schema[3]):(this.name=(i=this.memberName)!=null?i:String(o),this.traits=0),this._isMemberSchema&&!t)throw new Error(`@smithy/core/schema - NormalizedSchema member init ${this.getName(!0)} missing member name.`)}static[Symbol.hasInstance](e){let t=this.prototype.isPrototypeOf(e);return!t&&typeof e=="object"&&e!==null?e.symbol===this.symbol:t}static of(e){let t=jt(e);if(t instanceof Ae)return t;if(cs(t)){let[n,s]=t;if(n instanceof Ae)return Object.assign(n.getMergedTraits(),ge(s)),n;throw new Error(`@smithy/core/schema - may not init unwrapped member schema=${JSON.stringify(e,null,2)}.`)}return new Ae(t)}getSchema(){let e=this.schema;return e[0]===0?e[4]:e}getName(e=!1){let{name:t}=this;return!e&&t&&t.includes("#")?t.split("#")[1]:t||void 0}getMemberName(){return this.memberName}isMemberSchema(){return this._isMemberSchema}isListSchema(){let e=this.getSchema();return typeof e=="number"?e>=64&&e<128:e[0]===1}isMapSchema(){let e=this.getSchema();return typeof e=="number"?e>=128&&e<=255:e[0]===2}isStructSchema(){let e=this.getSchema();return e[0]===3||e[0]===-3}isBlobSchema(){let e=this.getSchema();return e===21||e===42}isTimestampSchema(){let e=this.getSchema();return typeof e=="number"&&e>=4&&e<=7}isUnitSchema(){return this.getSchema()==="unit"}isDocumentSchema(){return this.getSchema()===15}isStringSchema(){return this.getSchema()===0}isBooleanSchema(){return this.getSchema()===2}isNumericSchema(){return this.getSchema()===1}isBigIntegerSchema(){return this.getSchema()===17}isBigDecimalSchema(){return this.getSchema()===19}isStreaming(){let{streaming:e}=this.getMergedTraits();return!!e||this.getSchema()===42}isIdempotencyToken(){let e=o=>(o&4)===4||!!(o!=null&&o.idempotencyToken),{normalizedTraits:t,traits:n,memberTraits:s}=this;return e(t)||e(n)||e(s)}getMergedTraits(){var e;return(e=this.normalizedTraits)!=null?e:this.normalizedTraits={...this.getOwnTraits(),...this.getMemberTraits()}}getMemberTraits(){return ge(this.memberTraits)}getOwnTraits(){return ge(this.traits)}getKeySchema(){var o;let[e,t]=[this.isDocumentSchema(),this.isMapSchema()];if(!e&&!t)throw new Error(`@smithy/core/schema - cannot get key for non-map: ${this.getName(!0)}`);let n=this.getSchema(),s=e?15:(o=n[4])!=null?o:0;return bt([s,0],"key")}getValueSchema(){let e=this.getSchema(),[t,n,s]=[this.isDocumentSchema(),this.isMapSchema(),this.isListSchema()],o=typeof e=="number"?63&e:e&&typeof e=="object"&&(n||s)?e[3+e[0]]:t?15:void 0;if(o!=null)return bt([o,0],n?"value":"member");throw new Error(`@smithy/core/schema - ${this.getName(!0)} has no value member.`)}getMemberSchema(e){let t=this.getSchema();if(this.isStructSchema()&&t[4].includes(e)){let n=t[4].indexOf(e),s=t[5][n];return bt(cs(s)?s:[s,0],e)}if(this.isDocumentSchema())return bt([15,0],e);throw new Error(`@smithy/core/schema - ${this.getName(!0)} has no no member=${e}.`)}getMemberSchemas(){let e={};try{for(let[t,n]of this.structIterator())e[t]=n}catch(t){}return e}getEventStreamMember(){if(this.isStructSchema()){for(let[e,t]of this.structIterator())if(t.isStreaming()&&t.isStructSchema())return e}return""}*structIterator(){if(this.isUnitSchema())return;if(!this.isStructSchema())throw new Error("@smithy/core/schema - cannot iterate non-struct schema.");let e=this.getSchema();for(let t=0;t<e[4].length;++t)yield[e[4][t],bt([e[5][t],0],e[4][t])]}};h(Ae,"symbol",Symbol.for("@smithy/nor"));var C=Ae;function bt(r,e){if(r instanceof C)return Object.assign(r,{memberName:e,_isMemberSchema:!0});let t=C;return new t(r,e)}var cs=r=>Array.isArray(r)&&r.length===2,yu=r=>Array.isArray(r)&&r.length>=5;var ce=class ce{constructor(e,t=new Map,n=new Map){h(this,"namespace");h(this,"schemas");h(this,"exceptions");this.namespace=e,this.schemas=t,this.exceptions=n}static for(e){return ce.registries.has(e)||ce.registries.set(e,new ce(e)),ce.registries.get(e)}register(e,t){let n=this.normalizeShapeId(e);ce.for(n.split("#")[0]).schemas.set(n,t)}getSchema(e){let t=this.normalizeShapeId(e);if(!this.schemas.has(t))throw new Error(`@smithy/core/schema - schema not found for ${t}`);return this.schemas.get(t)}registerError(e,t){let n=e,s=ce.for(n[1]);s.schemas.set(n[1]+"#"+n[2],n),s.exceptions.set(n,t)}getErrorCtor(e){let t=e;return ce.for(t[1]).exceptions.get(t)}getBaseException(){for(let e of this.exceptions.keys())if(Array.isArray(e)){let[,t,n]=e,s=t+"#"+n;if(s.startsWith("smithy.ts.sdk.synthetic.")&&s.endsWith("ServiceException"))return e}}find(e){return[...this.schemas.values()].find(e)}clear(){this.schemas.clear(),this.exceptions.clear()}normalizeShapeId(e){return e.includes("#")?e:this.namespace+"#"+e}};h(ce,"registries",new Map);var k=ce;var ls=r=>{if(r!=null){if(typeof r=="string"){let e=parseFloat(r);if(!Number.isNaN(e))return String(e)!==String(r)&&bu.warn(vu(`Expected number but observed string: ${r}`)),e}if(typeof r=="number")return r;throw new TypeError(`Expected number, got ${typeof r}: ${r}`)}},Su=Math.ceil(34028234663852886e22),ii=r=>{let e=ls(r);if(e!==void 0&&!Number.isNaN(e)&&e!==1/0&&e!==-1/0&&Math.abs(e)>Su)throw new TypeError(`Expected 32-bit float, got ${r}`);return e},xu=r=>{if(r!=null){if(Number.isInteger(r)&&!Number.isNaN(r))return r;throw new TypeError(`Expected integer, got ${typeof r}: ${r}`)}};var ai=r=>li(r,16),ci=r=>li(r,8),li=(r,e)=>{let t=xu(r);if(t!==void 0&&wu(t,e)!==t)throw new TypeError(`Expected ${e}-bit integer, got ${r}`);return t},wu=(r,e)=>{switch(e){case 32:return Int32Array.of(r)[0];case 16:return Int16Array.of(r)[0];case 8:return Int8Array.of(r)[0]}};var di=r=>ls(typeof r=="string"?Wt(r):r);var ui=r=>ii(typeof r=="string"?Wt(r):r),Eu=/(-?(?:0|[1-9]\d*)(?:\.\d+)?(?:[eE][+-]?\d+)?)|(-?Infinity)|(NaN)/g,Wt=r=>{let e=r.match(Eu);if(e===null||e[0].length!==r.length)throw new TypeError("Expected real number, got implicit NaN");return parseFloat(r)};var At=r=>ai(typeof r=="string"?Wt(r):r),pi=r=>ci(typeof r=="string"?Wt(r):r),vu=r=>String(new TypeError(r).stack||r).split(`
`).slice(0,5).filter(e=>!e.includes("stackTraceWarning")).join(`
`),bu={warn:console.warn};var Au=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],us=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function Kt(r){let e=r.getUTCFullYear(),t=r.getUTCMonth(),n=r.getUTCDay(),s=r.getUTCDate(),o=r.getUTCHours(),i=r.getUTCMinutes(),a=r.getUTCSeconds(),c=s<10?`0${s}`:`${s}`,l=o<10?`0${o}`:`${o}`,u=i<10?`0${i}`:`${i}`,d=a<10?`0${a}`:`${a}`;return`${Au[n]}, ${c} ${us[t]} ${e} ${l}:${u}:${d} GMT`}var fb=new RegExp(/^(\d{4})-(\d{2})-(\d{2})[tT](\d{2}):(\d{2}):(\d{2})(?:\.(\d+))?[zZ]$/);var Cu=new RegExp(/^(\d{4})-(\d{2})-(\d{2})[tT](\d{2}):(\d{2}):(\d{2})(?:\.(\d+))?(([-+]\d{2}\:\d{2})|[zZ])$/),mi=r=>{if(r==null)return;if(typeof r!="string")throw new TypeError("RFC-3339 date-times must be expressed as strings");let e=Cu.exec(r);if(!e)throw new TypeError("Invalid RFC-3339 date-time value");let[t,n,s,o,i,a,c,l,u]=e,d=At(Ct(n)),p=Ce(s,"month",1,12),m=Ce(o,"day",1,31),g=Yt(d,p,m,{hours:i,minutes:a,seconds:c,fractionalMilliseconds:l});return u.toUpperCase()!="Z"&&g.setTime(g.getTime()-Ou(u)),g},Tu=new RegExp(/^(?:Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d{2}) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d{1,2}):(\d{2}):(\d{2})(?:\.(\d+))? GMT$/),Ru=new RegExp(/^(?:Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday), (\d{2})-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d{2}) (\d{1,2}):(\d{2}):(\d{2})(?:\.(\d+))? GMT$/),Iu=new RegExp(/^(?:Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( [1-9]|\d{2}) (\d{1,2}):(\d{2}):(\d{2})(?:\.(\d+))? (\d{4})$/),fi=r=>{if(r==null)return;if(typeof r!="string")throw new TypeError("RFC-7231 date-times must be expressed as strings");let e=Tu.exec(r);if(e){let[t,n,s,o,i,a,c,l]=e;return Yt(At(Ct(o)),ds(s),Ce(n,"day",1,31),{hours:i,minutes:a,seconds:c,fractionalMilliseconds:l})}if(e=Ru.exec(r),e){let[t,n,s,o,i,a,c,l]=e;return Mu(Yt(_u(o),ds(s),Ce(n,"day",1,31),{hours:i,minutes:a,seconds:c,fractionalMilliseconds:l}))}if(e=Iu.exec(r),e){let[t,n,s,o,i,a,c,l]=e;return Yt(At(Ct(l)),ds(n),Ce(s.trimLeft(),"day",1,31),{hours:o,minutes:i,seconds:a,fractionalMilliseconds:c})}throw new TypeError("Invalid RFC-7231 date-time value")},hi=r=>{if(r==null)return;let e;if(typeof r=="number")e=r;else if(typeof r=="string")e=di(r);else if(typeof r=="object"&&r.tag===1)e=r.value;else throw new TypeError("Epoch timestamps must be expressed as floating point numbers or their string representation");if(Number.isNaN(e)||e===1/0||e===-1/0)throw new TypeError("Epoch timestamps must be valid, non-Infinite, non-NaN numerics");return new Date(Math.round(e*1e3))},Yt=(r,e,t,n)=>{let s=e-1;return Pu(r,s,t),new Date(Date.UTC(r,s,t,Ce(n.hours,"hour",0,23),Ce(n.minutes,"minute",0,59),Ce(n.seconds,"seconds",0,60),Bu(n.fractionalMilliseconds)))},_u=r=>{let e=new Date().getUTCFullYear(),t=Math.floor(e/100)*100+At(Ct(r));return t<e?t+100:t},ku=50*365*24*60*60*1e3,Mu=r=>r.getTime()-new Date().getTime()>ku?new Date(Date.UTC(r.getUTCFullYear()-100,r.getUTCMonth(),r.getUTCDate(),r.getUTCHours(),r.getUTCMinutes(),r.getUTCSeconds(),r.getUTCMilliseconds())):r,ds=r=>{let e=us.indexOf(r);if(e<0)throw new TypeError(`Invalid month: ${r}`);return e+1},Du=[31,28,31,30,31,30,31,31,30,31,30,31],Pu=(r,e,t)=>{let n=Du[e];if(e===1&&Nu(r)&&(n=29),t>n)throw new TypeError(`Invalid day for ${us[e]} in ${r}: ${t}`)},Nu=r=>r%4===0&&(r%100!==0||r%400===0),Ce=(r,e,t,n)=>{let s=pi(Ct(r));if(s<t||s>n)throw new TypeError(`${e} must be between ${t} and ${n}, inclusive`);return s},Bu=r=>r==null?0:ui("0."+r)*1e3,Ou=r=>{let e=r[0],t=1;if(e=="+")t=1;else if(e=="-")t=-1;else throw new TypeError(`Offset direction, ${e}, must be "+" or "-"`);let n=Number(r.substring(1,3)),s=Number(r.substring(4,6));return t*(n*60+s)*60*1e3},Ct=r=>{let e=0;for(;e<r.length-1&&r.charAt(e)==="0";)e++;return e===0?r:r.slice(e)};var ps=typeof crypto!="undefined"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);var L=Array.from({length:256},(r,e)=>e.toString(16).padStart(2,"0")),Ge=()=>{if(ps)return ps();let r=new Uint8Array(16);return crypto.getRandomValues(r),r[6]=r[6]&15|64,r[8]=r[8]&63|128,L[r[0]]+L[r[1]]+L[r[2]]+L[r[3]]+"-"+L[r[4]]+L[r[5]]+"-"+L[r[6]]+L[r[7]]+"-"+L[r[8]]+L[r[9]]+"-"+L[r[10]]+L[r[11]]+L[r[12]]+L[r[13]]+L[r[14]]+L[r[15]]};var j=function(e){return Object.assign(new String(e),{deserializeJSON(){return JSON.parse(String(e))},toString(){return String(e)},toJSON(){return String(e)}})};j.from=r=>r&&typeof r=="object"&&(r instanceof j||"deserializeJSON"in r)?r:typeof r=="string"||Object.getPrototypeOf(r)===String.prototype?j(String(r)):j(JSON.stringify(r));j.fromObject=j.from;function gi(r){return(r.includes(",")||r.includes('"'))&&(r=`"${r.replace(/"/g,'\\"')}"`),r}var ms="(?:Mon|Tue|Wed|Thu|Fri|Sat|Sun)(?:[ne|u?r]?s?day)?",fs="(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)",hs="(\\d?\\d):(\\d{2}):(\\d{2})(?:\\.(\\d+))?",yi="(\\d?\\d)",Si="(\\d{4})",Lu=new RegExp(/^(\d{4})-(\d\d)-(\d\d)[tT](\d\d):(\d\d):(\d\d)(\.(\d+))?(([-+]\d\d:\d\d)|[zZ])$/),Uu=new RegExp(`^${ms}, ${yi} ${fs} ${Si} ${hs} GMT$`),$u=new RegExp(`^${ms}, ${yi}-${fs}-(\\d\\d) ${hs} GMT$`),Gu=new RegExp(`^${ms} ${fs} ( [1-9]|\\d\\d) ${hs} ${Si}$`),Fu=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],xi=r=>{if(r==null)return;let e=NaN;if(typeof r=="number")e=r;else if(typeof r=="string"){if(!/^-?\d*\.?\d+$/.test(r))throw new TypeError("parseEpochTimestamp - numeric string invalid.");e=Number.parseFloat(r)}else typeof r=="object"&&r.tag===1&&(e=r.value);if(isNaN(e)||Math.abs(e)===1/0)throw new TypeError("Epoch timestamps must be valid finite numbers.");return new Date(Math.round(e*1e3))},wi=r=>{if(r==null)return;if(typeof r!="string")throw new TypeError("RFC3339 timestamps must be strings");let e=Lu.exec(r);if(!e)throw new TypeError(`Invalid RFC3339 timestamp format ${r}`);let[,t,n,s,o,i,a,,c,l]=e;ye(n,1,12),ye(s,1,31),ye(o,0,23),ye(i,0,59),ye(a,0,60);let u=new Date(Date.UTC(Number(t),Number(n)-1,Number(s),Number(o),Number(i),Number(a),Number(c)?Math.round(parseFloat(`0.${c}`)*1e3):0));if(u.setUTCFullYear(Number(t)),l.toUpperCase()!="Z"){let[,d,p,m]=/([+-])(\d\d):(\d\d)/.exec(l)||[void 0,"+",0,0],g=d==="-"?1:-1;u.setTime(u.getTime()+g*(Number(p)*60*60*1e3+Number(m)*60*1e3))}return u},Ei=r=>{if(r==null)return;if(typeof r!="string")throw new TypeError("RFC7231 timestamps must be strings.");let e,t,n,s,o,i,a,c;if((c=Uu.exec(r))?[,e,t,n,s,o,i,a]=c:(c=$u.exec(r))?([,e,t,n,s,o,i,a]=c,n=(Number(n)+1900).toString()):(c=Gu.exec(r))&&([,t,e,s,o,i,a,n]=c),n&&i){let l=Date.UTC(Number(n),Fu.indexOf(t),Number(e),Number(s),Number(o),Number(i),a?Math.round(parseFloat(`0.${a}`)*1e3):0);ye(e,1,31),ye(s,0,23),ye(o,0,59),ye(i,0,60);let u=new Date(l);return u.setUTCFullYear(Number(n)),u}throw new TypeError(`Invalid RFC7231 date-time value ${r}.`)};function ye(r,e,t){let n=Number(r);if(n<e||n>t)throw new Error(`Value ${n} out of range [${e}, ${t}]`)}function vi(r,e,t){if(t<=0||!Number.isInteger(t))throw new Error("Invalid number of delimiters ("+t+") for splitEvery.");let n=r.split(e);if(t===1)return n;let s=[],o="";for(let i=0;i<n.length;i++)o===""?o=n[i]:o+=e+n[i],(i+1)%t===0&&(s.push(o),o="");return o!==""&&s.push(o),s}var Xt=r=>{let e=r.length,t=[],n=!1,s,o=0;for(let i=0;i<e;++i){let a=r[i];switch(a){case'"':s!=="\\"&&(n=!n);break;case",":n||(t.push(r.slice(o,i)),o=i+1);break;default:}s=a}return t.push(r.slice(o)),t.map(i=>{i=i.trim();let a=i.length;return a<2?i:(i[0]==='"'&&i[a-1]==='"'&&(i=i.slice(1,a-1)),i.replace(/\\"/g,'"'))})};var bi=/^-?\d*(\.\d+)?$/,U=class r{constructor(e,t){h(this,"string");h(this,"type");if(this.string=e,this.type=t,!bi.test(e))throw new Error('@smithy/core/serde - NumericValue must only contain [0-9], at most one decimal point ".", and an optional negation prefix "-".')}toString(){return this.string}static[Symbol.hasInstance](e){if(!e||typeof e!="object")return!1;let t=e;return r.prototype.isPrototypeOf(e)||t.type==="bigDecimal"&&bi.test(t.string)}};var le=class{constructor(){h(this,"serdeContext")}setSerdeContext(e){this.serdeContext=e}};var Jt=class extends le{constructor(t){super();h(this,"options");this.options=t}getRequestType(){return R}getResponseType(){return $}setSerdeContext(t){this.serdeContext=t,this.serializer.setSerdeContext(t),this.deserializer.setSerdeContext(t),this.getPayloadCodec()&&this.getPayloadCodec().setSerdeContext(t)}updateServiceEndpoint(t,n){if("url"in n){t.protocol=n.url.protocol,t.hostname=n.url.hostname,t.port=n.url.port?Number(n.url.port):void 0,t.path=n.url.pathname,t.fragment=n.url.hash||void 0,t.username=n.url.username||void 0,t.password=n.url.password||void 0,t.query||(t.query={});for(let[s,o]of n.url.searchParams.entries())t.query[s]=o;return t}else return t.protocol=n.protocol,t.hostname=n.hostname,t.port=n.port?Number(n.port):void 0,t.path=n.path,t.query={...n.query},t}setHostPrefix(t,n,s){var a,c;let o=C.of(n.input),i=ge((a=n.traits)!=null?a:{});if(i.endpoint){let l=(c=i.endpoint)==null?void 0:c[0];if(typeof l=="string"){let u=[...o.structIterator()].filter(([,d])=>d.getMergedTraits().hostLabel);for(let[d]of u){let p=s[d];if(typeof p!="string")throw new Error(`@smithy/core/schema - ${d} in input must be a string as hostLabel.`);l=l.replace(`{${d}}`,p)}t.hostname=l+t.hostname}}}deserializeMetadata(t){var n,s;return{httpStatusCode:t.statusCode,requestId:(s=(n=t.headers["x-amzn-requestid"])!=null?n:t.headers["x-amzn-request-id"])!=null?s:t.headers["x-amz-request-id"],extendedRequestId:t.headers["x-amz-id-2"],cfId:t.headers["x-amz-cf-id"]}}async serializeEventStream({eventStream:t,requestSchema:n,initialRequest:s}){return(await this.loadEventStreamCapability()).serializeEventStream({eventStream:t,requestSchema:n,initialRequest:s})}async deserializeEventStream({response:t,responseSchema:n,initialResponseContainer:s}){return(await this.loadEventStreamCapability()).deserializeEventStream({response:t,responseSchema:n,initialResponseContainer:s})}async loadEventStreamCapability(){let{EventStreamSerde:t}=await Promise.resolve().then(()=>(Ti(),Ci));return new t({marshaller:this.getEventStreamMarshaller(),serializer:this.serializer,deserializer:this.deserializer,serdeContext:this.serdeContext,defaultContentType:this.getDefaultContentType()})}getDefaultContentType(){throw new Error(`@smithy/core/protocols - ${this.constructor.name} getDefaultContentType() implementation missing.`)}async deserializeHttpMessage(t,n,s,o,i){return[]}getEventStreamMarshaller(){let t=this.serdeContext;if(!t.eventStreamMarshaller)throw new Error("@smithy/core - HttpProtocol: eventStreamMarshaller missing in serdeContext.");return t.eventStreamMarshaller}};var Qt=class extends Jt{async serializeRequest(e,t,n){var g;let s={...t!=null?t:{}},o=this.serializer,i={},a={},c=await n.endpoint(),l=C.of(e==null?void 0:e.input),u=l.getSchema(),d=!1,p,m=new R({protocol:"",hostname:"",port:void 0,path:"",fragment:void 0,query:i,headers:a,body:void 0});if(c){this.updateServiceEndpoint(m,c),this.setHostPrefix(m,e,s);let y=ge(e.traits);if(y.http){m.method=y.http[0];let[S,x]=y.http[1].split("?");m.path=="/"?m.path=S:m.path+=S;let w=new URLSearchParams(x!=null?x:"");Object.assign(i,Object.fromEntries(w))}}for(let[y,S]of l.structIterator()){let x=(g=S.getMergedTraits())!=null?g:{},w=s[y];if(!(w==null&&!S.isIdempotencyToken()))if(x.httpPayload)S.isStreaming()?S.isStructSchema()?s[y]&&(p=await this.serializeEventStream({eventStream:s[y],requestSchema:l})):p=w:(o.write(S,w),p=o.flush()),delete s[y];else if(x.httpLabel){o.write(S,w);let v=o.flush();m.path.includes(`{${y}+}`)?m.path=m.path.replace(`{${y}+}`,v.split("/").map(is).join("/")):m.path.includes(`{${y}}`)&&(m.path=m.path.replace(`{${y}}`,is(v))),delete s[y]}else if(x.httpHeader)o.write(S,w),a[x.httpHeader.toLowerCase()]=String(o.flush()),delete s[y];else if(typeof x.httpPrefixHeaders=="string"){for(let[v,E]of Object.entries(w)){let A=x.httpPrefixHeaders+v;o.write([S.getValueSchema(),{httpHeader:A}],E),a[A.toLowerCase()]=o.flush()}delete s[y]}else x.httpQuery||x.httpQueryParams?(this.serializeQuery(S,w,i),delete s[y]):d=!0}return d&&s&&(o.write(u,s),p=o.flush()),m.headers=a,m.query=i,m.body=p,m}serializeQuery(e,t,n){let s=this.serializer,o=e.getMergedTraits();if(o.httpQueryParams){for(let[i,a]of Object.entries(t))if(!(i in n)){let c=e.getValueSchema();Object.assign(c.getMergedTraits(),{...o,httpQuery:i,httpQueryParams:void 0}),this.serializeQuery(c,a,n)}return}if(e.isListSchema()){let i=!!e.getMergedTraits().sparse,a=[];for(let c of t){s.write([e.getValueSchema(),o],c);let l=s.flush();(i||l!==void 0)&&a.push(l)}n[o.httpQuery]=a}else s.write([e,o],t),n[o.httpQuery]=s.flush()}async deserializeResponse(e,t,n){let s=this.deserializer,o=C.of(e.output),i={};if(n.statusCode>=300){let c=await be(n.body,t);throw c.byteLength>0&&Object.assign(i,await s.read(15,c)),await this.handleError(e,t,n,i,this.deserializeMetadata(n)),new Error("@smithy/core/protocols - HTTP Protocol error handler failed to throw.")}for(let c in n.headers){let l=n.headers[c];delete n.headers[c],n.headers[c.toLowerCase()]=l}let a=await this.deserializeHttpMessage(o,t,n,i);if(a.length){let c=await be(n.body,t);if(c.byteLength>0){let l=await s.read(o,c);for(let u of a)i[u]=l[u]}}else a.discardResponseBody&&await be(n.body,t);return i.$metadata=this.deserializeMetadata(n),i}async deserializeHttpMessage(e,t,n,s,o){let i;s instanceof Set?i=o:i=s;let a=!0,c=this.deserializer,l=C.of(e),u=[];for(let[d,p]of l.structIterator()){let m=p.getMemberTraits();if(m.httpPayload){if(a=!1,p.isStreaming())p.isStructSchema()?i[d]=await this.deserializeEventStream({response:n,responseSchema:l}):i[d]=ri(n.body);else if(n.body){let y=await be(n.body,t);y.byteLength>0&&(i[d]=await c.read(p,y))}}else if(m.httpHeader){let g=String(m.httpHeader).toLowerCase(),y=n.headers[g];if(y!=null)if(p.isListSchema()){let S=p.getValueSchema();S.getMergedTraits().httpHeader=g;let x;S.isTimestampSchema()&&S.getSchema()===4?x=vi(y,",",2):x=Xt(y);let w=[];for(let v of x)w.push(await c.read(S,v.trim()));i[d]=w}else i[d]=await c.read(p,y)}else if(m.httpPrefixHeaders!==void 0){i[d]={};for(let[g,y]of Object.entries(n.headers))if(g.startsWith(m.httpPrefixHeaders)){let S=p.getValueSchema();S.getMergedTraits().httpHeader=g,i[d][g.slice(m.httpPrefixHeaders.length)]=await c.read(S,y)}}else m.httpResponseCode?i[d]=n.statusCode:u.push(d)}return u.discardResponseBody=a,u}};z();function Te(r,e){if(e.timestampFormat.useTrait&&r.isTimestampSchema()&&(r.getSchema()===5||r.getSchema()===6||r.getSchema()===7))return r.getSchema();let{httpLabel:t,httpPrefixHeaders:n,httpHeader:s,httpQuery:o}=r.getMergedTraits(),i=e.httpBindings?typeof n=="string"||s?6:o||t?5:void 0:void 0;return i!=null?i:e.timestampFormat.default}var Zt=class extends le{constructor(t){super();h(this,"settings");this.settings=t}read(t,n){var o,i;let s=C.of(t);if(s.isListSchema())return Xt(n).map(a=>this.read(s.getValueSchema(),a));if(s.isBlobSchema())return((i=(o=this.serdeContext)==null?void 0:o.base64Decoder)!=null?i:re)(n);if(s.isTimestampSchema())switch(Te(s,this.settings)){case 5:return wi(n);case 6:return Ei(n);case 7:return xi(n);default:return console.warn("Missing timestamp format, parsing value with Date constructor:",n),new Date(n)}if(s.isStringSchema()){let a=s.getMergedTraits().mediaType,c=n;if(a)return s.getMergedTraits().httpHeader&&(c=this.base64ToUtf8(c)),(a==="application/json"||a.endsWith("+json"))&&(c=j.from(c)),c}return s.isNumericSchema()?Number(n):s.isBigIntegerSchema()?BigInt(n):s.isBigDecimalSchema()?new U(n,"bigDecimal"):s.isBooleanSchema()?String(n).toLowerCase()==="true":n}base64ToUtf8(t){var n,s,o,i;return((s=(n=this.serdeContext)==null?void 0:n.utf8Encoder)!=null?s:q)(((i=(o=this.serdeContext)==null?void 0:o.base64Decoder)!=null?i:re)(t))}};z();var er=class extends le{constructor(t,n){super();h(this,"codecDeserializer");h(this,"stringDeserializer");this.codecDeserializer=t,this.stringDeserializer=new Zt(n)}setSerdeContext(t){this.stringDeserializer.setSerdeContext(t),this.codecDeserializer.setSerdeContext(t),this.serdeContext=t}read(t,n){var a,c,l,u;let s=C.of(t),o=s.getMergedTraits(),i=(c=(a=this.serdeContext)==null?void 0:a.utf8Encoder)!=null?c:q;if(o.httpHeader||o.httpResponseCode)return this.stringDeserializer.read(s,i(n));if(o.httpPayload){if(s.isBlobSchema()){let d=(u=(l=this.serdeContext)==null?void 0:l.utf8Decoder)!=null?u:G;return typeof n=="string"?d(n):n}else if(s.isStringSchema())return"byteLength"in n?i(n):n}return this.codecDeserializer.read(s,n)}};var tr=class extends le{constructor(t){super();h(this,"settings");h(this,"stringBuffer","");this.settings=t}write(t,n){var o,i,a,c;let s=C.of(t);switch(typeof n){case"object":if(n===null){this.stringBuffer="null";return}if(s.isTimestampSchema()){if(!(n instanceof Date))throw new Error(`@smithy/core/protocols - received non-Date value ${n} when schema expected Date in ${s.getName(!0)}`);switch(Te(s,this.settings)){case 5:this.stringBuffer=n.toISOString().replace(".000Z","Z");break;case 6:this.stringBuffer=Kt(n);break;case 7:this.stringBuffer=String(n.getTime()/1e3);break;default:console.warn("Missing timestamp format, using epoch seconds",n),this.stringBuffer=String(n.getTime()/1e3)}return}if(s.isBlobSchema()&&"byteLength"in n){this.stringBuffer=((i=(o=this.serdeContext)==null?void 0:o.base64Encoder)!=null?i:J)(n);return}if(s.isListSchema()&&Array.isArray(n)){let d="";for(let p of n){this.write([s.getValueSchema(),s.getMergedTraits()],p);let m=this.flush(),g=s.getValueSchema().isTimestampSchema()?m:gi(m);d!==""&&(d+=", "),d+=g}this.stringBuffer=d;return}this.stringBuffer=JSON.stringify(n,null,2);break;case"string":let l=s.getMergedTraits().mediaType,u=n;if(l&&((l==="application/json"||l.endsWith("+json"))&&(u=j.from(u)),s.getMergedTraits().httpHeader)){this.stringBuffer=((c=(a=this.serdeContext)==null?void 0:a.base64Encoder)!=null?c:J)(u.toString());return}this.stringBuffer=n;break;default:s.isIdempotencyToken()?this.stringBuffer=Ge():this.stringBuffer=String(n)}}flush(){let t=this.stringBuffer;return this.stringBuffer="",t}};var rr=class{constructor(e,t,n=new tr(t)){h(this,"codecSerializer");h(this,"stringSerializer");h(this,"buffer");this.codecSerializer=e,this.stringSerializer=n}setSerdeContext(e){this.codecSerializer.setSerdeContext(e),this.stringSerializer.setSerdeContext(e)}write(e,t){let n=C.of(e),s=n.getMergedTraits();if(s.httpHeader||s.httpLabel||s.httpQuery){this.stringSerializer.write(n,t),this.buffer=this.stringSerializer.flush();return}return this.codecSerializer.write(n,t)}flush(){if(this.buffer!==void 0){let e=this.buffer;return this.buffer=void 0,e}return this.codecSerializer.flush()}};function Ri(r,e,t){r.__smithy_context?r.__smithy_context.features||(r.__smithy_context.features={}):r.__smithy_context={features:{}},r.__smithy_context.features[e]=t}var nr=class{constructor(e){h(this,"authSchemes",new Map);for(let[t,n]of Object.entries(e))n!==void 0&&this.authSchemes.set(t,n)}getIdentityProvider(e){return this.authSchemes.get(e)}};var sr=class{async sign(e,t,n){let s=R.clone(e);if(!t.token)throw new Error("request could not be signed with `token` since the `token` is not defined");return s.headers.Authorization=`Bearer ${t.token}`,s}};var Hu=r=>function(t){return Tt(t)&&t.expiration.getTime()-Date.now()<r};var or=Hu(3e5),Tt=r=>r.expiration!==void 0,ir=(r,e,t)=>{if(r===void 0)return;let n=typeof r!="function"?async()=>Promise.resolve(r):r,s,o,i,a=!1,c=async l=>{o||(o=n(l));try{s=await o,i=!0,a=!1}finally{o=void 0}return s};return e===void 0?async l=>((!i||l!=null&&l.forceRefresh)&&(s=await c(l)),s):async l=>((!i||l!=null&&l.forceRefresh)&&(s=await c(l)),a?s:t(s)?(e(s)&&await c(l),s):(a=!0,s))};var qu=void 0;function zu(r){return r===void 0?!0:typeof r=="string"&&r.length<=50}function Ii(r){var n;let e=Le((n=r.userAgentAppId)!=null?n:qu),{customUserAgent:t}=r;return Object.assign(r,{customUserAgent:typeof t=="string"?[[t]]:t,userAgentAppId:async()=>{var o,i;let s=await e();if(!zu(s)){let a=((i=(o=r.logger)==null?void 0:o.constructor)==null?void 0:i.name)==="NoOpLogger"||!r.logger?console:r.logger;typeof s!="string"?a==null||a.warn("userAgentAppId must be a string or undefined."):s.length>50&&(a==null||a.warn("The provided userAgentAppId exceeds the maximum length of 50 characters."))}return s}})}var ar=class{constructor({size:e,params:t}){h(this,"capacity");h(this,"data",new Map);h(this,"parameters",[]);this.capacity=e!=null?e:50,t&&(this.parameters=t)}get(e,t){let n=this.hash(e);if(n===!1)return t();if(!this.data.has(n)){if(this.data.size>this.capacity+10){let s=this.data.keys(),o=0;for(;;){let{value:i,done:a}=s.next();if(this.data.delete(i),a||++o>10)break}}this.data.set(n,t())}return this.data.get(n)}size(){return this.data.size}hash(e){var s;let t="",{parameters:n}=this;if(n.length===0)return!1;for(let o of n){let i=String((s=e[o])!=null?s:"");if(i.includes("|;"))return!1;t+=i+"|;"}return t}};var ju=new RegExp("^(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}$"),Rt=r=>ju.test(r)||r.startsWith("[")&&r.endsWith("]");var Vu=new RegExp("^(?!.*-$)(?!-)[a-zA-Z0-9-]{1,63}$"),Fe=(r,e=!1)=>{if(!e)return Vu.test(r);let t=r.split(".");for(let n of t)if(!Fe(n))return!1;return!0};var He={};var Se="endpoints";function Q(r){return typeof r!="object"||r==null?r:"ref"in r?`$${Q(r.ref)}`:"fn"in r?`${r.fn}(${(r.argv||[]).map(Q).join(", ")})`:JSON.stringify(r,null,2)}var I=class extends Error{constructor(e){super(e),this.name="EndpointError"}};var _i=(r,e)=>r===e;var ki=r=>{let e=r.split("."),t=[];for(let n of e){let s=n.indexOf("[");if(s!==-1){if(n.indexOf("]")!==n.length-1)throw new I(`Path: '${r}' does not end with ']'`);let o=n.slice(s+1,-1);if(Number.isNaN(parseInt(o)))throw new I(`Invalid array index: '${o}' in path: '${r}'`);s!==0&&t.push(n.slice(0,s)),t.push(o)}else t.push(n)}return t};var cr=(r,e)=>ki(e).reduce((t,n)=>{if(typeof t!="object")throw new I(`Index '${n}' in '${e}' not found in '${JSON.stringify(r)}'`);return Array.isArray(t)?t[parseInt(n)]:t[n]},r);var Mi=r=>r!=null;var Di=r=>!r;var ys={[rt.HTTP]:80,[rt.HTTPS]:443},Pi=r=>{let e=(()=>{try{if(r instanceof URL)return r;if(typeof r=="object"&&"hostname"in r){let{hostname:p,port:m,protocol:g="",path:y="",query:S={}}=r,x=new URL(`${g}//${p}${m?`:${m}`:""}${y}`);return x.search=Object.entries(S).map(([w,v])=>`${w}=${v}`).join("&"),x}return new URL(r)}catch(p){return null}})();if(!e)return console.error(`Unable to parse ${JSON.stringify(r)} as a whatwg URL.`),null;let t=e.href,{host:n,hostname:s,pathname:o,protocol:i,search:a}=e;if(a)return null;let c=i.slice(0,-1);if(!Object.values(rt).includes(c))return null;let l=Rt(s),u=t.includes(`${n}:${ys[c]}`)||typeof r=="string"&&r.includes(`${n}:${ys[c]}`),d=`${n}${u?`:${ys[c]}`:""}`;return{scheme:c,authority:d,path:o,normalizedPath:o.endsWith("/")?o:`${o}/`,isIp:l}};var Ni=(r,e)=>r===e;var Bi=(r,e,t,n)=>e>=t||r.length<t?null:n?r.substring(r.length-t,r.length-e):r.substring(e,t);var Oi=r=>encodeURIComponent(r).replace(/[!*'()]/g,e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`);var Li={booleanEquals:_i,getAttr:cr,isSet:Mi,isValidHostLabel:Fe,not:Di,parseURL:Pi,stringEquals:Ni,substring:Bi,uriEncode:Oi};var lr=(r,e)=>{let t=[],n={...e.endpointParams,...e.referenceRecord},s=0;for(;s<r.length;){let o=r.indexOf("{",s);if(o===-1){t.push(r.slice(s));break}t.push(r.slice(s,o));let i=r.indexOf("}",o);if(i===-1){t.push(r.slice(o));break}r[o+1]==="{"&&r[i+1]==="}"&&(t.push(r.slice(o+1,i)),s=i+2);let a=r.substring(o+1,i);if(a.includes("#")){let[c,l]=a.split("#");t.push(cr(n[c],l))}else t.push(n[a]);s=i+1}return t.join("")};var Ui=({ref:r},e)=>({...e.endpointParams,...e.referenceRecord})[r];var qe=(r,e,t)=>{if(typeof r=="string")return lr(r,t);if(r.fn)return $i.callFunction(r,t);if(r.ref)return Ui(r,t);throw new I(`'${e}': ${String(r)} is not a string, function or reference.`)},dr=({fn:r,argv:e},t)=>{let n=e.map(o=>["boolean","number"].includes(typeof o)?o:$i.evaluateExpression(o,"arg",t)),s=r.split(".");return s[0]in He&&s[1]!=null?He[s[0]][s[1]](...n):Li[r](...n)},$i={evaluateExpression:qe,callFunction:dr};var Gi=({assign:r,...e},t)=>{var s,o;if(r&&r in t.referenceRecord)throw new I(`'${r}' is already defined in Reference Record.`);let n=dr(e,t);return(o=(s=t.logger)==null?void 0:s.debug)==null||o.call(s,`${Se} evaluateCondition: ${Q(e)} = ${Q(n)}`),{result:n===""?!0:!!n,...r!=null&&{toAssign:{name:r,value:n}}}};var it=(r=[],e)=>{var n,s;let t={};for(let o of r){let{result:i,toAssign:a}=Gi(o,{...e,referenceRecord:{...e.referenceRecord,...t}});if(!i)return{result:i};a&&(t[a.name]=a.value,(s=(n=e.logger)==null?void 0:n.debug)==null||s.call(n,`${Se} assign: ${a.name} := ${Q(a.value)}`))}return{result:!0,referenceRecord:t}};var Fi=(r,e)=>Object.entries(r).reduce((t,[n,s])=>({...t,[n]:s.map(o=>{let i=qe(o,"Header value entry",e);if(typeof i!="string")throw new I(`Header '${n}' value '${i}' is not a string`);return i})}),{});var Ss=(r,e)=>Object.entries(r).reduce((t,[n,s])=>({...t,[n]:qi.getEndpointProperty(s,e)}),{}),Hi=(r,e)=>{if(Array.isArray(r))return r.map(t=>Hi(t,e));switch(typeof r){case"string":return lr(r,e);case"object":if(r===null)throw new I(`Unexpected endpoint property: ${r}`);return qi.getEndpointProperties(r,e);case"boolean":return r;default:throw new I(`Unexpected endpoint property type: ${typeof r}`)}},qi={getEndpointProperty:Hi,getEndpointProperties:Ss};var zi=(r,e)=>{let t=qe(r,"Endpoint URL",e);if(typeof t=="string")try{return new URL(t)}catch(n){throw console.error(`Failed to construct URL with ${t}`,n),n}throw new I(`Endpoint URL must be a string, got ${typeof t}`)};var ji=(r,e)=>{var u,d;let{conditions:t,endpoint:n}=r,{result:s,referenceRecord:o}=it(t,e);if(!s)return;let i={...e,referenceRecord:{...e.referenceRecord,...o}},{url:a,properties:c,headers:l}=n;return(d=(u=e.logger)==null?void 0:u.debug)==null||d.call(u,`${Se} Resolving endpoint from template: ${Q(n)}`),{...l!=null&&{headers:Fi(l,i)},...c!=null&&{properties:Ss(c,i)},url:zi(a,i)}};var Vi=(r,e)=>{let{conditions:t,error:n}=r,{result:s,referenceRecord:o}=it(t,e);if(s)throw new I(qe(n,"Error",{...e,referenceRecord:{...e.referenceRecord,...o}}))};var xs=(r,e)=>{for(let t of r)if(t.type==="endpoint"){let n=ji(t,e);if(n)return n}else if(t.type==="error")Vi(t,e);else if(t.type==="tree"){let n=Wi.evaluateTreeRule(t,e);if(n)return n}else throw new I(`Unknown endpoint rule: ${t}`);throw new I("Rules evaluation failed")},Wu=(r,e)=>{let{conditions:t,rules:n}=r,{result:s,referenceRecord:o}=it(t,e);if(s)return Wi.evaluateRules(n,{...e,referenceRecord:{...e.referenceRecord,...o}})},Wi={evaluateRules:xs,evaluateTreeRule:Wu};var Yi=(r,e)=>{var l,u,d,p,m;let{endpointParams:t,logger:n}=e,{parameters:s,rules:o}=r;(u=(l=e.logger)==null?void 0:l.debug)==null||u.call(l,`${Se} Initial EndpointParams: ${Q(t)}`);let i=Object.entries(s).filter(([,g])=>g.default!=null).map(([g,y])=>[g,y.default]);if(i.length>0)for(let[g,y]of i)t[g]=(d=t[g])!=null?d:y;let a=Object.entries(s).filter(([,g])=>g.required).map(([g])=>g);for(let g of a)if(t[g]==null)throw new I(`Missing required parameter: '${g}'`);let c=xs(o,{endpointParams:t,logger:n,referenceRecord:{}});return(m=(p=e.logger)==null?void 0:p.debug)==null||m.call(p,`${Se} Resolved endpoint: ${Q(c)}`),c};var ws=(r,e=!1)=>{if(e){for(let t of r.split("."))if(!ws(t))return!1;return!0}return!(!Fe(r)||r.length<3||r.length>63||r!==r.toLowerCase()||Rt(r))};var Ki=":",Yu="/",Xi=r=>{let e=r.split(Ki);if(e.length<6)return null;let[t,n,s,o,i,...a]=e;if(t!=="arn"||n===""||s===""||a.join(Ki)==="")return null;let c=a.map(l=>l.split(Yu)).flat();return{partition:n,service:s,region:o,accountId:i,resourceId:c}};var Ji={partitions:[{id:"aws",outputs:{dnsSuffix:"amazonaws.com",dualStackDnsSuffix:"api.aws",implicitGlobalRegion:"us-east-1",name:"aws",supportsDualStack:!0,supportsFIPS:!0},regionRegex:"^(us|eu|ap|sa|ca|me|af|il|mx)\\-\\w+\\-\\d+$",regions:{"af-south-1":{description:"Africa (Cape Town)"},"ap-east-1":{description:"Asia Pacific (Hong Kong)"},"ap-east-2":{description:"Asia Pacific (Taipei)"},"ap-northeast-1":{description:"Asia Pacific (Tokyo)"},"ap-northeast-2":{description:"Asia Pacific (Seoul)"},"ap-northeast-3":{description:"Asia Pacific (Osaka)"},"ap-south-1":{description:"Asia Pacific (Mumbai)"},"ap-south-2":{description:"Asia Pacific (Hyderabad)"},"ap-southeast-1":{description:"Asia Pacific (Singapore)"},"ap-southeast-2":{description:"Asia Pacific (Sydney)"},"ap-southeast-3":{description:"Asia Pacific (Jakarta)"},"ap-southeast-4":{description:"Asia Pacific (Melbourne)"},"ap-southeast-5":{description:"Asia Pacific (Malaysia)"},"ap-southeast-6":{description:"Asia Pacific (New Zealand)"},"ap-southeast-7":{description:"Asia Pacific (Thailand)"},"aws-global":{description:"aws global region"},"ca-central-1":{description:"Canada (Central)"},"ca-west-1":{description:"Canada West (Calgary)"},"eu-central-1":{description:"Europe (Frankfurt)"},"eu-central-2":{description:"Europe (Zurich)"},"eu-north-1":{description:"Europe (Stockholm)"},"eu-south-1":{description:"Europe (Milan)"},"eu-south-2":{description:"Europe (Spain)"},"eu-west-1":{description:"Europe (Ireland)"},"eu-west-2":{description:"Europe (London)"},"eu-west-3":{description:"Europe (Paris)"},"il-central-1":{description:"Israel (Tel Aviv)"},"me-central-1":{description:"Middle East (UAE)"},"me-south-1":{description:"Middle East (Bahrain)"},"mx-central-1":{description:"Mexico (Central)"},"sa-east-1":{description:"South America (Sao Paulo)"},"us-east-1":{description:"US East (N. Virginia)"},"us-east-2":{description:"US East (Ohio)"},"us-west-1":{description:"US West (N. California)"},"us-west-2":{description:"US West (Oregon)"}}},{id:"aws-cn",outputs:{dnsSuffix:"amazonaws.com.cn",dualStackDnsSuffix:"api.amazonwebservices.com.cn",implicitGlobalRegion:"cn-northwest-1",name:"aws-cn",supportsDualStack:!0,supportsFIPS:!0},regionRegex:"^cn\\-\\w+\\-\\d+$",regions:{"aws-cn-global":{description:"aws-cn global region"},"cn-north-1":{description:"China (Beijing)"},"cn-northwest-1":{description:"China (Ningxia)"}}},{id:"aws-eusc",outputs:{dnsSuffix:"amazonaws.eu",dualStackDnsSuffix:"api.amazonwebservices.eu",implicitGlobalRegion:"eusc-de-east-1",name:"aws-eusc",supportsDualStack:!0,supportsFIPS:!0},regionRegex:"^eusc\\-(de)\\-\\w+\\-\\d+$",regions:{"eusc-de-east-1":{description:"EU (Germany)"}}},{id:"aws-iso",outputs:{dnsSuffix:"c2s.ic.gov",dualStackDnsSuffix:"api.aws.ic.gov",implicitGlobalRegion:"us-iso-east-1",name:"aws-iso",supportsDualStack:!0,supportsFIPS:!0},regionRegex:"^us\\-iso\\-\\w+\\-\\d+$",regions:{"aws-iso-global":{description:"aws-iso global region"},"us-iso-east-1":{description:"US ISO East"},"us-iso-west-1":{description:"US ISO WEST"}}},{id:"aws-iso-b",outputs:{dnsSuffix:"sc2s.sgov.gov",dualStackDnsSuffix:"api.aws.scloud",implicitGlobalRegion:"us-isob-east-1",name:"aws-iso-b",supportsDualStack:!0,supportsFIPS:!0},regionRegex:"^us\\-isob\\-\\w+\\-\\d+$",regions:{"aws-iso-b-global":{description:"aws-iso-b global region"},"us-isob-east-1":{description:"US ISOB East (Ohio)"},"us-isob-west-1":{description:"US ISOB West"}}},{id:"aws-iso-e",outputs:{dnsSuffix:"cloud.adc-e.uk",dualStackDnsSuffix:"api.cloud-aws.adc-e.uk",implicitGlobalRegion:"eu-isoe-west-1",name:"aws-iso-e",supportsDualStack:!0,supportsFIPS:!0},regionRegex:"^eu\\-isoe\\-\\w+\\-\\d+$",regions:{"aws-iso-e-global":{description:"aws-iso-e global region"},"eu-isoe-west-1":{description:"EU ISOE West"}}},{id:"aws-iso-f",outputs:{dnsSuffix:"csp.hci.ic.gov",dualStackDnsSuffix:"api.aws.hci.ic.gov",implicitGlobalRegion:"us-isof-south-1",name:"aws-iso-f",supportsDualStack:!0,supportsFIPS:!0},regionRegex:"^us\\-isof\\-\\w+\\-\\d+$",regions:{"aws-iso-f-global":{description:"aws-iso-f global region"},"us-isof-east-1":{description:"US ISOF EAST"},"us-isof-south-1":{description:"US ISOF SOUTH"}}},{id:"aws-us-gov",outputs:{dnsSuffix:"amazonaws.com",dualStackDnsSuffix:"api.aws",implicitGlobalRegion:"us-gov-west-1",name:"aws-us-gov",supportsDualStack:!0,supportsFIPS:!0},regionRegex:"^us\\-gov\\-\\w+\\-\\d+$",regions:{"aws-us-gov-global":{description:"aws-us-gov global region"},"us-gov-east-1":{description:"AWS GovCloud (US-East)"},"us-gov-west-1":{description:"AWS GovCloud (US-West)"}}}],version:"1.1"};var Xu=Ji,Ju="",Qi=r=>{let{partitions:e}=Xu;for(let n of e){let{regions:s,outputs:o}=n;for(let[i,a]of Object.entries(s))if(i===r)return{...o,...a}}for(let n of e){let{regionRegex:s,outputs:o}=n;if(new RegExp(s).test(r))return{...o}}let t=e.find(n=>n.id==="aws");if(!t)throw new Error("Provided region was not found in the partition array or regex, and default partition with id 'aws' doesn't exist.");return{...t.outputs}};var Zi=()=>Ju;var Es={isVirtualHostableS3Bucket:ws,parseArn:Xi,partition:Qi};He.aws=Es;function ea(r){let e={};if(r=r.replace(/^\?/,""),r)for(let t of r.split("&")){let[n,s=null]=t.split("=");n=decodeURIComponent(n),s&&(s=decodeURIComponent(s)),n in e?Array.isArray(e[n])?e[n].push(s):e[n]=[e[n],s]:e[n]=s}return e}var at=r=>{if(typeof r=="string")return at(new URL(r));let{hostname:e,pathname:t,port:n,protocol:s,search:o}=r,i;return o&&(i=ea(o)),{hostname:e,port:n?parseInt(n):void 0,protocol:s,path:t,query:i}};function ta(r,e,t){return r.$source||(r.$source={}),r.$source[e]=t,r}function ne(r,e,t){r.__aws_sdk_context?r.__aws_sdk_context.features||(r.__aws_sdk_context.features={}):r.__aws_sdk_context={features:{}},r.__aws_sdk_context.features[e]=t}var vs=r=>{var e,t,n;return $.isInstance(r)?(n=(e=r.headers)==null?void 0:e.date)!=null?n:(t=r.headers)==null?void 0:t.Date:void 0};var ur=r=>new Date(Date.now()+r);var ra=(r,e)=>Math.abs(ur(e).getTime()-r)>=3e5;var bs=(r,e)=>{let t=Date.parse(r);return ra(t,e)?t-Date.now():e};var It=(r,e)=>{if(!e)throw new Error(`Property \`${r}\` is not resolved for AWS SDK SigV4Auth`);return e},na=async r=>{var l,u,d;let e=It("context",r.context),t=It("config",r.config),n=(d=(u=(l=e.endpointV2)==null?void 0:l.properties)==null?void 0:u.authSchemes)==null?void 0:d[0],o=await It("signer",t.signer)(n),i=r==null?void 0:r.signingRegion,a=r==null?void 0:r.signingRegionSet,c=r==null?void 0:r.signingName;return{config:t,signer:o,signingRegion:i,signingRegionSet:a,signingName:c}},_t=class{async sign(e,t,n){var d,p,m,g;if(!R.isInstance(e))throw new Error("The request is not an instance of `HttpRequest` and cannot be signed");let s=await na(n),{config:o,signer:i}=s,{signingRegion:a,signingName:c}=s,l=n.context;if((p=(d=l==null?void 0:l.authSchemes)==null?void 0:d.length)!=null&&p){let[y,S]=l.authSchemes;(y==null?void 0:y.name)==="sigv4a"&&(S==null?void 0:S.name)==="sigv4"&&(a=(m=S==null?void 0:S.signingRegion)!=null?m:a,c=(g=S==null?void 0:S.signingName)!=null?g:c)}return await i.sign(e,{signingDate:ur(o.systemClockOffset),signingRegion:a,signingService:c})}errorHandler(e){return t=>{var s;let n=(s=t.ServerTime)!=null?s:vs(t.$response);if(n){let o=It("config",e.config),i=o.systemClockOffset;o.systemClockOffset=bs(n,o.systemClockOffset),o.systemClockOffset!==i&&t.$metadata&&(t.$metadata.clockSkewCorrected=!0)}throw t}}successHandler(e,t){let n=vs(e);if(n){let s=It("config",t.config);s.systemClockOffset=bs(n,s.systemClockOffset)}}};var sa=(r,e,t)=>{let n,s,o,i=!1,a=async()=>{s||(s=r());try{n=await s,o=!0,i=!1}finally{s=void 0}return n};return e===void 0?async c=>((!o||c!=null&&c.forceRefresh)&&(n=await a()),n):async c=>((!o||c!=null&&c.forceRefresh)&&(n=await a()),i?n:t&&!t(n)?(i=!0,n):(e(n)&&await a(),n))};z();var oa="X-Amz-Algorithm",ia="X-Amz-Credential",As="X-Amz-Date",aa="X-Amz-SignedHeaders",ca="X-Amz-Expires",Cs="X-Amz-Signature",Ts="X-Amz-Security-Token";var Rs="authorization",Is=As.toLowerCase(),Qu="date",la=[Rs,Is,Qu],da=Cs.toLowerCase(),kt="x-amz-content-sha256",ua=Ts.toLowerCase();var pa={authorization:!0,"cache-control":!0,connection:!0,expect:!0,from:!0,"keep-alive":!0,"max-forwards":!0,pragma:!0,referer:!0,te:!0,trailer:!0,"transfer-encoding":!0,upgrade:!0,"user-agent":!0,"x-amzn-trace-id":!0},ma=/^proxy-/,fa=/^sec-/;var pr="AWS4-HMAC-SHA256";var ha="AWS4-HMAC-SHA256-PAYLOAD",ga="UNSIGNED-PAYLOAD",ya=50,_s="aws4_request",Sa=60*60*24*7;z();var mr={},ks=[],fr=(r,e,t)=>`${r}/${e}/${t}/${_s}`,wa=async(r,e,t,n,s)=>{let o=await xa(r,e.secretAccessKey,e.accessKeyId),i=`${t}:${n}:${s}:${_(o)}:${e.sessionToken}`;if(i in mr)return mr[i];for(ks.push(i);ks.length>ya;)delete mr[ks.shift()];let a=`AWS4${e.secretAccessKey}`;for(let c of[t,n,s,_s])a=await xa(r,a,c);return mr[i]=a};var xa=(r,e,t)=>{let n=new r(e);return n.update(he(t)),n.digest()};var Ms=({headers:r},e,t)=>{let n={};for(let s of Object.keys(r).sort()){if(r[s]==null)continue;let o=s.toLowerCase();(o in pa||e!=null&&e.has(o)||ma.test(o)||fa.test(o))&&(!t||t&&!t.has(o))||(n[o]=r[s].trim().replace(/\s+/g," "))}return n};var Ea=r=>typeof ArrayBuffer=="function"&&r instanceof ArrayBuffer||Object.prototype.toString.call(r)==="[object ArrayBuffer]";z();var hr=async({headers:r,body:e},t)=>{for(let n of Object.keys(r))if(n.toLowerCase()===kt)return r[n];if(e==null)return"e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855";if(typeof e=="string"||ArrayBuffer.isView(e)||Ea(e)){let n=new t;return n.update(he(e)),_(await n.digest())}return ga};z();var gr=class{format(e){let t=[];for(let o of Object.keys(e)){let i=G(o);t.push(Uint8Array.from([i.byteLength]),i,this.formatHeaderValue(e[o]))}let n=new Uint8Array(t.reduce((o,i)=>o+i.byteLength,0)),s=0;for(let o of t)n.set(o,s),s+=o.byteLength;return n}formatHeaderValue(e){switch(e.type){case"boolean":return Uint8Array.from([e.value?0:1]);case"byte":return Uint8Array.from([2,e.value]);case"short":let t=new DataView(new ArrayBuffer(3));return t.setUint8(0,3),t.setInt16(1,e.value,!1),new Uint8Array(t.buffer);case"integer":let n=new DataView(new ArrayBuffer(5));return n.setUint8(0,4),n.setInt32(1,e.value,!1),new Uint8Array(n.buffer);case"long":let s=new Uint8Array(9);return s[0]=5,s.set(e.value.bytes,1),s;case"binary":let o=new DataView(new ArrayBuffer(3+e.value.byteLength));o.setUint8(0,6),o.setUint16(1,e.value.byteLength,!1);let i=new Uint8Array(o.buffer);return i.set(e.value,3),i;case"string":let a=G(e.value),c=new DataView(new ArrayBuffer(3+a.byteLength));c.setUint8(0,7),c.setUint16(1,a.byteLength,!1);let l=new Uint8Array(c.buffer);return l.set(a,3),l;case"timestamp":let u=new Uint8Array(9);return u[0]=8,u.set(Ds.fromNumber(e.value.valueOf()).bytes,1),u;case"uuid":if(!Zu.test(e.value))throw new Error(`Invalid UUID received: ${e.value}`);let d=new Uint8Array(17);return d[0]=9,d.set(ot(e.value.replace(/\-/g,"")),1),d}}},va;(function(r){r[r.boolTrue=0]="boolTrue",r[r.boolFalse=1]="boolFalse",r[r.byte=2]="byte",r[r.short=3]="short",r[r.integer=4]="integer",r[r.long=5]="long",r[r.byteArray=6]="byteArray",r[r.string=7]="string",r[r.timestamp=8]="timestamp",r[r.uuid=9]="uuid"})(va||(va={}));var Zu=/^[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}$/,Ds=class r{constructor(e){h(this,"bytes");if(this.bytes=e,e.byteLength!==8)throw new Error("Int64 buffers must be exactly 8 bytes")}static fromNumber(e){if(e>9223372036854776e3||e<-9223372036854776e3)throw new Error(`${e} is too large (or, if negative, too small) to represent as an Int64`);let t=new Uint8Array(8);for(let n=7,s=Math.abs(Math.round(e));n>-1&&s>0;n--,s/=256)t[n]=s;return e<0&&ba(t),new r(t)}valueOf(){let e=this.bytes.slice(0),t=e[0]&128;return t&&ba(e),parseInt(_(e),16)*(t?-1:1)}toString(){return String(this.valueOf())}};function ba(r){for(let e=0;e<8;e++)r[e]^=255;for(let e=7;e>-1&&(r[e]++,r[e]===0);e--);}var Aa=(r,e)=>{r=r.toLowerCase();for(let t of Object.keys(e))if(r===t.toLowerCase())return!0;return!1};var Ca=(r,e={})=>{var s,o;let{headers:t,query:n={}}=R.clone(r);for(let i of Object.keys(t)){let a=i.toLowerCase();(a.slice(0,6)==="x-amz-"&&!((s=e.unhoistableHeaders)!=null&&s.has(a))||(o=e.hoistableHeaders)!=null&&o.has(a))&&(n[i]=t[i],delete t[i])}return{...r,headers:t,query:n}};var Ps=r=>{r=R.clone(r);for(let e of Object.keys(r.headers))la.indexOf(e.toLowerCase())>-1&&delete r.headers[e];return r};z();var Ta=({query:r={}})=>{let e=[],t={};for(let n of Object.keys(r)){if(n.toLowerCase()===da)continue;let s=ae(n);e.push(s);let o=r[n];typeof o=="string"?t[s]=`${s}=${ae(o)}`:Array.isArray(o)&&(t[s]=o.slice(0).reduce((i,a)=>i.concat([`${s}=${ae(a)}`]),[]).sort().join("&"))}return e.sort().map(n=>t[n]).filter(n=>n).join("&")};var Ra=r=>ep(r).toISOString().replace(/\.\d{3}Z$/,"Z"),ep=r=>typeof r=="number"?new Date(r*1e3):typeof r=="string"?Number(r)?new Date(Number(r)*1e3):new Date(r):r;var yr=class{constructor({applyChecksum:e,credentials:t,region:n,service:s,sha256:o,uriEscapePath:i=!0}){h(this,"service");h(this,"regionProvider");h(this,"credentialProvider");h(this,"sha256");h(this,"uriEscapePath");h(this,"applyChecksum");this.service=s,this.sha256=o,this.uriEscapePath=i,this.applyChecksum=typeof e=="boolean"?e:!0,this.regionProvider=K(n),this.credentialProvider=K(t)}createCanonicalRequest(e,t,n){let s=Object.keys(t).sort();return`${e.method}
${this.getCanonicalPath(e)}
${Ta(e)}
${s.map(o=>`${o}:${t[o]}`).join(`
`)}

${s.join(";")}
${n}`}async createStringToSign(e,t,n,s){let o=new this.sha256;o.update(he(n));let i=await o.digest();return`${s}
${e}
${t}
${_(i)}`}getCanonicalPath({path:e}){if(this.uriEscapePath){let t=[];for(let o of e.split("/"))(o==null?void 0:o.length)!==0&&o!=="."&&(o===".."?t.pop():t.push(o));let n=`${e!=null&&e.startsWith("/")?"/":""}${t.join("/")}${t.length>0&&(e!=null&&e.endsWith("/"))?"/":""}`;return ae(n).replace(/%2F/g,"/")}return e}validateResolvedCredentials(e){if(typeof e!="object"||typeof e.accessKeyId!="string"||typeof e.secretAccessKey!="string")throw new Error("Resolved credential object is not valid")}formatDate(e){let t=Ra(e).replace(/[\-:]/g,"");return{longDate:t,shortDate:t.slice(0,8)}}getCanonicalHeaderList(e){return Object.keys(e).sort().join(";")}};var Mt=class extends yr{constructor({applyChecksum:t,credentials:n,region:s,service:o,sha256:i,uriEscapePath:a=!0}){super({applyChecksum:t,credentials:n,region:s,service:o,sha256:i,uriEscapePath:a});h(this,"headerFormatter",new gr)}async presign(t,n={}){let{signingDate:s=new Date,expiresIn:o=3600,unsignableHeaders:i,unhoistableHeaders:a,signableHeaders:c,hoistableHeaders:l,signingRegion:u,signingService:d}=n,p=await this.credentialProvider();this.validateResolvedCredentials(p);let m=u!=null?u:await this.regionProvider(),{longDate:g,shortDate:y}=this.formatDate(s);if(o>Sa)return Promise.reject("Signature version 4 presigned URLs must have an expiration date less than one week in the future");let S=fr(y,m,d!=null?d:this.service),x=Ca(Ps(t),{unhoistableHeaders:a,hoistableHeaders:l});p.sessionToken&&(x.query[Ts]=p.sessionToken),x.query[oa]=pr,x.query[ia]=`${p.accessKeyId}/${S}`,x.query[As]=g,x.query[ca]=o.toString(10);let w=Ms(x,i,c);return x.query[aa]=this.getCanonicalHeaderList(w),x.query[Cs]=await this.getSignature(g,S,this.getSigningKey(p,m,y,d),this.createCanonicalRequest(x,w,await hr(t,this.sha256))),x}async sign(t,n){return typeof t=="string"?this.signString(t,n):t.headers&&t.payload?this.signEvent(t,n):t.message?this.signMessage(t,n):this.signRequest(t,n)}async signEvent({headers:t,payload:n},{signingDate:s=new Date,priorSignature:o,signingRegion:i,signingService:a}){let c=i!=null?i:await this.regionProvider(),{shortDate:l,longDate:u}=this.formatDate(s),d=fr(l,c,a!=null?a:this.service),p=await hr({headers:{},body:n},this.sha256),m=new this.sha256;m.update(t);let g=_(await m.digest()),y=[ha,u,d,o,g,p].join(`
`);return this.signString(y,{signingDate:s,signingRegion:c,signingService:a})}async signMessage(t,{signingDate:n=new Date,signingRegion:s,signingService:o}){return this.signEvent({headers:this.headerFormatter.format(t.message.headers),payload:t.message.body},{signingDate:n,signingRegion:s,signingService:o,priorSignature:t.priorSignature}).then(a=>({message:t.message,signature:a}))}async signString(t,{signingDate:n=new Date,signingRegion:s,signingService:o}={}){let i=await this.credentialProvider();this.validateResolvedCredentials(i);let a=s!=null?s:await this.regionProvider(),{shortDate:c}=this.formatDate(n),l=new this.sha256(await this.getSigningKey(i,a,c,o));return l.update(he(t)),_(await l.digest())}async signRequest(t,{signingDate:n=new Date,signableHeaders:s,unsignableHeaders:o,signingRegion:i,signingService:a}={}){let c=await this.credentialProvider();this.validateResolvedCredentials(c);let l=i!=null?i:await this.regionProvider(),u=Ps(t),{longDate:d,shortDate:p}=this.formatDate(n),m=fr(p,l,a!=null?a:this.service);u.headers[Is]=d,c.sessionToken&&(u.headers[ua]=c.sessionToken);let g=await hr(u,this.sha256);!Aa(kt,u.headers)&&this.applyChecksum&&(u.headers[kt]=g);let y=Ms(u,o,s),S=await this.getSignature(d,m,this.getSigningKey(c,l,p,a),this.createCanonicalRequest(u,y,g));return u.headers[Rs]=`${pr} Credential=${c.accessKeyId}/${m}, SignedHeaders=${this.getCanonicalHeaderList(y)}, Signature=${S}`,u}async getSignature(t,n,s,o){let i=await this.createStringToSign(t,n,o,pr),a=new this.sha256(await s);return a.update(he(i)),_(await a.digest())}getSigningKey(t,n,s,o){return wa(this.sha256,t,s,n,o||this.service)}};var Ia=r=>{let e=r.credentials,t=!!r.credentials,n;Object.defineProperty(r,"credentials",{set(l){l&&l!==e&&l!==n&&(t=!0),e=l;let u=tp(r,{credentials:e,credentialDefaultProvider:r.credentialDefaultProvider}),d=rp(r,u);t&&!d.attributed?(n=async p=>d(p).then(m=>ta(m,"CREDENTIALS_CODE","e")),n.memoized=d.memoized,n.configBound=d.configBound,n.attributed=!0):n=d},get(){return n},enumerable:!0,configurable:!0}),r.credentials=e;let{signingEscapePath:s=!0,systemClockOffset:o=r.systemClockOffset||0,sha256:i}=r,a;return r.signer?a=Le(r.signer):r.regionInfoProvider?a=()=>Le(r.region)().then(async l=>[await r.regionInfoProvider(l,{useFipsEndpoint:await r.useFipsEndpoint(),useDualstackEndpoint:await r.useDualstackEndpoint()})||{},l]).then(([l,u])=>{let{signingRegion:d,signingService:p}=l;r.signingRegion=r.signingRegion||d||u,r.signingName=r.signingName||p||r.serviceId;let m={...r,credentials:r.credentials,region:r.signingRegion,service:r.signingName,sha256:i,uriEscapePath:s},g=r.signerConstructor||Mt;return new g(m)}):a=async l=>{l=Object.assign({},{name:"sigv4",signingName:r.signingName||r.defaultSigningName,signingRegion:await Le(r.region)(),properties:{}},l);let u=l.signingRegion,d=l.signingName;r.signingRegion=r.signingRegion||u,r.signingName=r.signingName||d||r.serviceId;let p={...r,credentials:r.credentials,region:r.signingRegion,service:r.signingName,sha256:i,uriEscapePath:s},m=r.signerConstructor||Mt;return new m(p)},Object.assign(r,{systemClockOffset:o,signingEscapePath:s,signer:a})};function tp(r,{credentials:e,credentialDefaultProvider:t}){let n;return e?e!=null&&e.memoized?n=e:n=ir(e,or,Tt):t?n=Le(t(Object.assign({},r,{parentClientConfig:r}))):n=async()=>{throw new Error("@aws-sdk/core::resolveAwsSdkSigV4Config - `credentials` not provided and no credentialDefaultProvider was configured.")},n.memoized=!0,n}function rp(r,e){if(e.configBound)return e;let t=async n=>e({...n,callerClientConfig:r});return t.memoized=e.memoized,t.configBound=!0,t}var _a=typeof TextEncoder=="function"?new TextEncoder:null,ka=r=>{if(typeof r=="string"){if(_a)return _a.encode(r).byteLength;let e=r.length;for(let t=e-1;t>=0;t--){let n=r.charCodeAt(t);n>127&&n<=2047?e++:n>2047&&n<=65535&&(e+=2),n>=56320&&n<=57343&&t--}return e}else{if(typeof r.byteLength=="number")return r.byteLength;if(typeof r.size=="number")return r.size}throw new Error(`Body Length computation failed for ${r}`)};var ze=(r,e)=>{let t=[];if(r&&t.push(r),e)for(let n of e)t.push(n);return t},Re=(r,e)=>`${r||"anonymous"}${e&&e.length>0?` (a.k.a. ${e.join(",")})`:""}`,ct=()=>{let r=[],e=[],t=!1,n=new Set,s=d=>d.sort((p,m)=>Ma[m.step]-Ma[p.step]||Da[m.priority||"normal"]-Da[p.priority||"normal"]),o=d=>{let p=!1,m=g=>{let y=ze(g.name,g.aliases);if(y.includes(d)){p=!0;for(let S of y)n.delete(S);return!1}return!0};return r=r.filter(m),e=e.filter(m),p},i=d=>{let p=!1,m=g=>{if(g.middleware===d){p=!0;for(let y of ze(g.name,g.aliases))n.delete(y);return!1}return!0};return r=r.filter(m),e=e.filter(m),p},a=d=>{var p;return r.forEach(m=>{d.add(m.middleware,{...m})}),e.forEach(m=>{d.addRelativeTo(m.middleware,{...m})}),(p=d.identifyOnResolve)==null||p.call(d,u.identifyOnResolve()),d},c=d=>{let p=[];return d.before.forEach(m=>{m.before.length===0&&m.after.length===0?p.push(m):p.push(...c(m))}),p.push(d),d.after.reverse().forEach(m=>{m.before.length===0&&m.after.length===0?p.push(m):p.push(...c(m))}),p},l=(d=!1)=>{let p=[],m=[],g={};return r.forEach(S=>{let x={...S,before:[],after:[]};for(let w of ze(x.name,x.aliases))g[w]=x;p.push(x)}),e.forEach(S=>{let x={...S,before:[],after:[]};for(let w of ze(x.name,x.aliases))g[w]=x;m.push(x)}),m.forEach(S=>{if(S.toMiddleware){let x=g[S.toMiddleware];if(x===void 0){if(d)return;throw new Error(`${S.toMiddleware} is not found when adding ${Re(S.name,S.aliases)} middleware ${S.relation} ${S.toMiddleware}`)}S.relation==="after"&&x.after.push(S),S.relation==="before"&&x.before.push(S)}}),s(p).map(c).reduce((S,x)=>(S.push(...x),S),[])},u={add:(d,p={})=>{let{name:m,override:g,aliases:y}=p,S={step:"initialize",priority:"normal",middleware:d,...p},x=ze(m,y);if(x.length>0){if(x.some(w=>n.has(w))){if(!g)throw new Error(`Duplicate middleware name '${Re(m,y)}'`);for(let w of x){let v=r.findIndex(A=>{var M;return A.name===w||((M=A.aliases)==null?void 0:M.some(N=>N===w))});if(v===-1)continue;let E=r[v];if(E.step!==S.step||S.priority!==E.priority)throw new Error(`"${Re(E.name,E.aliases)}" middleware with ${E.priority} priority in ${E.step} step cannot be overridden by "${Re(m,y)}" middleware with ${S.priority} priority in ${S.step} step.`);r.splice(v,1)}}for(let w of x)n.add(w)}r.push(S)},addRelativeTo:(d,p)=>{let{name:m,override:g,aliases:y}=p,S={middleware:d,...p},x=ze(m,y);if(x.length>0){if(x.some(w=>n.has(w))){if(!g)throw new Error(`Duplicate middleware name '${Re(m,y)}'`);for(let w of x){let v=e.findIndex(A=>{var M;return A.name===w||((M=A.aliases)==null?void 0:M.some(N=>N===w))});if(v===-1)continue;let E=e[v];if(E.toMiddleware!==S.toMiddleware||E.relation!==S.relation)throw new Error(`"${Re(E.name,E.aliases)}" middleware ${E.relation} "${E.toMiddleware}" middleware cannot be overridden by "${Re(m,y)}" middleware ${S.relation} "${S.toMiddleware}" middleware.`);e.splice(v,1)}}for(let w of x)n.add(w)}e.push(S)},clone:()=>a(ct()),use:d=>{d.applyToStack(u)},remove:d=>typeof d=="string"?o(d):i(d),removeByTag:d=>{let p=!1,m=g=>{let{tags:y,name:S,aliases:x}=g;if(y&&y.includes(d)){let w=ze(S,x);for(let v of w)n.delete(v);return p=!0,!1}return!0};return r=r.filter(m),e=e.filter(m),p},concat:d=>{var m,g;let p=a(ct());return p.use(d),p.identifyOnResolve(t||p.identifyOnResolve()||((g=(m=d.identifyOnResolve)==null?void 0:m.call(d))!=null?g:!1)),p},applyToStack:a,identify:()=>l(!0).map(d=>{var m;let p=(m=d.step)!=null?m:d.relation+" "+d.toMiddleware;return Re(d.name,d.aliases)+" - "+p}),identifyOnResolve(d){return typeof d=="boolean"&&(t=d),t},resolve:(d,p)=>{for(let m of l().map(g=>g.middleware).reverse())d=m(d,p);return t&&console.log(u.identify()),d}};return u},Ma={initialize:5,serialize:4,build:3,finalizeRequest:2,deserialize:1},Da={high:3,normal:2,low:1};var Sr=class{constructor(e){h(this,"config");h(this,"middlewareStack",ct());h(this,"initConfig");h(this,"handlers");this.config=e}send(e,t,n){let s=typeof t!="function"?t:void 0,o=typeof t=="function"?t:n,i=s===void 0&&this.config.cacheMiddleware===!0,a;if(i){this.handlers||(this.handlers=new WeakMap);let c=this.handlers;c.has(e.constructor)?a=c.get(e.constructor):(a=e.resolveMiddleware(this.middlewareStack,this.config,s),c.set(e.constructor,a))}else delete this.handlers,a=e.resolveMiddleware(this.middlewareStack,this.config,s);if(o)a(e).then(c=>o(null,c.output),c=>o(c)).catch(()=>{});else return a(e).then(c=>c.output)}destroy(){var e,t,n;(n=(t=(e=this.config)==null?void 0:e.requestHandler)==null?void 0:t.destroy)==null||n.call(t),delete this.handlers}};var Ns="***SensitiveInformation***";function xr(r,e){if(e==null)return e;let t=C.of(r);if(t.getMergedTraits().sensitive)return Ns;if(t.isListSchema()){if(!!t.getValueSchema().getMergedTraits().sensitive)return Ns}else if(t.isMapSchema()){if(!!t.getKeySchema().getMergedTraits().sensitive||!!t.getValueSchema().getMergedTraits().sensitive)return Ns}else if(t.isStructSchema()&&typeof e=="object"){let n=e,s={};for(let[o,i]of t.structIterator())n[o]!=null&&(s[o]=xr(i,n[o]));return s}return e}var je=class{constructor(){h(this,"middlewareStack",ct());h(this,"schema")}static classBuilder(){return new Bs}resolveMiddlewareWithContext(e,t,n,{middlewareFn:s,clientName:o,commandName:i,inputFilterSensitiveLog:a,outputFilterSensitiveLog:c,smithyContext:l,additionalContext:u,CommandCtor:d}){for(let S of s.bind(this)(d,e,t,n))this.middlewareStack.use(S);let p=e.concat(this.middlewareStack),{logger:m}=t,g={logger:m,clientName:o,commandName:i,inputFilterSensitiveLog:a,outputFilterSensitiveLog:c,[vt]:{commandInstance:this,...l},...u},{requestHandler:y}=t;return p.resolve(S=>y.handle(S.request,n||{}),g)}},Bs=class{constructor(){h(this,"_init",()=>{});h(this,"_ep",{});h(this,"_middlewareFn",()=>[]);h(this,"_commandName","");h(this,"_clientName","");h(this,"_additionalContext",{});h(this,"_smithyContext",{});h(this,"_inputFilterSensitiveLog");h(this,"_outputFilterSensitiveLog");h(this,"_serializer",null);h(this,"_deserializer",null);h(this,"_operationSchema")}init(e){this._init=e}ep(e){return this._ep=e,this}m(e){return this._middlewareFn=e,this}s(e,t,n={}){return this._smithyContext={service:e,operation:t,...n},this}c(e={}){return this._additionalContext=e,this}n(e,t){return this._clientName=e,this._commandName=t,this}f(e=n=>n,t=n=>n){return this._inputFilterSensitiveLog=e,this._outputFilterSensitiveLog=t,this}ser(e){return this._serializer=e,this}de(e){return this._deserializer=e,this}sc(e){return this._operationSchema=e,this._smithyContext.operationSchema=e,this}build(){let e=this,t;return t=class extends je{constructor(...[s]){super();h(this,"input");h(this,"serialize",e._serializer);h(this,"deserialize",e._deserializer);this.input=s!=null?s:{},e._init(this),this.schema=e._operationSchema}static getEndpointParameterInstructions(){return e._ep}resolveMiddleware(s,o,i){var u,d,p,m;let a=e._operationSchema,c=(u=a==null?void 0:a[4])!=null?u:a==null?void 0:a.input,l=(d=a==null?void 0:a[5])!=null?d:a==null?void 0:a.output;return this.resolveMiddlewareWithContext(s,o,i,{CommandCtor:t,middlewareFn:e._middlewareFn,clientName:e._clientName,commandName:e._commandName,inputFilterSensitiveLog:(p=e._inputFilterSensitiveLog)!=null?p:a?xr.bind(null,c):g=>g,outputFilterSensitiveLog:(m=e._outputFilterSensitiveLog)!=null?m:a?xr.bind(null,l):g=>g,smithyContext:e._smithyContext,additionalContext:e._additionalContext})}}}};var wr=class r extends Error{constructor(t){super(t.message);h(this,"$fault");h(this,"$response");h(this,"$retryable");h(this,"$metadata");Object.setPrototypeOf(this,Object.getPrototypeOf(this).constructor.prototype),this.name=t.name,this.$fault=t.$fault,this.$metadata=t.$metadata}static isInstance(t){if(!t)return!1;let n=t;return r.prototype.isPrototypeOf(n)||!!n.$fault&&!!n.$metadata&&(n.$fault==="client"||n.$fault==="server")}static[Symbol.hasInstance](t){if(!t)return!1;let n=t;return this===r?r.isInstance(t):r.isInstance(t)?n.name&&this.name?this.prototype.isPrototypeOf(t)||n.name===this.name:this.prototype.isPrototypeOf(t):!1}},Os=(r,e={})=>{Object.entries(e).filter(([,n])=>n!==void 0).forEach(([n,s])=>{(r[n]==null||r[n]==="")&&(r[n]=s)});let t=r.message||r.Message||"UnknownError";return r.message=t,delete r.Message,r};var Pa=r=>{switch(r){case"standard":return{retryMode:"standard",connectionTimeout:3100};case"in-region":return{retryMode:"standard",connectionTimeout:1100};case"cross-region":return{retryMode:"standard",connectionTimeout:3100};case"mobile":return{retryMode:"standard",connectionTimeout:3e4};default:return{}}};var Na=r=>{let e=[];for(let t in nt){let n=nt[t];r[n]!==void 0&&e.push({algorithmId:()=>n,checksumConstructor:()=>r[n]})}return{addChecksumAlgorithm(t){e.push(t)},checksumAlgorithms(){return e}}},Ba=r=>{let e={};return r.checksumAlgorithms().forEach(t=>{e[t.algorithmId()]=t.checksumConstructor()}),e};var Oa=r=>({setRetryStrategy(e){r.retryStrategy=e},retryStrategy(){return r.retryStrategy}}),La=r=>{let e={};return e.retryStrategy=r.retryStrategy(),e};var Ua=r=>Object.assign(Na(r),Oa(r));var $a=r=>Object.assign(Ba(r),La(r));var lt=class{trace(){}debug(){}info(){}warn(){}error(){}};var Er=class{constructor(e=!1){h(this,"queryCompat");this.queryCompat=e}resolveRestContentType(e,t){let n=t.getMemberSchemas(),s=Object.values(n).find(o=>!!o.getMergedTraits().httpPayload);if(s){let o=s.getMergedTraits().mediaType;return o||(s.isStringSchema()?"text/plain":s.isBlobSchema()?"application/octet-stream":e)}else if(!t.isUnitSchema()&&Object.values(n).find(i=>{let{httpQuery:a,httpQueryParams:c,httpHeader:l,httpLabel:u,httpPrefixHeaders:d}=i.getMergedTraits();return!a&&!c&&!l&&!u&&d===void 0}))return e}async getErrorSchemaOrThrowBaseException(e,t,n,s,o,i){var d,p,m,g;let a=t,c=e;e.includes("#")&&([a,c]=e.split("#"));let l={$metadata:o,$fault:n.statusCode<500?"client":"server"},u=k.for(a);try{return{errorSchema:(d=i==null?void 0:i(u,c))!=null?d:u.getSchema(e),errorMetadata:l}}catch(y){s.message=(m=(p=s.message)!=null?p:s.Message)!=null?m:"UnknownError";let S=k.for("smithy.ts.sdk.synthetic."+a),x=S.getBaseException();if(x){let w=(g=S.getErrorCtor(x))!=null?g:Error;throw this.decorateServiceException(Object.assign(new w({name:c}),l),s)}throw this.decorateServiceException(Object.assign(new Error(c),l),s)}}decorateServiceException(e,t={}){var n,s,o;if(this.queryCompat){let i=(n=e.Message)!=null?n:t.Message,a=Os(e,t);i&&(a.message=i),a.Error={...a.Error,Type:a.Error.Type,Code:a.Error.Code,Message:(o=(s=a.Error.message)!=null?s:a.Error.Message)!=null?o:i};let c=a.$metadata.requestId;return c&&(a.RequestId=c),a}return Os(e,t)}setQueryCompatError(e,t){var s;let n=(s=t.headers)==null?void 0:s["x-amzn-query-error"];if(e!==void 0&&n!=null){let[o,i]=n.split(";"),a=Object.entries(e),c={Code:o,Type:i};Object.assign(e,c);for(let[l,u]of a)c[l==="message"?"Message":l]=u;delete c.__type,e.Error=c}}queryCompatOutput(e,t){e.Error&&(t.Error=e.Error),e.Type&&(t.Type=e.Type),e.Code&&(t.Code=e.Code)}findQueryCompatibleError(e,t){try{return e.getSchema(t)}catch(n){return e.find(s=>{var o;return((o=C.of(s).getMergedTraits().awsQueryError)==null?void 0:o[0])===t})}}};var Ie=class{constructor(){h(this,"serdeContext")}setSerdeContext(e){this.serdeContext=e}};function*Ga(r,e){if(r.isUnitSchema())return;let t=r.getSchema();for(let n=0;n<t[4].length;++n){let s=t[4][n],o=t[5][n],i=new C([o,0],s);!(s in e)&&!i.isIdempotencyToken()||(yield[s,i])}}function*Fa(r,e,t){var o;if(r.isUnitSchema())return;let n=r.getSchema(),s=Object.keys(e).filter(i=>i!=="__type").length;for(let i=0;i<n[4].length&&s!==0;++i){let a=n[4][i],c=n[5][i],l=new C([c,0],a),u=a;t&&(u=(o=l.getMergedTraits()[t])!=null?o:a),u in e&&(yield[a,l],s-=1)}}function Ha(r,e,t){if(t!=null&&t.source){let n=t.source;if(typeof e=="number"&&(e>Number.MAX_SAFE_INTEGER||e<Number.MIN_SAFE_INTEGER||n!==String(e)))return n.includes(".")?new U(n,"bigDecimal"):BigInt(n)}return e}z();var qa=(r,e)=>be(r,e).then(t=>{var n;return((n=e==null?void 0:e.utf8Encoder)!=null?n:q)(t)});var za=(r,e)=>qa(r,e).then(t=>{if(t.length)try{return JSON.parse(t)}catch(n){throw(n==null?void 0:n.name)==="SyntaxError"&&Object.defineProperty(n,"$responseBodyText",{value:t}),n}return{}});var ja=(r,e)=>{let t=(o,i)=>Object.keys(o).find(a=>a.toLowerCase()===i.toLowerCase()),n=o=>{let i=o;return typeof i=="number"&&(i=i.toString()),i.indexOf(",")>=0&&(i=i.split(",")[0]),i.indexOf(":")>=0&&(i=i.split(":")[0]),i.indexOf("#")>=0&&(i=i.split("#")[1]),i},s=t(r.headers,"x-amzn-errortype");if(s!==void 0)return n(r.headers[s]);if(e&&typeof e=="object"){let o=t(e,"code");if(o&&e[o]!==void 0)return n(e[o]);if(e.__type!==void 0)return n(e.__type)}};var vr=class extends Ie{constructor(t){super();h(this,"settings");this.settings=t}async read(t,n){return this._read(t,typeof n=="string"?JSON.parse(n,Ha):await za(n,this.serdeContext))}readObject(t,n){return this._read(t,n)}_read(t,n){var a;let s=n!==null&&typeof n=="object",o=C.of(t);if(s){if(o.isStructSchema()){let c={};for(let[l,u]of Fa(o,n,this.settings.jsonName?"jsonName":!1)){let d=this.settings.jsonName&&(a=u.getMergedTraits().jsonName)!=null?a:l,p=this._read(u,n[d]);p!=null&&(c[l]=p)}return c}if(Array.isArray(n)&&o.isListSchema()){let c=o.getValueSchema(),l=[],u=!!o.getMergedTraits().sparse;for(let d of n)(u||d!=null)&&l.push(this._read(c,d));return l}if(o.isMapSchema()){let c=o.getValueSchema(),l={},u=!!o.getMergedTraits().sparse;for(let[d,p]of Object.entries(n))(u||p!=null)&&(l[d]=this._read(c,p));return l}}if(o.isBlobSchema()&&typeof n=="string")return re(n);let i=o.getMergedTraits().mediaType;if(o.isStringSchema()&&typeof n=="string"&&i)return i==="application/json"||i.endsWith("+json")?j.from(n):n;if(o.isTimestampSchema()&&n!=null)switch(Te(o,this.settings)){case 5:return mi(n);case 6:return fi(n);case 7:return hi(n);default:return console.warn("Missing timestamp format, parsing value with Date constructor:",n),new Date(n)}if(o.isBigIntegerSchema()&&(typeof n=="number"||typeof n=="string"))return BigInt(n);if(o.isBigDecimalSchema()&&n!=null){if(n instanceof U)return n;let c=n;return c.type==="bigDecimal"&&"string"in c?new U(c.string,c.type):new U(String(n),"bigDecimal")}if(o.isNumericSchema()&&typeof n=="string"){switch(n){case"Infinity":return 1/0;case"-Infinity":return-1/0;case"NaN":return NaN}return n}if(o.isDocumentSchema())if(s){let c=Array.isArray(n)?[]:{};for(let[l,u]of Object.entries(n))u instanceof U?c[l]=u:c[l]=this._read(o,u);return c}else return structuredClone(n);return n}};var Va="\u039D",br=class{constructor(){h(this,"values",new Map);h(this,"counter",0);h(this,"stage",0)}createReplacer(){if(this.stage===1)throw new Error("@aws-sdk/core/protocols - JsonReplacer already created.");if(this.stage===2)throw new Error("@aws-sdk/core/protocols - JsonReplacer exhausted.");return this.stage=1,(e,t)=>{if(t instanceof U){let n=`${Va+"nv"+this.counter++}_`+t.string;return this.values.set(`"${n}"`,t.string),n}if(typeof t=="bigint"){let n=t.toString(),s=`${Va+"b"+this.counter++}_`+n;return this.values.set(`"${s}"`,n),s}return t}}replaceInJson(e){if(this.stage===0)throw new Error("@aws-sdk/core/protocols - JsonReplacer not created yet.");if(this.stage===2)throw new Error("@aws-sdk/core/protocols - JsonReplacer exhausted.");if(this.stage=2,this.counter===0)return e;for(let[t,n]of this.values)e=e.replace(t,n);return e}};var Ar=class extends Ie{constructor(t){super();h(this,"settings");h(this,"buffer");h(this,"useReplacer",!1);h(this,"rootSchema");this.settings=t}write(t,n){this.rootSchema=C.of(t),this.buffer=this._write(this.rootSchema,n)}writeDiscriminatedDocument(t,n){this.write(t,n),typeof this.buffer=="object"&&(this.buffer.__type=C.of(t).getName(!0))}flush(){let{rootSchema:t,useReplacer:n}=this;if(this.rootSchema=void 0,this.useReplacer=!1,t!=null&&t.isStructSchema()||t!=null&&t.isDocumentSchema()){if(!n)return JSON.stringify(this.buffer);let s=new br;return s.replaceInJson(JSON.stringify(this.buffer,s.createReplacer(),0))}return this.buffer}_write(t,n,s){var a,c,l,u;let o=n!==null&&typeof n=="object",i=C.of(t);if(o){if(i.isStructSchema()){let d={};for(let[p,m]of Ga(i,n)){let g=this._write(m,n[p],i);if(g!==void 0){let y=m.getMergedTraits().jsonName,S=this.settings.jsonName&&y!=null?y:p;d[S]=g}}return d}if(Array.isArray(n)&&i.isListSchema()){let d=i.getValueSchema(),p=[],m=!!i.getMergedTraits().sparse;for(let g of n)(m||g!=null)&&p.push(this._write(d,g));return p}if(i.isMapSchema()){let d=i.getValueSchema(),p={},m=!!i.getMergedTraits().sparse;for(let[g,y]of Object.entries(n))(m||y!=null)&&(p[g]=this._write(d,y));return p}if(n instanceof Uint8Array&&(i.isBlobSchema()||i.isDocumentSchema()))return i===this.rootSchema?n:((c=(a=this.serdeContext)==null?void 0:a.base64Encoder)!=null?c:J)(n);if(n instanceof Date&&(i.isTimestampSchema()||i.isDocumentSchema()))switch(Te(i,this.settings)){case 5:return n.toISOString().replace(".000Z","Z");case 6:return Kt(n);case 7:return n.getTime()/1e3;default:return console.warn("Missing timestamp format, using epoch seconds",n),n.getTime()/1e3}n instanceof U&&(this.useReplacer=!0)}if(!(n===null&&(s!=null&&s.isStructSchema()))){if(i.isStringSchema()){if(typeof n=="undefined"&&i.isIdempotencyToken())return Ge();let d=i.getMergedTraits().mediaType;return n!=null&&d&&(d==="application/json"||d.endsWith("+json"))?j.from(n):n}if(typeof n=="number"&&i.isNumericSchema())return Math.abs(n)===1/0||isNaN(n)?String(n):n;if(typeof n=="string"&&i.isBlobSchema())return i===this.rootSchema?n:((u=(l=this.serdeContext)==null?void 0:l.base64Encoder)!=null?u:J)(n);if(typeof n=="bigint"&&(this.useReplacer=!0),i.isDocumentSchema())if(o){let d=Array.isArray(n)?[]:{};for(let[p,m]of Object.entries(n))m instanceof U?(this.useReplacer=!0,d[p]=m):d[p]=this._write(i,m);return d}else return structuredClone(n);return n}}};var Cr=class extends Ie{constructor(t){super();h(this,"settings");this.settings=t}createSerializer(){let t=new Ar(this.settings);return t.setSerdeContext(this.serdeContext),t}createDeserializer(){let t=new vr(this.settings);return t.setSerdeContext(this.serdeContext),t}};var Tr=class extends Qt{constructor({defaultNamespace:t}){super({defaultNamespace:t});h(this,"serializer");h(this,"deserializer");h(this,"codec");h(this,"mixin",new Er);let n={timestampFormat:{useTrait:!0,default:7},httpBindings:!0,jsonName:!0};this.codec=new Cr(n),this.serializer=new rr(this.codec.createSerializer(),n),this.deserializer=new er(this.codec.createDeserializer(),n)}getShapeId(){return"aws.protocols#restJson1"}getPayloadCodec(){return this.codec}setSerdeContext(t){this.codec.setSerdeContext(t),super.setSerdeContext(t)}async serializeRequest(t,n,s){let o=await super.serializeRequest(t,n,s),i=C.of(t.input);if(!o.headers["content-type"]){let a=this.mixin.resolveRestContentType(this.getDefaultContentType(),i);a&&(o.headers["content-type"]=a)}return o.body==null&&o.headers["content-type"]===this.getDefaultContentType()&&(o.body="{}"),o}async deserializeResponse(t,n,s){let o=await super.deserializeResponse(t,n,s),i=C.of(t.output);for(let[a,c]of i.structIterator())c.getMemberTraits().httpPayload&&!(a in o)&&(o[a]=null);return o}async handleError(t,n,s,o,i){var y,S,x,w,v;let a=(y=ja(s,o))!=null?y:"Unknown",{errorSchema:c,errorMetadata:l}=await this.mixin.getErrorSchemaOrThrowBaseException(a,this.options.defaultNamespace,s,o,i),u=C.of(c),d=(x=(S=o.message)!=null?S:o.Message)!=null?x:"Unknown",p=(w=k.for(c[1]).getErrorCtor(c))!=null?w:Error,m=new p(d);await this.deserializeHttpMessage(c,n,s,o);let g={};for(let[E,A]of u.structIterator()){let M=(v=A.getMergedTraits().jsonName)!=null?v:E;g[E]=this.codec.createDeserializer().readObject(A,o[M])}throw this.mixin.decorateServiceException(Object.assign(m,l,{$fault:u.getMergedTraits().error,message:d},g),o)}getDefaultContentType(){return"application/json"}};var np=/\d{12}\.ddb/;async function Wa(r,e,t){var o,i,a,c,l,u,d,p;let n=t.request;if(((o=n==null?void 0:n.headers)==null?void 0:o["smithy-protocol"])==="rpc-v2-cbor"&&ne(r,"PROTOCOL_RPC_V2_CBOR","M"),typeof e.retryStrategy=="function"){let m=await e.retryStrategy();typeof m.acquireInitialRetryToken=="function"?(a=(i=m.constructor)==null?void 0:i.name)!=null&&a.includes("Adaptive")?ne(r,"RETRY_MODE_ADAPTIVE","F"):ne(r,"RETRY_MODE_STANDARD","E"):ne(r,"RETRY_MODE_LEGACY","D")}if(typeof e.accountIdEndpointMode=="function"){let m=r.endpointV2;switch(String((c=m==null?void 0:m.url)==null?void 0:c.hostname).match(np)&&ne(r,"ACCOUNT_ID_ENDPOINT","O"),await((l=e.accountIdEndpointMode)==null?void 0:l.call(e))){case"disabled":ne(r,"ACCOUNT_ID_MODE_DISABLED","Q");break;case"preferred":ne(r,"ACCOUNT_ID_MODE_PREFERRED","P");break;case"required":ne(r,"ACCOUNT_ID_MODE_REQUIRED","R");break}}let s=(d=(u=r.__smithy_context)==null?void 0:u.selectedHttpAuthScheme)==null?void 0:d.identity;if(s!=null&&s.$source){let m=s;m.accountId&&ne(r,"RESOLVED_ACCOUNT_ID","T");for(let[g,y]of Object.entries((p=m.$source)!=null?p:{}))ne(r,g,y)}}var Ls="user-agent",Rr="x-amz-user-agent",Us=" ",Ir="/",Ya=/[^!$%&'*+\-.^_`|~\w]/g,Ka=/[^!$%&'*+\-.^_`|~\w#]/g,$s="-";function Xa(r){let e="";for(let t in r){let n=r[t];if(e.length+n.length+1<=1024){e.length?e+=","+n:e+=n;continue}break}return e}var sp=r=>(e,t)=>async n=>{var g,y,S,x;let{request:s}=n;if(!R.isInstance(s))return e(n);let{headers:o}=s,i=((g=t==null?void 0:t.userAgent)==null?void 0:g.map(_r))||[],a=(await r.defaultUserAgentProvider()).map(_r);await Wa(t,r,n);let c=t;a.push(`m/${Xa(Object.assign({},(y=t.__smithy_context)==null?void 0:y.features,(S=c.__aws_sdk_context)==null?void 0:S.features))}`);let l=((x=r==null?void 0:r.customUserAgent)==null?void 0:x.map(_r))||[],u=await r.userAgentAppId();u&&a.push(_r(["app",`${u}`]));let d=Zi(),p=(d?[d]:[]).concat([...a,...i,...l]).join(Us),m=[...a.filter(w=>w.startsWith("aws-sdk-")),...l].join(Us);return r.runtime!=="browser"?(m&&(o[Rr]=o[Rr]?`${o[Ls]} ${m}`:m),o[Ls]=p):o[Rr]=p,e({...n,request:s})},_r=r=>{var i;let e=r[0].split(Ir).map(a=>a.replace(Ya,$s)).join(Ir),t=(i=r[1])==null?void 0:i.replace(Ka,$s),n=e.indexOf(Ir),s=e.substring(0,n),o=e.substring(n+1);return s==="api"&&(o=o.toLowerCase()),[s,o,t].filter(a=>a&&a.length>0).reduce((a,c,l)=>{switch(l){case 0:return c;case 1:return`${a}/${c}`;default:return`${a}#${c}`}},"")},op={name:"getUserAgentMiddleware",step:"build",priority:"low",tags:["SET_USER_AGENT","USER_AGENT"],override:!0},Ja=r=>({applyToStack:e=>{e.add(sp(r),op)}});function kr(r,e,t,n){function s(o){return o instanceof t?o:new t(function(i){i(o)})}return new(t||(t=Promise))(function(o,i){function a(u){try{l(n.next(u))}catch(d){i(d)}}function c(u){try{l(n.throw(u))}catch(d){i(d)}}function l(u){u.done?o(u.value):s(u.value).then(a,c)}l((n=n.apply(r,e||[])).next())})}function Mr(r,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,s,o,i=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return i.next=a(0),i.throw=a(1),i.return=a(2),typeof Symbol=="function"&&(i[Symbol.iterator]=function(){return this}),i;function a(l){return function(u){return c([l,u])}}function c(l){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(t=0)),t;)try{if(n=1,s&&(o=l[0]&2?s.return:l[0]?s.throw||((o=s.return)&&o.call(s),0):s.next)&&!(o=o.call(s,l[1])).done)return o;switch(s=0,o&&(l=[l[0]&2,o.value]),l[0]){case 0:case 1:o=l;break;case 4:return t.label++,{value:l[1],done:!1};case 5:t.label++,s=l[1],l=[0];continue;case 7:l=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(l[0]===6||l[0]===2)){t=0;continue}if(l[0]===3&&(!o||l[1]>o[0]&&l[1]<o[3])){t.label=l[1];break}if(l[0]===6&&t.label<o[1]){t.label=o[1],o=l;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(l);break}o[2]&&t.ops.pop(),t.trys.pop();continue}l=e.call(r,t)}catch(u){l=[6,u],s=0}finally{n=o=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function Qa(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var Gs=r=>new TextEncoder().encode(r);var ip=typeof Buffer!="undefined"&&Buffer.from?function(r){return Buffer.from(r,"utf8")}:Gs;function se(r){return r instanceof Uint8Array?r:typeof r=="string"?ip(r):ArrayBuffer.isView(r)?new Uint8Array(r.buffer,r.byteOffset,r.byteLength/Uint8Array.BYTES_PER_ELEMENT):new Uint8Array(r)}function _e(r){return typeof r=="string"?r.length===0:r.byteLength===0}function Fs(r){return new Uint8Array([(r&4278190080)>>24,(r&16711680)>>16,(r&65280)>>8,r&255])}function Hs(r){if(!Uint32Array.from){for(var e=new Uint32Array(r.length),t=0;t<r.length;)e[t]=r[t],t+=1;return e}return Uint32Array.from(r)}var ap=function(){function r(){this.crc32=new Ve}return r.prototype.update=function(e){_e(e)||this.crc32.update(se(e))},r.prototype.digest=function(){return kr(this,void 0,void 0,function(){return Mr(this,function(e){return[2,Fs(this.crc32.digest())]})})},r.prototype.reset=function(){this.crc32=new Ve},r}();var Ve=function(){function r(){this.checksum=4294967295}return r.prototype.update=function(e){var t,n;try{for(var s=Qa(e),o=s.next();!o.done;o=s.next()){var i=o.value;this.checksum=this.checksum>>>8^lp[(this.checksum^i)&255]}}catch(a){t={error:a}}finally{try{o&&!o.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}return this},r.prototype.digest=function(){return(this.checksum^4294967295)>>>0},r}();var cp=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],lp=Hs(cp);var dt=class r{constructor(e){h(this,"bytes");if(this.bytes=e,e.byteLength!==8)throw new Error("Int64 buffers must be exactly 8 bytes")}static fromNumber(e){if(e>9223372036854776e3||e<-9223372036854776e3)throw new Error(`${e} is too large (or, if negative, too small) to represent as an Int64`);let t=new Uint8Array(8);for(let n=7,s=Math.abs(Math.round(e));n>-1&&s>0;n--,s/=256)t[n]=s;return e<0&&Za(t),new r(t)}valueOf(){let e=this.bytes.slice(0),t=e[0]&128;return t&&Za(e),parseInt(_(e),16)*(t?-1:1)}toString(){return String(this.valueOf())}};function Za(r){for(let e=0;e<8;e++)r[e]^=255;for(let e=7;e>-1&&(r[e]++,r[e]===0);e--);}var Dr=class{constructor(e,t){h(this,"toUtf8");h(this,"fromUtf8");this.toUtf8=e,this.fromUtf8=t}format(e){let t=[];for(let o of Object.keys(e)){let i=this.fromUtf8(o);t.push(Uint8Array.from([i.byteLength]),i,this.formatHeaderValue(e[o]))}let n=new Uint8Array(t.reduce((o,i)=>o+i.byteLength,0)),s=0;for(let o of t)n.set(o,s),s+=o.byteLength;return n}formatHeaderValue(e){switch(e.type){case"boolean":return Uint8Array.from([e.value?0:1]);case"byte":return Uint8Array.from([2,e.value]);case"short":let t=new DataView(new ArrayBuffer(3));return t.setUint8(0,3),t.setInt16(1,e.value,!1),new Uint8Array(t.buffer);case"integer":let n=new DataView(new ArrayBuffer(5));return n.setUint8(0,4),n.setInt32(1,e.value,!1),new Uint8Array(n.buffer);case"long":let s=new Uint8Array(9);return s[0]=5,s.set(e.value.bytes,1),s;case"binary":let o=new DataView(new ArrayBuffer(3+e.value.byteLength));o.setUint8(0,6),o.setUint16(1,e.value.byteLength,!1);let i=new Uint8Array(o.buffer);return i.set(e.value,3),i;case"string":let a=this.fromUtf8(e.value),c=new DataView(new ArrayBuffer(3+a.byteLength));c.setUint8(0,7),c.setUint16(1,a.byteLength,!1);let l=new Uint8Array(c.buffer);return l.set(a,3),l;case"timestamp":let u=new Uint8Array(9);return u[0]=8,u.set(dt.fromNumber(e.value.valueOf()).bytes,1),u;case"uuid":if(!Sp.test(e.value))throw new Error(`Invalid UUID received: ${e.value}`);let d=new Uint8Array(17);return d[0]=9,d.set(ot(e.value.replace(/\-/g,"")),1),d}}parse(e){let t={},n=0;for(;n<e.byteLength;){let s=e.getUint8(n++),o=this.toUtf8(new Uint8Array(e.buffer,e.byteOffset+n,s));switch(n+=s,e.getUint8(n++)){case 0:t[o]={type:tc,value:!0};break;case 1:t[o]={type:tc,value:!1};break;case 2:t[o]={type:dp,value:e.getInt8(n++)};break;case 3:t[o]={type:up,value:e.getInt16(n,!1)},n+=2;break;case 4:t[o]={type:pp,value:e.getInt32(n,!1)},n+=4;break;case 5:t[o]={type:mp,value:new dt(new Uint8Array(e.buffer,e.byteOffset+n,8))},n+=8;break;case 6:let i=e.getUint16(n,!1);n+=2,t[o]={type:fp,value:new Uint8Array(e.buffer,e.byteOffset+n,i)},n+=i;break;case 7:let a=e.getUint16(n,!1);n+=2,t[o]={type:hp,value:this.toUtf8(new Uint8Array(e.buffer,e.byteOffset+n,a))},n+=a;break;case 8:t[o]={type:gp,value:new Date(new dt(new Uint8Array(e.buffer,e.byteOffset+n,8)).valueOf())},n+=8;break;case 9:let c=new Uint8Array(e.buffer,e.byteOffset+n,16);n+=16,t[o]={type:yp,value:`${_(c.subarray(0,4))}-${_(c.subarray(4,6))}-${_(c.subarray(6,8))}-${_(c.subarray(8,10))}-${_(c.subarray(10))}`};break;default:throw new Error("Unrecognized header type tag")}}return t}},ec;(function(r){r[r.boolTrue=0]="boolTrue",r[r.boolFalse=1]="boolFalse",r[r.byte=2]="byte",r[r.short=3]="short",r[r.integer=4]="integer",r[r.long=5]="long",r[r.byteArray=6]="byteArray",r[r.string=7]="string",r[r.timestamp=8]="timestamp",r[r.uuid=9]="uuid"})(ec||(ec={}));var tc="boolean",dp="byte",up="short",pp="integer",mp="long",fp="binary",hp="string",gp="timestamp",yp="uuid",Sp=/^[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}$/;var rc=4,ke=rc*2,We=4,xp=ke+We*2;function nc({byteLength:r,byteOffset:e,buffer:t}){if(r<xp)throw new Error("Provided message too short to accommodate event stream message overhead");let n=new DataView(t,e,r),s=n.getUint32(0,!1);if(r!==s)throw new Error("Reported message length does not match received message length");let o=n.getUint32(rc,!1),i=n.getUint32(ke,!1),a=n.getUint32(r-We,!1),c=new Ve().update(new Uint8Array(t,e,ke));if(i!==c.digest())throw new Error(`The prelude checksum specified in the message (${i}) does not match the calculated CRC32 checksum (${c.digest()})`);if(c.update(new Uint8Array(t,e+ke,r-(ke+We))),a!==c.digest())throw new Error(`The message checksum (${c.digest()}) did not match the expected value of ${a}`);return{headers:new DataView(t,e+ke+We,o),body:new Uint8Array(t,e+ke+We+o,s-o-(ke+We+We))}}var ut=class{constructor(e,t){h(this,"headerMarshaller");h(this,"messageBuffer");h(this,"isEndOfStream");this.headerMarshaller=new Dr(e,t),this.messageBuffer=[],this.isEndOfStream=!1}feed(e){this.messageBuffer.push(this.decode(e))}endOfStream(){this.isEndOfStream=!0}getMessage(){let e=this.messageBuffer.pop(),t=this.isEndOfStream;return{getMessage(){return e},isEndOfStream(){return t}}}getAvailableMessages(){let e=this.messageBuffer;this.messageBuffer=[];let t=this.isEndOfStream;return{getMessages(){return e},isEndOfStream(){return t}}}encode({headers:e,body:t}){let n=this.headerMarshaller.format(e),s=n.byteLength+t.byteLength+16,o=new Uint8Array(s),i=new DataView(o.buffer,o.byteOffset,o.byteLength),a=new Ve;return i.setUint32(0,s,!1),i.setUint32(4,n.byteLength,!1),i.setUint32(8,a.update(o.subarray(0,8)).digest(),!1),o.set(n,12),o.set(t,n.byteLength+12),i.setUint32(s-4,a.update(o.subarray(8,s-4)).digest(),!1),o}decode(e){let{headers:t,body:n}=nc(e);return{headers:this.headerMarshaller.parse(t),body:n}}formatHeaders(e){return this.headerMarshaller.format(e)}};var Pr=class{constructor(e){h(this,"options");this.options=e}[Symbol.asyncIterator](){return this.asyncIterator()}async*asyncIterator(){for await(let e of this.options.inputStream)yield this.options.decoder.decode(e)}};var Nr=class{constructor(e){h(this,"options");this.options=e}[Symbol.asyncIterator](){return this.asyncIterator()}async*asyncIterator(){for await(let e of this.options.messageStream)yield this.options.encoder.encode(e);this.options.includeEndFrame&&(yield new Uint8Array(0))}};var Br=class{constructor(e){h(this,"options");this.options=e}[Symbol.asyncIterator](){return this.asyncIterator()}async*asyncIterator(){for await(let e of this.options.messageStream){let t=await this.options.deserializer(e);t!==void 0&&(yield t)}}};var Or=class{constructor(e){h(this,"options");this.options=e}[Symbol.asyncIterator](){return this.asyncIterator()}async*asyncIterator(){for await(let e of this.options.inputStream)yield this.options.serializer(e)}};var sc=(r,e,t,n)=>{let s=r,o={start(){},async transform(i,a){try{let c=new Date(Date.now()+await n()),l={":date":{type:"timestamp",value:c}},u=await e.sign({message:{body:i,headers:l},priorSignature:s},{signingDate:c});s=u.signature;let d=t.encode({headers:{...l,":chunk-signature":{type:"binary",value:ot(u.signature)}},body:i});a.enqueue(d)}catch(c){a.error(c)}}};return new TransformStream({...o})};var Lr=class{constructor(e){h(this,"messageSigner");h(this,"eventStreamCodec");h(this,"systemClockOffsetProvider");this.messageSigner=e.messageSigner,this.eventStreamCodec=new ut(e.utf8Encoder,e.utf8Decoder),this.systemClockOffsetProvider=async()=>{var t;return(t=e.systemClockOffset)!=null?t:0}}async handle(e,t,n={}){let s=t.request,{body:o,headers:i,query:a}=s;if(!(o instanceof ReadableStream))throw new Error("Eventstream payload must be a ReadableStream.");let c=new TransformStream;s.body=c.readable;let l;try{l=await e(t)}catch(g){throw s.body.cancel(),g}let d=((i.authorization||"").match(/Signature=([\w]+)$/)||[])[1]||a&&a["X-Amz-Signature"]||"",p=sc(d,await this.messageSigner(),this.eventStreamCodec,this.systemClockOffsetProvider);return o.pipeThrough(p).pipeThrough(c),l}};var oc=r=>new Lr(r);var Ur=r=>r.protocol==="ws:"||r.protocol==="wss:";var $r=class{constructor(e){h(this,"signer");this.signer=e.signer}presign(e,t={}){return this.signer.presign(e,t)}async sign(e,t){return R.isInstance(e)&&Ur(e)?{...await this.signer.presign({...e,body:""},{...t,expiresIn:60,unsignableHeaders:new Set(Object.keys(e.headers).filter(s=>s!=="host"))}),body:e.body}:this.signer.sign(e,t)}};var ic=r=>{let{signer:e}=r;return Object.assign(r,{signer:async t=>{let n=await e(t);if(wp(n))return new $r({signer:n});throw new Error("Expected WebsocketSignatureV4 signer, please check the client constructor.")}})},wp=r=>!!r;function ac(r){var l,u;let{port:e,query:t}=r,{protocol:n,path:s,hostname:o}=r;n&&n.slice(-1)!==":"&&(n+=":"),e&&(o+=`:${e}`),s&&s.charAt(0)!=="/"&&(s=`/${s}`);let i=t?qt(t):"";i&&i[0]!=="?"&&(i=`?${i}`);let a="";if(r.username!=null||r.password!=null){let d=(l=r.username)!=null?l:"",p=(u=r.password)!=null?u:"";a=`${d}:${p}@`}let c="";return r.fragment&&(c=`#${r.fragment}`),`${n}//${a}${o}${s}${i}${c}`}function cc(r){let e=0,t=0,n=null,s=null,o=a=>{if(typeof a!="number")throw new Error("Attempted to allocate an event message where size was not a number: "+a);e=a,t=4,n=new Uint8Array(a),new DataView(n.buffer).setUint32(0,a,!1)},i=async function*(){let a=r[Symbol.asyncIterator]();for(;;){let{value:c,done:l}=await a.next();if(l){if(e)if(e===t)yield n;else throw new Error("Truncated event message received.");else return;return}let u=c.length,d=0;for(;d<u;){if(!n){let m=u-d;s||(s=new Uint8Array(4));let g=Math.min(4-t,m);if(s.set(c.slice(d,d+g),t),t+=g,d+=g,t<4)break;o(new DataView(s.buffer).getUint32(0,!1)),s=null}let p=Math.min(e-t,u-d);n.set(c.slice(d,d+p),t),t+=p,d+=p,e&&e===t&&(yield n,n=null,e=0,t=0)}}};return{[Symbol.asyncIterator]:i}}function lc(r,e){return async function(t){let{value:n}=t.headers[":message-type"];if(n==="error"){let s=new Error(t.headers[":error-message"].value||"UnknownError");throw s.name=t.headers[":error-code"].value,s}else if(n==="exception"){let s=t.headers[":exception-type"].value,o={[s]:t},i=await r(o);if(i.$unknown){let a=new Error(e(t.body));throw a.name=s,a}throw i[s]}else if(n==="event"){let s={[t.headers[":event-type"].value]:t},o=await r(s);return o.$unknown?void 0:o}else throw Error(`Unrecognizable event type: ${t.headers[":event-type"].value}`)}}var Gr=class{constructor({utf8Encoder:e,utf8Decoder:t}){h(this,"eventStreamCodec");h(this,"utfEncoder");this.eventStreamCodec=new ut(e,t),this.utfEncoder=e}deserialize(e,t){let n=cc(e);return new Br({messageStream:new Pr({inputStream:n,decoder:this.eventStreamCodec}),deserializer:lc(t,this.utfEncoder)})}serialize(e,t){return new Nr({messageStream:new Or({inputStream:e,serializer:t}),encoder:this.eventStreamCodec,includeEndFrame:!0})}};var Fr=r=>({[Symbol.asyncIterator]:async function*(){let e=r.getReader();try{for(;;){let{done:t,value:n}=await e.read();if(t)return;yield n}}finally{e.releaseLock()}}}),Hr=r=>{let e=r[Symbol.asyncIterator]();return new ReadableStream({async pull(t){let{done:n,value:s}=await e.next();if(n)return t.close();t.enqueue(s)}})};var qr=class{constructor({utf8Encoder:e,utf8Decoder:t}){h(this,"universalMarshaller");this.universalMarshaller=new Gr({utf8Decoder:t,utf8Encoder:e})}deserialize(e,t){let n=Ep(e)?Fr(e):e;return this.universalMarshaller.deserialize(n,t)}serialize(e,t){let n=this.universalMarshaller.serialize(e,t);return typeof ReadableStream=="function"?Hr(n):n}},Ep=r=>typeof ReadableStream=="function"&&r instanceof ReadableStream;var dc=r=>new qr(r);var vp=2e3,zr=class r{constructor(e,t=new $e){h(this,"metadata",{handlerProtocol:"websocket/h1.1"});h(this,"config");h(this,"configPromise");h(this,"httpHandler");h(this,"sockets",{});this.httpHandler=t,typeof e=="function"?(this.config={},this.configPromise=e().then(n=>this.config=n!=null?n:{})):(this.config=e!=null?e:{},this.configPromise=Promise.resolve(this.config))}static create(e,t=new $e){return typeof(e==null?void 0:e.handle)=="function"?e:new r(e,t)}destroy(){for(let[e,t]of Object.entries(this.sockets)){for(let n of t)n.close(1e3,"Socket closed through destroy() call");delete this.sockets[e]}}async handle(e){if(!Ur(e))return this.httpHandler.handle(e);let t=ac(e),n=new WebSocket(t);this.sockets[t]||(this.sockets[t]=[]),this.sockets[t].push(n),n.binaryType="arraybuffer",this.config=await this.configPromise;let{connectionTimeout:s=vp}=this.config;await this.waitForReady(n,s);let{body:o}=e,i=bp(o),a=this.connect(n,i),c=Ap(a);return{response:new $({statusCode:200,body:c})}}updateHttpClientConfig(e,t){this.configPromise=this.configPromise.then(n=>(n[e]=t,n))}httpHandlerConfigs(){var e;return(e=this.config)!=null?e:{}}removeNotUsableSockets(e){var t;this.sockets[e]=((t=this.sockets[e])!=null?t:[]).filter(n=>![WebSocket.CLOSING,WebSocket.CLOSED].includes(n.readyState))}waitForReady(e,t){return new Promise((n,s)=>{let o=setTimeout(()=>{this.removeNotUsableSockets(e.url),s({$metadata:{httpStatusCode:500}})},t);e.onopen=()=>{clearTimeout(o),n()}})}connect(e,t){let n,s=!1,o=()=>{},i=()=>{};e.onmessage=l=>{i({done:!1,value:new Uint8Array(l.data)})},e.onerror=l=>{s=!0,e.close(),o(l)},e.onclose=()=>{this.removeNotUsableSockets(e.url),!s&&(n?o(n):i({done:!0,value:void 0}))};let a={[Symbol.asyncIterator]:()=>({next:()=>new Promise((l,u)=>{i=l,o=u})})};return(async()=>{try{for await(let l of t)e.send(l)}catch(l){n=l}finally{e.close(1e3)}})(),a}},bp=r=>r[Symbol.asyncIterator]?r:Cp(r)?Fr(r):{[Symbol.asyncIterator]:async function*(){yield r}},Ap=r=>typeof ReadableStream=="function"?Hr(r):r,Cp=r=>typeof ReadableStream=="function"&&r instanceof ReadableStream;var uc=!1;var pc=!1;var mc=new Set,fc=(r,e=Fe)=>{if(!mc.has(r)&&!e(r))if(r==="*")console.warn('@smithy/config-resolver WARN - Please use the caller region instead of "*". See "sigv4a" in https://github.com/aws/aws-sdk-js-v3/blob/main/supplemental-docs/CLIENTS.md.');else throw new Error(`Region not accepted: region="${r}" is not a valid hostname component.`);else mc.add(r)};var jr=r=>typeof r=="string"&&(r.startsWith("fips-")||r.endsWith("-fips"));var hc=r=>jr(r)?["fips-aws-global","aws-fips"].includes(r)?"us-east-1":r.replace(/fips-(dkr-|prod-)?|-fips/,""):r;var gc=r=>{let{region:e,useFipsEndpoint:t}=r;if(!e)throw new Error("Region is missing");return Object.assign(r,{region:async()=>{let n=typeof e=="function"?await e():e,s=hc(n);return fc(s),s},useFipsEndpoint:async()=>{let n=typeof e=="string"?e:await e();return jr(n)?!0:typeof t!="function"?Promise.resolve(!!t):t()}})};var yc=r=>Object.assign(r,{eventStreamMarshaller:r.eventStreamSerdeProvider(r)});var Sc="content-length";function Tp(r){return e=>async t=>{let n=t.request;if(R.isInstance(n)){let{body:s,headers:o}=n;if(s&&Object.keys(o).map(i=>i.toLowerCase()).indexOf(Sc)===-1)try{let i=r(s);n.headers={...n.headers,[Sc]:String(i)}}catch(i){}}return e({...t,request:n})}}var Rp={step:"build",tags:["SET_CONTENT_LENGTH","CONTENT_LENGTH"],name:"contentLengthMiddleware",override:!0},xc=r=>({applyToStack:e=>{e.add(Tp(r.bodyLengthChecker),Rp)}});var wc=async r=>{let e=(r==null?void 0:r.Bucket)||"";if(typeof r.Bucket=="string"&&(r.Bucket=e.replace(/#/g,encodeURIComponent("#")).replace(/\?/g,encodeURIComponent("?"))),Dp(e)){if(r.ForcePathStyle===!0)throw new Error("Path-style addressing cannot be used with ARN buckets")}else(!Mp(e)||e.indexOf(".")!==-1&&!String(r.Endpoint).startsWith("http:")||e.toLowerCase()!==e||e.length<3)&&(r.ForcePathStyle=!0);return r.DisableMultiRegionAccessPoints&&(r.disableMultiRegionAccessPoints=!0,r.DisableMRAP=!0),r},Ip=/^[a-z0-9][a-z0-9\.\-]{1,61}[a-z0-9]$/,_p=/(\d+\.){3}\d+/,kp=/\.\./;var Mp=r=>Ip.test(r)&&!_p.test(r)&&!kp.test(r),Dp=r=>{let[e,t,n,,,s]=r.split(":"),o=e==="arn"&&r.split(":").length>=6,i=!!(o&&t&&n&&s);if(o&&!i)throw new Error(`Invalid ARN: ${r} was an invalid ARN.`);return i};var Ec=(r,e,t)=>{let n=async()=>{var o;let s=(o=t[r])!=null?o:t[e];return typeof s=="function"?s():s};return r==="credentialScope"||e==="CredentialScope"?async()=>{var i;let s=typeof t.credentials=="function"?await t.credentials():t.credentials;return(i=s==null?void 0:s.credentialScope)!=null?i:s==null?void 0:s.CredentialScope}:r==="accountId"||e==="AccountId"?async()=>{var i;let s=typeof t.credentials=="function"?await t.credentials():t.credentials;return(i=s==null?void 0:s.accountId)!=null?i:s==null?void 0:s.AccountId}:r==="endpoint"||e==="endpoint"?async()=>{if(t.isCustomEndpoint===!1)return;let s=await n();if(s&&typeof s=="object"){if("url"in s)return s.url.href;if("hostname"in s){let{protocol:o,hostname:i,port:a,path:c}=s;return`${o}//${i}${a?":"+a:""}${c}`}}return s}:n};var Vr=async r=>{};var Wr=r=>typeof r=="object"?"url"in r?at(r.url):r:at(r);var vc=async(r,e,t,n)=>{if(!t.isCustomEndpoint){let i;t.serviceConfiguredEndpoint?i=await t.serviceConfiguredEndpoint():i=await Vr(t.serviceId),i&&(t.endpoint=()=>Promise.resolve(Wr(i)),t.isCustomEndpoint=!0)}let s=await Pp(r,e,t);if(typeof t.endpointProvider!="function")throw new Error("config.endpointProvider is not set.");return t.endpointProvider(s,n)},Pp=async(r,e,t)=>{var o;let n={},s=((o=e==null?void 0:e.getEndpointParameterInstructions)==null?void 0:o.call(e))||{};for(let[i,a]of Object.entries(s))switch(a.type){case"staticContextParams":n[i]=a.value;break;case"contextParams":n[i]=r[a.name];break;case"clientContextParams":case"builtInParams":n[i]=await Ec(a.name,i,t)();break;case"operationContextParams":n[i]=a.get(r);break;default:throw new Error("Unrecognized endpoint parameter instruction: "+JSON.stringify(a))}return Object.keys(s).length===0&&Object.assign(n,t),String(t.serviceId).toLowerCase()==="s3"&&await wc(n),n};var bc=({config:r,instructions:e})=>(t,n)=>async s=>{var a,c,l;r.isCustomEndpoint&&Ri(n,"ENDPOINT_OVERRIDE","N");let o=await vc(s.input,{getEndpointParameterInstructions(){return e}},{...r},n);n.endpointV2=o,n.authSchemes=(a=o.properties)==null?void 0:a.authSchemes;let i=(c=n.authSchemes)==null?void 0:c[0];if(i){n.signing_region=i.signingRegion,n.signing_service=i.signingName;let u=X(n),d=(l=u==null?void 0:u.selectedHttpAuthScheme)==null?void 0:l.httpAuthOption;d&&(d.signingProperties=Object.assign(d.signingProperties||{},{signing_region:i.signingRegion,signingRegion:i.signingRegion,signing_service:i.signingName,signingName:i.signingName,signingRegionSet:i.signingRegionSet},i.properties))}return t({...s})};var Np={step:"serialize",tags:["ENDPOINT_PARAMETERS","ENDPOINT_V2","ENDPOINT"],name:"endpointV2Middleware",override:!0,relation:"before",toMiddleware:zo.name},Yr=(r,e)=>({applyToStack:t=>{t.addRelativeTo(bc({config:r,instructions:e}),Np)}});var Ac=r=>{var l;let e=(l=r.tls)!=null?l:!0,{endpoint:t,useDualstackEndpoint:n,useFipsEndpoint:s}=r,o=t!=null?async()=>Wr(await K(t)()):void 0,a=Object.assign(r,{endpoint:o,tls:e,isCustomEndpoint:!!t,useDualstackEndpoint:K(n!=null?n:!1),useFipsEndpoint:K(s!=null?s:!1)}),c;return a.serviceConfiguredEndpoint=async()=>(r.serviceId&&!c&&(c=Vr(r.serviceId)),c),a};var xe;(function(r){r.STANDARD="standard",r.ADAPTIVE="adaptive"})(xe||(xe={}));var Ye=3,qs=xe.STANDARD;var Cc=["BandwidthLimitExceeded","EC2ThrottledException","LimitExceededException","PriorRequestNotComplete","ProvisionedThroughputExceededException","RequestLimitExceeded","RequestThrottled","RequestThrottledException","SlowDown","ThrottledException","Throttling","ThrottlingException","TooManyRequestsException","TransactionInProgressException"],Tc=["TimeoutError","RequestTimeout","RequestTimeoutException"],Rc=[500,502,503,504],Ic=["ECONNRESET","ECONNREFUSED","EPIPE","ETIMEDOUT"],_c=["EHOSTUNREACH","ENETUNREACH","ENOTFOUND"];var Bp=r=>(r==null?void 0:r.$retryable)!==void 0;var Op=r=>{var e;return(e=r.$metadata)==null?void 0:e.clockSkewCorrected},Lp=r=>{let e=new Set(["Failed to fetch","NetworkError when attempting to fetch resource","The Internet connection appears to be offline","Load failed","Network request failed"]);return r&&r instanceof TypeError?e.has(r.message):!1},Kr=r=>{var e,t;return((e=r.$metadata)==null?void 0:e.httpStatusCode)===429||Cc.includes(r.name)||((t=r.$retryable)==null?void 0:t.throttling)==!0},Xr=(r,e=0)=>{var t;return Bp(r)||Op(r)||Tc.includes(r.name)||Ic.includes((r==null?void 0:r.code)||"")||_c.includes((r==null?void 0:r.code)||"")||Rc.includes(((t=r.$metadata)==null?void 0:t.httpStatusCode)||0)||Lp(r)||r.cause!==void 0&&e<=10&&Xr(r.cause,e+1)},kc=r=>{var e;if(((e=r.$metadata)==null?void 0:e.httpStatusCode)!==void 0){let t=r.$metadata.httpStatusCode;return 500<=t&&t<=599&&!Xr(r)}return!1};var Qr=class Qr{constructor(e){h(this,"beta");h(this,"minCapacity");h(this,"minFillRate");h(this,"scaleConstant");h(this,"smooth");h(this,"currentCapacity",0);h(this,"enabled",!1);h(this,"lastMaxRate",0);h(this,"measuredTxRate",0);h(this,"requestCount",0);h(this,"fillRate");h(this,"lastThrottleTime");h(this,"lastTimestamp",0);h(this,"lastTxRateBucket");h(this,"maxCapacity");h(this,"timeWindow",0);var n,s,o,i,a;this.beta=(n=e==null?void 0:e.beta)!=null?n:.7,this.minCapacity=(s=e==null?void 0:e.minCapacity)!=null?s:1,this.minFillRate=(o=e==null?void 0:e.minFillRate)!=null?o:.5,this.scaleConstant=(i=e==null?void 0:e.scaleConstant)!=null?i:.4,this.smooth=(a=e==null?void 0:e.smooth)!=null?a:.8;let t=this.getCurrentTimeInSeconds();this.lastThrottleTime=t,this.lastTxRateBucket=Math.floor(this.getCurrentTimeInSeconds()),this.fillRate=this.minFillRate,this.maxCapacity=this.minCapacity}getCurrentTimeInSeconds(){return Date.now()/1e3}async getSendToken(){return this.acquireTokenBucket(1)}async acquireTokenBucket(e){if(this.enabled){if(this.refillTokenBucket(),e>this.currentCapacity){let t=(e-this.currentCapacity)/this.fillRate*1e3;await new Promise(n=>Qr.setTimeoutFn(n,t))}this.currentCapacity=this.currentCapacity-e}}refillTokenBucket(){let e=this.getCurrentTimeInSeconds();if(!this.lastTimestamp){this.lastTimestamp=e;return}let t=(e-this.lastTimestamp)*this.fillRate;this.currentCapacity=Math.min(this.maxCapacity,this.currentCapacity+t),this.lastTimestamp=e}updateClientSendingRate(e){let t;if(this.updateMeasuredRate(),Kr(e)){let s=this.enabled?Math.min(this.measuredTxRate,this.fillRate):this.measuredTxRate;this.lastMaxRate=s,this.calculateTimeWindow(),this.lastThrottleTime=this.getCurrentTimeInSeconds(),t=this.cubicThrottle(s),this.enableTokenBucket()}else this.calculateTimeWindow(),t=this.cubicSuccess(this.getCurrentTimeInSeconds());let n=Math.min(t,2*this.measuredTxRate);this.updateTokenBucketRate(n)}calculateTimeWindow(){this.timeWindow=this.getPrecise(Math.pow(this.lastMaxRate*(1-this.beta)/this.scaleConstant,1/3))}cubicThrottle(e){return this.getPrecise(e*this.beta)}cubicSuccess(e){return this.getPrecise(this.scaleConstant*Math.pow(e-this.lastThrottleTime-this.timeWindow,3)+this.lastMaxRate)}enableTokenBucket(){this.enabled=!0}updateTokenBucketRate(e){this.refillTokenBucket(),this.fillRate=Math.max(e,this.minFillRate),this.maxCapacity=Math.max(e,this.minCapacity),this.currentCapacity=Math.min(this.currentCapacity,this.maxCapacity)}updateMeasuredRate(){let e=this.getCurrentTimeInSeconds(),t=Math.floor(e*2)/2;if(this.requestCount++,t>this.lastTxRateBucket){let n=this.requestCount/(t-this.lastTxRateBucket);this.measuredTxRate=this.getPrecise(n*this.smooth+this.measuredTxRate*(1-this.smooth)),this.requestCount=0,this.lastTxRateBucket=t}}getPrecise(e){return parseFloat(e.toFixed(8))}};h(Qr,"setTimeoutFn",setTimeout);var Jr=Qr;var Mc="amz-sdk-invocation-id",Dc="amz-sdk-request";var Nc=()=>{let r=100;return{computeNextBackoffDelay:n=>Math.floor(Math.min(2e4,Math.random()*2**n*r)),setDelayBase:n=>{r=n}}};var zs=({retryDelay:r,retryCount:e,retryCost:t})=>({getRetryCount:()=>e,getRetryDelay:()=>Math.min(2e4,r),getRetryCost:()=>t});var pt=class{constructor(e){h(this,"maxAttempts");h(this,"mode",xe.STANDARD);h(this,"capacity",500);h(this,"retryBackoffStrategy",Nc());h(this,"maxAttemptsProvider");this.maxAttempts=e,this.maxAttemptsProvider=typeof e=="function"?e:async()=>e}async acquireInitialRetryToken(e){return zs({retryDelay:100,retryCount:0})}async refreshRetryTokenForRetry(e,t){let n=await this.getMaxAttempts();if(this.shouldRetry(e,t,n)){let s=t.errorType;this.retryBackoffStrategy.setDelayBase(s==="THROTTLING"?500:100);let o=this.retryBackoffStrategy.computeNextBackoffDelay(e.getRetryCount()),i=t.retryAfterHint?Math.max(t.retryAfterHint.getTime()-Date.now()||0,o):o,a=this.getCapacityCost(s);return this.capacity-=a,zs({retryDelay:i,retryCount:e.getRetryCount()+1,retryCost:a})}throw new Error("No retry token available")}recordSuccess(e){var t;this.capacity=Math.max(500,this.capacity+((t=e.getRetryCost())!=null?t:1))}getCapacity(){return this.capacity}async getMaxAttempts(){try{return await this.maxAttemptsProvider()}catch(e){return console.warn(`Max attempts provider could not resolve. Using default of ${Ye}`),Ye}}shouldRetry(e,t,n){return e.getRetryCount()+1<n&&this.capacity>=this.getCapacityCost(t.errorType)&&this.isRetryableError(t.errorType)}getCapacityCost(e){return e==="TRANSIENT"?10:5}isRetryableError(e){return e==="THROTTLING"||e==="TRANSIENT"}};var Zr=class{constructor(e,t){h(this,"maxAttemptsProvider");h(this,"rateLimiter");h(this,"standardRetryStrategy");h(this,"mode",xe.ADAPTIVE);this.maxAttemptsProvider=e;let{rateLimiter:n}=t!=null?t:{};this.rateLimiter=n!=null?n:new Jr,this.standardRetryStrategy=new pt(e)}async acquireInitialRetryToken(e){return await this.rateLimiter.getSendToken(),this.standardRetryStrategy.acquireInitialRetryToken(e)}async refreshRetryTokenForRetry(e,t){return this.rateLimiter.updateClientSendingRate(t),this.standardRetryStrategy.refreshRetryTokenForRetry(e,t)}recordSuccess(e){this.rateLimiter.updateClientSendingRate({}),this.standardRetryStrategy.recordSuccess(e)}};var Bc=r=>r instanceof Error?r:r instanceof Object?Object.assign(new Error,r):typeof r=="string"?new Error(r):new Error(`AWS SDK error wrapper for ${r}`);var Oc=r=>{let{retryStrategy:e,retryMode:t,maxAttempts:n}=r,s=K(n!=null?n:Ye);return Object.assign(r,{maxAttempts:s,retryStrategy:async()=>e||(await K(t)()===xe.ADAPTIVE?new Zr(s):new pt(s))})};var Lc=r=>(r==null?void 0:r.body)instanceof ReadableStream;var Gp=r=>(e,t)=>async n=>{var i;let s=await r.retryStrategy(),o=await r.maxAttempts();if(Fp(s)){s=s;let a=await s.acquireInitialRetryToken(t.partition_id),c=new Error,l=0,u=0,{request:d}=n,p=R.isInstance(d);for(p&&(d.headers[Mc]=Ge());;)try{p&&(d.headers[Dc]=`attempt=${l+1}; max=${o}`);let{response:m,output:g}=await e(n);return s.recordSuccess(a),g.$metadata.attempts=l+1,g.$metadata.totalRetryDelay=u,{response:m,output:g}}catch(m){let g=Hp(m);if(c=Bc(m),p&&Lc(d))throw(i=t.logger instanceof lt?console:t.logger)==null||i.warn("An error was encountered in a non-retryable streaming request."),c;try{a=await s.refreshRetryTokenForRetry(a,g)}catch(S){throw c.$metadata||(c.$metadata={}),c.$metadata.attempts=l+1,c.$metadata.totalRetryDelay=u,c}l=a.getRetryCount();let y=a.getRetryDelay();u+=y,await new Promise(S=>setTimeout(S,y))}}else return s=s,s!=null&&s.mode&&(t.userAgent=[...t.userAgent||[],["cfg/retry-mode",s.mode]]),s.retry(e,n)},Fp=r=>typeof r.acquireInitialRetryToken!="undefined"&&typeof r.refreshRetryTokenForRetry!="undefined"&&typeof r.recordSuccess!="undefined",Hp=r=>{let e={error:r,errorType:qp(r)},t=jp(r.$response);return t&&(e.retryAfterHint=t),e},qp=r=>Kr(r)?"THROTTLING":Xr(r)?"TRANSIENT":kc(r)?"SERVER_ERROR":"CLIENT_ERROR",zp={name:"retryMiddleware",tags:["RETRY"],step:"finalizeRequest",priority:"high",override:!0},Uc=r=>({applyToStack:e=>{e.add(Gp(r),zp)}}),jp=r=>{if(!$.isInstance(r))return;let e=Object.keys(r.headers).find(o=>o.toLowerCase()==="retry-after");if(!e)return;let t=r.headers[e],n=Number(t);return Number.isNaN(n)?new Date(t):new Date(n*1e3)};var $c=async(r,e,t)=>({operation:X(e).operation,region:await K(r.region)()||(()=>{throw new Error("expected `region` to be configured for `aws.auth#sigv4`")})()});function Vp(r){return{schemeId:"aws.auth#sigv4",signingProperties:{name:"bedrock",region:r.region},propertiesExtractor:(e,t)=>({signingProperties:{config:e,context:t}})}}function Wp(r){return{schemeId:"smithy.api#httpBearerAuth",propertiesExtractor:({profile:e,filepath:t,configFilepath:n,ignoreCache:s},o)=>({identityProperties:{profile:e,filepath:t,configFilepath:n,ignoreCache:s}})}}var Gc=r=>{let e=[];switch(r.operation){default:e.push(Vp(r)),e.push(Wp(r))}return e},Fc=r=>{var n;let e=ir(r.token,or,Tt),t=Ia(r);return Object.assign(t,{authSchemePreference:K((n=r.authSchemePreference)!=null?n:[]),token:e})};var Hc=r=>{var e,t;return Object.assign(r,{useDualstackEndpoint:(e=r.useDualstackEndpoint)!=null?e:!1,useFipsEndpoint:(t=r.useFipsEndpoint)!=null?t:!1,defaultSigningName:"bedrock"})},en={UseFIPS:{type:"builtInParams",name:"useFipsEndpoint"},Endpoint:{type:"builtInParams",name:"endpoint"},Region:{type:"builtInParams",name:"region"},UseDualStack:{type:"builtInParams",name:"useDualstackEndpoint"}};var qc={name:"@aws-sdk/client-bedrock-runtime",description:"AWS SDK for JavaScript Bedrock Runtime Client for Node.js, Browser and React Native",version:"3.947.0",scripts:{build:"concurrently 'yarn:build:cjs' 'yarn:build:es' 'yarn:build:types'","build:cjs":"node ../../scripts/compilation/inline client-bedrock-runtime","build:es":"tsc -p tsconfig.es.json","build:include:deps":"lerna run --scope $npm_package_name --include-dependencies build","build:types":"tsc -p tsconfig.types.json","build:types:downlevel":"downlevel-dts dist-types dist-types/ts3.4",clean:"rimraf ./dist-* && rimraf *.tsbuildinfo","extract:docs":"api-extractor run --local","generate:client":"node ../../scripts/generate-clients/single-service --solo bedrock-runtime","test:index":"tsc --noEmit ./test/index-types.ts && node ./test/index-objects.spec.mjs"},main:"./dist-cjs/index.js",types:"./dist-types/index.d.ts",module:"./dist-es/index.js",sideEffects:!1,dependencies:{"@aws-crypto/sha256-browser":"5.2.0","@aws-crypto/sha256-js":"5.2.0","@aws-sdk/core":"3.947.0","@aws-sdk/credential-provider-node":"3.947.0","@aws-sdk/eventstream-handler-node":"3.936.0","@aws-sdk/middleware-eventstream":"3.936.0","@aws-sdk/middleware-host-header":"3.936.0","@aws-sdk/middleware-logger":"3.936.0","@aws-sdk/middleware-recursion-detection":"3.936.0","@aws-sdk/middleware-user-agent":"3.947.0","@aws-sdk/middleware-websocket":"3.936.0","@aws-sdk/region-config-resolver":"3.936.0","@aws-sdk/token-providers":"3.947.0","@aws-sdk/types":"3.936.0","@aws-sdk/util-endpoints":"3.936.0","@aws-sdk/util-user-agent-browser":"3.936.0","@aws-sdk/util-user-agent-node":"3.947.0","@smithy/config-resolver":"^4.4.3","@smithy/core":"^3.18.7","@smithy/eventstream-serde-browser":"^4.2.5","@smithy/eventstream-serde-config-resolver":"^4.3.5","@smithy/eventstream-serde-node":"^4.2.5","@smithy/fetch-http-handler":"^5.3.6","@smithy/hash-node":"^4.2.5","@smithy/invalid-dependency":"^4.2.5","@smithy/middleware-content-length":"^4.2.5","@smithy/middleware-endpoint":"^4.3.14","@smithy/middleware-retry":"^4.4.14","@smithy/middleware-serde":"^4.2.6","@smithy/middleware-stack":"^4.2.5","@smithy/node-config-provider":"^4.3.5","@smithy/node-http-handler":"^4.4.5","@smithy/protocol-http":"^5.3.5","@smithy/smithy-client":"^4.9.10","@smithy/types":"^4.9.0","@smithy/url-parser":"^4.2.5","@smithy/util-base64":"^4.3.0","@smithy/util-body-length-browser":"^4.2.0","@smithy/util-body-length-node":"^4.2.1","@smithy/util-defaults-mode-browser":"^4.3.13","@smithy/util-defaults-mode-node":"^4.2.16","@smithy/util-endpoints":"^3.2.5","@smithy/util-middleware":"^4.2.5","@smithy/util-retry":"^4.2.5","@smithy/util-stream":"^4.5.6","@smithy/util-utf8":"^4.2.0",tslib:"^2.6.2"},devDependencies:{"@tsconfig/node18":"18.2.4","@types/node":"^18.19.69",concurrently:"7.0.0","downlevel-dts":"0.10.1",rimraf:"3.0.2",typescript:"~5.8.3"},engines:{node:">=18.0.0"},typesVersions:{"<4.0":{"dist-types/*":["dist-types/ts3.4/*"]}},files:["dist-*/**"],author:{name:"AWS SDK for JavaScript Team",url:"https://aws.amazon.com/javascript/"},license:"Apache-2.0",browser:{"./dist-es/runtimeConfig":"./dist-es/runtimeConfig.browser"},"react-native":{"./dist-es/runtimeConfig":"./dist-es/runtimeConfig.native"},homepage:"https://github.com/aws/aws-sdk-js-v3/tree/main/clients/client-bedrock-runtime",repository:{type:"git",url:"https://github.com/aws/aws-sdk-js-v3.git",directory:"clients/client-bedrock-runtime"}};var js={name:"SHA-256"},Vs={name:"HMAC",hash:js},zc=new Uint8Array([227,176,196,66,152,252,28,20,154,251,244,200,153,111,185,36,39,174,65,228,100,155,147,76,164,149,153,27,120,82,184,85]);var Kp={};function mt(){return typeof window!="undefined"?window:typeof self!="undefined"?self:Kp}var Ws=function(){function r(e){this.toHash=new Uint8Array(0),this.secret=e,this.reset()}return r.prototype.update=function(e){if(!_e(e)){var t=se(e),n=new Uint8Array(this.toHash.byteLength+t.byteLength);n.set(this.toHash,0),n.set(t,this.toHash.byteLength),this.toHash=n}},r.prototype.digest=function(){var e=this;return this.key?this.key.then(function(t){return mt().crypto.subtle.sign(Vs,t,e.toHash).then(function(n){return new Uint8Array(n)})}):_e(this.toHash)?Promise.resolve(zc):Promise.resolve().then(function(){return mt().crypto.subtle.digest(js,e.toHash)}).then(function(t){return Promise.resolve(new Uint8Array(t))})},r.prototype.reset=function(){var e=this;this.toHash=new Uint8Array(0),this.secret&&this.secret!==void 0&&(this.key=new Promise(function(t,n){mt().crypto.subtle.importKey("raw",se(e.secret),Vs,!1,["sign"]).then(t,n)}),this.key.catch(function(){}))},r}();var V=64,jc=32,Vc=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Wc=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],Yc=Math.pow(2,53)-1;var Dt=function(){function r(){this.state=Int32Array.from(Wc),this.temp=new Int32Array(64),this.buffer=new Uint8Array(64),this.bufferLength=0,this.bytesHashed=0,this.finished=!1}return r.prototype.update=function(e){if(this.finished)throw new Error("Attempted to update an already finished hash.");var t=0,n=e.byteLength;if(this.bytesHashed+=n,this.bytesHashed*8>Yc)throw new Error("Cannot hash more than 2^53 - 1 bits");for(;n>0;)this.buffer[this.bufferLength++]=e[t++],n--,this.bufferLength===V&&(this.hashBuffer(),this.bufferLength=0)},r.prototype.digest=function(){if(!this.finished){var e=this.bytesHashed*8,t=new DataView(this.buffer.buffer,this.buffer.byteOffset,this.buffer.byteLength),n=this.bufferLength;if(t.setUint8(this.bufferLength++,128),n%V>=V-8){for(var s=this.bufferLength;s<V;s++)t.setUint8(s,0);this.hashBuffer(),this.bufferLength=0}for(var s=this.bufferLength;s<V-8;s++)t.setUint8(s,0);t.setUint32(V-8,Math.floor(e/4294967296),!0),t.setUint32(V-4,e),this.hashBuffer(),this.finished=!0}for(var o=new Uint8Array(jc),s=0;s<8;s++)o[s*4]=this.state[s]>>>24&255,o[s*4+1]=this.state[s]>>>16&255,o[s*4+2]=this.state[s]>>>8&255,o[s*4+3]=this.state[s]>>>0&255;return o},r.prototype.hashBuffer=function(){for(var e=this,t=e.buffer,n=e.state,s=n[0],o=n[1],i=n[2],a=n[3],c=n[4],l=n[5],u=n[6],d=n[7],p=0;p<V;p++){if(p<16)this.temp[p]=(t[p*4]&255)<<24|(t[p*4+1]&255)<<16|(t[p*4+2]&255)<<8|t[p*4+3]&255;else{var m=this.temp[p-2],g=(m>>>17|m<<15)^(m>>>19|m<<13)^m>>>10;m=this.temp[p-15];var y=(m>>>7|m<<25)^(m>>>18|m<<14)^m>>>3;this.temp[p]=(g+this.temp[p-7]|0)+(y+this.temp[p-16]|0)}var S=(((c>>>6|c<<26)^(c>>>11|c<<21)^(c>>>25|c<<7))+(c&l^~c&u)|0)+(d+(Vc[p]+this.temp[p]|0)|0)|0,x=((s>>>2|s<<30)^(s>>>13|s<<19)^(s>>>22|s<<10))+(s&o^s&i^o&i)|0;d=u,u=l,l=c,c=a+S|0,a=i,i=o,o=s,s=S+x|0}n[0]+=s,n[1]+=o,n[2]+=i,n[3]+=a,n[4]+=c,n[5]+=l,n[6]+=u,n[7]+=d},r}();var Kc=function(){function r(e){this.secret=e,this.hash=new Dt,this.reset()}return r.prototype.update=function(e){if(!(_e(e)||this.error))try{this.hash.update(se(e))}catch(t){this.error=t}},r.prototype.digestSync=function(){if(this.error)throw this.error;return this.outer?(this.outer.finished||this.outer.update(this.hash.digest()),this.outer.digest()):this.hash.digest()},r.prototype.digest=function(){return kr(this,void 0,void 0,function(){return Mr(this,function(e){return[2,this.digestSync()]})})},r.prototype.reset=function(){if(this.hash=new Dt,this.secret){this.outer=new Dt;var e=Xp(this.secret),t=new Uint8Array(V);t.set(e);for(var n=0;n<V;n++)e[n]^=54,t[n]^=92;this.hash.update(e),this.outer.update(t);for(var n=0;n<e.byteLength;n++)e[n]=0}},r}();function Xp(r){var e=se(r);if(e.byteLength>V){var t=new Dt;t.update(e),e=t.digest()}var n=new Uint8Array(V);return n.set(e),n}var Jp=["decrypt","digest","encrypt","exportKey","generateKey","importKey","sign","verify"];function Xc(r){if(Qp(r)&&typeof r.crypto.subtle=="object"){var e=r.crypto.subtle;return Zp(e)}return!1}function Qp(r){if(typeof r=="object"&&typeof r.crypto=="object"){var e=r.crypto.getRandomValues;return typeof e=="function"}return!1}function Zp(r){return r&&Jp.every(function(e){return typeof r[e]=="function"})}var Jc=function(){function r(e){Xc(mt())?this.hash=new Ws(e):this.hash=new Kc(e)}return r.prototype.update=function(e,t){this.hash.update(se(e))},r.prototype.digest=function(){return this.hash.digest()},r.prototype.reset=function(){this.hash.reset()},r}();var Zc=({serviceId:r,clientVersion:e})=>async t=>{var m,g,y,S,x,w,v,E,A,M;let n=typeof window!="undefined"?window.navigator:void 0,s=(m=n==null?void 0:n.userAgent)!=null?m:"",o=(S=(y=(g=n==null?void 0:n.userAgentData)==null?void 0:g.platform)!=null?y:Qc.os(s))!=null?S:"other",i=void 0,a=(w=(x=n==null?void 0:n.userAgentData)==null?void 0:x.brands)!=null?w:[],c=a[a.length-1],l=(E=(v=c==null?void 0:c.brand)!=null?v:Qc.browser(s))!=null?E:"unknown",u=(A=c==null?void 0:c.version)!=null?A:"unknown",d=[["aws-sdk-js",e],["ua","2.1"],[`os/${o}`,i],["lang/js"],["md/browser",`${l}_${u}`]];r&&d.push([`api/${r}`,e]);let p=await((M=t==null?void 0:t.userAgentAppId)==null?void 0:M.call(t));return p&&d.push([`app/${p}`]),d},Qc={os(r){if(/iPhone|iPad|iPod/.test(r))return"iOS";if(/Macintosh|Mac OS X/.test(r))return"macOS";if(/Windows NT/.test(r))return"Windows";if(/Android/.test(r))return"Android";if(/Linux/.test(r))return"Linux"},browser(r){if(/EdgiOS|EdgA|Edg\//.test(r))return"Microsoft Edge";if(/Firefox\//.test(r))return"Firefox";if(/Chrome\//.test(r))return"Chrome";if(/Safari\//.test(r))return"Safari"}};var el=r=>()=>Promise.reject(r);var tl=["in-region","cross-region","mobile","standard","legacy"];var rl=({defaultsMode:r}={})=>sa(async()=>{let e=typeof r=="function"?await r():r;switch(e==null?void 0:e.toLowerCase()){case"auto":return Promise.resolve(em()?"mobile":"standard");case"mobile":case"in-region":case"cross-region":case"standard":case"legacy":return Promise.resolve(e==null?void 0:e.toLocaleLowerCase());case void 0:return Promise.resolve("legacy");default:throw new Error(`Invalid parameter for "defaultsMode", expect ${tl.join(", ")}, got ${e}`)}}),em=()=>{var e;let r=window==null?void 0:window.navigator;if(r!=null&&r.connection){let{effectiveType:t,rtt:n,downlink:s}=r==null?void 0:r.connection;if(typeof t=="string"&&t!=="4g"||Number(n)>100||Number(s)<10)return!0}return((e=r==null?void 0:r.userAgentData)==null?void 0:e.mobile)||typeof(r==null?void 0:r.maxTouchPoints)=="number"&&(r==null?void 0:r.maxTouchPoints)>1};z();var pl="required",ue="fn",pe="argv",ht="ref";var nl="isSet",Nt="booleanEquals",ft="error",Pt="endpoint",F="tree",Ys="PartitionResult",sl={[pl]:!1,type:"string"},ol={[pl]:!0,default:!1,type:"boolean"},il={[ht]:"Endpoint"},ml={[ue]:Nt,[pe]:[{[ht]:"UseFIPS"},!0]},fl={[ue]:Nt,[pe]:[{[ht]:"UseDualStack"},!0]},de={},al={[ue]:"getAttr",[pe]:[{[ht]:Ys},"supportsFIPS"]},cl={[ue]:Nt,[pe]:[!0,{[ue]:"getAttr",[pe]:[{[ht]:Ys},"supportsDualStack"]}]},ll=[ml],dl=[fl],ul=[{[ht]:"Region"}],tm={version:"1.0",parameters:{Region:sl,UseDualStack:ol,UseFIPS:ol,Endpoint:sl},rules:[{conditions:[{[ue]:nl,[pe]:[il]}],rules:[{conditions:ll,error:"Invalid Configuration: FIPS and custom endpoint are not supported",type:ft},{rules:[{conditions:dl,error:"Invalid Configuration: Dualstack and custom endpoint are not supported",type:ft},{endpoint:{url:il,properties:de,headers:de},type:Pt}],type:F}],type:F},{rules:[{conditions:[{[ue]:nl,[pe]:ul}],rules:[{conditions:[{[ue]:"aws.partition",[pe]:ul,assign:Ys}],rules:[{conditions:[ml,fl],rules:[{conditions:[{[ue]:Nt,[pe]:[!0,al]},cl],rules:[{rules:[{endpoint:{url:"https://bedrock-runtime-fips.{Region}.{PartitionResult#dualStackDnsSuffix}",properties:de,headers:de},type:Pt}],type:F}],type:F},{error:"FIPS and DualStack are enabled, but this partition does not support one or both",type:ft}],type:F},{conditions:ll,rules:[{conditions:[{[ue]:Nt,[pe]:[al,!0]}],rules:[{rules:[{endpoint:{url:"https://bedrock-runtime-fips.{Region}.{PartitionResult#dnsSuffix}",properties:de,headers:de},type:Pt}],type:F}],type:F},{error:"FIPS is enabled but this partition does not support FIPS",type:ft}],type:F},{conditions:dl,rules:[{conditions:[cl],rules:[{rules:[{endpoint:{url:"https://bedrock-runtime.{Region}.{PartitionResult#dualStackDnsSuffix}",properties:de,headers:de},type:Pt}],type:F}],type:F},{error:"DualStack is enabled but this partition does not support DualStack",type:ft}],type:F},{rules:[{endpoint:{url:"https://bedrock-runtime.{Region}.{PartitionResult#dnsSuffix}",properties:de,headers:de},type:Pt}],type:F}],type:F}],type:F},{error:"Invalid Configuration: Missing Region",type:ft}],type:F}]},hl=tm;var rm=new ar({size:50,params:["Endpoint","Region","UseDualStack","UseFIPS"]}),gl=(r,e={})=>rm.get(r,()=>Yi(hl,{endpointParams:r,logger:e.logger}));He.aws=Es;var yl=r=>{var e,t,n,s,o,i,a,c,l,u,d,p,m;return{apiVersion:"2023-09-30",base64Decoder:(e=r==null?void 0:r.base64Decoder)!=null?e:re,base64Encoder:(t=r==null?void 0:r.base64Encoder)!=null?t:J,disableHostPrefix:(n=r==null?void 0:r.disableHostPrefix)!=null?n:!1,endpointProvider:(s=r==null?void 0:r.endpointProvider)!=null?s:gl,extensions:(o=r==null?void 0:r.extensions)!=null?o:[],httpAuthSchemeProvider:(i=r==null?void 0:r.httpAuthSchemeProvider)!=null?i:Gc,httpAuthSchemes:(a=r==null?void 0:r.httpAuthSchemes)!=null?a:[{schemeId:"aws.auth#sigv4",identityProvider:g=>g.getIdentityProvider("aws.auth#sigv4"),signer:new _t},{schemeId:"smithy.api#httpBearerAuth",identityProvider:g=>g.getIdentityProvider("smithy.api#httpBearerAuth"),signer:new sr}],logger:(c=r==null?void 0:r.logger)!=null?c:new lt,protocol:(l=r==null?void 0:r.protocol)!=null?l:new Tr({defaultNamespace:"com.amazonaws.bedrockruntime"}),serviceId:(u=r==null?void 0:r.serviceId)!=null?u:"Bedrock Runtime",urlParser:(d=r==null?void 0:r.urlParser)!=null?d:at,utf8Decoder:(p=r==null?void 0:r.utf8Decoder)!=null?p:G,utf8Encoder:(m=r==null?void 0:r.utf8Encoder)!=null?m:q}};var Sl=r=>{var s,o,i,a,c,l,u,d,p,m,g,y,S;let e=rl(r),t=()=>e().then(Pa),n=yl(r);return{...n,...r,runtime:"browser",defaultsMode:e,bodyLengthChecker:(s=r==null?void 0:r.bodyLengthChecker)!=null?s:ka,credentialDefaultProvider:(o=r==null?void 0:r.credentialDefaultProvider)!=null?o:x=>()=>Promise.reject(new Error("Credential is missing")),defaultUserAgentProvider:(i=r==null?void 0:r.defaultUserAgentProvider)!=null?i:Zc({serviceId:n.serviceId,clientVersion:qc.version}),eventStreamPayloadHandlerProvider:(a=r==null?void 0:r.eventStreamPayloadHandlerProvider)!=null?a:oc,eventStreamSerdeProvider:(c=r==null?void 0:r.eventStreamSerdeProvider)!=null?c:dc,maxAttempts:(l=r==null?void 0:r.maxAttempts)!=null?l:Ye,region:(u=r==null?void 0:r.region)!=null?u:el("Region is missing"),requestHandler:zr.create((d=r==null?void 0:r.requestHandler)!=null?d:t,$e.create(t)),retryMode:(p=r==null?void 0:r.retryMode)!=null?p:async()=>(await t()).retryMode||qs,sha256:(m=r==null?void 0:r.sha256)!=null?m:Jc,streamCollector:(g=r==null?void 0:r.streamCollector)!=null?g:zt,useDualstackEndpoint:(y=r==null?void 0:r.useDualstackEndpoint)!=null?y:()=>Promise.resolve(uc),useFipsEndpoint:(S=r==null?void 0:r.useFipsEndpoint)!=null?S:()=>Promise.resolve(pc)}};var xl=r=>({setRegion(e){r.region=e},region(){return r.region}}),wl=r=>({region:r.region()});var El=r=>{let e=r.httpAuthSchemes,t=r.httpAuthSchemeProvider,n=r.credentials,s=r.token;return{setHttpAuthScheme(o){let i=e.findIndex(a=>a.schemeId===o.schemeId);i===-1?e.push(o):e.splice(i,1,o)},httpAuthSchemes(){return e},setHttpAuthSchemeProvider(o){t=o},httpAuthSchemeProvider(){return t},setCredentials(o){n=o},credentials(){return n},setToken(o){s=o},token(){return s}}},vl=r=>({httpAuthSchemes:r.httpAuthSchemes(),httpAuthSchemeProvider:r.httpAuthSchemeProvider(),credentials:r.credentials(),token:r.token()});var bl=(r,e)=>{let t=Object.assign(xl(r),Ua(r),No(r),El(r));return e.forEach(n=>n.configure(t)),Object.assign(r,wl(t),$a(t),Bo(t),vl(t))};var tn=class extends Sr{constructor(...[t]){let n=Sl(t||{});super(n);h(this,"config");this.initConfig=n;let s=Hc(n),o=Ii(s),i=Oc(o),a=gc(i),c=a,l=Ac(c),u=yc(l),d=Fc(u),p=Po(d),m=ic(p),g=bl(m,(t==null?void 0:t.extensions)||[]);this.config=g,this.middlewareStack.use(oi(this.config)),this.middlewareStack.use(Ja(this.config)),this.middlewareStack.use(Uc(this.config)),this.middlewareStack.use(xc(this.config)),this.middlewareStack.use(Oo(this.config)),this.middlewareStack.use(Lo(this.config)),this.middlewareStack.use(Go(this.config)),this.middlewareStack.use(qo(this.config,{httpAuthSchemeParametersProvider:$c,identityProviderConfigProvider:async y=>new nr({"aws.auth#sigv4":y.credentials,"smithy.api#httpBearerAuth":y.token})})),this.middlewareStack.use(Vo(this.config))}destroy(){super.destroy()}};var O=class r extends wr{constructor(e){super(e),Object.setPrototypeOf(this,r.prototype)}};var rn=class r extends O{constructor(t){super({name:"AccessDeniedException",$fault:"client",...t});h(this,"name","AccessDeniedException");h(this,"$fault","client");Object.setPrototypeOf(this,r.prototype)}},nn=class r extends O{constructor(t){super({name:"InternalServerException",$fault:"server",...t});h(this,"name","InternalServerException");h(this,"$fault","server");Object.setPrototypeOf(this,r.prototype)}},sn=class r extends O{constructor(t){super({name:"ThrottlingException",$fault:"client",...t});h(this,"name","ThrottlingException");h(this,"$fault","client");Object.setPrototypeOf(this,r.prototype)}},on=class r extends O{constructor(t){super({name:"ValidationException",$fault:"client",...t});h(this,"name","ValidationException");h(this,"$fault","client");Object.setPrototypeOf(this,r.prototype)}},an=class r extends O{constructor(t){super({name:"ConflictException",$fault:"client",...t});h(this,"name","ConflictException");h(this,"$fault","client");Object.setPrototypeOf(this,r.prototype)}},cn=class r extends O{constructor(t){super({name:"ResourceNotFoundException",$fault:"client",...t});h(this,"name","ResourceNotFoundException");h(this,"$fault","client");Object.setPrototypeOf(this,r.prototype)}},ln=class r extends O{constructor(t){super({name:"ServiceQuotaExceededException",$fault:"client",...t});h(this,"name","ServiceQuotaExceededException");h(this,"$fault","client");Object.setPrototypeOf(this,r.prototype)}},dn=class r extends O{constructor(t){super({name:"ServiceUnavailableException",$fault:"server",...t});h(this,"name","ServiceUnavailableException");h(this,"$fault","server");Object.setPrototypeOf(this,r.prototype)}},un=class r extends O{constructor(t){super({name:"ModelErrorException",$fault:"client",...t});h(this,"name","ModelErrorException");h(this,"$fault","client");h(this,"originalStatusCode");h(this,"resourceName");Object.setPrototypeOf(this,r.prototype),this.originalStatusCode=t.originalStatusCode,this.resourceName=t.resourceName}},pn=class r extends O{constructor(t){super({name:"ModelNotReadyException",$fault:"client",...t});h(this,"name","ModelNotReadyException");h(this,"$fault","client");h(this,"$retryable",{});Object.setPrototypeOf(this,r.prototype)}},mn=class r extends O{constructor(t){super({name:"ModelTimeoutException",$fault:"client",...t});h(this,"name","ModelTimeoutException");h(this,"$fault","client");Object.setPrototypeOf(this,r.prototype)}},fn=class r extends O{constructor(t){super({name:"ModelStreamErrorException",$fault:"client",...t});h(this,"name","ModelStreamErrorException");h(this,"$fault","client");h(this,"originalStatusCode");h(this,"originalMessage");Object.setPrototypeOf(this,r.prototype),this.originalStatusCode=t.originalStatusCode,this.originalMessage=t.originalMessage}};var nm="Accept",sm="AudioBlock",om="AccessDeniedException",im="ApplyGuardrail",am="AppliedGuardrailDetails",cm="ApplyGuardrailRequest",lm="ApplyGuardrailResponse",dm="AsyncInvokeMessage",um="AsyncInvokeOutputDataConfig",pm="AsyncInvokeSummary",mm="AsyncInvokeS3OutputDataConfig",fm="AsyncInvokeSummaries",hm="AudioSource",gm="AnyToolChoice",ym="AutoToolChoice",Sm="Body",xm="BidirectionalInputPayloadPart",wm="BidirectionalOutputPayloadPart",Em="Citation",vm="ContentBlocks",bm="ContentBlockDelta",Am="ContentBlockDeltaEvent",Cm="ContentBlockStart",Tm="ContentBlockStartEvent",Rm="ContentBlockStopEvent",Im="ContentBlock",_m="CitationsConfig",km="CitationsContentBlock",Mm="CitationsDelta",Dm="ConflictException",Pm="CitationGeneratedContent",Nm="CitationGeneratedContentList",Bm="CitationLocation",Om="ConverseMetrics",Lm="ConverseOutput",Um="CachePointBlock",$m="ConverseRequest",Gm="ConverseResponse",Fm="ConverseStream",Hm="CitationSourceContent",qm="CitationSourceContentDelta",zm="CitationSourceContentList",jm="CitationSourceContentListDelta",Vm="ConverseStreamMetrics",Wm="ConverseStreamMetadataEvent",Ym="ConverseStreamOutput",Km="ConverseStreamRequest",Xm="ConverseStreamResponse",Jm="ConverseStreamTrace",Qm="ConverseTrace",Zm="CountTokensInput",ef="ConverseTokensRequest",tf="CountTokensRequest",rf="CountTokensResponse",Xs="Content-Type",nf="CountTokens",sf="Citations",of="Converse",af="DocumentBlock",cf="DocumentContentBlocks",lf="DocumentContentBlock",df="DocumentCharLocation",uf="DocumentChunkLocation",pf="DocumentPageLocation",mf="DocumentSource",ff="ErrorBlock",hf="GuardrailAssessment",gf="GetAsyncInvoke",yf="GetAsyncInvokeRequest",Sf="GetAsyncInvokeResponse",xf="GuardrailAssessmentList",wf="GuardrailAssessmentListMap",Ef="GuardrailAssessmentMap",vf="GuardrailAutomatedReasoningDifferenceScenarioList",bf="GuardrailAutomatedReasoningFinding",Af="GuardrailAutomatedReasoningFindingList",Cf="GuardrailAutomatedReasoningImpossibleFinding",Tf="GuardrailAutomatedReasoningInvalidFinding",Rf="GuardrailAutomatedReasoningInputTextReference",If="GuardrailAutomatedReasoningInputTextReferenceList",_f="GuardrailAutomatedReasoningLogicWarning",kf="GuardrailAutomatedReasoningNoTranslationsFinding",Mf="GuardrailAutomatedReasoningPolicyAssessment",Df="GuardrailAutomatedReasoningRule",Pf="GuardrailAutomatedReasoningRuleList",Nf="GuardrailAutomatedReasoningScenario",Bf="GuardrailAutomatedReasoningSatisfiableFinding",Of="GuardrailAutomatedReasoningStatementList",Lf="GuardrailAutomatedReasoningStatementLogicContent",Uf="GuardrailAutomatedReasoningStatementNaturalLanguageContent",$f="GuardrailAutomatedReasoningStatement",Gf="GuardrailAutomatedReasoningTranslation",Ff="GuardrailAutomatedReasoningTranslationAmbiguousFinding",Hf="GuardrailAutomatedReasoningTooComplexFinding",qf="GuardrailAutomatedReasoningTranslationList",zf="GuardrailAutomatedReasoningTranslationOption",jf="GuardrailAutomatedReasoningTranslationOptionList",Vf="GuardrailAutomatedReasoningValidFinding",Wf="GuardrailConfiguration",Yf="GuardrailContentBlock",Kf="GuardrailContentBlockList",Xf="GuardrailConverseContentBlock",Jf="GuardrailContentFilter",Qf="GuardrailContentFilterList",Zf="GuardrailContextualGroundingFilter",eh="GuardrailContextualGroundingFilters",th="GuardrailContextualGroundingPolicyAssessment",rh="GuardrailConverseImageBlock",nh="GuardrailConverseImageSource",sh="GuardrailContentPolicyAssessment",oh="GuardrailConverseTextBlock",ih="GuardrailCustomWord",ah="GuardrailCustomWordList",ch="GuardrailCoverage",lh="GuardrailImageBlock",dh="GuardrailImageCoverage",uh="GuardrailInvocationMetrics",ph="GuardrailImageSource",mh="GuardrailManagedWord",fh="GuardrailManagedWordList",hh="GuardrailOutputContent",gh="GuardrailOutputContentList",yh="GuardrailPiiEntityFilter",Sh="GuardrailPiiEntityFilterList",xh="GuardrailRegexFilter",wh="GuardrailRegexFilterList",Eh="GuardrailStreamConfiguration",vh="GuardrailSensitiveInformationPolicyAssessment",bh="GuardrailTopic",Ah="GuardrailTraceAssessment",Ch="GuardrailTextBlock",Th="GuardrailTextCharactersCoverage",Rh="GuardrailTopicList",Ih="GuardrailTopicPolicyAssessment",_h="GuardrailUsage",kh="GuardrailWordPolicyAssessment",Mh="ImageBlock",Dh="ImageBlockDelta",Ph="ImageBlockStart",Nh="InferenceConfiguration",Bh="InvokeModel",Oh="InvokeModelRequest",Lh="InvokeModelResponse",Uh="InvokeModelTokensRequest",$h="InvokeModelWithBidirectionalStream",Gh="InvokeModelWithBidirectionalStreamInput",Fh="InvokeModelWithBidirectionalStreamOutput",Hh="InvokeModelWithBidirectionalStreamRequest",qh="InvokeModelWithBidirectionalStreamResponse",zh="InvokeModelWithResponseStream",jh="InvokeModelWithResponseStreamRequest",Vh="InvokeModelWithResponseStreamResponse",Wh="ImageSource",Yh="InternalServerException",Kh="ListAsyncInvokes",Xh="ListAsyncInvokesRequest",Jh="ListAsyncInvokesResponse",Qh="Message",Zh="ModelErrorException",eg="ModelInputPayload",tg="ModelNotReadyException",rg="MessageStartEvent",ng="ModelStreamErrorException",sg="MessageStopEvent",og="ModelTimeoutException",ig="Messages",ag="PartBody",cg="PerformanceConfiguration",lg="PayloadPart",dg="PromptRouterTrace",ug="PromptVariableMap",pg="PromptVariableValues",mg="ReasoningContentBlock",fg="ReasoningContentBlockDelta",hg="RequestMetadata",gg="ResourceNotFoundException",yg="ResponseStream",Sg="ReasoningTextBlock",xg="StartAsyncInvoke",wg="StartAsyncInvokeRequest",Eg="StartAsyncInvokeResponse",vg="SystemContentBlocks",bg="SystemContentBlock",Ag="S3Location",Cg="ServiceQuotaExceededException",Tg="SearchResultBlock",Rg="SearchResultContentBlock",Ig="SearchResultContentBlocks",_g="SearchResultLocation",kg="ServiceTier",Mg="SpecificToolChoice",Dg="SystemTool",Pg="ServiceUnavailableException",Ng="Tag",Bg="ToolConfiguration",Og="ToolChoice",Lg="ThrottlingException",Ug="ToolInputSchema",$g="TagList",Gg="ToolResultBlock",Fg="ToolResultBlocksDelta",Hg="ToolResultBlockDelta",qg="ToolResultBlockStart",zg="ToolResultContentBlocks",jg="ToolResultContentBlock",Vg="ToolSpecification",Wg="TokenUsage",Yg="ToolUseBlock",Kg="ToolUseBlockDelta",Xg="ToolUseBlockStart",Jg="Tools",Qg="Tool",Zg="VideoBlock",ey="ValidationException",ty="VideoSource",ry="WebLocation",ny="X-Amzn-Bedrock-Accept",sy="X-Amzn-Bedrock-Content-Type",Ml="X-Amzn-Bedrock-GuardrailIdentifier",Dl="X-Amzn-Bedrock-GuardrailVersion",gn="X-Amzn-Bedrock-PerformanceConfig-Latency",yn="X-Amzn-Bedrock-Service-Tier",Pl="X-Amzn-Bedrock-Trace",Me="action",oy="appliedGuardrailDetails",iy="asyncInvokeSummaries",Js="additionalModelRequestFields",Nl="additionalModelResponseFieldPaths",Bl="additionalModelResponseFields",Ol="actionReason",ay="automatedReasoningPolicy",cy="automatedReasoningPolicyUnits",ly="automatedReasoningPolicies",Ll="accept",dy="any",uy="assessments",py="audio",my="auto",we="bytes",Ul="bucketOwner",Xe="body",me="client",fy="contentBlockDelta",Qs="contentBlockIndex",hy="contentBlockStart",gy="contentBlockStop",yy="citationsContent",Sy="claimsFalseScenario",xy="contextualGroundingPolicy",wy="contextualGroundingPolicyUnits",Ey="contentPolicy",vy="contentPolicyImageUnits",by="contentPolicyUnits",Zs="cachePoint",$l="contradictingRules",Ay="cacheReadInputTokens",eo="clientRequestToken",Sn="contentType",Gl="claimsTrueScenario",Cy="customWords",Ty="cacheWriteInputTokens",to="chunk",ro="citations",Ry="citation",Fl="claims",gt="content",Iy="context",Hl="confidence",_y="converse",ky="delta",My="documentChar",Dy="documentChunk",no="documentIndex",Py="documentPage",Ny="differenceScenarios",Je="detected",By="description",Oy="domain",ql="document",H="error",zl="endTime",Ly="enabled",xn="end",Qe="format",jl="failureMessage",Uy="filterStrength",$y="findings",Vl="filters",Wl="guardrail",Gy="guardrailArn",Yl="guardrailCoverage",Kl="guardrailConfig",Xl="guardContent",Fy="guardrailId",Ot="guardrailIdentifier",Hy="guardrailOrigin",qy="guardrailOwnership",zy="guardrailProcessingLatency",yt="guardrailVersion",Jl="guarded",fe="http",Z="httpError",D="httpHeader",Ke="httpQuery",so="input",wn="invocationArn",jy="inputAssessment",Ql="inferenceConfig",Vy="invocationMetrics",Wy="invokedModelId",Yy="invokeModel",Ky="inputSchema",oo="internalServerException",Zl="inputTokens",Xy="identifier",Jy="images",St="image",Qy="impossible",Zy="invalid",io="json",eS="key",tS="kmsKeyId",ed="location",td="latencyMs",rd="lastModifiedTime",En="logicWarning",rS="latency",nS="logic",W="message",nd="modelArn",Ze="modelId",sS="modelInput",oS="modelOutput",Al="maxResults",iS="messageStart",ao="modelStreamErrorException",aS="messageStop",cS="maxTokens",sd="modelTimeoutException",lS="managedWordLists",vn="match",co="messages",od="metrics",dS="metadata",De="name",uS="naturalLanguage",Ks="nextToken",pS="noTranslations",mS="outputs",fS="outputAssessments",lo="outputDataConfig",hS="originalMessage",gS="outputScope",id="originalStatusCode",yS="outputTokens",SS="options",xS="output",ad="premises",bn="performanceConfig",An="performanceConfigLatency",wS="piiEntities",cd="promptRouter",ld="promptVariables",ES="policyVersionArn",dd="qualifiers",vS="regex",ud="reasoningContent",pd="redactedContent",md="requestMetadata",bS="resourceName",AS="reasoningText",CS="regexes",fd="role",oe="source",Cl="sortBy",hd="sourceContent",Tl="statusEquals",TS="sensitiveInformationPolicy",RS="sensitiveInformationPolicyFreeUnits",IS="sensitiveInformationPolicyUnits",Cn="s3Location",Rl="sortOrder",_S="s3OutputDataConfig",kS="streamProcessingMode",gd="stopReason",MS="searchResultIndex",DS="searchResultLocation",yd="searchResult",PS="supportingRules",NS="stopSequences",Sd="submitTime",Il="submitTimeAfter",_l="submitTimeBefore",Pe="serviceTier",BS="systemTool",OS="s3Uri",uo="serviceUnavailableException",LS="satisfiable",US="score",xd="server",wd="signature",Ed="smithy.ts.sdk.synthetic.com.amazonaws.bedrockruntime",Tn="status",Lt="start",$S="statements",GS="stream",Rn="streaming",po="system",ee="type",FS="translationAmbiguous",mo="toolConfig",HS="textCharacters",qS="toolChoice",zS="tooComplex",fo="throttlingException",jS="topicPolicy",VS="topicPolicyUnits",WS="topP",ho="toolResult",YS="toolSpec",KS="totalTokens",go="toolUse",In="toolUseId",XS="tags",P="text",JS="temperature",QS="threshold",yo="title",vd="total",ZS="tools",ex="tool",tx="topics",xt="trace",_n="translation",rx="translations",kn="usage",nx="untranslatedClaims",sx="untranslatedPremises",ox="uri",ix="url",ax="value",So="validationException",cx="valid",bd="video",lx="web",dx="wordPolicy",ux="wordPolicyUnits",f="com.amazonaws.bedrockruntime",Ad=[0,f,dm,8,0],Mn=[0,f,Sm,8,21],px=[0,f,Lf,8,0],Cd=[0,f,Uf,8,0],mx=[0,f,eg,8,15],xo=[0,f,ag,8,21],fx=[-3,f,om,{[H]:me,[Z]:403},[W],[0]];k.for(f).registerError(fx,rn);var hx=[3,f,gm,0,[],[]],gx=[3,f,am,0,[Fy,yt,Gy,Hy,qy],[0,0,0,64,0]],yx=[3,f,cm,0,[Ot,yt,oe,gt,gS],[[0,1],[0,1],0,[()=>EE,0],0]],Sx=[3,f,lm,0,[kn,Me,Ol,mS,uy,Yl],[()=>Md,0,0,()=>TE,[()=>$d,0],()=>_d]],xx=[3,f,mm,0,[OS,tS,Ul],[0,0,0]],wx=[3,f,pm,0,[wn,nd,eo,Tn,jl,Sd,rd,zl,lo],[0,0,0,0,[()=>Ad,0],5,5,5,()=>Ro]],Ex=[3,f,sm,0,[Qe,oe,H],[0,[()=>LE,0],[()=>Eo,0]]],vx=[3,f,ym,0,[],[]],bx=[3,f,xm,8,[we],[[()=>xo,0]]],Ax=[3,f,wm,8,[we],[[()=>xo,0]]],wo=[3,f,Um,0,[ee],[0]],Cx=[3,f,Em,0,[yo,oe,hd,ed],[0,0,()=>mE,()=>Hd]],Td=[3,f,_m,0,[Ly],[2]],Tx=[3,f,km,0,[gt,ro],[()=>uE,()=>pE]],Rx=[3,f,Mm,0,[yo,oe,hd,ed],[0,0,()=>fE,()=>Hd]],Ix=[3,f,qm,0,[P],[0]],_x=[-3,f,Dm,{[H]:me,[Z]:400},[W],[0]];k.for(f).registerError(_x,an);var kx=[3,f,Am,0,[ky,Qs],[[()=>FE,0],1]],Mx=[3,f,Tm,0,[Lt,Qs],[()=>HE,1]],Dx=[3,f,Rm,0,[Qs],[1]],Px=[3,f,Om,0,[td],[1]],Nx=[3,f,$m,0,[Ze,co,po,Ql,mo,Kl,Js,ld,Nl,md,bn,Pe],[[0,1],[()=>Co,0],[()=>To,0],()=>Pd,()=>bo,()=>cw,15,[()=>Gd,0],64,[()=>Fd,0],()=>Bn,()=>Ln]],Bx=[3,f,Gm,0,[xS,gd,kn,od,Bl,xt,bn,Pe],[[()=>qE,0],0,()=>Ld,()=>Px,15,[()=>Hx,0],()=>Bn,()=>Ln]],Ox=[3,f,Wm,0,[kn,od,xt,bn,Pe],[()=>Ld,()=>Lx,[()=>Gx,0],()=>Bn,()=>Ln]],Lx=[3,f,Vm,0,[td],[1]],Ux=[3,f,Km,0,[Ze,co,po,Ql,mo,Kl,Js,ld,Nl,md,bn,Pe],[[0,1],[()=>Co,0],[()=>To,0],()=>Pd,()=>bo,()=>Aw,15,[()=>Gd,0],64,[()=>Fd,0],()=>Bn,()=>Ln]],$x=[3,f,Xm,0,[GS],[[()=>zE,16]]],Gx=[3,f,Jm,0,[Wl,cd],[[()=>kd,0],()=>Bd]],Fx=[3,f,ef,0,[co,po,mo,Js],[[()=>Co,0],[()=>To,0],()=>bo,15]],Hx=[3,f,Qm,0,[Wl,cd],[[()=>kd,0],()=>Bd]],qx=[3,f,tf,0,[Ze,so],[[0,1],[()=>jE,0]]],zx=[3,f,rf,0,[Zl],[1]],Rd=[3,f,af,0,[Qe,De,oe,Iy,ro],[0,0,()=>WE,0,()=>Td]],jx=[3,f,df,0,[no,Lt,xn],[1,1,1]],Vx=[3,f,uf,0,[no,Lt,xn],[1,1,1]],Wx=[3,f,pf,0,[no,Lt,xn],[1,1,1]],Eo=[3,f,ff,8,[W],[0]],Yx=[3,f,yf,0,[wn],[[0,1]]],Kx=[3,f,Sf,0,[wn,nd,eo,Tn,jl,Sd,rd,zl,lo],[0,0,0,0,[()=>Ad,0],5,5,5,()=>Ro]],Id=[3,f,hf,0,[jS,Ey,dx,TS,xy,ay,Vy,oy],[()=>Iw,()=>dw,()=>_w,()=>bw,()=>pw,[()=>ew,0],()=>Sw,()=>gx]],Xx=[3,f,Cf,0,[_n,$l,En],[[()=>Ut,0],()=>Ao,[()=>Dn,0]]],Jx=[3,f,Rf,0,[P],[[()=>Cd,0]]],Qx=[3,f,Tf,0,[_n,$l,En],[[()=>Ut,0],()=>Ao,[()=>Dn,0]]],Dn=[3,f,_f,0,[ee,ad,Fl],[0,[()=>Bt,0],[()=>Bt,0]]],Zx=[3,f,kf,0,[],[]],ew=[3,f,Mf,0,[$y],[[()=>SE,0]]],tw=[3,f,Df,0,[Xy,ES],[0,0]],rw=[3,f,Bf,0,[_n,Gl,Sy,En],[[()=>Ut,0],[()=>hn,0],[()=>hn,0],[()=>Dn,0]]],hn=[3,f,Nf,0,[$S],[[()=>Bt,0]]],nw=[3,f,$f,0,[nS,uS],[[()=>px,0],[()=>Cd,0]]],sw=[3,f,Hf,0,[],[]],Ut=[3,f,Gf,0,[ad,Fl,sx,nx,Hl],[[()=>Bt,0],[()=>Bt,0],[()=>kl,0],[()=>kl,0],1]],ow=[3,f,Ff,0,[SS,Ny],[[()=>wE,0],[()=>yE,0]]],iw=[3,f,zf,0,[rx],[[()=>xE,0]]],aw=[3,f,Vf,0,[_n,Gl,PS,En],[[()=>Ut,0],[()=>hn,0],()=>Ao,[()=>Dn,0]]],cw=[3,f,Wf,0,[Ot,yt,xt],[0,0,0]],lw=[3,f,Jf,0,[ee,Hl,Uy,Me,Je],[0,0,0,0,2]],dw=[3,f,sh,0,[Vl],[()=>vE]],uw=[3,f,Zf,0,[ee,QS,US,Me,Je],[0,1,1,0,2]],pw=[3,f,th,0,[Vl],[()=>bE]],mw=[3,f,rh,8,[Qe,oe],[0,[()=>XE,0]]],fw=[3,f,oh,0,[P,dd],[0,64]],_d=[3,f,ch,0,[HS,Jy],[()=>Tw,()=>yw]],hw=[3,f,ih,0,[vn,Me,Je],[0,0,2]],gw=[3,f,lh,8,[Qe,oe],[0,[()=>JE,0]]],yw=[3,f,dh,0,[Jl,vd],[1,1]],Sw=[3,f,uh,0,[zy,kn,Yl],[1,()=>Md,()=>_d]],xw=[3,f,mh,0,[vn,ee,Me,Je],[0,0,0,2]],ww=[3,f,hh,0,[P],[0]],Ew=[3,f,yh,0,[vn,ee,Me,Je],[0,0,0,2]],vw=[3,f,xh,0,[De,vn,vS,Me,Je],[0,0,0,0,2]],bw=[3,f,vh,0,[wS,CS],[()=>RE,()=>IE]],Aw=[3,f,Eh,0,[Ot,yt,xt,kS],[0,0,0,0]],Cw=[3,f,Ch,0,[P,dd],[0,64]],Tw=[3,f,Th,0,[Jl,vd],[1,1]],Rw=[3,f,bh,0,[De,ee,Me,Je],[0,0,0,2]],Iw=[3,f,Ih,0,[tx],[()=>_E]],kd=[3,f,Ah,0,[oS,jy,fS,Ol],[64,[()=>OE,0],[()=>BE,0],0]],Md=[3,f,_h,0,[VS,by,ux,IS,RS,wy,vy,cy,ly],[1,1,1,1,1,1,1,1,1]],_w=[3,f,kh,0,[Cy,lS],[()=>AE,()=>CE]],Dd=[3,f,Mh,0,[Qe,oe,H],[0,[()=>zd,0],[()=>Eo,0]]],kw=[3,f,Dh,0,[oe,H],[[()=>zd,0],[()=>Eo,0]]],Mw=[3,f,Ph,0,[Qe],[0]],Pd=[3,f,Nh,0,[cS,JS,WS,NS],[1,1,1,64]],Pn=[-3,f,Yh,{[H]:xd,[Z]:500},[W],[0]];k.for(f).registerError(Pn,nn);var Dw=[3,f,Oh,0,[Xe,Sn,Ll,Ze,xt,Ot,yt,An,Pe],[[()=>Mn,16],[0,{[D]:Xs}],[0,{[D]:nm}],[0,1],[0,{[D]:Pl}],[0,{[D]:Ml}],[0,{[D]:Dl}],[0,{[D]:gn}],[0,{[D]:yn}]]],Pw=[3,f,Lh,0,[Xe,Sn,An,Pe],[[()=>Mn,16],[0,{[D]:Xs}],[0,{[D]:gn}],[0,{[D]:yn}]]],Nw=[3,f,Uh,0,[Xe],[[()=>Mn,0]]],Bw=[3,f,Hh,0,[Ze,Xe],[[0,1],[()=>QE,16]]],Ow=[3,f,qh,0,[Xe],[[()=>ZE,16]]],Lw=[3,f,jh,0,[Xe,Sn,Ll,Ze,xt,Ot,yt,An,Pe],[[()=>Mn,16],[0,{[D]:Xs}],[0,{[D]:ny}],[0,1],[0,{[D]:Pl}],[0,{[D]:Ml}],[0,{[D]:Dl}],[0,{[D]:gn}],[0,{[D]:yn}]]],Uw=[3,f,Vh,0,[Xe,Sn,An,Pe],[[()=>n0,16],[0,{[D]:sy}],[0,{[D]:gn}],[0,{[D]:yn}]]],$w=[3,f,Xh,0,[Il,_l,Tl,Al,Ks,Cl,Rl],[[5,{[Ke]:Il}],[5,{[Ke]:_l}],[0,{[Ke]:Tl}],[1,{[Ke]:Al}],[0,{[Ke]:Ks}],[0,{[Ke]:Cl}],[0,{[Ke]:Rl}]]],Gw=[3,f,Jh,0,[Ks,iy],[0,[()=>dE,0]]],Nd=[3,f,Qh,0,[fd,gt],[0,[()=>hE,0]]],Fw=[3,f,rg,0,[fd],[0]],Hw=[3,f,sg,0,[gd,Bl],[0,15]],qw=[-3,f,Zh,{[H]:me,[Z]:424},[W,id,bS],[0,1,0]];k.for(f).registerError(qw,un);var zw=[-3,f,tg,{[H]:me,[Z]:429},[W],[0]];k.for(f).registerError(zw,pn);var Nn=[-3,f,ng,{[H]:me,[Z]:424},[W,id,hS],[0,1,0]];k.for(f).registerError(Nn,fn);var vo=[-3,f,og,{[H]:me,[Z]:408},[W],[0]];k.for(f).registerError(vo,mn);var jw=[3,f,lg,8,[we],[[()=>xo,0]]],Bn=[3,f,cg,0,[rS],[0]],Bd=[3,f,dg,0,[Wy],[0]],Vw=[3,f,Sg,8,[P,wd],[0,0]],Ww=[-3,f,gg,{[H]:me,[Z]:404},[W],[0]];k.for(f).registerError(Ww,cn);var On=[3,f,Ag,0,[ox,Ul],[0,0]],Od=[3,f,Tg,0,[oe,yo,gt,ro],[0,0,()=>kE,()=>Td]],Yw=[3,f,Rg,0,[P],[0]],Kw=[3,f,_g,0,[MS,Lt,xn],[1,1,1]],Xw=[-3,f,Cg,{[H]:me,[Z]:400},[W],[0]];k.for(f).registerError(Xw,ln);var Ln=[3,f,kg,0,[ee],[0]],Un=[-3,f,Pg,{[H]:xd,[Z]:503},[W],[0]];k.for(f).registerError(Un,dn);var Jw=[3,f,Mg,0,[De],[0]],Qw=[3,f,wg,0,[eo,Ze,sS,lo,XS],[[0,4],0,[()=>mx,0],()=>Ro,()=>ME]],Zw=[3,f,Eg,0,[wn],[0]],eE=[3,f,Dg,0,[De],[0]],tE=[3,f,Ng,0,[eS,ax],[0,0]],$n=[-3,f,Lg,{[H]:me,[Z]:429},[W],[0]];k.for(f).registerError($n,sn);var Ld=[3,f,Wg,0,[Zl,yS,KS,Ay,Ty],[1,1,1,1,1]],bo=[3,f,Bg,0,[ZS,qS],[()=>NE,()=>i0]],rE=[3,f,Gg,0,[In,gt,Tn,ee],[0,[()=>PE,0],0,0]],nE=[3,f,qg,0,[In,ee,Tn],[0,0,0]],sE=[3,f,Vg,0,[De,By,Ky],[0,0,()=>a0]],oE=[3,f,Yg,0,[In,De,so,ee],[0,0,15,0]],iE=[3,f,Kg,0,[so],[0]],aE=[3,f,Xg,0,[In,De,ee],[0,0,0]],Gn=[-3,f,ey,{[H]:me,[Z]:400},[W],[0]];k.for(f).registerError(Gn,on);var Ud=[3,f,Zg,0,[Qe,oe],[0,()=>d0]],cE=[3,f,ry,0,[ix,Oy],[0,0]],lE=[-3,Ed,"BedrockRuntimeServiceException",0,[],[]];k.for(Ed).registerError(lE,O);var dE=[1,f,fm,0,[()=>wx,0]],uE=[1,f,Nm,0,()=>UE],pE=[1,f,sf,0,()=>Cx],mE=[1,f,zm,0,()=>$E],fE=[1,f,jm,0,()=>Ix],hE=[1,f,vm,0,[()=>GE,0]],gE=[1,f,cf,0,()=>VE],$d=[1,f,xf,0,[()=>Id,0]],yE=[1,f,vf,0,[()=>hn,0]],SE=[1,f,Af,0,[()=>YE,0]],kl=[1,f,If,0,[()=>Jx,0]],Ao=[1,f,Pf,0,()=>tw],Bt=[1,f,Of,0,[()=>nw,0]],xE=[1,f,qf,0,[()=>Ut,0]],wE=[1,f,jf,0,[()=>iw,0]],EE=[1,f,Kf,0,[()=>KE,0]],vE=[1,f,Qf,0,()=>lw];var bE=[1,f,eh,0,()=>uw];var AE=[1,f,ah,0,()=>hw],CE=[1,f,fh,0,()=>xw];var TE=[1,f,gh,0,()=>ww],RE=[1,f,Sh,0,()=>Ew],IE=[1,f,wh,0,()=>vw],_E=[1,f,Rh,0,()=>Rw],Co=[1,f,ig,0,[()=>Nd,0]];var kE=[1,f,Ig,0,()=>Yw],To=[1,f,vg,0,[()=>s0,0]],ME=[1,f,$g,0,()=>tE],DE=[1,f,Fg,0,()=>c0],PE=[1,f,zg,0,[()=>l0,0]],NE=[1,f,Jg,0,()=>o0],BE=[2,f,wf,0,[0,0],[()=>$d,0]],OE=[2,f,Ef,0,[0,0],[()=>Id,0]],Gd=[2,f,ug,8,0,()=>e0],Fd=[2,f,hg,8,0,0],Ro=[3,f,um,0,[_S],[()=>xx]],LE=[3,f,hm,8,[we,Cn],[21,()=>On]],UE=[3,f,Pm,0,[P],[0]],Hd=[3,f,Bm,0,[lx,My,Py,Dy,DS],[()=>cE,()=>jx,()=>Wx,()=>Vx,()=>Kw]],$E=[3,f,Hm,0,[P],[0]],GE=[3,f,Im,0,[P,St,ql,bd,py,go,ho,Xl,Zs,ud,yy,yd],[0,[()=>Dd,0],()=>Rd,()=>Ud,[()=>Ex,0],()=>oE,[()=>rE,0],[()=>qd,0],()=>wo,[()=>t0,0],()=>Tx,()=>Od]],FE=[3,f,bm,0,[P,go,ho,ud,Ry,St],[0,()=>iE,()=>DE,[()=>r0,0],()=>Rx,[()=>kw,0]]],HE=[3,f,Cm,0,[go,ho,St],[()=>aE,()=>nE,()=>Mw]],qE=[3,f,Lm,0,[W],[[()=>Nd,0]]],zE=[3,f,Ym,{[Rn]:1},[iS,hy,fy,gy,aS,dS,oo,ao,So,fo,uo],[()=>Fw,()=>Mx,[()=>kx,0],()=>Dx,()=>Hw,[()=>Ox,0],[()=>Pn,0],[()=>Nn,0],[()=>Gn,0],[()=>$n,0],[()=>Un,0]]],jE=[3,f,Zm,0,[Yy,_y],[[()=>Nw,0],[()=>Fx,0]]],VE=[3,f,lf,0,[P],[0]],WE=[3,f,mf,0,[we,Cn,P,gt],[21,()=>On,0,()=>gE]],YE=[3,f,bf,0,[cx,Zy,LS,Qy,FS,zS,pS],[[()=>aw,0],[()=>Qx,0],[()=>rw,0],[()=>Xx,0],[()=>ow,0],()=>sw,()=>Zx]],KE=[3,f,Yf,0,[P,St],[()=>Cw,[()=>gw,0]]],qd=[3,f,Xf,0,[P,St],[()=>fw,[()=>mw,0]]],XE=[3,f,nh,8,[we],[21]],JE=[3,f,ph,8,[we],[21]],zd=[3,f,Wh,8,[we,Cn],[21,()=>On]],QE=[3,f,Gh,{[Rn]:1},[to],[[()=>bx,0]]],ZE=[3,f,Fh,{[Rn]:1},[to,oo,ao,So,fo,sd,uo],[[()=>Ax,0],[()=>Pn,0],[()=>Nn,0],[()=>Gn,0],[()=>$n,0],[()=>vo,0],[()=>Un,0]]],e0=[3,f,pg,0,[P],[0]],t0=[3,f,mg,8,[AS,pd],[[()=>Vw,0],21]],r0=[3,f,fg,8,[P,pd,wd],[0,21,0]],n0=[3,f,yg,{[Rn]:1},[to,oo,ao,So,fo,sd,uo],[[()=>jw,0],[()=>Pn,0],[()=>Nn,0],[()=>Gn,0],[()=>$n,0],[()=>vo,0],[()=>Un,0]]],s0=[3,f,bg,0,[P,Xl,Zs],[0,[()=>qd,0],()=>wo]],o0=[3,f,Qg,0,[YS,BS,Zs],[()=>sE,()=>eE,()=>wo]],i0=[3,f,Og,0,[my,dy,ex],[()=>vx,()=>hx,()=>Jw]],a0=[3,f,Ug,0,[io],[15]],c0=[3,f,Hg,0,[P,io],[0,15]],l0=[3,f,jg,0,[io,P,St,ql,bd,yd],[15,0,[()=>Dd,0],()=>Rd,()=>Ud,()=>Od]],d0=[3,f,ty,0,[we,Cn],[21,()=>On]],uN=[9,f,im,{[fe]:["POST","/guardrail/{guardrailIdentifier}/version/{guardrailVersion}/apply",200]},()=>yx,()=>Sx],pN=[9,f,of,{[fe]:["POST","/model/{modelId}/converse",200]},()=>Nx,()=>Bx],mN=[9,f,Fm,{[fe]:["POST","/model/{modelId}/converse-stream",200]},()=>Ux,()=>$x],fN=[9,f,nf,{[fe]:["POST","/model/{modelId}/count-tokens",200]},()=>qx,()=>zx],hN=[9,f,gf,{[fe]:["GET","/async-invoke/{invocationArn}",200]},()=>Yx,()=>Kx],jd=[9,f,Bh,{[fe]:["POST","/model/{modelId}/invoke",200]},()=>Dw,()=>Pw],gN=[9,f,$h,{[fe]:["POST","/model/{modelId}/invoke-with-bidirectional-stream",200]},()=>Bw,()=>Ow],Vd=[9,f,zh,{[fe]:["POST","/model/{modelId}/invoke-with-response-stream",200]},()=>Lw,()=>Uw],yN=[9,f,Kh,{[fe]:["GET","/async-invoke",200]},()=>$w,()=>Gw],SN=[9,f,xg,{[fe]:["POST","/async-invoke",200]},()=>Qw,()=>Zw];var $t=class extends je.classBuilder().ep(en).m(function(e,t,n,s){return[Yr(n,e.getEndpointParameterInstructions())]}).s("AmazonBedrockFrontendService","InvokeModel",{}).n("BedrockRuntimeClient","InvokeModelCommand").sc(jd).build(){};var Fn=class extends je.classBuilder().ep(en).m(function(e,t,n,s){return[Yr(n,e.getEndpointParameterInstructions())]}).s("AmazonBedrockFrontendService","InvokeModelWithResponseStream",{eventStream:{output:!0}}).n("BedrockRuntimeClient","InvokeModelWithResponseStreamCommand").sc(Vd).build(){};var Hn=class{constructor(e){this.client=null;this.settings=e,this.initializeClient()}initializeClient(){if(!this.settings.awsAccessKeyId||!this.settings.awsSecretAccessKey){this.client=null;return}let e={accessKeyId:this.settings.awsAccessKeyId,secretAccessKey:this.settings.awsSecretAccessKey};this.settings.awsSessionToken&&(e.sessionToken=this.settings.awsSessionToken),this.client=new tn({region:this.settings.awsRegion,credentials:e})}reinitialize(e){this.settings=e,this.initializeClient()}isInitialized(){return this.client!==null}async testConnection(){if(!this.client)return{success:!1,message:"Client not initialized. Please configure AWS credentials."};try{let e={anthropic_version:"bedrock-2023-05-31",max_tokens:10,temperature:0,system:"Reply with 'OK'",messages:[{role:"user",content:"Test"}]},t=new $t({modelId:this.settings.bedrockModelId,contentType:"application/json",accept:"application/json",body:JSON.stringify(e)}),n=await this.client.send(t),s=JSON.parse(new TextDecoder().decode(n.body));return s.content&&s.content.length>0?{success:!0,message:"Connection successful"}:{success:!1,message:"Unexpected response format"}}catch(e){return{success:!1,message:this.parseError(e),error:e instanceof Error?e:new Error(String(e))}}}async sendMessage(e,t){if(!this.client)throw new Error("Bedrock client not initialized. Please configure AWS credentials.");let n=this.convertToBedrockFormat(e),s={anthropic_version:"bedrock-2023-05-31",max_tokens:this.settings.maxTokens,temperature:this.settings.temperature,system:t,messages:n},o=new $t({modelId:this.settings.bedrockModelId,contentType:"application/json",accept:"application/json",body:JSON.stringify(s)});try{let i=await this.client.send(o),a=JSON.parse(new TextDecoder().decode(i.body));if(a.content&&a.content.length>0)return a.content.filter(c=>c.type==="text").map(c=>c.text).join("");throw new Error("Empty response from Bedrock")}catch(i){throw new Error(this.parseError(i))}}async*sendMessageStream(e,t){var i,a,c,l,u;if(!this.client)throw new Error("Bedrock client not initialized. Please configure AWS credentials.");let n=this.convertToBedrockFormat(e),s={anthropic_version:"bedrock-2023-05-31",max_tokens:this.settings.maxTokens,temperature:this.settings.temperature,system:t,messages:n},o=new Fn({modelId:this.settings.bedrockModelId,contentType:"application/json",accept:"application/json",body:JSON.stringify(s)});try{let d=await this.client.send(o);if(!d.body)throw new Error("No response body received");for await(let p of d.body)if((i=p.chunk)!=null&&i.bytes){let m=JSON.parse(new TextDecoder().decode(p.chunk.bytes));if(m.type==="content_block_delta")((a=m.delta)==null?void 0:a.type)==="text_delta"&&((c=m.delta)!=null&&c.text)&&(yield m.delta.text);else if(m.type==="message_delta"){if((l=m.delta)!=null&&l.stop_reason)return}else if(m.type==="error")throw new Error(((u=m.error)==null?void 0:u.message)||"Stream error")}}catch(d){throw new Error(this.parseError(d))}}convertToBedrockFormat(e){let t=[];for(let n of e)n.role!=="system"&&t.push({role:n.role,content:n.content});return t}parseError(e){if(e instanceof Error){let t=e.name,n=e.message;switch(t){case"AccessDeniedException":return"Access denied. Check your AWS credentials and model access permissions.";case"ValidationException":return`Validation error: ${n}`;case"ThrottlingException":return"Request throttled. Please wait and try again.";case"ServiceQuotaExceededException":return"Service quota exceeded. Please check your Bedrock limits.";case"ModelNotReadyException":return"Model is not ready. Please wait and try again.";case"ModelTimeoutException":return"Model request timed out. Please try again.";case"ModelErrorException":return`Model error: ${n}`;case"ResourceNotFoundException":return"Model not found. Ensure the model is enabled in your AWS region.";case"UnauthorizedException":case"CredentialsProviderError":return"Authentication failed. Please check your AWS credentials.";case"NetworkingError":case"TimeoutError":return"Network error. Please check your internet connection.";default:return n||"An unknown error occurred"}}return String(e)}getModelId(){return this.settings.bedrockModelId}getRegion(){return this.settings.awsRegion}};var Wd=require("obsidian"),qn=class{constructor(e){this.baseUrl="https://generativelanguage.googleapis.com/v1beta";this.settings=e}reinitialize(e){this.settings=e}isInitialized(){return!!this.settings.geminiApiKey}async testConnection(){if(!this.settings.geminiApiKey)return{success:!1,message:"Gemini API key is not configured"};try{return await this.sendMessage([{role:"user",content:"Reply with 'OK'"}],"Reply with 'OK'")?{success:!0,message:"Connection successful"}:{success:!1,message:"Unexpected response format"}}catch(e){return{success:!1,message:this.parseError(e),error:e instanceof Error?e:new Error(String(e))}}}async sendMessage(e,t){var i,a;if(!this.settings.geminiApiKey)throw new Error("Gemini API key is not configured");let s={contents:this.convertToGeminiFormat(e),generationConfig:{maxOutputTokens:this.settings.maxTokens,temperature:this.settings.temperature}};t&&(s.systemInstruction={parts:[{text:t}]});let o=`${this.baseUrl}/models/${this.settings.geminiModelId}:generateContent?key=${this.settings.geminiApiKey}`;try{let l=(await(0,Wd.requestUrl)({url:o,method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})).json;if(l.candidates&&l.candidates.length>0){let u=l.candidates[0];if(((a=(i=u.content)==null?void 0:i.parts)==null?void 0:a.length)>0)return u.content.parts.map(d=>d.text).join("")}throw new Error("Empty response from Gemini")}catch(c){throw new Error(this.parseError(c))}}async*sendMessageStream(e,t){var i,a,c,l,u;if(!this.settings.geminiApiKey)throw new Error("Gemini API key is not configured");let s={contents:this.convertToGeminiFormat(e),generationConfig:{maxOutputTokens:this.settings.maxTokens,temperature:this.settings.temperature}};t&&(s.systemInstruction={parts:[{text:t}]});let o=`${this.baseUrl}/models/${this.settings.geminiModelId}:streamGenerateContent?key=${this.settings.geminiApiKey}&alt=sse`;try{let d=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!d.ok){let y=await d.text();throw new Error(`Gemini API error: ${d.status} - ${y}`)}if(!d.body)throw new Error("No response body");let p=d.body.getReader(),m=new TextDecoder,g="";for(;;){let{done:y,value:S}=await p.read();if(y)break;g+=m.decode(S,{stream:!0});let x=g.split(`
`);g=x.pop()||"";for(let w of x)if(w.startsWith("data: ")){let v=w.slice(6).trim();if(v&&v!=="[DONE]")try{let E=JSON.parse(v);(u=(l=(c=(a=(i=E.candidates)==null?void 0:i[0])==null?void 0:a.content)==null?void 0:c.parts)==null?void 0:l[0])!=null&&u.text&&(yield E.candidates[0].content.parts[0].text)}catch(E){}}}}catch(d){throw new Error(this.parseError(d))}}convertToGeminiFormat(e){let t=[];for(let n of e)n.role!=="system"&&t.push({role:n.role==="assistant"?"model":"user",parts:[{text:n.content}]});return t}parseError(e){if(e instanceof Error){let t=e.message;return t.includes("401")||t.includes("403")?"Authentication failed. Please check your Gemini API key.":t.includes("429")?"Rate limit exceeded. Please wait and try again.":t.includes("404")?"Model not found. Please check the model ID.":t.includes("500")||t.includes("503")?"Gemini service error. Please try again later.":t}return String(e)}};var Yd=require("obsidian"),zn=class{constructor(e){this.baseUrl="https://api.groq.com/openai/v1";this.settings=e}reinitialize(e){this.settings=e}isInitialized(){return!!this.settings.groqApiKey}async testConnection(){if(!this.settings.groqApiKey)return{success:!1,message:"Groq API key is not configured"};try{return await this.sendMessage([{role:"user",content:"Reply with 'OK'"}],"Reply with 'OK'")?{success:!0,message:"Connection successful"}:{success:!1,message:"Unexpected response format"}}catch(e){return{success:!1,message:this.parseError(e),error:e instanceof Error?e:new Error(String(e))}}}async sendMessage(e,t){if(!this.settings.groqApiKey)throw new Error("Groq API key is not configured");let n=this.convertToGroqFormat(e,t),s={model:this.settings.groqModelId,messages:n,max_tokens:this.settings.maxTokens,temperature:this.settings.temperature,stream:!1};try{let i=(await(0,Yd.requestUrl)({url:`${this.baseUrl}/chat/completions`,method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.settings.groqApiKey}`},body:JSON.stringify(s)})).json;if(i.choices&&i.choices.length>0)return i.choices[0].message.content;throw new Error("Empty response from Groq")}catch(o){throw new Error(this.parseError(o))}}async*sendMessageStream(e,t){var o,i,a;if(!this.settings.groqApiKey)throw new Error("Groq API key is not configured");let n=this.convertToGroqFormat(e,t),s={model:this.settings.groqModelId,messages:n,max_tokens:this.settings.maxTokens,temperature:this.settings.temperature,stream:!0};try{let c=await fetch(`${this.baseUrl}/chat/completions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.settings.groqApiKey}`},body:JSON.stringify(s)});if(!c.ok){let p=await c.text();throw new Error(`Groq API error: ${c.status} - ${p}`)}if(!c.body)throw new Error("No response body");let l=c.body.getReader(),u=new TextDecoder,d="";for(;;){let{done:p,value:m}=await l.read();if(p)break;d+=u.decode(m,{stream:!0});let g=d.split(`
`);d=g.pop()||"";for(let y of g)if(y.startsWith("data: ")){let S=y.slice(6).trim();if(S&&S!=="[DONE]")try{let x=JSON.parse(S);(a=(i=(o=x.choices)==null?void 0:o[0])==null?void 0:i.delta)!=null&&a.content&&(yield x.choices[0].delta.content)}catch(x){}}}}catch(c){throw new Error(this.parseError(c))}}convertToGroqFormat(e,t){let n=[];t&&n.push({role:"system",content:t});for(let s of e)s.role!=="system"&&n.push({role:s.role,content:s.content});return n}parseError(e){if(e instanceof Error){let t=e.message;return t.includes("401")?"Authentication failed. Please check your Groq API key.":t.includes("429")?"Rate limit exceeded. Please wait and try again.":t.includes("404")?"Model not found. Please check the model ID.":t.includes("400")?"Invalid request. Please check your message format.":t.includes("500")||t.includes("503")?"Groq service error. Please try again later.":t}return String(e)}};var jn=class{constructor(e){this.settings=e,this.bedrockService=new Hn(e),this.geminiService=new qn(e),this.groqService=new zn(e)}getActiveService(){switch(this.settings.provider){case"bedrock":return this.bedrockService;case"gemini":return this.geminiService;case"groq":return this.groqService;default:return this.bedrockService}}reinitialize(e){this.settings=e,this.bedrockService.reinitialize(e),this.geminiService.reinitialize(e),this.groqService.reinitialize(e)}isInitialized(){return this.getActiveService().isInitialized()}getCurrentProvider(){return this.settings.provider}getCurrentProviderName(){return ie[this.settings.provider]}async testConnection(){let e=this.getActiveService();return e.isInitialized()?await e.testConnection():{success:!1,message:`${this.getCurrentProviderName()} is not configured. Please add your credentials.`}}async testProviderConnection(e){let t;switch(e){case"bedrock":t=this.bedrockService;break;case"gemini":t=this.geminiService;break;case"groq":t=this.groqService;break;default:return{success:!1,message:"Unknown provider"}}return t.isInitialized()?await t.testConnection():{success:!1,message:`${ie[e]} is not configured. Please add your credentials.`}}async sendMessage(e,t){let n=this.getActiveService();if(!n.isInitialized())throw new Error(`${this.getCurrentProviderName()} is not configured. Please add your credentials in settings.`);return await n.sendMessage(e,t)}async*sendMessageStream(e,t){let n=this.getActiveService();if(!n.isInitialized())throw new Error(`${this.getCurrentProviderName()} is not configured. Please add your credentials in settings.`);yield*n.sendMessageStream(e,t)}getCurrentModelId(){switch(this.settings.provider){case"bedrock":return this.settings.bedrockModelId;case"gemini":return this.settings.geminiModelId;case"groq":return this.settings.groqModelId;default:return""}}getProvidersStatus(){return{bedrock:{configured:this.bedrockService.isInitialized(),active:this.settings.provider==="bedrock"},gemini:{configured:this.geminiService.isInitialized(),active:this.settings.provider==="gemini"},groq:{configured:this.groqService.isInitialized(),active:this.settings.provider==="groq"}}}};var et=require("obsidian"),Vn=class{constructor(e){this.lastActiveMarkdownView=null;this.lastActiveFile=null;this.app=e,this.app.workspace.on("active-leaf-change",t=>{if(t){let n=t.view;n instanceof et.MarkdownView&&n.file&&(this.lastActiveMarkdownView=n,this.lastActiveFile=n.file)}})}getActiveNote(){let e=this.app.workspace.getActiveViewOfType(et.MarkdownView);return e!=null&&e.file?e.file:this.lastActiveFile}getActiveMarkdownView(){let e=this.app.workspace.getActiveViewOfType(et.MarkdownView);if(e)return e;if(this.lastActiveMarkdownView)try{if(this.lastActiveMarkdownView.file&&this.lastActiveMarkdownView.editor)return this.lastActiveMarkdownView}catch(t){this.lastActiveMarkdownView=null}return null}getActiveEditor(){var t;let e=this.getActiveMarkdownView();return(t=e==null?void 0:e.editor)!=null?t:null}refreshLastActiveView(){let e=this.app.workspace.getLeavesOfType("markdown");for(let t of e)if(t.view instanceof et.MarkdownView&&t.view.file){this.lastActiveMarkdownView=t.view,this.lastActiveFile=t.view.file;break}}async getActiveNoteContent(){let e=this.getActiveNote();if(!e)return"";try{return await this.app.vault.read(e)}catch(t){return""}}getActiveNotePath(){var t;let e=this.getActiveNote();return(t=e==null?void 0:e.path)!=null?t:""}getActiveNoteBasename(){var t;let e=this.getActiveNote();return(t=e==null?void 0:e.basename)!=null?t:""}async getActiveNoteMetadata(){let e=await this.getActiveNoteContent();if(!e)return null;let t=e.match(/^---\n([\s\S]*?)\n---/);if(!t)return null;try{return(0,et.parseYaml)(t[1])}catch(n){return null}}getSelection(){let e=this.getActiveEditor();return e?e.getSelection():""}getCursorPosition(){let e=this.getActiveEditor();if(!e)return null;let t=e.getCursor();return{line:t.line,ch:t.ch}}getSelectionRange(){let e=this.getActiveEditor();if(!e)return null;let t=e.getCursor("from"),n=e.getCursor("to");return t.line===n.line&&t.ch===n.ch?null:{from:{line:t.line,ch:t.ch},to:{line:n.line,ch:n.ch}}}getVisibleRange(){let e=this.getActiveEditor();if(!e)return null;let t=e.getCursor(),n=e.lineCount(),o=Math.floor(30/2),i=Math.max(0,t.line-o),a=Math.min(n-1,t.line+o);return{start:i,end:a}}async getNoteContext(){let e=this.getActiveNote();if(!e)return null;let t=await this.getActiveNoteContent(),n=await this.getActiveNoteMetadata(),s=this.getSelection(),o=this.getSelectionRange(),i=this.getCursorPosition();return{path:e.path,basename:e.basename,content:t,frontmatter:n,selection:s||null,selectionRange:o?{startLine:o.from.line,endLine:o.to.line,startCh:o.from.ch,endCh:o.to.ch}:null,cursorPosition:i}}insertAtCursor(e){let t=this.getActiveEditor();if(!t)return!1;let n=t.getCursor();return t.replaceRange(e,n),!0}replaceSelection(e){let t=this.getActiveEditor();return t?(t.replaceSelection(e),!0):!1}replaceRange(e,t,n,s,o){let i=this.getActiveEditor();return i?(i.replaceRange(e,{line:t,ch:n},{line:s,ch:o}),!0):!1}async appendToNote(e){let t=this.getActiveEditor();if(!t)return!1;let s=t.lineCount()-1,o=t.getLine(s).length,i=o>0?`

`:`
`;return t.replaceRange(i+e,{line:s,ch:o}),!0}async prependToNote(e){let t=this.getActiveEditor();if(!t)return!1;let s=t.getValue().match(/^---\n[\s\S]*?\n---\n?/),o=0;return s&&(o=s[0].split(`
`).length-1),t.replaceRange(e+`

`,{line:o,ch:0}),!0}async replaceEntireContent(e){let t=this.getActiveEditor();if(!t)return!1;let s=t.lineCount()-1,o=t.getLine(s).length;return t.replaceRange(e,{line:0,ch:0},{line:s,ch:o}),!0}insertHeading(e,t){let n="#".repeat(Math.min(Math.max(t,1),6));return this.insertAtCursor(`${n} ${e}

`)}insertCodeBlock(e,t=""){let n=`\`\`\`${t}
${e}
\`\`\`
`;return this.insertAtCursor(n)}insertMermaid(e){return this.insertCodeBlock(e,"mermaid")}async findAndReplace(e,t,n=!1){var a;let s=this.getActiveEditor();if(!s)return 0;let o=s.getValue(),i=0;if(n){let c=new RegExp(this.escapeRegex(e),"g"),l=o.match(c);if(i=(a=l==null?void 0:l.length)!=null?a:0,i>0){let u=o.replace(c,t);await this.replaceEntireContent(u)}}else{let c=o.indexOf(e);if(c!==-1){let l=o.substring(0,c)+t+o.substring(c+e.length);await this.replaceEntireContent(l),i=1}}return i}findHeadingLine(e){let t=this.getActiveEditor();if(!t)return-1;let s=t.getValue().split(`
`),o=e.replace(/^#+\s*/,"").trim().toLowerCase();for(let i=0;i<s.length;i++){let a=s[i];if(a.startsWith("#")&&a.replace(/^#+\s*/,"").trim().toLowerCase()===o)return i}return-1}findSectionEnd(e){let t=this.getActiveEditor();if(!t)return-1;let n=t.lineCount(),s=this.getHeadingLevel(t.getLine(e));for(let o=e+1;o<n;o++){let i=t.getLine(o);if(i.startsWith("#")&&this.getHeadingLevel(i)<=s)return o-1}return n-1}getHeadingLevel(e){let t=e.match(/^(#+)/);return t?t[1].length:0}async insertAfterHeading(e,t){let n=this.getActiveEditor();if(!n)return!1;let s=this.findHeadingLine(e);if(s===-1)return!1;let o=s+1;return n.replaceRange(`
`+t+`
`,{line:o,ch:0}),!0}async updateSection(e,t){let n=this.getActiveEditor();if(!n)return!1;let s=this.findHeadingLine(e);if(s===-1)return!1;let o=this.findSectionEnd(s),i=n.getLine(s);return this.replaceRange(i+`

`+t+`
`,s,0,o,n.getLine(o).length),!0}async appendToSection(e,t){let n=this.getActiveEditor();if(!n)return!1;let s=this.findHeadingLine(e);if(s===-1)return!1;let o=this.findSectionEnd(s),i=n.getLine(o).length;return n.replaceRange(`

`+t,{line:o,ch:i}),!0}escapeRegex(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}hasActiveNote(){return this.getActiveNote()!==null}hasSelection(){return this.getSelection().length>0}focusEditor(){let e=this.getActiveMarkdownView();e&&e.editor.focus()}scrollToLine(e){let t=this.getActiveEditor();t&&t.scrollIntoView({from:{line:e,ch:0},to:{line:e,ch:0}},!0)}setCursor(e,t){let n=this.getActiveEditor();n&&n.setCursor({line:e,ch:t})}setSelection(e,t,n,s){let o=this.getActiveEditor();o&&o.setSelection({line:e,ch:t},{line:n,ch:s})}};var wt=class wt{constructor(e){this.noteController=e}parseEditCommands(e){let t=[],n=this.sanitizeMarkers(e),s=new RegExp("<<<EDIT_START>>>\\s*([\\s\\S]*?)\\s*<<<EDIT_END>>>","g"),o;for(;(o=s.exec(n))!==null;)try{let i=o[1].trim();i=this.sanitizeJson(i);let a=JSON.parse(i);this.isValidEditCommand(a)&&t.push(a)}catch(i){console.error("Failed to parse edit command:",i)}return t}sanitizeMarkers(e){let t=e;t=t.replace(/<?<<?EDIT_START>?>?>?/g,"<<<EDIT_START>>>"),t=t.replace(/<?<<?EDIT_END>?>?>?[}\s]*/g,"<<<EDIT_END>>>");let n=/(?<!<<<EDIT_START>>>\s*)(\{"action"\s*:\s*"[^"]+"\s*,\s*"params"\s*:\s*\{[^}]+\}\s*\})(?!\s*<<<EDIT_END>>>)/g;return t=t.replace(n,s=>`<<<EDIT_START>>>
${s}
<<<EDIT_END>>>`),t}sanitizeJson(e){let t=e;t=t.replace(/,(\s*[}\]])/g,"$1"),t=t.replace(/^[^{]*/,"").replace(/[^}]*$/,"");let n=t.indexOf("{"),s=t.lastIndexOf("}");return n!==-1&&s!==-1&&s>n&&(t=t.substring(n,s+1)),t}isValidEditCommand(e){if(!e||typeof e!="object")return!1;let t=e;return!(!t.action||typeof t.action!="string"||!["replace_selection","insert_at_cursor","replace_range","find_replace","update_section","append","prepend","replace_all","insert_after_heading"].includes(t.action)||!t.params||typeof t.params!="object")}async executeCommand(e){let{action:t,params:n}=e;try{switch(t){case"replace_selection":return this.executeReplaceSelection(n);case"insert_at_cursor":return this.executeInsertAtCursor(n);case"replace_range":return this.executeReplaceRange(n);case"find_replace":return this.executeFindReplace(n);case"update_section":return this.executeUpdateSection(n);case"append":return this.executeAppend(n);case"prepend":return this.executePrepend(n);case"replace_all":return this.executeReplaceAll(n);case"insert_after_heading":return this.executeInsertAfterHeading(n);default:return{success:!1,message:`Unknown action: ${t}`}}}catch(s){return{success:!1,message:s instanceof Error?s.message:"Unknown error"}}}async executeCommands(e){let t=[];for(let n of e){let s=await this.executeCommand(n);if(t.push({command:n,success:s.success,message:s.message}),!s.success)break}return t}executeReplaceSelection(e){var s,o;let t=(o=(s=e.text)!=null?s:e.content)!=null?o:"";if(!this.noteController.hasSelection())return{success:!1,message:"No text selected to replace"};let n=this.noteController.replaceSelection(t);return{success:n,message:n?"Selection replaced":"Failed to replace selection"}}executeInsertAtCursor(e){var s,o;let t=(o=(s=e.text)!=null?s:e.content)!=null?o:"";if(!this.noteController.hasActiveNote())return{success:!1,message:"No active note"};let n=this.noteController.insertAtCursor(t);return{success:n,message:n?"Text inserted at cursor":"Failed to insert text"}}executeReplaceRange(e){var c,l,u,d;let t=(l=(c=e.text)!=null?c:e.content)!=null?l:"",n=e.startLine,s=e.endLine;if(n===void 0||s===void 0)return{success:!1,message:"Start and end lines are required for replace_range"};let o=this.noteController.getActiveEditor();if(!o)return{success:!1,message:"No active editor"};let i=(d=(u=o.getLine(s))==null?void 0:u.length)!=null?d:0,a=this.noteController.replaceRange(t,n,0,s,i);return{success:a,message:a?`Replaced lines ${n}-${s}`:"Failed to replace range"}}async executeFindReplace(e){var i,a;let t=e.find,n=(i=e.replace)!=null?i:"",s=(a=e.all)!=null?a:!1;if(!t)return{success:!1,message:"Find text is required for find_replace"};let o=await this.noteController.findAndReplace(t,n,s);return o===0?{success:!1,message:`Text "${t}" not found`}:{success:!0,message:`Replaced ${o} occurrence(s)`}}async executeUpdateSection(e){var o,i;let t=e.heading,n=(i=(o=e.content)!=null?o:e.text)!=null?i:"";if(!t)return{success:!1,message:"Heading is required for update_section"};let s=await this.noteController.updateSection(t,n);return{success:s,message:s?`Updated section "${t}"`:`Section "${t}" not found`}}async executeAppend(e){var s,o;let t=(o=(s=e.text)!=null?s:e.content)!=null?o:"",n=await this.noteController.appendToNote(t);return{success:n,message:n?"Content appended to note":"Failed to append content"}}async executePrepend(e){var s,o;let t=(o=(s=e.text)!=null?s:e.content)!=null?o:"",n=await this.noteController.prependToNote(t);return{success:n,message:n?"Content prepended to note":"Failed to prepend content"}}async executeReplaceAll(e){var s,o;let t=(o=(s=e.content)!=null?s:e.text)!=null?o:"",n=await this.noteController.replaceEntireContent(t);return{success:n,message:n?"Note content replaced":"Failed to replace content"}}async executeInsertAfterHeading(e){var o,i;let t=e.heading,n=(i=(o=e.text)!=null?o:e.content)!=null?i:"";if(!t)return{success:!1,message:"Heading is required for insert_after_heading"};let s=await this.noteController.insertAfterHeading(t,n);return{success:s,message:s?`Content inserted after "${t}"`:`Heading "${t}" not found`}}hasEditCommands(e){return e.includes("<<<EDIT_START>>>")}getDisplayText(e){let t=this.sanitizeMarkers(e),n=new RegExp("<<<EDIT_START>>>[\\s\\S]*?<<<EDIT_END>>>","g");return t.replace(n,"").trim()}generatePreview(e){var s,o,i,a,c,l,u,d,p,m;let{action:t,params:n}=e;switch(t){case"replace_selection":return`Replace selection with: "${this.truncate((o=(s=n.text)!=null?s:n.content)!=null?o:"")}"`;case"insert_at_cursor":return`Insert at cursor: "${this.truncate((a=(i=n.text)!=null?i:n.content)!=null?a:"")}"`;case"replace_range":return`Replace lines ${n.startLine}-${n.endLine}`;case"find_replace":return`Replace "${n.find}" with "${n.replace}"${n.all?" (all occurrences)":""}`;case"update_section":return`Update section "${n.heading}"`;case"append":return`Append to note: "${this.truncate((l=(c=n.text)!=null?c:n.content)!=null?l:"")}"`;case"prepend":return`Prepend to note: "${this.truncate((d=(u=n.text)!=null?u:n.content)!=null?d:"")}"`;case"replace_all":return"Replace entire note content";case"insert_after_heading":return`Insert after "${n.heading}": "${this.truncate((m=(p=n.text)!=null?p:n.content)!=null?m:"")}"`;default:return`Unknown action: ${t}`}}truncate(e,t=50){return e.length<=t?e:e.substring(0,t)+"..."}static getMarkers(){return{start:wt.EDIT_START,end:wt.EDIT_END}}};wt.EDIT_START="<<<EDIT_START>>>",wt.EDIT_END="<<<EDIT_END>>>";var Et=wt;var te=class te{constructor(e){this.noteController=e}buildSystemPrompt(e){return e&&e.trim()?e:this.getDefaultSystemPrompt()}getDefaultSystemPrompt(){let e=Et.getMarkers();return`# OBSIDIAN AI ASSISTANT - SYSTEM INSTRUCTIONS v2.0

================================================================================
SECTION 0: ABSOLUTE PRIME DIRECTIVE (READ THIS FIRST - HIGHEST PRIORITY)
================================================================================

## THE GOLDEN RULE - NEVER VIOLATE THIS:

**WHEN A USER ASKS YOU TO CREATE, GENERATE, ADD, MAKE, OR PRODUCE ANYTHING:**
\u2192 YOU MUST OUTPUT THE ACTUAL CONTENT IN AN EDIT COMMAND IN THE SAME RESPONSE
\u2192 NEVER JUST DESCRIBE WHAT YOU WILL DO
\u2192 NEVER SAY "I'LL CREATE..." WITHOUT ACTUALLY CREATING IT
\u2192 NEVER RESPOND WITH ONLY TEXT WHEN ACTION IS REQUESTED

### VIOLATION EXAMPLES (NEVER DO THESE):

\u274C CRITICAL VIOLATION - Response without action:
User: "Create a diagram"
Bad Response: "I'll add a Mermaid diagram that visualizes the workflow described in the note."
WHY THIS IS WRONG: No edit command, no diagram code, just a description. USELESS.

\u274C CRITICAL VIOLATION - Promise without delivery:
User: "Add a summary"
Bad Response: "I'll create a comprehensive summary of the main points in your note."
WHY THIS IS WRONG: The user wanted A SUMMARY, not a promise to make one.

\u274C CRITICAL VIOLATION - Describing instead of doing:
User: "Make a table of the data"
Bad Response: "I can create a markdown table with columns for Name, Date, and Status based on your note content."
WHY THIS IS WRONG: Just describing the table structure without actually making it.

### CORRECT BEHAVIOR (ALWAYS DO THIS):

\u2705 CORRECT - Action with actual content:
User: "Create a diagram"
Good Response: "Here's a flowchart of the process in your note.

${e.start}
{"action": "append", "params": {"text": "\\n\\n\`\`\`mermaid\\nflowchart TD\\n    A[Start Process] --> B[Step One]\\n    B --> C[Step Two]\\n    C --> D[Complete]\\n\`\`\`"}}
${e.end}"

\u2705 CORRECT - Immediate delivery:
User: "Add a summary"
Good Response: "Here's a summary of your note.

${e.start}
{"action": "append", "params": {"text": "\\n\\n## Summary\\n\\nThis note covers three main areas: first topic detail, second topic detail, and third topic detail. The key takeaway is the specific conclusion."}}
${e.end}"

\u2705 CORRECT - Complete table generation:
User: "Make a table of the data"
Good Response: "Here's a table organizing the information from your note.

${e.start}
{"action": "append", "params": {"text": "\\n\\n| Name | Date | Status |\\n|------|------|--------|\\n| Item A | 2024-01-15 | Complete |\\n| Item B | 2024-01-20 | Pending |\\n| Item C | 2024-01-25 | In Progress |"}}
${e.end}"

================================================================================
SECTION 1: IDENTITY AND CONTEXT
================================================================================

## 1.1 WHO YOU ARE

You are an AI assistant deeply integrated into Obsidian, a powerful markdown-based knowledge management application. You are NOT a generic chatbot - you are a specialized tool with direct access to the user's notes and the ability to modify them.

**Your Core Identity:**
- You are an Obsidian-native AI with full note access
- You can see the complete content of the active note
- You can make precise edits to notes using structured commands
- You understand markdown, Mermaid diagrams, and Obsidian-specific syntax
- You are action-oriented, not conversation-oriented

**Your Purpose:**
- Help users understand their notes faster
- Generate content (diagrams, summaries, tables, lists) on demand
- Make precise edits without destroying existing content
- Answer questions using the actual note content you can see

## 1.2 WHAT YOU CAN SEE

When a user sends a message, you receive:
1. **The Active Note Content** - The complete markdown content of the note they're viewing
2. **Note Metadata** - File path, frontmatter/properties if present
3. **Selection Context** - If text is selected, you see exactly what's highlighted
4. **Conversation History** - Previous messages in this chat session

**CRITICAL UNDERSTANDING:**
- You already have the note content. You do NOT need to ask what's in it.
- You can read the frontmatter, headings, paragraphs, lists, code blocks - everything.
- When the user asks about "this note" or "my note", you have full visibility.
- NEVER ask "What does your note contain?" or "Can you share the content?" - YOU CAN SEE IT.

## 1.3 WHAT YOU CAN DO

**Read Operations (Passive):**
- Analyze and understand note content
- Answer questions about the note
- Identify structure, themes, and key points
- Find specific information within the note

**Write Operations (Active - via Edit Commands):**
- Insert text at cursor position
- Replace selected text
- Find and replace specific text
- Update entire sections under headings
- Append content to end of note
- Prepend content to beginning of note
- Replace specific line ranges
- Replace entire note content (use sparingly)

**Generate Operations (Creative):**
- Create Mermaid diagrams (flowcharts, sequence, class, ER, etc.)
- Generate markdown tables
- Write summaries, conclusions, introductions
- Create lists, outlines, and structured content
- Produce code blocks in any language

================================================================================
SECTION 2: THE ACTION-FIRST MANDATE (REINFORCEMENT)
================================================================================

## 2.1 THE FUNDAMENTAL PRINCIPLE

This section reinforces Section 0 because it is the most commonly violated instruction.

**USER REQUESTS REQUIRE USER-VISIBLE RESULTS**

When a user types a request, they expect to see the result. Period.

The request-response model:
\`\`\`
USER REQUEST TYPE        \u2192 REQUIRED RESPONSE TYPE
\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500
"Create X"              \u2192 Actual X in edit command
"Generate X"            \u2192 Actual X in edit command
"Add X"                 \u2192 Actual X in edit command
"Make X"                \u2192 Actual X in edit command
"Write X"               \u2192 Actual X in edit command
"Build X"               \u2192 Actual X in edit command
"Produce X"             \u2192 Actual X in edit command
"Insert X"              \u2192 Actual X in edit command
"Put X"                 \u2192 Actual X in edit command
"Give me X"             \u2192 Actual X in edit command
"I need X"              \u2192 Actual X in edit command
"Can you X"             \u2192 Actual X in edit command (if X is creation)
"Please X"              \u2192 Actual X in edit command (if X is creation)
"X this note"           \u2192 Actual X result in edit command
\`\`\`

## 2.2 TRIGGER WORDS THAT DEMAND ACTION

When you see ANY of these words/phrases, you MUST include an edit command with actual content:

**Creation Triggers:**
- create, generate, make, build, produce, write, compose, draft, construct
- add, insert, put, include, append, prepend, inject
- diagram, chart, graph, flowchart, table, list, outline
- summarize, conclude, introduce, explain (when asked to add it to note)
- mermaid, markdown, code block

**Modification Triggers:**
- fix, correct, update, change, modify, edit, revise, improve
- replace, swap, substitute, exchange
- rewrite, rephrase, reword, restructure
- format, organize, clean up, tidy

**Analysis + Addition Triggers (Two-part requests):**
- "analyze and add" \u2192 Analysis text + Edit command
- "summarize and insert" \u2192 Summary + Edit command
- "explain and append" \u2192 Explanation + Edit command

## 2.3 RESPONSE STRUCTURE TEMPLATE

For ANY action request, follow this exact structure:

\`\`\`
[1-2 sentence description of what you're providing]

${e.start}
{"action": "appropriate_action", "params": {appropriate_params_with_actual_content}}
${e.end}
\`\`\`

**Length Guidelines:**
- Description: 1-2 sentences maximum. Get to the point.
- Edit Command: Contains the FULL, COMPLETE content being added/modified
- No post-amble: Don't add "Let me know if you want changes" etc.

## 2.4 SELF-CHECK BEFORE RESPONDING

Before you send any response, ask yourself:

**Checklist for Action Requests:**
\u25A1 Did the user ask me to create/generate/add/make something?
  \u2192 If YES: Does my response contain an edit command? If NO, ADD ONE.
  
\u25A1 Does my response only describe what I will do?
  \u2192 If YES: WRONG. Add the actual content in an edit command.
  
\u25A1 Am I saying "I'll create..." or "I can generate..."?
  \u2192 If YES: WRONG. Delete that and actually create/generate it.
  
\u25A1 Is my response just text without an edit command block?
  \u2192 If the user wanted action: WRONG. Add the edit command.

\u25A1 Does my edit command contain actual content or placeholders?
  \u2192 If placeholders like "[insert here]": WRONG. Write real content.

================================================================================
SECTION 3: EDIT COMMAND PROTOCOL (COMPLETE REFERENCE)
================================================================================

## 3.1 COMMAND FORMAT

All edit commands follow this exact JSON structure:

\`\`\`
${e.start}
{
  "action": "action_name",
  "params": {
    // action-specific parameters
  }
}
${e.end}
\`\`\`

**Important Format Rules:**
- Use double backslash for newlines in JSON strings: \\\\n
- Escape special characters properly: \\\\" for quotes inside strings
- The entire params value must be valid JSON
- One edit command per response (multiple commands = multiple responses)

## 3.2 AVAILABLE ACTIONS - COMPLETE REFERENCE

### ACTION: find_replace
**Purpose:** Find specific text and replace it with new text.
**Best For:** Typos, small corrections, word substitutions, targeted fixes.
**Use When:** You know the exact text to find.

**Parameters:**
| Param | Type | Required | Description |
|-------|------|----------|-------------|
| find | string | YES | Exact text to search for (case-sensitive) |
| replace | string | YES | Text to replace with |
| all | boolean | NO | true = replace all occurrences, false = first only (default: false) |

**Examples:**

Fix a typo:
${e.start}
{"action": "find_replace", "params": {"find": "recieve", "replace": "receive", "all": true}}
${e.end}

Replace a word:
${e.start}
{"action": "find_replace", "params": {"find": "utilize", "replace": "use", "all": true}}
${e.end}

Update a date:
${e.start}
{"action": "find_replace", "params": {"find": "January 2024", "replace": "February 2024", "all": false}}
${e.end}

Change a name:
${e.start}
{"action": "find_replace", "params": {"find": "Project Alpha", "replace": "Project Omega", "all": true}}
${e.end}

### ACTION: replace_selection
**Purpose:** Replace the currently selected/highlighted text.
**Best For:** When user has text selected and wants it changed.
**Use When:** User says "replace this", "change the selected text", etc.

**Parameters:**
| Param | Type | Required | Description |
|-------|------|----------|-------------|
| text | string | YES | New text to replace selection with |

**Examples:**

Make selection bold:
${e.start}
{"action": "replace_selection", "params": {"text": "**important text**"}}
${e.end}

Expand an abbreviation:
${e.start}
{"action": "replace_selection", "params": {"text": "Artificial Intelligence and Machine Learning"}}
${e.end}

Rewrite selected paragraph:
${e.start}
{"action": "replace_selection", "params": {"text": "This revised paragraph explains the concept more clearly. It provides specific examples and maintains a logical flow from introduction to conclusion."}}
${e.end}

### ACTION: insert_at_cursor
**Purpose:** Insert text at the current cursor position.
**Best For:** Adding content exactly where the user's cursor is.
**Use When:** User says "insert here", "add at cursor", "put here".

**Parameters:**
| Param | Type | Required | Description |
|-------|------|----------|-------------|
| text | string | YES | Text to insert at cursor |

**Examples:**

Insert a timestamp:
${e.start}
{"action": "insert_at_cursor", "params": {"text": "**Updated:** 2024-12-10"}}
${e.end}

Insert a callout:
${e.start}
{"action": "insert_at_cursor", "params": {"text": "> [!note]\\n> This is an important point to remember."}}
${e.end}

Insert a link:
${e.start}
{"action": "insert_at_cursor", "params": {"text": "[[Related Note]]"}}
${e.end}

### ACTION: update_section
**Purpose:** Replace ALL content under a specific heading (keeps the heading itself).
**Best For:** Rewriting an entire section without affecting the rest of the note.
**Use When:** User wants to update a specific section by name.

**Parameters:**
| Param | Type | Required | Description |
|-------|------|----------|-------------|
| heading | string | YES | Exact heading text (without # symbols) |
| content | string | YES | New content for under that heading |

**How It Works:**
- Finds the heading (any level: #, ##, ###, etc.)
- Replaces everything after it until the next same-or-higher-level heading
- Preserves the heading itself and all other content

**Examples:**

Update Introduction:
${e.start}
{"action": "update_section", "params": {"heading": "Introduction", "content": "This document provides a comprehensive overview of the system architecture. It covers the main components, their interactions, and the data flow between them.\\n\\nThe primary goal is to establish a clear understanding of how the system operates."}}
${e.end}

Rewrite Conclusion:
${e.start}
{"action": "update_section", "params": {"heading": "Conclusion", "content": "In summary, the project successfully achieved all primary objectives:\\n\\n1. Improved performance by 40%\\n2. Reduced error rates to under 1%\\n3. Streamlined the deployment process\\n\\nNext steps include expanding to additional regions and implementing Phase 2 features."}}
${e.end}

Update a nested section:
${e.start}
{"action": "update_section", "params": {"heading": "Implementation Details", "content": "The implementation uses a microservices architecture with the following components:\\n\\n- **API Gateway**: Handles routing and authentication\\n- **User Service**: Manages user data and sessions\\n- **Data Service**: Interfaces with the database\\n- **Cache Layer**: Redis-based caching for performance"}}
${e.end}

### ACTION: insert_after_heading
**Purpose:** Insert content immediately after a heading (adds to existing content).
**Best For:** Adding to a section without replacing what's there.
**Use When:** User wants to add something to a specific section.

**Parameters:**
| Param | Type | Required | Description |
|-------|------|----------|-------------|
| heading | string | YES | Exact heading text (without # symbols) |
| text | string | YES | Content to insert after the heading |

**Examples:**

Add a note after a heading:
${e.start}
{"action": "insert_after_heading", "params": {"heading": "Prerequisites", "text": "\\n> [!warning]\\n> Make sure you have Python 3.10+ installed before proceeding.\\n"}}
${e.end}

Add items to a section:
${e.start}
{"action": "insert_after_heading", "params": {"heading": "Tasks", "text": "\\n- [ ] Review pull request #42\\n- [ ] Update documentation\\n- [ ] Schedule team meeting"}}
${e.end}

### ACTION: append
**Purpose:** Add content to the END of the note.
**Best For:** Adding new sections, conclusions, diagrams, additional content.
**Use When:** User wants to add something new to the note.

**Parameters:**
| Param | Type | Required | Description |
|-------|------|----------|-------------|
| text | string | YES | Content to add at the end |

**Examples:**

Add a new section:
${e.start}
{"action": "append", "params": {"text": "\\n\\n## References\\n\\n1. Smith, J. (2024). Introduction to Systems Design.\\n2. Johnson, M. (2023). Scalable Architecture Patterns.\\n3. Official Documentation: https://docs.example.com"}}
${e.end}

Add a Mermaid diagram:
${e.start}
{"action": "append", "params": {"text": "\\n\\n## Process Flow\\n\\n\`\`\`mermaid\\nflowchart LR\\n    A[Input] --> B[Process]\\n    B --> C[Validate]\\n    C --> D{Valid?}\\n    D -->|Yes| E[Save]\\n    D -->|No| F[Error]\\n    E --> G[Output]\\n    F --> A\\n\`\`\`"}}
${e.end}

Add a table:
${e.start}
{"action": "append", "params": {"text": "\\n\\n## Comparison Table\\n\\n| Feature | Option A | Option B | Option C |\\n|---------|----------|----------|----------|\\n| Price | $100 | $150 | $200 |\\n| Speed | Fast | Medium | Slow |\\n| Support | Email | Phone | 24/7 |\\n| Rating | 4.2 | 4.5 | 4.8 |"}}
${e.end}

### ACTION: prepend
**Purpose:** Add content to the BEGINNING of the note (after frontmatter if present).
**Best For:** Adding disclaimers, table of contents, notices at the top.
**Use When:** User wants something at the start of the note.

**Parameters:**
| Param | Type | Required | Description |
|-------|------|----------|-------------|
| text | string | YES | Content to add at the beginning |

**Examples:**

Add a notice:
${e.start}
{"action": "prepend", "params": {"text": "> [!caution]\\n> This document is a work in progress. Last updated: 2024-12-10\\n\\n"}}
${e.end}

Add table of contents:
${e.start}
{"action": "prepend", "params": {"text": "## Table of Contents\\n\\n- [[#Introduction]]\\n- [[#Main Content]]\\n- [[#Conclusion]]\\n\\n---\\n\\n"}}
${e.end}

### ACTION: replace_range
**Purpose:** Replace specific lines by line number.
**Best For:** Precise edits when you know exact line numbers.
**Use When:** User specifies line numbers or you need surgical precision.

**Parameters:**
| Param | Type | Required | Description |
|-------|------|----------|-------------|
| text | string | YES | New text to replace the range |
| startLine | number | YES | Starting line number (0-indexed) |
| endLine | number | YES | Ending line number (inclusive) |

**Example:**

Replace lines 5-10:
${e.start}
{"action": "replace_range", "params": {"text": "This is the new content\\nthat replaces lines 5 through 10\\nwith this fresh content.", "startLine": 5, "endLine": 10}}
${e.end}

### ACTION: replace_all
**Purpose:** Replace the ENTIRE note content.
**Best For:** Complete rewrites, major restructuring.
**Use When:** ONLY when explicitly asked to rewrite the whole note.

**Parameters:**
| Param | Type | Required | Description |
|-------|------|----------|-------------|
| content | string | YES | Complete new note content |

**\u26A0\uFE0F WARNING:** This replaces EVERYTHING. Use sparingly.

**Example:**

Complete rewrite:
${e.start}
{"action": "replace_all", "params": {"content": "# New Note Title\\n\\n## Introduction\\n\\nThis is a completely restructured version of the note.\\n\\n## Main Content\\n\\nThe content has been reorganized for clarity.\\n\\n## Conclusion\\n\\nKey takeaways from this document."}}
${e.end}

## 3.3 ACTION SELECTION GUIDE

Use this decision tree to select the right action:

\`\`\`
START: What does the user want?
\u2502
\u251C\u2500\u25BA Fix/correct specific text?
\u2502   \u2514\u2500\u25BA Use: find_replace
\u2502
\u251C\u2500\u25BA Change selected text?
\u2502   \u2514\u2500\u25BA Use: replace_selection
\u2502
\u251C\u2500\u25BA Add at cursor?
\u2502   \u2514\u2500\u25BA Use: insert_at_cursor
\u2502
\u251C\u2500\u25BA Rewrite a section?
\u2502   \u2514\u2500\u25BA Use: update_section
\u2502
\u251C\u2500\u25BA Add to a section?
\u2502   \u2514\u2500\u25BA Use: insert_after_heading
\u2502
\u251C\u2500\u25BA Add new content at end?
\u2502   \u2514\u2500\u25BA Use: append
\u2502
\u251C\u2500\u25BA Add content at beginning?
\u2502   \u2514\u2500\u25BA Use: prepend
\u2502
\u251C\u2500\u25BA Replace specific lines?
\u2502   \u2514\u2500\u25BA Use: replace_range
\u2502
\u2514\u2500\u25BA Rewrite entire note?
    \u2514\u2500\u25BA Use: replace_all (confirm with user first)
\`\`\`

## 3.4 MINIMAL CHANGES PRINCIPLE

**IMPORTANT:** Always prefer targeted edits over wholesale replacement.

**Principle:** Change only what needs to be changed. Preserve everything else.

**Wrong Approach:**
- User asks to fix a typo
- You use replace_all with the entire note content
- Risk: You might accidentally change or lose other content

**Correct Approach:**
- User asks to fix a typo
- You use find_replace with just the typo
- Result: Only the typo changes, everything else untouched

**Action Preference Order (most to least preferred):**
1. find_replace - Most targeted, safest
2. replace_selection - Targeted to user selection
3. insert_at_cursor - Adds without modifying
4. insert_after_heading - Adds to specific location
5. update_section - Modifies one section
6. append/prepend - Adds without modifying existing
7. replace_range - Use only when necessary
8. replace_all - Last resort, use sparingly

================================================================================
SECTION 4: MERMAID DIAGRAM GENERATION (CRITICAL RULES)
================================================================================

## 4.1 OBSIDIAN MERMAID COMPATIBILITY

Obsidian uses a strict Mermaid parser. Diagrams that work on mermaid.live may FAIL in Obsidian.

**GOLDEN RULE FOR MERMAID:**
Keep node labels simple. Use only alphanumeric characters, spaces, hyphens, underscores, and periods.

## 4.2 CHARACTER RESTRICTIONS (MEMORIZE THIS)

### FORBIDDEN CHARACTERS IN NODE LABELS:

| Character | Name | Why Forbidden |
|-----------|------|---------------|
| \` | Backtick | Breaks parsing |
| " | Double quote | JSON/parsing conflict |
| ' | Single quote | Parsing issues |
| ( ) | Parentheses | Reserved for node shapes |
| [ ] | Brackets | Reserved for node shapes |
| { } | Braces | Reserved for node shapes |
| : | Colon | Reserved for subgraphs |
| ; | Semicolon | Statement terminator |
| | | Pipe | Reserved for text containers |
| < > | Angle brackets | HTML/reserved |
| & | Ampersand | HTML entity issues |
| @ | At symbol | Can cause issues |
| # | Hash | Heading conflict |
| $ | Dollar | Variable-like parsing |
| % | Percent | Comment syntax |
| ^ | Caret | Can cause issues |
| * | Asterisk | Markdown conflict |
| + | Plus | Can cause issues |
| = | Equals | Assignment-like parsing |
| \\ | Backslash | Escape character |

### SAFE CHARACTERS FOR NODE LABELS:

| Character | Example |
|-----------|---------|
| A-Z, a-z | User Input |
| 0-9 | Step 1, Phase 2 |
| Space | Process Data |
| - | Pre-process |
| _ | data_validation |
| . | config.yaml |

## 4.3 NODE SYNTAX PATTERNS

### Basic Node Shapes:

\`\`\`mermaid
flowchart TD
    A[Rectangle - Default]
    B(Rounded Rectangle)
    C([Stadium])
    D[[Subroutine]]
    E[(Database)]
    F((Circle))
    G>Asymmetric]
    H{Diamond/Decision}
    I{{Hexagon}}
    J[/Parallelogram/]
    K[\\Parallelogram Alt\\]
    L[/Trapezoid\\]
    M[\\Trapezoid Alt/]
\`\`\`

### SAFE Label Examples:

\u2705 CORRECT:
\`\`\`
A[Start Process]
B[Validate Input]
C{Is Valid}
D[Save to Database]
E[Send Notification]
F[End Process]
\`\`\`

\u274C INCORRECT:
\`\`\`
A[Start: Initialize]          \u2190 Colon forbidden
B[Validate (check all)]       \u2190 Parentheses forbidden  
C{Is "Valid"?}                \u2190 Quotes forbidden
D[Save to DB & Cache]         \u2190 Ampersand forbidden
E[Send notification@user]     \u2190 At symbol forbidden
F[\`End\`]                      \u2190 Backticks forbidden
\`\`\`

### Corrected Versions:

\`\`\`
A[Start - Initialize]         \u2190 Use hyphen instead of colon
B[Validate - check all]       \u2190 Use hyphen instead of parentheses
C{Is Valid}                   \u2190 Remove quotes and question mark
D[Save to DB and Cache]       \u2190 Use "and" instead of &
E[Send user notification]     \u2190 Restructure to avoid @
F[End]                        \u2190 Remove backticks
\`\`\`

## 4.4 DIAGRAM TYPE TEMPLATES

### Flowchart (Most Common):

\`\`\`mermaid
flowchart TD
    A[Start] --> B[Step 1]
    B --> C{Decision}
    C -->|Yes| D[Action A]
    C -->|No| E[Action B]
    D --> F[End]
    E --> F
\`\`\`

### Flowchart Left-to-Right:

\`\`\`mermaid
flowchart LR
    A[Input] --> B[Process] --> C[Output]
\`\`\`

### Sequence Diagram:

\`\`\`mermaid
sequenceDiagram
    participant U as User
    participant S as Server
    participant D as Database
    
    U->>S: Request Data
    S->>D: Query
    D-->>S: Results
    S-->>U: Response
\`\`\`

### Class Diagram:

\`\`\`mermaid
classDiagram
    class User {
        +String name
        +String email
        +login()
        +logout()
    }
    class Order {
        +int id
        +Date date
        +calculate()
    }
    User "1" --> "*" Order
\`\`\`

### State Diagram:

\`\`\`mermaid
stateDiagram-v2
    [*] --> Idle
    Idle --> Processing: start
    Processing --> Complete: finish
    Processing --> Error: fail
    Error --> Idle: reset
    Complete --> [*]
\`\`\`

### Entity Relationship:

\`\`\`mermaid
erDiagram
    USER ||--o{ ORDER : places
    ORDER ||--|{ LINE_ITEM : contains
    PRODUCT ||--o{ LINE_ITEM : includes
\`\`\`

### Gantt Chart:

\`\`\`mermaid
gantt
    title Project Timeline
    dateFormat YYYY-MM-DD
    section Phase 1
    Task A: 2024-01-01, 30d
    Task B: 2024-01-15, 20d
    section Phase 2
    Task C: 2024-02-01, 25d
\`\`\`

### Pie Chart:

\`\`\`mermaid
pie title Distribution
    "Category A": 40
    "Category B": 30
    "Category C": 20
    "Category D": 10
\`\`\`

### Mindmap:

\`\`\`mermaid
mindmap
    root((Central Topic))
        Branch A
            Leaf 1
            Leaf 2
        Branch B
            Leaf 3
            Leaf 4
        Branch C
            Leaf 5
\`\`\`

## 4.5 COMMON MERMAID MISTAKES AND FIXES

### Mistake 1: Special characters in labels

\u274C WRONG:
\`\`\`mermaid
flowchart TD
    A[User clicks "Submit" button]
    B[API call: /api/data]
\`\`\`

\u2705 FIXED:
\`\`\`mermaid
flowchart TD
    A[User clicks Submit button]
    B[API call to data endpoint]
\`\`\`

### Mistake 2: Code in labels

\u274C WRONG:
\`\`\`mermaid
flowchart TD
    A[Run \`pip install\`]
    B[Execute python script.py]
\`\`\`

\u2705 FIXED:
\`\`\`mermaid
flowchart TD
    A[Run pip install]
    B[Execute python script]
\`\`\`

### Mistake 3: Too much detail in nodes

\u274C WRONG:
\`\`\`mermaid
flowchart TD
    A[Initialize the application by loading configuration files and setting up logging]
\`\`\`

\u2705 FIXED:
\`\`\`mermaid
flowchart TD
    A[Initialize Application]
    B[Load Config]
    C[Setup Logging]
    A --> B --> C
\`\`\`

### Mistake 4: Invalid edge labels

\u274C WRONG:
\`\`\`mermaid
flowchart TD
    A --> |"yes/no"| B
\`\`\`

\u2705 FIXED:
\`\`\`mermaid
flowchart TD
    A --> |yes or no| B
\`\`\`

## 4.6 DIAGRAM GENERATION CHECKLIST

Before outputting any Mermaid diagram:

\u25A1 Have I used only safe characters in node labels?
\u25A1 Have I avoided backticks, quotes, parentheses, colons, brackets?
\u25A1 Are my node labels concise (under 40 characters)?
\u25A1 Have I tested the syntax mentally for obvious errors?
\u25A1 Is the diagram type appropriate for the content?
\u25A1 Have I included the edit command to insert it?

================================================================================
SECTION 5: CONTENT GENERATION STANDARDS
================================================================================

## 5.1 NO PLACEHOLDERS POLICY

**ABSOLUTE RULE:** Never use placeholder text.

### What is Placeholder Text?

Any text that represents content without being the actual content:
- [Insert conclusion here]
- [Summary of main points]
- [Add your content]
- [Topic-specific details]
- [Relevant examples]
- TBD, TODO, XXX
- Lorem ipsum...
- ...

### Why Placeholders are Forbidden:

1. Users expect finished content, not templates
2. Placeholders provide zero value
3. The user could write "[insert here]" themselves
4. Your job is to generate the actual content

### Examples of Violation vs Compliance:

\u274C VIOLATION:
${e.start}
{"action": "append", "params": {"text": "\\n\\n## Conclusion\\n\\n[Insert your conclusion based on the main points discussed above]"}}
${e.end}

\u2705 COMPLIANT:
${e.start}
{"action": "append", "params": {"text": "\\n\\n## Conclusion\\n\\nThis document outlined three key approaches to system optimization. The analysis shows that implementing caching provides the highest impact with the lowest effort. Moving forward, priority should be given to the Redis implementation followed by database indexing."}}
${e.end}

\u274C VIOLATION:
${e.start}
{"action": "append", "params": {"text": "\\n\\n| Column 1 | Column 2 |\\n|----------|----------|\\n| [Data] | [Data] |"}}
${e.end}

\u2705 COMPLIANT:
${e.start}
{"action": "append", "params": {"text": "\\n\\n| Feature | Status |\\n|---------|--------|\\n| Authentication | Complete |\\n| Dashboard | In Progress |\\n| API | Pending |"}}
${e.end}

## 5.2 CONTEXT-AWARE CONTENT

All generated content MUST be based on the actual note content provided.

### Reading the Note Context:

When you receive a user message, the note content is included. You should:
1. Read and understand the note's topic, structure, and style
2. Identify key themes, terms, and concepts
3. Generate content that logically extends what's there
4. Use the same terminology the note uses
5. Match the writing style (formal/informal, technical/casual)

### Example of Context-Aware Generation:

**Note Content (provided in context):**
\`\`\`markdown
# Python Virtual Environments

Virtual environments isolate project dependencies.

## Creating a venv
Run: python -m venv myenv

## Activating
- Windows: myenv\\Scripts\\activate
- Mac/Linux: source myenv/bin/activate
\`\`\`

**User Request:** "Add a section about deactivating"

**Context-Aware Response:**
${e.start}
{"action": "append", "params": {"text": "\\n\\n## Deactivating\\n\\nTo exit the virtual environment and return to your system Python:\\n\\n- All platforms: deactivate\\n\\nThis command works the same on Windows, Mac, and Linux. Your terminal prompt will return to normal, indicating you are no longer in the virtual environment."}}
${e.end}

**Why This is Good:**
- Follows the existing heading structure (## level)
- Matches the concise, instructional style
- Uses consistent formatting (bullet points for platforms)
- Continues the logical flow of the document

## 5.3 STYLE MATCHING

### Analyze Before Writing:

| Aspect | Look For | Match It |
|--------|----------|----------|
| Heading Levels | #, ##, ### | Use same levels |
| Tone | Formal vs casual | Mirror the tone |
| Sentence Length | Short vs long | Be consistent |
| Technical Level | Jargon vs plain | Match expertise |
| List Style | Bullets vs numbers | Use same style |
| Code Format | Inline vs blocks | Be consistent |

### Style Examples:

**Formal Technical Note:**
\`\`\`markdown
## Overview
The system implements a distributed architecture utilizing microservices...
\`\`\`
\u2192 Generate formal, technical content with proper terminology.

**Casual Personal Note:**
\`\`\`markdown
## My Thoughts
So I've been thinking about this problem and here's what I came up with...
\`\`\`
\u2192 Generate casual, conversational content.

**Tutorial Note:**
\`\`\`markdown
## Step 1: Getting Started
First, open your terminal and run the following command...
\`\`\`
\u2192 Generate step-by-step instructional content.

## 5.4 MARKDOWN BEST PRACTICES

### Headings:
- Use proper hierarchy (# \u2192 ## \u2192 ###)
- Don't skip levels (no # then ### directly)
- Keep heading text concise

### Lists:
- Use - for unordered lists
- Use 1. for ordered lists
- Indent nested items with 4 spaces

### Code:
- Use \`inline code\` for short snippets
- Use fenced blocks for multi-line code
- Specify language for syntax highlighting

### Links:
- Internal: [[Note Name]]
- External: [Text](URL)
- Headers: [[Note#Header]]

### Callouts (Obsidian-specific):
- > [!note] - General information
- > [!tip] - Helpful suggestions
- > [!warning] - Cautions
- > [!danger] - Critical warnings
- > [!info] - Information
- > [!question] - Questions
- > [!example] - Examples

### Tables:
\`\`\`markdown
| Header 1 | Header 2 |
|----------|----------|
| Cell 1   | Cell 2   |
\`\`\`

================================================================================
SECTION 6: CONVERSATION HANDLING
================================================================================

## 6.1 QUESTION TYPES AND RESPONSE PATTERNS

### Type 1: Questions About Note Content
User asks about what's in their note.

**Response Pattern:**
- Answer directly using the note content
- Be specific, cite relevant parts
- NO edit command needed (unless asked to add the answer to note)

**Examples:**
User: "What are the main topics in this note?"
Response: "Your note covers three main topics: virtual environment creation, activation methods for different operating systems, and dependency management with pip. The focus is on Python development workflow."

User: "How many steps are in my process?"
Response: "Your note outlines 5 steps: initialization, data loading, preprocessing, training, and evaluation."

### Type 2: Requests to Add/Create Content
User wants something added to the note.

**Response Pattern:**
- Brief acknowledgment (1 sentence max)
- Edit command with ACTUAL content
- NO lengthy explanation

**Examples:**
User: "Add a summary"
Response: "Here's a summary of the key points.

${e.start}
{"action": "append", "params": {"text": "\\n\\n## Summary\\n\\n- Point 1 from the note\\n- Point 2 from the note\\n- Point 3 from the note"}}
${e.end}"

User: "Create a diagram of this process"
Response: "Here's a flowchart of the process.

${e.start}
{"action": "append", "params": {"text": "\\n\\n\`\`\`mermaid\\nflowchart TD\\n    A[Start] --> B[Step 1]\\n    B --> C[Step 2]\\n    C --> D[End]\\n\`\`\`"}}
${e.end}"

### Type 3: Requests to Modify Content
User wants existing content changed.

**Response Pattern:**
- State what you're changing (1 sentence)
- Use most targeted edit command
- Preserve unchanged content

**Examples:**
User: "Fix the grammar in the introduction"
Response: "I'll correct the grammatical errors in your introduction.

${e.start}
{"action": "update_section", "params": {"heading": "Introduction", "content": "[Corrected introduction text maintaining original meaning]"}}
${e.end}"

User: "Change 'utilise' to 'use' throughout"
Response: "I'll replace all instances.

${e.start}
{"action": "find_replace", "params": {"find": "utilise", "replace": "use", "all": true}}
${e.end}"

### Type 4: General Chat/Questions
User wants information or conversation.

**Response Pattern:**
- Provide helpful response
- No edit command (unless they want it in the note)
- Be concise but complete

**Examples:**
User: "What's the best way to structure a technical doc?"
Response: "For technical documentation, use this structure: 1) Overview with purpose and scope, 2) Prerequisites listing requirements, 3) Step-by-step instructions with code examples, 4) Troubleshooting for common issues, 5) References for further reading. Each section should be self-contained where possible."

### Type 5: Ambiguous Requests
User's intent isn't clear.

**Response Pattern:**
- Make reasonable assumption based on context
- Provide the result
- Mention alternative interpretation if significant

**Examples:**
User: "diagram" (just one word)
Response: "Here's a diagram based on your note's content.

${e.start}
{"action": "append", "params": {"text": "\\n\\n\`\`\`mermaid\\nflowchart TD\\n    A[Main Topic] --> B[Subtopic 1]\\n    A --> C[Subtopic 2]\\n    B --> D[Detail]\\n    C --> E[Detail]\\n\`\`\`"}}
${e.end}

If you wanted a different type of diagram (sequence, class, etc.), let me know."

## 6.2 HANDLING PARTIAL REQUESTS

When users give minimal input, interpret based on context:

| User Says | Interpret As | Action |
|-----------|--------------|--------|
| "diagram" | "Create a diagram of the note content" | Generate + append |
| "table" | "Create a table from the note data" | Generate + append |
| "summary" | "Summarize this note" | Generate + append |
| "fix it" | "Fix the obvious issue" | Use find_replace |
| "add more" | "Expand the current topic" | Use append |
| "clean up" | "Improve formatting/organization" | Appropriate edits |

## 6.3 ERROR RECOVERY

### If Edit Fails:
- Acknowledge the failure
- Offer alternative approach
- Don't blame the user

### If Request is Impossible:
- Explain why briefly
- Suggest alternative
- Offer what you can do

### If Note is Empty:
- Acknowledge it
- Offer to help create initial content
- Suggest structure

================================================================================
SECTION 7: RESPONSE QUALITY STANDARDS
================================================================================

## 7.1 BREVITY REQUIREMENTS

**Maximum Response Lengths:**
| Response Type | Max Length |
|--------------|------------|
| Simple acknowledgment | 1 sentence |
| Explanation before edit | 1-2 sentences |
| Question answer | 2-4 sentences |
| Complex explanation | 1 paragraph |

**Avoid:**
- Repeating the user's question back
- Explaining what you're about to do in detail
- Summarizing what you just did
- Offering excessive alternatives
- Thanking the user repeatedly

## 7.2 FORBIDDEN PHRASES

Never use these phrases:
- "I'd be happy to..."
- "Certainly! I can..."
- "Sure thing! Let me..."
- "Absolutely! Here's..."
- "Great question!..."
- "That's a good request..."
- "I'll help you with..."
- "Let me explain..."
- "First, I'll..."
- "To accomplish this..."
- "Based on your request..."
- "As you asked..."

Instead, just do the thing.

## 7.3 RESPONSE TEMPLATES

### For Adding Content:
"[Brief description of what's being added].

${e.start}
{edit command}
${e.end}"

### For Modifying Content:
"[Brief description of change].

${e.start}
{edit command}
${e.end}"

### For Answering Questions:
"[Direct answer to the question, using note content as evidence]."

### For Errors/Limitations:
"[Brief explanation of issue]. [Alternative suggestion]."

================================================================================
SECTION 8: ADVANCED PATTERNS
================================================================================

## 8.1 MULTI-STEP OPERATIONS

For complex requests requiring multiple changes:
1. Acknowledge the scope briefly
2. Provide each edit command sequentially
3. Let user apply one at a time

**Example:**
User: "Add a table of contents and a conclusion"

Response: "I'll add both. First, the table of contents:

${e.start}
{"action": "prepend", "params": {"text": "## Table of Contents\\n\\n- [[#Introduction]]\\n- [[#Main Content]]\\n- [[#Conclusion]]\\n\\n---\\n\\n"}}
${e.end}

And the conclusion:

${e.start}
{"action": "append", "params": {"text": "\\n\\n## Conclusion\\n\\nThis document covered the key aspects of [topic]. The main takeaways are [point 1], [point 2], and [point 3]."}}
${e.end}"

## 8.2 CONDITIONAL RESPONSES

When you're unsure about the user's intent, but can make a reasonable guess:

**Pattern:** Take action + offer alternative

**Example:**
User: "reorganize"

Response: "I've restructured the note with improved section ordering.

${e.start}
{"action": "replace_all", "params": {"content": "[reorganized content]"}}
${e.end}

If you meant a different type of reorganization (alphabetical, by topic, etc.), let me know."

## 8.3 HANDLING LARGE NOTES

For notes over 5000 words:
- Focus on the specific section mentioned
- Use targeted actions (find_replace, update_section)
- Avoid replace_all unless necessary
- Break large changes into multiple edits

## 8.4 HANDLING SENSITIVE CONTENT

If the note contains sensitive information:
- Don't repeat sensitive data unnecessarily
- Focus on structure over specific content
- Be extra careful with replace_all

================================================================================
SECTION 9: EXAMPLES LIBRARY (COMPREHENSIVE)
================================================================================

## 9.1 DIAGRAM GENERATION EXAMPLES

### Example: User asks for flowchart

**Context:** Note about user authentication flow
**User:** "Create a diagram"

**Response:**
"Here's a flowchart of the authentication process.

${e.start}
{"action": "append", "params": {"text": "\\n\\n## Authentication Flow\\n\\n\`\`\`mermaid\\nflowchart TD\\n    A[User Enters Credentials] --> B[Validate Input]\\n    B --> C{Valid Format}\\n    C -->|No| D[Show Error]\\n    D --> A\\n    C -->|Yes| E[Check Database]\\n    E --> F{User Exists}\\n    F -->|No| G[Show Invalid Message]\\n    F -->|Yes| H{Password Correct}\\n    H -->|No| G\\n    H -->|Yes| I[Generate Token]\\n    I --> J[Redirect to Dashboard]\\n\`\`\`"}}
${e.end}"

### Example: User asks for sequence diagram

**Context:** Note about API communication
**User:** "Add a sequence diagram showing the API flow"

**Response:**
"Here's a sequence diagram of the API communication.

${e.start}
{"action": "append", "params": {"text": "\\n\\n## API Sequence\\n\\n\`\`\`mermaid\\nsequenceDiagram\\n    participant C as Client\\n    participant G as API Gateway\\n    participant A as Auth Service\\n    participant D as Database\\n    \\n    C->>G: POST /api/login\\n    G->>A: Validate Token\\n    A->>D: Query User\\n    D-->>A: User Data\\n    A-->>G: Token Valid\\n    G-->>C: 200 OK with Data\\n\`\`\`"}}
${e.end}"

### Example: User asks for class diagram

**Context:** Note about object-oriented design
**User:** "Create a class diagram for the models"

**Response:**
"Here's a class diagram showing the model relationships.

${e.start}
{"action": "append", "params": {"text": "\\n\\n## Class Diagram\\n\\n\`\`\`mermaid\\nclassDiagram\\n    class User {\\n        +int id\\n        +String name\\n        +String email\\n        +login()\\n        +logout()\\n    }\\n    class Order {\\n        +int id\\n        +Date createdAt\\n        +float total\\n        +addItem()\\n        +removeItem()\\n    }\\n    class Product {\\n        +int id\\n        +String name\\n        +float price\\n    }\\n    User \\"1\\" --> \\"*\\" Order\\n    Order \\"*\\" --> \\"*\\" Product\\n\`\`\`"}}
${e.end}"

## 9.2 TEXT MODIFICATION EXAMPLES

### Example: Fix grammar

**User:** "Fix the grammar in this note"

**Response:**
"I've corrected the grammatical errors throughout your note.

${e.start}
{"action": "find_replace", "params": {"find": "their is", "replace": "there is", "all": true}}
${e.end}

${e.start}
{"action": "find_replace", "params": {"find": "its a", "replace": "it's a", "all": true}}
${e.end}"

### Example: Improve a section

**User:** "Make the introduction more engaging"

**Response:**
"Here's a more engaging introduction.

${e.start}
{"action": "update_section", "params": {"heading": "Introduction", "content": "What if you could automate 80% of your daily tasks? This guide reveals the exact workflow that transformed our team's productivity, eliminating hours of repetitive work while actually improving quality. Here's how to implement it in your own projects."}}
${e.end}"

### Example: Add bullet points

**User:** "Convert the paragraph about benefits to bullet points"

**Response:**
"I've converted the benefits to a bulleted list.

${e.start}
{"action": "update_section", "params": {"heading": "Benefits", "content": "- Reduces processing time by 40%\\n- Eliminates manual data entry errors\\n- Integrates seamlessly with existing tools\\n- Requires no additional training\\n- Scales automatically with demand"}}
${e.end}"

## 9.3 CONTENT ADDITION EXAMPLES

### Example: Add conclusion

**User:** "Add a conclusion"

**Response:**
"Here's a conclusion summarizing the key points.

${e.start}
{"action": "append", "params": {"text": "\\n\\n## Conclusion\\n\\nThis guide covered the essential steps for setting up a development environment, from installing prerequisites to configuring your IDE. The key takeaways are: always use virtual environments, version control everything, and document your setup for future reference. With this foundation, you're ready to start building robust applications."}}
${e.end}"

### Example: Add table

**User:** "Create a comparison table"

**Response:**
"Here's a comparison table based on your note content.

${e.start}
{"action": "append", "params": {"text": "\\n\\n## Comparison\\n\\n| Approach | Speed | Cost | Complexity | Best For |\\n|----------|-------|------|------------|----------|\\n| Manual | Slow | Free | Low | Small tasks |\\n| Semi-Auto | Medium | Low | Medium | Regular tasks |\\n| Full Auto | Fast | High | High | Scale operations |"}}
${e.end}"

### Example: Add code block

**User:** "Add an example code snippet"

**Response:**
"Here's an example implementation.

${e.start}
{"action": "append", "params": {"text": "\\n\\n## Example Code\\n\\n\`\`\`python\\ndef process_data(input_data):\\n    # Validate input\\n    if not input_data:\\n        raise ValueError(\\"Input cannot be empty\\")\\n    \\n    # Process and return\\n    results = [transform(item) for item in input_data]\\n    return results\\n\`\`\`"}}
${e.end}"

## 9.4 ANALYSIS EXAMPLES

### Example: Summarize note

**User:** "What is this note about?"

**Response:**
"Your note is a technical guide for setting up Python virtual environments. It covers three main areas: creating virtual environments using venv, activating them on different operating systems (Windows and Unix-based), and managing dependencies with pip. The note is structured as a step-by-step tutorial aimed at beginners."

### Example: Extract action items

**User:** "What are the action items?"

**Response:**
"Based on your note, the action items are:
1. Install Python 3.10 or higher
2. Create a new project directory
3. Initialize the virtual environment
4. Install required dependencies from requirements.txt
5. Configure VS Code to use the venv interpreter"

### Example: Identify issues

**User:** "Are there any issues with this note?"

**Response:**
"I noticed a few issues:
1. The section on activation is missing the Windows PowerShell command
2. There's a typo in 'requeriments.txt' (should be 'requirements.txt')
3. The pip install example references a package name placeholder instead of actual packages

Would you like me to fix any of these?"

================================================================================
SECTION 10: FINAL CHECKLIST (EXECUTE BEFORE EVERY RESPONSE)
================================================================================

## 10.1 PRE-RESPONSE CHECKLIST

Before sending ANY response, verify:

### For Action Requests:
\u25A1 Does my response contain an edit command with actual content?
\u25A1 Is the content specific to this note (not generic placeholders)?
\u25A1 Did I use the most targeted action (find_replace > replace_all)?
\u25A1 Is my explanation under 2 sentences?
\u25A1 Did I avoid starting with "I'll..." without delivering?

### For Mermaid Diagrams:
\u25A1 Did I use only safe characters (letters, numbers, spaces, hyphens)?
\u25A1 Are all node labels under 40 characters?
\u25A1 Did I avoid quotes, parentheses, colons, brackets, backticks?
\u25A1 Is the diagram in an edit command (not just shown)?

### For Questions:
\u25A1 Did I answer using the actual note content?
\u25A1 Is my response direct and specific?
\u25A1 Did I avoid unnecessary preamble?

### For Modifications:
\u25A1 Did I preserve unchanged content?
\u25A1 Did I use the minimum necessary edit scope?
\u25A1 Did I clearly state what changed?

## 10.2 POST-RESPONSE VALIDATION

After generating response, check:

\u25A1 If user asked to CREATE something, does response CREATE it?
\u25A1 If user asked to ADD something, does response ADD it?
\u25A1 If user asked to FIX something, does response FIX it?
\u25A1 Is there actual deliverable content, not just description?

## 10.3 FAILURE MODES TO AVOID

NEVER DO THESE:
1. Respond with only text when action was requested
2. Describe what you will do without doing it
3. Use placeholder text like [insert here]
4. Ask what the note contains (you can see it)
5. Use replace_all for small changes
6. Include special characters in Mermaid labels
7. Write excessive explanation before/after edits
8. Repeat the user's request back to them
9. Thank the user for their request
10. Offer to do something instead of doing it

## CRITICAL: NEVER ASK CLARIFYING QUESTIONS FOR ACTION REQUESTS

**BANNED RESPONSES:**
- "Which topic would you like..."
- "Could you let me know..."
- "What section should I..."
- "Would you prefer..."
- "Can you specify..."

**WHEN USER SAYS "CREATE A DIAGRAM" AND NOTE CONTEXT EXISTS:**
\u2192 Analyze the note content YOU CAN SEE
\u2192 Identify the main process/structure/flow
\u2192 Generate a diagram of THE ENTIRE NOTE or its primary topic
\u2192 DO NOT ASK - JUST CREATE

**FALLBACK RULE:**
If the note has:
- Steps/process \u2192 Create flowchart
- Multiple items/topics \u2192 Create mindmap
- Relationships \u2192 Create ER or class diagram
- Timeline/sequence \u2192 Create sequence diagram
- Comparisons \u2192 Create table instead

**EXAMPLE:**
User: "Create a diagram"
Note contains: Python venv setup steps

WRONG: "Which part would you like visualized?"
CORRECT: [Immediately output flowchart of the venv setup process]
================================================================================
END OF SYSTEM INSTRUCTIONS
================================================================================

Remember: Your primary job is to EXECUTE requests, not discuss them. When in doubt, provide the result. Users prefer imperfect action over perfect inaction.

Current Note Context:
{note_context_injected_here}`}async buildContextMessage(e,t){if(!t)return e;let n=await this.noteController.getNoteContext();if(!n)return e;let s=[];return s.push("=== CURRENT NOTE CONTEXT ==="),s.push(`Path: ${n.path}`),n.frontmatter&&(s.push(`
Frontmatter:`),s.push("```yaml"),s.push(JSON.stringify(n.frontmatter,null,2)),s.push("```")),s.push(`
Note Content:`),s.push("```markdown"),s.push(this.truncateContent(n.content)),s.push("```"),n.selection&&n.selectionRange&&(s.push(`
User Selection (Lines ${n.selectionRange.startLine+1}-${n.selectionRange.endLine+1}):`),s.push("```"),s.push(n.selection),s.push("```")),n.cursorPosition&&s.push(`
Cursor Position: Line ${n.cursorPosition.line+1}, Column ${n.cursorPosition.ch+1}`),s.push(`=== END CONTEXT ===
`),s.push("User Request:"),s.push(e),s.join(`
`)}truncateContent(e){if(e.length<=te.MAX_NOTE_CHARS)return e;let t=Math.floor(te.MAX_NOTE_CHARS/2),n=e.substring(0,t),s=e.substring(e.length-t);return`${n}

[...truncated ${e.length-te.MAX_NOTE_CHARS} characters...]

${s}`}convertToLLMMessages(e,t,n){let s=[];for(let o of e)s.push({role:o.role,content:o.content});return s}async buildMessages(e,t,n){let s=[];for(let i of e)s.push({role:i.role,content:i.content});let o=await this.buildContextMessage(t,n);return s.push({role:"user",content:o}),s}async getContextSummary(){let e=await this.noteController.getNoteContext();if(!e)return null;let t=[];if(t.push(`\u{1F4C4} ${e.basename}`),e.selection){let s=e.selectionRange?` (L${e.selectionRange.startLine+1}-${e.selectionRange.endLine+1})`:"";t.push(`\u{1F4DD} Selection${s}`)}let n=e.content.split(/\s+/).length;return t.push(`${n} words`),t.join(" \u2022 ")}async hasNoteContext(){return this.noteController.hasActiveNote()}estimateTokens(e){return Math.ceil(e.length/te.CHARS_PER_TOKEN)}getMaxMessageLength(){return te.MAX_NOTE_CHARS}};te.MAX_NOTE_TOKENS=8e3,te.CHARS_PER_TOKEN=4,te.MAX_NOTE_CHARS=te.MAX_NOTE_TOKENS*te.CHARS_PER_TOKEN;var Wn=te;var b=require("obsidian");var Ee=class Ee{extractMermaidBlocks(e){let t=[],n=new RegExp(Ee.MERMAID_PATTERN.source,"g"),s;for(;(s=n.exec(e))!==null;)t.push({code:s[1].trim(),startIndex:s.index,endIndex:s.index+s[0].length});return t}hasMermaid(e){return Ee.MERMAID_PATTERN.test(e)}validateMermaid(e){let t=e.trim();if(!t)return{valid:!1,diagramType:null,error:"Empty Mermaid code"};let n=t.split(`
`)[0].trim().toLowerCase(),s=null;for(let d of Ee.DIAGRAM_TYPES)if(n.startsWith(d.toLowerCase())){s=d;break}if(!s)return{valid:!1,diagramType:null,error:`Unknown diagram type. First line: "${n}"`};let o=(t.match(/\[/g)||[]).length,i=(t.match(/\]/g)||[]).length,a=(t.match(/\(/g)||[]).length,c=(t.match(/\)/g)||[]).length,l=(t.match(/\{/g)||[]).length,u=(t.match(/\}/g)||[]).length;return o!==i?{valid:!1,diagramType:s,error:"Mismatched brackets []"}:a!==c?{valid:!1,diagramType:s,error:"Mismatched parentheses ()"}:l!==u?{valid:!1,diagramType:s,error:"Mismatched braces {}"}:{valid:!0,diagramType:s,error:null}}sanitizeMermaidCode(e){let t=e.split(`
`),n=[];for(let s of t){let o=s,i=[/(\w+)\s*\[([^\]]+)\]/g,/(\w+)\s*\(([^)]+)\)/g,/(\w+)\s*\{([^}]+)\}/g,/(\w+)\s*\[\[([^\]]+)\]\]/g,/(\w+)\s*\[\(([^)]+)\)\]/g,/(\w+)\s*\(\[([^\]]+)\]\)/g,/(\w+)\s*\(\(([^)]+)\)\)/g,/(\w+)\s*\[\{([^}]+)\}\]/g];for(let a of i)o=o.replace(a,(c,l,u)=>{let d=this.sanitizeNodeLabel(u),p=c.indexOf(l)+l.length,m=c.substring(p).replace(u,d);return l+m});o=o.replace(/\|([^|]+)\|/g,(a,c)=>`|${this.sanitizeNodeLabel(c)}|`),n.push(o)}return n.join(`
`)}sanitizeNodeLabel(e){let t=e;return t=t.replace(/`/g,""),t=t.replace(/:\s*/g," - "),t=t.replace(/:/g," "),t=t.replace(/["']/g,""),t=t.replace(/[()]/g," "),t=t.replace(/[\[\]]/g," "),t=t.replace(/[{}]/g," "),t=t.replace(/[;|<>&@#$%^*+=\\]/g," "),t=t.replace(/\s+/g," ").trim(),t}formatForInsertion(e){return`\`\`\`mermaid
${this.sanitizeMermaidCode(e).trim()}
\`\`\``}formatForInsertionRaw(e){return`\`\`\`mermaid
${e.trim()}
\`\`\``}extractMermaidCode(e){return this.extractMermaidBlocks(e).map(n=>this.sanitizeMermaidCode(n.code))}extractMermaidCodeRaw(e){return this.extractMermaidBlocks(e).map(n=>n.code)}getDiagramType(e){let t=e.trim().split(`
`)[0].trim().toLowerCase();for(let n of Ee.DIAGRAM_TYPES)if(t.startsWith(n.toLowerCase()))return n;return null}createFlowchartTemplate(e,t,n){let s=["flowchart TD"];for(let o of t)s.push(`    ${o.id}[${o.label}]`);for(let o of n){let i=o.label?`|${o.label}|`:"";s.push(`    ${o.from} -->${i} ${o.to}`)}return s.join(`
`)}createSequenceTemplate(e,t){let n=["sequenceDiagram"];for(let s of e)n.push(`    participant ${s}`);for(let s of t){let o=(s.type==="async","->>");n.push(`    ${s.from}${o}${s.to}: ${s.message}`)}return n.join(`
`)}createClassTemplate(e,t){let n=["classDiagram"];for(let o of e){if(n.push(`    class ${o.name} {`),o.attributes)for(let i of o.attributes)n.push(`        ${i}`);if(o.methods)for(let i of o.methods)n.push(`        ${i}()`);n.push("    }")}let s={inheritance:"<|--",composition:"*--",aggregation:"o--",association:"--"};for(let o of t){let i=s[o.type]||"--";n.push(`    ${o.from} ${i} ${o.to}`)}return n.join(`
`)}createPieTemplate(e,t){let n=[`pie title ${e}`];for(let s of t)n.push(`    "${s.label}" : ${s.value}`);return n.join(`
`)}createGanttTemplate(e,t){let n=["gantt",`    title ${e}`,"    dateFormat YYYY-MM-DD"];for(let s of t){n.push(`    section ${s.name}`);for(let o of s.tasks){let i=o.after?`, after ${o.after}`:"";n.push(`    ${o.name} :${i} ${o.duration}`)}}return n.join(`
`)}replaceMermaidWithPlaceholders(e){let t=this.extractMermaidBlocks(e),n=e,s=0;for(let o=0;o<t.length;o++){let i=t[o],a=`[MERMAID_DIAGRAM_${o}]`,c=i.endIndex-i.startIndex;n=n.substring(0,i.startIndex-s)+a+n.substring(i.endIndex-s),s+=c-a.length}return{text:n,blocks:t}}static getSupportedDiagramTypes(){return[...Ee.DIAGRAM_TYPES]}};Ee.MERMAID_PATTERN=/```mermaid\n([\s\S]*?)```/g,Ee.DIAGRAM_TYPES=["flowchart","graph","sequenceDiagram","classDiagram","stateDiagram","stateDiagram-v2","erDiagram","gantt","pie","journey","gitGraph","mindmap","timeline","quadrantChart","xychart-beta","block-beta","sankey-beta"];var Yn=Ee;var Io=class extends b.FuzzySuggestModal{constructor(e,t){super(e),this.onSelect=t,this.setPlaceholder("Search for a note to reference...")}getItems(){return this.app.vault.getMarkdownFiles()}getItemText(e){return e.path}onChooseItem(e){this.onSelect(e)}},Kn=class extends b.ItemView{constructor(t,n){super(t);this.chatHistory=[];this.isLoading=!1;this.referencedNotes=[];this.plugin=n,this.editProtocol=new Et(this.plugin.noteController),this.mermaidHandler=new Yn}getViewType(){return Oe}getDisplayText(){return"AI Assistant"}getIcon(){return"bot"}async onOpen(){let t=this.containerEl.children[1];t.empty(),t.addClass("ai-assistant-container"),this.createHeader(t),this.messagesContainer=t.createDiv({cls:"ai-assistant-messages"}),this.createInputArea(t),this.addWelcomeMessage(),this.registerEvent(this.app.workspace.on("active-leaf-change",()=>{this.updateActiveNoteDisplay()})),this.updateActiveNoteDisplay()}async onClose(){}createHeader(t){let n=t.createDiv({cls:"ai-assistant-header"}),s=n.createDiv({cls:"ai-assistant-header-left"}),o=s.createDiv({cls:"ai-assistant-title-row"}),i=o.createSpan({cls:"ai-assistant-logo"});(0,b.setIcon)(i,"bot"),o.createSpan({text:"AI Assistant",cls:"ai-assistant-title-text"});let a=s.createDiv({cls:"ai-assistant-selectors"}),c=a.createDiv({cls:"ai-assistant-selector-group"});c.createSpan({text:"Provider:",cls:"ai-assistant-selector-label"}),this.providerSelector=c.createEl("select",{cls:"ai-assistant-provider-select"});for(let[m,g]of Object.entries(ie)){let y=this.providerSelector.createEl("option",{value:m,text:g});m===this.plugin.settings.provider&&(y.selected=!0)}this.providerSelector.addEventListener("change",async()=>{this.plugin.settings.provider=this.providerSelector.value,await this.plugin.saveSettings(),this.plugin.reinitializeLLMService(),this.updateModelSelector()});let l=a.createDiv({cls:"ai-assistant-selector-group"});l.createSpan({text:"Model:",cls:"ai-assistant-selector-label"}),this.modelSelector=l.createEl("select",{cls:"ai-assistant-model-select"}),this.updateModelSelector(),this.modelSelector.addEventListener("change",async()=>{let m=this.plugin.settings.provider;m==="bedrock"?this.plugin.settings.bedrockModelId=this.modelSelector.value:m==="gemini"?this.plugin.settings.geminiModelId=this.modelSelector.value:m==="groq"&&(this.plugin.settings.groqModelId=this.modelSelector.value),await this.plugin.saveSettings()});let u=n.createDiv({cls:"ai-assistant-header-actions"}),d=u.createEl("button",{cls:"ai-assistant-header-btn",attr:{"aria-label":"New chat"}});(0,b.setIcon)(d,"plus"),d.addEventListener("click",()=>this.clearChat());let p=u.createEl("button",{cls:"ai-assistant-header-btn",attr:{"aria-label":"Settings"}});(0,b.setIcon)(p,"settings"),p.addEventListener("click",()=>{this.app.setting.open(),this.app.setting.openTabById(this.plugin.manifest.id)})}async updateModelSelector(){this.modelSelector.empty();let t=this.plugin.settings.provider,n=[],s="";if(t==="bedrock")n=Object.entries(Ft).map(([a,c])=>({id:a,name:c})),s=this.plugin.settings.bedrockModelId;else if(t==="gemini"){if(this.plugin.settings.geminiApiKey){let a=await B.fetchGeminiModels(this.plugin.settings.geminiApiKey);n=a.length>0?a:B.getFallbackGeminiModels()}else n=B.getFallbackGeminiModels();s=this.plugin.settings.geminiModelId}else if(t==="groq"){if(this.plugin.settings.groqApiKey){let a=await B.fetchGroqModels(this.plugin.settings.groqApiKey);n=a.length>0?a:B.getFallbackGroqModels()}else n=B.getFallbackGroqModels();s=this.plugin.settings.groqModelId}let o=n.some(a=>a.id===s);s&&!o&&n.unshift({id:s,name:`${s} (saved)`});let i=!1;for(let a of n){let c=this.modelSelector.createEl("option",{value:a.id,text:a.name});a.id===s&&(c.selected=!0,i=!0)}if(!i&&n.length>0){this.modelSelector.selectedIndex=0;let a=n[0].id;t==="bedrock"?this.plugin.settings.bedrockModelId=a:t==="gemini"?this.plugin.settings.geminiModelId=a:t==="groq"&&(this.plugin.settings.groqModelId=a),await this.plugin.saveSettings()}}createInputArea(t){this.inputContainer=t.createDiv({cls:"ai-assistant-input-wrapper"});let n=this.inputContainer.createDiv({cls:"ai-assistant-context-section"}),s=n.createDiv({cls:"ai-assistant-active-note-row"}),o=s.createDiv({cls:"ai-assistant-toggle-wrapper"});this.contextToggle=o.createEl("input",{type:"checkbox",cls:"ai-assistant-context-toggle"}),this.contextToggle.checked=this.plugin.settings.autoIncludeContext,this.contextToggle.id="context-toggle",o.createEl("label",{attr:{for:"context-toggle"},cls:"ai-assistant-toggle-label-modern"}).createSpan({cls:"ai-assistant-toggle-slider"}),this.activeNoteDisplay=s.createDiv({cls:"ai-assistant-active-note-display"}),this.updateActiveNoteDisplay(),this.contextToggle.addEventListener("change",async()=>{this.plugin.settings.autoIncludeContext=this.contextToggle.checked,await this.plugin.saveSettings(),this.updateActiveNoteDisplay()});let a=n.createDiv({cls:"ai-assistant-references-row"}),c=a.createEl("button",{cls:"ai-assistant-add-ref-btn",attr:{"aria-label":"Add note reference"}});(0,b.setIcon)(c,"file-plus"),c.createSpan({text:"Add Note Reference"}),c.addEventListener("click",()=>this.openNoteSuggester()),this.referencedNotesContainer=a.createDiv({cls:"ai-assistant-referenced-notes"});let l=this.inputContainer.createDiv({cls:"ai-assistant-input-area-modern"}),u=l.createDiv({cls:"ai-assistant-textarea-container"});this.inputTextarea=u.createEl("textarea",{cls:"ai-assistant-input-modern",attr:{placeholder:"Ask me anything about your notes...",rows:"1"}}),this.inputTextarea.addEventListener("input",()=>{this.inputTextarea.style.height="auto";let m=Math.min(Math.max(this.inputTextarea.scrollHeight,44),200);this.inputTextarea.style.height=m+"px"}),this.inputTextarea.addEventListener("input",m=>{let g=this.inputTextarea.value,y=this.inputTextarea.selectionStart;g.substring(0,y).endsWith("@")&&this.openNoteSuggester()}),this.inputTextarea.addEventListener("keydown",m=>{m.key==="Enter"&&!m.shiftKey&&(m.preventDefault(),this.sendMessage())}),this.sendButton=l.createEl("button",{cls:"ai-assistant-send-btn-modern",attr:{"aria-label":"Send message"}});let d=this.sendButton.createSpan({cls:"ai-assistant-send-icon"});(0,b.setIcon)(d,"send"),this.sendButton.addEventListener("click",()=>this.sendMessage()),this.inputContainer.createDiv({cls:"ai-assistant-hint"}).createSpan({text:"Press Enter to send \u2022 Shift+Enter for new line \u2022 @ to reference notes"})}updateActiveNoteDisplay(){if(!this.activeNoteDisplay)return;if(this.activeNoteDisplay.empty(),!this.contextToggle.checked){this.activeNoteDisplay.createSpan({text:"Active note not included",cls:"ai-assistant-note-disabled"});return}let t=this.app.workspace.getActiveFile();if(t){let n=this.activeNoteDisplay.createDiv({cls:"ai-assistant-note-tag"}),s=n.createSpan({cls:"ai-assistant-note-icon"});(0,b.setIcon)(s,"file-text"),n.createSpan({text:t.basename,cls:"ai-assistant-note-name"})}else this.activeNoteDisplay.createSpan({text:"No note open",cls:"ai-assistant-note-disabled"})}openNoteSuggester(){new Io(this.app,t=>{this.addReferencedNote(t)}).open()}addReferencedNote(t){this.referencedNotes.some(n=>n.path===t.path)||(this.referencedNotes.push(t),this.renderReferencedNotes())}removeReferencedNote(t){this.referencedNotes=this.referencedNotes.filter(n=>n.path!==t.path),this.renderReferencedNotes()}renderReferencedNotes(){this.referencedNotesContainer.empty();for(let t of this.referencedNotes){let n=this.referencedNotesContainer.createDiv({cls:"ai-assistant-ref-tag"}),s=n.createSpan({cls:"ai-assistant-ref-icon"});(0,b.setIcon)(s,"file-text"),n.createSpan({text:t.basename,cls:"ai-assistant-ref-name"});let o=n.createSpan({cls:"ai-assistant-ref-remove"});(0,b.setIcon)(o,"x"),o.addEventListener("click",i=>{i.stopPropagation(),this.removeReferencedNote(t)})}}addWelcomeMessage(){let t=this.messagesContainer.createDiv({cls:"ai-assistant-welcome-modern"}),n=t.createDiv({cls:"ai-assistant-welcome-logo"});(0,b.setIcon)(n,"bot"),t.createEl("h2",{text:"How can I help you today?"}),t.createEl("p",{text:"I can help you write, edit, and analyze your notes. Try one of these:",cls:"ai-assistant-welcome-subtitle"});let s=t.createDiv({cls:"ai-assistant-suggestions-grid"}),o=[{icon:"file-text",text:"Summarize this note",desc:"Get a quick summary"},{icon:"spell-check",text:"Fix grammar and spelling",desc:"Polish your writing"},{icon:"list-plus",text:"Add a conclusion",desc:"Complete your note"},{icon:"git-branch",text:"Create a diagram",desc:"Visualize concepts"}];for(let i of o){let a=s.createDiv({cls:"ai-assistant-suggestion-card"}),c=a.createDiv({cls:"ai-assistant-suggestion-icon"});(0,b.setIcon)(c,i.icon),a.createDiv({text:i.text,cls:"ai-assistant-suggestion-text"}),a.createDiv({text:i.desc,cls:"ai-assistant-suggestion-desc"}),a.addEventListener("click",()=>{this.inputTextarea.value=i.text,this.inputTextarea.focus()})}}async sendMessage(t){let n=t!=null?t:this.inputTextarea.value.trim();if(!n||this.isLoading)return;t||(this.inputTextarea.value="",this.inputTextarea.style.height="auto");let s=this.messagesContainer.querySelector(".ai-assistant-welcome-modern");s&&s.remove();let o=this.createChatMessage("user",n);this.chatHistory.push(o),this.renderMessage(o),this.setLoading(!0);let i=this.createChatMessage("assistant","");this.chatHistory.push(i);let a=this.renderMessage(i,!0),c=a.querySelector(".ai-assistant-message-content");try{let l=n;this.referencedNotes.length>0&&(l=await this.buildReferencedNotesContext()+`

User Request: `+n);let d=this.chatHistory.slice(0,-1).slice(-10),p=await this.plugin.contextBuilder.buildMessages(d,l,this.contextToggle.checked),m=this.plugin.contextBuilder.buildSystemPrompt(this.plugin.settings.systemPrompt),g="";if(this.plugin.settings.streamResponses){let y=this.plugin.llmService.sendMessageStream(p,m);for await(let S of y)g+=S,i.content=g,await this.updateMessageContent(c,g),this.scrollToBottom()}else g=await this.plugin.llmService.sendMessage(p,m),i.content=g,await this.updateMessageContent(c,g);i.editCommands=this.editProtocol.parseEditCommands(g),i.mermaidBlocks=this.mermaidHandler.extractMermaidCode(g),this.addMessageActions(a,i)}catch(l){let u=l instanceof Error?l.message:String(l),d=u,p="";u.includes("401")||u.includes("Unauthorized")||u.includes("invalid_api_key")?(d="Authentication Failed",p="Your API key is invalid or expired. Please check your API key in the plugin settings."):u.includes("403")||u.includes("Forbidden")||u.includes("access")?(d="Model Access Denied",p="You don't have access to the selected model. Try switching to a different model from the dropdown above, or check your API permissions."):u.includes("404")||u.includes("not found")?(d="Model Not Found",p="The selected model doesn't exist or is not available. Please select a different model."):u.includes("429")||u.includes("rate limit")||u.includes("quota")?(d="Rate Limit Exceeded",p="You've exceeded the API rate limit. Please wait a moment and try again."):u.includes("500")||u.includes("502")||u.includes("503")?(d="Server Error",p="The AI service is temporarily unavailable. Please try again later."):u.includes("timeout")||u.includes("ETIMEDOUT")?(d="Request Timeout",p="The request took too long. Please try again with a shorter message."):(u.includes("network")||u.includes("ENOTFOUND")||u.includes("fetch"))&&(d="Network Error",p="Unable to connect to the AI service. Please check your internet connection.");let m=p?`**\u26A0\uFE0F ${d}**

${p}

<details><summary>Technical Details</summary>

\`\`\`
${u}
\`\`\`
</details>`:`**\u26A0\uFE0F Error:** ${u}`;i.content=m,await this.updateMessageContent(c,m),c.addClass("ai-assistant-error")}finally{this.setLoading(!1),this.scrollToBottom()}}async buildReferencedNotesContext(){let t=[];t.push("=== ADDITIONAL REFERENCED NOTES ==="),t.push(`(The user has explicitly referenced these notes for context. Use this information to answer their question.)
`);for(let n=0;n<this.referencedNotes.length;n++){let s=this.referencedNotes[n],o=await this.app.vault.read(s);t.push(`### Referenced Note ${n+1}: "${s.basename}"`),t.push(`Path: ${s.path}`),t.push("Content:"),t.push("```markdown"),t.push(o.substring(0,8e3)),t.push("```\n")}return t.push(`=== END REFERENCED NOTES ===
`),t.join(`
`)}createChatMessage(t,n){return{id:crypto.randomUUID(),role:t,content:n,timestamp:new Date}}renderMessage(t,n=!1){let s=this.messagesContainer.createDiv({cls:`ai-assistant-message ai-assistant-message-${t.role}`}),o=s.createDiv({cls:"ai-assistant-avatar"});t.role==="assistant"?(0,b.setIcon)(o,"bot"):(0,b.setIcon)(o,"user");let i=s.createDiv({cls:"ai-assistant-message-wrapper"}),c=i.createDiv({cls:"ai-assistant-bubble"}).createDiv({cls:"ai-assistant-message-content"});if(t.content)this.updateMessageContent(c,t.content);else if(n){let d=c.createDiv({cls:"ai-assistant-typing-modern"});d.createSpan({cls:"ai-assistant-typing-dot"}),d.createSpan({cls:"ai-assistant-typing-dot"}),d.createSpan({cls:"ai-assistant-typing-dot"})}let l=i.createDiv({cls:"ai-assistant-message-meta-row"});if(l.createDiv({cls:"ai-assistant-message-meta"}).createSpan({text:t.timestamp.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),t.role==="user"&&t.content){let p=l.createDiv({cls:"ai-assistant-user-actions"}).createEl("button",{cls:"ai-assistant-action-btn-small",attr:{"aria-label":"Copy message"}});(0,b.setIcon)(p,"copy"),p.addEventListener("click",async()=>{await navigator.clipboard.writeText(t.content),(0,b.setIcon)(p,"check"),new b.Notice("Copied to clipboard"),setTimeout(()=>(0,b.setIcon)(p,"copy"),2e3)})}return this.scrollToBottom(),s}async updateMessageContent(t,n){t.empty();let s=this.editProtocol.getDisplayText(n);await b.MarkdownRenderer.render(this.app,s,t,"",this.plugin),t.querySelectorAll("pre").forEach(i=>{let a=i.createEl("button",{cls:"ai-assistant-copy-code",attr:{"aria-label":"Copy code"}});(0,b.setIcon)(a,"copy"),a.addEventListener("click",async()=>{var l,u;let c=(u=(l=i.querySelector("code"))==null?void 0:l.textContent)!=null?u:"";await navigator.clipboard.writeText(c),(0,b.setIcon)(a,"check"),setTimeout(()=>(0,b.setIcon)(a,"copy"),2e3)})})}addMessageActions(t,n){let s=t.querySelector(".ai-assistant-message-wrapper");if(!s)return;let o=s.createDiv({cls:"ai-assistant-message-actions"}),i=o.createEl("button",{cls:"ai-assistant-action-btn-modern",attr:{"aria-label":"Copy"}});(0,b.setIcon)(i,"copy"),i.addEventListener("click",async()=>{let c=this.editProtocol.getDisplayText(n.content);await navigator.clipboard.writeText(c),new b.Notice("Copied to clipboard")});let a=o.createEl("button",{cls:"ai-assistant-action-btn-modern",attr:{"aria-label":"Insert at cursor"}});if((0,b.setIcon)(a,"file-input"),a.addEventListener("click",()=>{let c=this.editProtocol.getDisplayText(n.content);this.plugin.noteController.insertAtCursor(c)?new b.Notice("Inserted at cursor"):new b.Notice("No active note")}),n.editCommands&&n.editCommands.length>0){let c=o.createEl("button",{cls:"ai-assistant-action-btn-modern ai-assistant-action-apply",attr:{"aria-label":"Apply edit"}});n.applied?((0,b.setIcon)(c,"check-circle"),c.disabled=!0,c.addClass("ai-assistant-action-applied")):((0,b.setIcon)(c,"edit"),c.addEventListener("click",async()=>{let l=await this.editProtocol.executeCommands(n.editCommands);if(l.every(d=>d.success))n.applied=!0,(0,b.setIcon)(c,"check-circle"),c.disabled=!0,c.addClass("ai-assistant-action-applied"),new b.Notice("Edit applied successfully");else{let d=l.find(p=>!p.success);new b.Notice(`Edit failed: ${d==null?void 0:d.message}`)}}))}if(n.mermaidBlocks&&n.mermaidBlocks.length>0){let c=o.createEl("button",{cls:"ai-assistant-action-btn-modern",attr:{"aria-label":"Insert diagram"}});(0,b.setIcon)(c,"git-branch"),c.addEventListener("click",()=>{for(let l of n.mermaidBlocks)this.plugin.noteController.insertMermaid(l)?new b.Notice("Diagram inserted"):new b.Notice("No active note")})}}setLoading(t){this.isLoading=t,this.sendButton.disabled=t,this.inputTextarea.disabled=t,t?this.sendButton.addClass("ai-assistant-loading"):this.sendButton.removeClass("ai-assistant-loading")}scrollToBottom(){this.messagesContainer.scrollTop=this.messagesContainer.scrollHeight}clearChat(){this.chatHistory=[],this.referencedNotes=[],this.messagesContainer.empty(),this.renderReferencedNotes(),this.addWelcomeMessage(),new b.Notice("Chat cleared")}getChatHistory(){return[...this.chatHistory]}focusInput(){var t;(t=this.inputTextarea)==null||t.focus()}async setInputAndSend(t,n=!1){this.inputTextarea&&(this.inputTextarea.value=t,n?await this.sendMessage():this.inputTextarea.focus())}};var Xn=class extends Jn.Plugin{constructor(){super(...arguments);this.chatView=null}async onload(){console.log("Loading AI Assistant plugin"),await this.loadSettings(),this.noteController=new Vn(this.app),this.llmService=new jn(this.settings),this.contextBuilder=new Wn(this.noteController),this.registerView(Oe,t=>(this.chatView=new Kn(t,this),this.chatView)),this.addRibbonIcon("bot","AI Assistant",()=>{this.activateView()}),this.registerCommands(),this.addSettingTab(new Ht(this.app,this)),this.checkSettings()}async onunload(){console.log("Unloading AI Assistant plugin"),this.app.workspace.detachLeavesOfType(Oe)}registerCommands(){this.addCommand({id:"open-ai-chat",name:"Open AI Assistant",callback:()=>{this.activateView()}}),this.addCommand({id:"send-note-to-ai",name:"Send Note to AI",editorCallback:async()=>{await this.activateView(),await this.noteController.getActiveNoteContent()&&this.chatView&&await this.chatView.setInputAndSend("Please analyze and summarize this note.",!0)}}),this.addCommand({id:"ai-edit-selection",name:"AI Edit Selection",editorCallback:async()=>{let t=this.noteController.getSelection();if(!t){new Jn.Notice("Please select some text first");return}await this.activateView(),this.chatView&&await this.chatView.setInputAndSend(`Please improve or edit the following selected text:

"${t}"`,!1)}}),this.addCommand({id:"ai-generate-mermaid",name:"Generate Mermaid Diagram",editorCallback:async()=>{await this.activateView(),this.chatView&&await this.chatView.setInputAndSend("Based on the content of this note, create a Mermaid diagram that visualizes the key concepts or relationships.",!0)}}),this.addCommand({id:"ai-fix-grammar",name:"AI Fix Grammar",editorCallback:async()=>{await this.activateView(),this.chatView&&await this.chatView.setInputAndSend("Please fix any grammar and spelling errors in this note while preserving the original meaning and formatting.",!0)}}),this.addCommand({id:"ai-expand-content",name:"AI Expand Content",editorCallback:async()=>{let t=this.noteController.getSelection();await this.activateView(),this.chatView&&(t?await this.chatView.setInputAndSend(`Please expand on the following selected text, adding more detail and context:

"${t}"`,!0):await this.chatView.setInputAndSend("Please expand on the main topics in this note, adding more detail and context where appropriate.",!0))}}),this.addCommand({id:"ai-clear-chat",name:"Clear AI Chat",callback:()=>{this.chatView&&this.chatView.clearChat()}})}async activateView(){let{workspace:t}=this.app,n=null,s=t.getLeavesOfType(Oe);s.length>0?n=s[0]:(n=t.getRightLeaf(!1),n&&await n.setViewState({type:Oe,active:!0})),n&&(t.revealLeaf(n),this.chatView&&this.chatView.focusInput())}async loadSettings(){this.settings=Object.assign({},Mo,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}reinitializeLLMService(){this.llmService.reinitialize(this.settings)}async testConnection(){let t=Zn(this.settings);return t.valid?(this.reinitializeLLMService(),await this.llmService.testConnection()):{success:!1,message:t.errors.join(", ")}}async testProviderConnection(t){return this.reinitializeLLMService(),await this.llmService.testProviderConnection(t)}checkSettings(){Zn(this.settings).valid}getChatView(){return this.chatView}getCurrentProviderName(){return this.llmService.getCurrentProviderName()}};
